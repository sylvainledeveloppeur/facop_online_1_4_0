<?php @session_start();require_once('../db_2_js.class.php');require_once('../../class/Bee.class.php');require_once('../../class/default.class.php');$Beclas->checkIns();if(!empty($_POST['nom'])AND!empty($_POST['nomen'])AND!empty($_POST['aut'])AND!empty($_POST['dur'])AND!empty($_POST['pg'])AND!empty($_POST['desc'])AND!empty($_POST['descen'])){$nbr_pseudo=$tams->prepare("SELECT COUNT(id_bk) nbr FROM book
		     WHERE titreFR_bk=:pse  ");$nbr_pseudo->execute(array('pse'=>$_POST['nom']));$chif_pse=$nbr_pseudo->fetch();if($chif_pse['nbr']==0){$allowed=array("jpg","jpeg","png");$allowed2=array("pdf");if(isset($_FILES['img'])&&$_FILES['img']['error']==0 AND isset($_FILES['img1'])&&$_FILES['img1']['error']==0 AND isset($_FILES['img2'])&&$_FILES['img2']['error']==0){$tatu=false;$extension=pathinfo($_FILES['img']['name'],PATHINFO_EXTENSION);$extension1=pathinfo($_FILES['img1']['name'],PATHINFO_EXTENSION);$extension2=pathinfo($_FILES['img2']['name'],PATHINFO_EXTENSION);if(in_array(strtolower($extension),$allowed)AND in_array(strtolower($extension1),$allowed2)AND in_array(strtolower($extension2),$allowed2)){$time=time();$Gimg=$time.'.'.$extension;$Pdf1=$time.'_fr.pdf';$Pdf2=$time.'_en.pdf';if(move_uploaded_file($_FILES['img']['tmp_name'],'../../../../source/img/book/'.$Gimg)AND move_uploaded_file($_FILES['img1']['tmp_name'],'../../../../source/pdf/book/'.$Pdf1)AND move_uploaded_file($_FILES['img2']['tmp_name'],'../../../../source/pdf/book/'.$Pdf2)){$tatu=true;}if($tatu){$req=$tams->prepare('INSERT INTO book (actif_bk, img_bk, titreFR_bk, titreEN_bk, descFR_bk, descEN_bk, pg_bk, duree_bk, auteur_bk, linkFR_bk, linkEN_bk, datephp_bk, datesql_bk ) 
                                                        VALUES (?,?,?,?,?,?,?,?,?,?,?,?,NOW()) ');$inser=$req->execute(array(0,$Gimg,$_POST['nom'],$_POST['nomen'],$_POST['desc'],$_POST['descen'],$_POST['pg'],$_POST['dur'],$_POST['aut'],$Pdf1,$Pdf2,$Beclas->phpDate()));if($inser){$Beclas->echoo1(1,"Successfully saved");$Beclas->notify($tams,$_SESSION['id_admin'],$_SESSION['pseu'],"A ajouter, le Livre: ",$_POST['nom']);}else{$Beclas->echoo1(0,"ERROR: contact the developper");$Beclas->notify($tams,$_SESSION['id_admin'],$_SESSION['pseu'],"(ERROR) A ajouter, le Livre: ",$_POST['nom']);}}else{$Beclas->echoo1(0,"ERROR: Impossible de télécharger les PDF");}}else{$Beclas->echoo1(0,"ERROR: Veuilez selectionner 1 image et 2 PDF");}}else{$Beclas->echoo1(2,"ERROR: fichier: ".$_FILES["img"]["error"]);}}else{$Beclas->echoo1(2,"INFO: élément déja enregistré, existant");}}else{$Beclas->echoo1(0,"ERROR: Veuillez completer correctement tous les champs");} ?>