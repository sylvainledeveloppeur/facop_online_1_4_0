/*
 * GoJS v3.0.14 JavaScript Library for HTML Diagrams, https://gojs.net
 * GoJS and Northwoods Software are registered trademarks of Northwoods Software Corporation, https://nwoods.com.
 * Copyright (C) 1998-2024 by Northwoods Software Corporation.  All Rights Reserved.
 * THIS SOFTWARE IS LICENSED.  THE LICENSE AGREEMENT IS AT: https://gojs.net/3.0.14/license.html.
 * DO NOT MODIFY THIS FILE.  DO NOT DISTRIBUTE A MODIFIED COPY OF THE CONTENTS OF THIS FILE.
 */
(function() {const root=typeof globalThis=="object"&&globalThis||typeof global=="object"&&global.global===global&&global||typeof self=="object"&&self.self===self&&self||{};root.requestAnimationFrame===void 0&&(root.setImmediate===void 0?root.requestAnimationFrame=w=>root.setTimeout(w,0):root.requestAnimationFrame=root.setImmediate);class Util{static or=root.navigator!==void 0&&root.navigator.platform!==void 0&&root.navigator.platform.match(/(iPhone|iPod|iPad|Mac)/i)!==null;static Nk(t,i,e){let s=-1;return function(){const n=this,o=arguments;s!==-1&&Util.Ig(s),s=Util.Oh(()=>{s=-1,e||t.apply(n,o)},i),e&&!s&&t.apply(n,o)}}static Oh(t,i){return root.setTimeout(t,i)}static Ig(t){root.clearTimeout(t)}static en(t){return root.document.createElement(t)}static o(t){throw new Error(t)}static T(t,i){let e="The object is frozen, so its properties cannot be set: "+t.toString();i!==void 0&&(e+="  to value: "+i),Util.o(e)}static WI(t,i,e,s){}static i(t,i,e,s){}static JI(t,i,e){}static $I(t,i,e){}static we(t,i,e,s){}static _(t,i,e,s){let n=Util.LD(e);s!==void 0&&(n+="."+s),Util.o(n+" is not in the range "+i+": "+t)}static ve(t){}static rr(t,i){}static ei(t){root.console&&root.console.log(t)}static wt(t){return typeof t=="object"&&t!==null}static ZI(t,i,e){}static su(t,i,e){Array.isArray(t)?i>=t.length?t.push(e):t.splice(i,0,e):Util.o("Cannot insert an object into an HTMLCollection or NodeList: "+e+" at "+i)}static tc(t,i){Array.isArray(t)?i>=t.length?t.pop():t.splice(i,1):Util.o("Cannot remove an object from an HTMLCollection or NodeList at "+i)}static Ck=[];static nt(){const t=Util.Ck.pop();return t===void 0?[]:t}static tt(t){t.length=0,Util.Ck.push(t)}static QI=Object.freeze([]);static LD(t){return t===null?"*":typeof t=="string"?t:typeof t=="function"?t.name:""}static sn(t){return typeof t=="function"?t.className?t.className:t.name:Util.wt(t)&&t.constructor?Util.sn(t.constructor):typeof t}static Ih(t,i){return i==null||i===""?null:Util.wt(t)&&i in t||t[i]?t[i]:null}static toString(t){let i=t;return Util.wt(t)&&(t.text?i=t.text:t.name?i=t.name:t.key!==void 0?i=t.key:t.id!==void 0?i=t.id:t.constructor===Object&&(t.Text?i=t.Text:t.Name?i=t.Name:t.Key!==void 0?i=t.Key:t.Id!==void 0?i=t.Id:t.ID!==void 0&&(i=t.ID))),i===void 0?"undefined":i===null?"null":i.toString()}static fw(t,i){if(t.hasOwnProperty(i))return!0;let e=Object.getPrototypeOf(t);for(;e&&e!==Function;){if(e.hasOwnProperty(i))return!0;const s=e._I;if(s&&s[i])return!0;e=Object.getPrototypeOf(e)}return!1}static AD(t){const i=[];let e=0;for(e=0;e<256;e++)i[e]=e;let s=0,n=0;for(e=0;e<256;e++)s=(s+i[e]+119)%256,n=i[e],i[e]=i[s],i[s]=n;e=0,s=0;let o="";for(let r=0;r<t.length;r++)e=(e+1)%256,s=(s+i[e])%256,n=i[e],i[e]=i[s],i[s]=n,o+=String.fromCharCode(t.charCodeAt(r)^i[(i[e]+i[s])%256]);return o}static TD(t){const i="0123456789abcdef",e=[];for(let r=0;r<256;r++)e[i.charAt(r>>4)+i.charAt(r&15)]=String.fromCharCode(r);t.length%2&&(t="0"+t);const s=[];let n=0;for(let r=0;r<t.length;r+=2)s[n++]=e[t.substring(r,r+2)];const o=s.join("");return o===""?"0":o}static Cs(t){return Util.AD(Util.TD(t))}static color1="@COLOR1";static color2="@COLOR2";static uw="32ab5ff3b26f42dc0ed90f21402913b5"}Util.vfo="29e646fdb262";class StringBuilder{Lk;constructor(){this.Lk=[]}toString(){return this.Lk.join("")}add(t){t!==""&&this.Lk.push(t)}}class PropertyCollection{}class EmptyIterator{w;constructor(){this.w=[]}[Symbol.iterator](){return this.w.values()}key;value;get iterator(){return this}reset(){}next(){return!1}hasNext(){return!1}first(){return null}any(){return!1}all(){return!0}each(){return this}map(t){return this}filter(){return this}get count(){return 0}dl(){}toString(){return"EmptyIterator"}static instance=new EmptyIterator}class SingletonIterator{constructor(t){this.key=-1,this.value=t}[Symbol.iterator](){return[this.value].values()}key;value;get iterator(){return this}reset(){this.key=-1}next(){return this.key===-1?(this.key=0,!0):!1}hasNext(){return this.next()}first(){return this.key=0,this.value}any(t){return this.key=-1,t(this.value)}all(t){return this.key=-1,t(this.value)}each(t){return this.key=-1,t(this.value),this}map(t){return new SingletonIterator(t(this.value))}filter(t){return t(this.value)?new SingletonIterator(this.value):EmptyIterator.instance}get count(){return 1}dl(){this.value=null}toString(){return"SingletonIterator("+this.value+")"}}class ListIterator{Wt;Ls;Gt;Dt;constructor(t){this.Wt=t,this.Ls=null,t.lr=null,this.Gt=t.ht,this.Dt=-1}[Symbol.iterator](){return this.Ls===null?this.Wt.r.values():this.Wt.r.filter(this.Ls).values()}key;value;get iterator(){return this}get predicate(){return this.Ls}set predicate(t){this.Ls=t}reset(){const t=this.Wt;t.lr=null,this.Gt=t.ht,this.Dt=-1}next(){const t=this.Wt;if(t.ht!==this.Gt){if(this.key<0)return!1;Util.ve(t)}const i=t.r,e=i.length;let s=++this.Dt;const n=this.Ls;if(n!==null)for(;s<e;){const o=i[s];if(n(o))return this.Dt=s,this.key=s,this.value=o,!0;s++}else{if(s<e)return this.key=s,this.value=i[s],!0;this.dl()}return!1}hasNext(){return this.next()}first(){const t=this.Wt;this.Gt=t.ht,this.Dt=0;const i=t.r,e=i.length,s=this.Ls;if(s!==null){let n=0;for(;n<e;){const o=i[n];if(s(o))return this.Dt=n,this.key=n,this.value=o,o;n++}return null}else if(e>0){const n=i[0];return this.key=0,this.value=n,n}else return null}any(t){const i=this.Wt;i.lr=null;const e=i.ht;this.Dt=-1;const s=i.r,n=s.length,o=this.Ls;for(let r=0;r<n;r++){const l=s[r];if(!(o!==null&&!o(l))){if(t(l))return!0;i.ht!==e&&Util.ve(i)}}return!1}all(t){const i=this.Wt;i.lr=null;const e=i.ht;this.Dt=-1;const s=i.r,n=s.length,o=this.Ls;for(let r=0;r<n;r++){const l=s[r];if(!(o!==null&&!o(l))){if(!t(l))return!1;i.ht!==e&&Util.ve(i)}}return!0}each(t){const i=this.Wt;i.lr=null;const e=i.ht;this.Dt=-1;const s=i.r,n=s.length,o=this.Ls;for(let r=0;r<n;r++){const l=s[r];o!==null&&!o(l)||(t(l),i.ht!==e&&Util.ve(i))}return this}map(t){const i=this.Wt;i.lr=null;const e=i.ht;this.Dt=-1;const s=[],n=i.r,o=n.length,r=this.Ls;for(let h=0;h<o;h++){const a=n[h];r!==null&&!r(a)||(s.push(t(a)),i.ht!==e&&Util.ve(i))}const l=new List;return l.r=s,l.Oe(),l.iterator}filter(t){const i=this.Wt;i.lr=null;const e=i.ht;this.Dt=-1;const s=[],n=i.r,o=n.length,r=this.Ls;for(let h=0;h<o;h++){const a=n[h];r!==null&&!r(a)||(t(a)&&s.push(a),i.ht!==e&&Util.ve(i))}const l=new List;return l.r=s,l.Oe(),l.iterator}get count(){const t=this.Ls;if(t!==null){let i=0;const e=this.Wt.r,s=e.length;for(let n=0;n<s;n++)t(e[n])&&i++;return i}else return this.Wt.r.length}dl(){this.key=-1,this.value=null,this.Gt=-1,this.Ls=null,this.Wt.lr=this}toString(){return"ListIterator@"+this.Dt+"/"+this.Wt.count}}class ListIteratorBackwards{Wt;Gt;Dt;constructor(t){this.Wt=t,t.hr=null,this.Gt=t.ht,this.Dt=t.r.length}[Symbol.iterator](){return this.Wt.r.reverse().values()}key;value;get iterator(){return this}reset(){const t=this.Wt;t.hr=null,this.Gt=t.ht,this.Dt=t.r.length}next(){const t=this.Wt;if(t.ht!==this.Gt){if(this.key<0)return!1;Util.ve(t)}const i=--this.Dt;return i>=0?(this.key=i,this.value=t.r[i],!0):(this.dl(),!1)}hasNext(){return this.next()}first(){const t=this.Wt;this.Gt=t.ht;const i=t.r,e=i.length-1;if(this.Dt=e,e>=0){const s=i[e];return this.key=e,this.value=s,s}else return null}any(t){const i=this.Wt;i.hr=null;const e=i.ht,s=i.r,n=s.length;this.Dt=n;for(let o=n-1;o>=0;o--){const r=s[o];if(t(r))return!0;i.ht!==e&&Util.ve(i)}return!1}all(t){const i=this.Wt;i.hr=null;const e=i.ht,s=i.r,n=s.length;this.Dt=n;for(let o=n-1;o>=0;o--){const r=s[o];if(!t(r))return!1;i.ht!==e&&Util.ve(i)}return!0}each(t){const i=this.Wt;i.hr=null;const e=i.ht,s=i.r,n=s.length;this.Dt=n;for(let o=n-1;o>=0;o--){const r=s[o];t(r),i.ht!==e&&Util.ve(i)}return this}map(t){const i=this.Wt;i.hr=null;const e=i.ht,s=[],n=i.r,o=n.length;this.Dt=o;for(let l=o-1;l>=0;l--){const h=n[l];s.push(t(h)),i.ht!==e&&Util.ve(i)}const r=new List;return r.r=s,r.Oe(),r.iterator}filter(t){const i=this.Wt;i.hr=null;const e=i.ht,s=[],n=i.r,o=n.length;this.Dt=o;for(let l=o-1;l>=0;l--){const h=n[l];t(h)&&s.push(h),i.ht!==e&&Util.ve(i)}const r=new List;return r.r=s,r.Oe(),r.iterator}get count(){return this.Wt.r.length}dl(){this.key=-1,this.value=null,this.Gt=-1,this.Wt.hr=this}toString(){return"ListIteratorBackwards("+this.Dt+"/"+this.Wt.count+")"}}class List{h;r;ht;lr;hr;constructor(t){GSet.ji(this),this.h=!1,this.r=[],this.ht=0,this.lr=null,this.hr=null,t!==void 0&&this.addAll(t)}[Symbol.iterator](){return this.r.values()}Oe(){let t=this.ht;t++,t>999999999&&(t=0),this.ht=t}g(){return this.h=!0,this}ot(){return this.h=!1,this}toString(){return"List()#"+GSet.as(this)}add(t){return this.h&&Util.T(this,t),this.r.push(t),this.Oe(),this}push(t){this.add(t)}addAll(t){if(t===null)return this;this.h&&Util.T(this);const i=this.r;if(Array.isArray(t)){const e=t.length;for(let s=0;s<e;s++){const n=t[s];i.push(n)}}else{const e=t.iterator;for(;e.next();){const s=e.value;i.push(s)}}return this.Oe(),this}clear(){this.h&&Util.T(this),this.r.length=0,this.Oe()}contains(t){return this.has(t)}has(t){return t===null?!1:this.r.indexOf(t)!==-1}indexOf(t){return t===null?-1:this.r.indexOf(t)}elt(t){const i=this.r;return(t<0||t>=i.length)&&Util._(t,"0 <= i < length",List,"elt:i"),i[t]}get(t){return this.elt(t)}setElt(t,i){const e=this.r;(t<0||t>=e.length)&&Util._(t,"0 <= i < length",List,"setElt:i"),this.h&&Util.T(this,t),e[t]=i}set(t,i){this.setElt(t,i)}first(){const t=this.r;return t.length===0?null:t[0]}last(){const t=this.r,i=t.length;return i>0?t[i-1]:null}pop(){this.h&&Util.T(this);const t=this.r;return t.length>0?t.pop():null}any(t){const i=this.r,e=this.ht,s=i.length;for(let n=0;n<s;n++){if(t(i[n]))return!0;this.ht!==e&&Util.ve(this)}return!1}all(t){const i=this.r,e=this.ht,s=i.length;for(let n=0;n<s;n++){if(!t(i[n]))return!1;this.ht!==e&&Util.ve(this)}return!0}each(t){const i=this.r,e=this.ht,s=i.length;for(let n=0;n<s;n++)t(i[n]),this.ht!==e&&Util.ve(this);return this}map(t){const i=new List,e=[],s=this.r,n=this.ht,o=s.length;for(let r=0;r<o;r++)e.push(t(s[r])),this.ht!==n&&Util.ve(this);return i.r=e,i.Oe(),i}filter(t){const i=new List,e=[],s=this.r,n=this.ht,o=s.length;for(let r=0;r<o;r++){const l=s[r];t(l)&&e.push(l),this.ht!==n&&Util.ve(this)}return i.r=e,i.Oe(),i}insertAt(t,i){t<0&&Util._(t,">= 0",List,"insertAt:i"),this.h&&Util.T(this,t);const e=this.r;t>=e.length?e.push(i):e.splice(t,0,i),this.Oe()}remove(t){return this.delete(t)}delete(t){if(t===null)return!1;this.h&&Util.T(this,t);const i=this.r,e=i.indexOf(t);return e===-1?!1:(e===i.length-1?i.pop():i.splice(e,1),this.Oe(),!0)}removeAt(t){const i=this.r;(t<0||t>=i.length)&&Util._(t,"0 <= i < length",List,"removeAt:i"),this.h&&Util.T(this,t),t===i.length-1?i.pop():i.splice(t,1),this.Oe()}removeRange(t,i){const e=this.r,s=e.length;if(t<0)t=0;else if(t>=s)return this;if(i<0)return this;if(i>=s&&(i=s-1),t>i)return this;this.h&&Util.T(this);let n=t,o=i+1;for(;o<s;)e[n++]=e[o++];return e.length=s-(i-t+1),this.Oe(),this}copy(){const t=new List,i=this.r;return i.length>0&&(t.r=Array.prototype.slice.call(i)),t}toArray(){const t=this.r,i=this.count,e=new Array(i);for(let s=0;s<i;s++)e[s]=t[s];return e}get JN(){return this.r}toSet(){const t=new GSet,i=this.r,e=this.count;for(let s=0;s<e;s++)t.add(i[s]);return t}sort(t){return this.h&&Util.T(this),this.r.sort(t),this.Oe(),this}sortRange(t,i,e){const s=this.r,n=s.length;i===void 0&&(i=0),e===void 0&&(e=n),this.h&&Util.T(this);const o=e-i;if(o<=1)return this;if((i<0||i>=n-1)&&Util._(i,"0 <= from < length",List,"sortRange:from"),o===2){const r=s[i],l=s[i+1];return t(r,l)>0&&(s[i]=l,s[i+1]=r,this.Oe()),this}if(i===0)if(e>=n)s.sort(t);else{const r=s.slice(0,e);r.sort(t);for(let l=0;l<e;l++)s[l]=r[l]}else if(e>=n){const r=s.slice(i);r.sort(t);for(let l=i;l<n;l++)s[l]=r[l-i]}else{const r=s.slice(i,e);r.sort(t);for(let l=i;l<e;l++)s[l]=r[l-i]}return this.Oe(),this}reverse(){return this.h&&Util.T(this),this.r.reverse(),this.Oe(),this}get count(){return this.r.length}get size(){return this.r.length}get length(){return this.r.length}get iterator(){if(this.r.length<=0)return EmptyIterator.instance;const t=this.lr;return t!==null?(t.reset(),t):new ListIterator(this)}get iteratorBackwards(){if(this.r.length<=0)return EmptyIterator.instance;const t=this.hr;return t!==null?(t.reset(),t):new ListIteratorBackwards(this)}}class SetIterator{ko;si;constructor(t){this.ko=t,this.si=t.w.values()}[Symbol.iterator](){return this.ko.w.values()}key;value;get iterator(){return this}reset(){const t=this.ko;this.si=t.w.values()}next(){const t=this.si.next();return this.value=t.value,this.key=t.value,!t.done}hasNext(){return this.next()}first(){return this.ko.w.size===0?null:(this.si=this.ko.w.values(),this.si.next().value)}any(t){return this.ko.any(t)}all(t){return this.ko.all(t)}each(t){return this.ko.each(t),this}map(t){const i=new List;return this.ko.w.forEach(e=>i.add(t(e))),i.iterator}filter(t){const i=new List;return this.ko.w.forEach(e=>{t(e)&&i.add(e)}),i.iterator}get count(){return this.ko.count}dl(){this.key=null,this.value=null,this.si=null}toString(){return"SetIterator"}}class GSet{h;w;constructor(t){this.h=!1,this.w=new Set,t!==void 0&&this.addAll(t)}[Symbol.iterator](){return this.w.values()}values(){return this.w.values()}g(){return this.h=!0,this}ot(){return this.h=!1,this}toString(){return"Set()#"+GSet.as(this)}add(t){return t===null?this:(this.w.add(t),this)}addAll(t){if(t===null)return this;if(Array.isArray(t)){const i=t.length;for(let e=0;e<i;e++){const s=t[e];s!==null&&this.w.add(s)}}else{const i=t.iterator;for(;i.next();){const e=i.value;e!==null&&this.w.add(e)}}return this}has(t){return this.w.has(t)}contains(t){return this.has(t)}containsAll(t){if(t===null)return!0;const i=t.iterator;for(;i.next();)if(!this.has(i.value))return!1;return!0}containsAny(t){if(t===null)return!0;const i=t.iterator;for(;i.next();)if(this.has(i.value))return!0;return!1}first(){return this.w.size===0?null:this.w.values().next().value}any(t){for(const i of this.w)if(t(i))return!0;return!1}all(t){for(const i of this.w)if(!t(i))return!1;return!0}each(t){for(const i of this.w)t(i);return this}map(t){const i=new GSet;for(const e of this.w)i.add(t(e));return i}filter(t){const i=new GSet;for(const e of this.w)t(e)&&i.add(e);return i}delete(t){return this.h&&Util.T(this),this.w.delete(t)}remove(t){return this.delete(t)}removeAll(t){if(t===null)return this;if(this.h&&Util.T(this),Array.isArray(t)){const i=t.length;for(let e=0;e<i;e++)this.delete(t[e])}else{const i=t.iterator;for(;i.next();)this.delete(i.value)}return this}retainAll(t){if(t===null)return this;if(this.count===0)return this;this.h&&Util.T(this);const i=new GSet;i.addAll(t);const e=[],s=this.iterator;for(;s.next();){const n=s.value;i.has(n)||e.push(n)}return this.removeAll(e),this}clear(){this.h&&Util.T(this),this.w.clear()}copy(){const t=new GSet;return this.w.forEach(i=>t.add(i)),t}toArray(){return Array.from(this.w)}toList(){const t=new List;return this.w.forEach(i=>t.add(i)),t}get count(){return this.w.size}get size(){return this.w.size}get iterator(){return this.w.size<=0?EmptyIterator.instance:new SetIterator(this)}entries(){return this.w.entries()}keys(){return this.w.keys()}forEach(t,i){return this.w.forEach(t,i)}static Eg=1;static ji(t){t.__gohashid=GSet.Eg++}static as(t){return t.__gohashid}}class MapKeySetIterator{Z;si;constructor(t){this.Z=t,this.si=t.w.keys()}[Symbol.iterator](){return this.Z.w.keys()}key;value;get iterator(){return this}reset(){const t=this.Z;this.si=t.w.keys()}next(){const t=this.si.next();return this.value=t.value,this.key=t.value,!t.done}hasNext(){return this.next()}first(){return this.Z.w.size===0?null:(this.si=this.Z.w.keys(),this.si.next().value)}any(t){for(const i of this.Z.w)if(t(i[0]))return!0;return!1}all(t){for(const i of this.Z.w)if(!t(i[0]))return!1;return!0}each(t){for(const i of this.Z.w)t(i[0]);return this}map(t){const i=this.Z,e=new List;for(const s of i.w)e.add(t(s[0]));return e.iterator}filter(t){const i=this.Z,e=new List;for(const s of i.w){const n=s[0];t(n)&&e.add(n)}return e.iterator}get count(){return this.Z.size}dl(){this.key=null,this.value=null,this.si=null}toString(){return"MapKeySetIterator"}}class MapKeySet extends GSet{Z;constructor(t){super(),GSet.ji(this),this.h=!0,this.Z=t}[Symbol.iterator](){return this.w.keys()}values(){return this.w.keys()}g(){return this}ot(){return this}toString(){return"MapKeySet("+this.Z.toString()+")"}add(t){Util.o("This Set is read-only: "+this.toString())}has(t){return this.Z.has(t)}contains(t){return this.has(t)}delete(t){Util.o("This Set is read-only: "+this.toString())}remove(t){return this.delete(t)}clear(){Util.o("This Set is read-only: "+this.toString())}first(){return this.Z.w.size===0?null:this.Z.w.keys().next().value}any(t){for(const i of this.Z.w)if(t(i[0]))return!0;return!1}all(t){for(const i of this.Z.w)if(!t(i[0]))return!1;return!0}each(t){for(const i of this.Z.w)t(i[0]);return this}map(t){const i=new GSet;for(const e of this.Z.w)i.add(t(e[0]));return i}filter(t){const i=new GSet;for(const e of this.Z.w){const s=e[0];t(s)&&i.add(s)}return i}copy(){return new MapKeySet(this.Z)}toSet(){const t=new GSet,i=this.Z.w;for(const e of i)t.add(e[0]);return t}toArray(){const t=this.Z.w,i=new Array(t.size);let e=0;for(const s of t)i[e]=s[0],e++;return i}toList(){const t=new List,i=this.Z.w;for(const e of i)t.add(e[0]);return t}get count(){return this.Z.size}get size(){return this.Z.size}get iterator(){return this.Z.size<=0?EmptyIterator.instance:new MapKeySetIterator(this.Z)}}class MapValueSetIterator{Z;si;constructor(t){this.Z=t,this.si=t.w.values()}[Symbol.iterator](){return this.Z.w.values()}key;value;get iterator(){return this}reset(){const t=this.Z;this.si=t.w.values()}next(){const t=this.si.next();return this.value=t.value,this.key=t.value,!t.done}hasNext(){return this.next()}first(){return this.Z.w.size===0?null:(this.si=this.Z.w.values(),this.si.next().value)}any(t){for(const i of this.Z.w)if(t(i[1]))return!0;return!1}all(t){for(const i of this.Z.w)if(!t(i[1]))return!1;return!0}each(t){for(const i of this.Z.w)t(i[1]);return this}map(t){const i=this.Z,e=new List;for(const s of i.w)e.add(t(s[1]));return e.iterator}filter(t){const i=this.Z,e=new List;for(const s of i.w){const n=s[1];t(n)&&e.add(n)}return e.iterator}get count(){return this.Z.size}dl(){this.key=null,this.value=null,this.si=null}toString(){return"MapValueSetIterator"}}class KeyValuePair{constructor(t,i){this.key=t,this.value=i}toString(){return"{"+this.key+":"+this.value+"}"}key;value}class MapIterator{Z;si;constructor(t){this.Z=t,this.si=t.w.entries()}[Symbol.iterator](){return this.Z.w.entries()}key;value;get iterator(){return this}reset(){const t=this.Z;this.si=t.w.entries()}next(){const t=this.si.next();return t.done?(this.key=null,this.value=null,!1):(this.key=t.value[0],this.value=t.value[1],!0)}hasNext(){return this.next()}first(){if(this.Z.w.size===0)return null;this.si=this.Z.w.entries();const t=this.si.next().value;return this.key=t[0],this.value=t[1],new KeyValuePair(t[0],t[1])}any(t){return this.Z.any(t)}all(t){return this.Z.all(t)}each(t){return this.Z.each(t),this}map(t){const i=new List;let e=null;return this.Z.w.forEach((s,n)=>{e===null?e=new KeyValuePair(n,s):(e.key=n,e.value=s),i.add(t(e))}),i.iterator}filter(t){const i=new List;let e=null;return this.Z.w.forEach((s,n)=>{e===null?e=new KeyValuePair(n,s):(e.key=n,e.value=s),t(e)&&(i.add(e),e=null)}),i.iterator}get count(){return this.Z.size}dl(){this.key=null,this.value=null,this.si=null}toString(){return"MapIterator"}}class GMap{h;w;constructor(t){GSet.ji(this),this.h=!1,this.w=new Map,t!==void 0&&this.addAll(t)}[Symbol.iterator](){return this.w.entries()}entries(){return this.w.entries()}g(){return this.h=!0,this}ot(){return this.h=!1,this}toString(){return"Map()#"+GSet.as(this)}set(t,i){return this.h&&Util.T(this,t),this.w.set(t,i),this}add(t,i){return this.set(t,i)}addAll(t){if(t===null)return this;if(this.h&&Util.T(this),Array.isArray(t)){const i=t.length;for(let e=0;e<i;e++){const s=t[e];this.set(s.key,s.value)}}else if(t instanceof GMap){const i=t.iterator;for(;i.next();)this.set(i.key,i.value)}else{const i=t.iterator;for(;i.next();){const e=i.value;this.set(e.key,e.value)}}return this}first(){if(this.w.size===0)return null;const t=this.w.entries().next().value;return new KeyValuePair(t[0],t[1])}any(t){let i=null;for(const[e,s]of this.w)if(i===null?i=new KeyValuePair(e,s):(i.key=e,i.value=s),t(i))return!0;return!1}all(t){let i=null;for(const[e,s]of this.w)if(i===null?i=new KeyValuePair(e,s):(i.key=e,i.value=s),!t(i))return!1;return!0}each(t){let i=null;for(const[e,s]of this.w)i===null?i=new KeyValuePair(e,s):(i.key=e,i.value=s),t(i);return this}map(t){const i=new GMap;let e=null;for(const[s,n]of this.w)e===null?e=new KeyValuePair(s,n):(e.key=s,e.value=n),i.set(s,t(e));return i}filter(t){const i=new GMap;let e=null;for(const[s,n]of this.w)e===null?e=new KeyValuePair(s,n):(e.key=s,e.value=n),t(e)&&i.set(s,n);return i}has(t){return this.w.has(t)}contains(t){return this.has(t)}get(t){const i=this.w.get(t);return i===void 0?null:i}getValue(t){return this.get(t)}delete(t){return t===null?!1:(this.h&&Util.T(this,t),this.w.delete(t))}remove(t){return this.delete(t)}clear(){this.h&&Util.T(this),this.w.clear()}copy(){const t=new GMap;return t.w=new Map(this.w),t}toArray(){const t=this.w,i=new Array(t.size);let e=0;for(const s of t)i[e]=new KeyValuePair(s[0],s[1]),e++;return i}toKeySet(){return new MapKeySet(this)}get count(){return this.w.size}get size(){return this.w.size}get iterator(){return this.w.size<=0?EmptyIterator.instance:new MapIterator(this)}get iteratorKeys(){return this.count<=0?EmptyIterator.instance:new MapKeySetIterator(this)}keys(){return this.w.keys()}get iteratorValues(){return this.count<=0?EmptyIterator.instance:new MapValueSetIterator(this)}values(){return this.w.values()}forEach(t,i){return this.w.forEach(t,i)}}class Point{b;k;h;constructor(t,i){t===void 0?(this.b=0,this.k=0):typeof t=="number"&&typeof i=="number"?(this.b=t,this.k=i):Util.o("Invalid arguments to Point constructor: "+t+", "+i),this.h=!1}a(t){return this.b=t.b,this.k=t.k,this}e(t,i){return this.b=t,this.k=i,this}setTo(t,i){return this.b=t,this.k=i,this}set(t){return this.b=t.b,this.k=t.k,this}copy(){const t=new Point;return t.b=this.b,t.k=this.k,t}it(){return this.h=!0,Object.freeze(this),this}N(){return this.h||Object.isFrozen(this)?this:this.copy().g()}g(){return this.h=!0,this}ot(){return Object.isFrozen(this)&&Util.o("cannot thaw constant: "+this),this.h=!1,this}dw(t){}static parse(t){if(typeof t=="string"){const i=t.split(" ");let e=0,s=0;for(;i[e]==="";)e++;let n=i[e++];n&&(s=parseFloat(n));let o=0;for(;i[e]==="";)e++;return n=i[e++],n&&(o=parseFloat(n)),new Point(s,o)}else return new Point}static stringify(t){return t.x.toString()+" "+t.y.toString()}static stringifyFixed(t){return Util.i(t,"number",Point,"stringifyFixed:digits"),i=>i.x.toFixed(t)+" "+i.y.toFixed(t)}toString(){return"Point("+this.x+","+this.y+")"}equals(t){return t instanceof Point?this.b===t.x&&this.k===t.y:!1}equalTo(t,i){return this.b===t&&this.k===i}equalsApprox(t){return Geo.u(this.b,t.x)&&Geo.u(this.k,t.y)}add(t){return this.b+=t.x,this.k+=t.y,this}subtract(t){return this.b-=t.x,this.k-=t.y,this}offset(t,i){return this.b+=t,this.k+=i,this}rotate(t){if(t===0)return this;const i=this.b,e=this.k;if(i===0&&e===0)return this;let s=0,n=0;if(t>=360?t-=360:t<0&&(t+=360),t===90)s=0,n=1;else if(t===180)s=-1,n=0;else if(t===270)s=0,n=-1;else{const o=t*Math.PI/180;s=Math.cos(o),n=Math.sin(o)}return this.b=s*i-n*e,this.k=n*i+s*e,this}scale(t,i){return this.b*=t,this.k*=i,this}distanceSquaredPoint(t){const i=t.x-this.b,e=t.y-this.k;return i*i+e*e}distanceSquared(t,i){const e=t-this.b,s=i-this.k;return e*e+s*s}normalize(){const t=this.b,i=this.k,e=Math.sqrt(t*t+i*i);return e>0&&(this.b=t/e,this.k=i/e),this}directionPoint(t){return this.$N(t.x-this.b,t.y-this.k)}direction(t,i){return this.$N(t-this.b,i-this.k)}$N(t,i){if(t===0)return i>0?90:i<0?270:0;if(i===0)return t>0?0:180;{if(isNaN(t)||isNaN(i))return 0;let e=Math.atan(Math.abs(i/t))*180/Math.PI;return t<0?i<0?e+=180:e=180-e:i<0&&(e=360-e),e}}static compareWithLineSegment(t,i,e,s,n,o){return Geo.nu(t,i,e,s,n,o)}compareWithLineSegmentPoint(t,i){return Geo.nu(t.x,t.y,i.x,i.y,this.x,this.y)}static intersectingLineSegments(t,i,e,s,n,o,r,l){return Geo.ou(t,i,e,s,n,o,r,l)}projectOntoLineSegment(t,i,e,s){return Geo.gl(t,i,e,s,this.b,this.k,this),this}projectOntoLineSegmentPoint(t,i){return Geo.gl(t.x,t.y,i.x,i.y,this.b,this.k,this),this}snapToGrid(t,i,e,s){return Geo.Bg(this.b,this.k,t,i,e,s,this),this}snapToGridPoint(t,i){return Geo.Bg(this.b,this.k,t.x,t.y,i.width,i.height,this),this}setRectSpot(t,i){return this.b=t.x+i.x*t.width+i.offsetX,this.k=t.y+i.y*t.height+i.offsetY,this}setSpot(t,i,e,s,n){return this.b=t+n.x*e+n.offsetX,this.k=i+n.y*s+n.offsetY,this}D(t){return t.xt(this),this}Ie(t){return t.ts(this),this}static distanceLineSegmentSquared(t,i,e,s,n,o){let r=n-e,l=o-s;const h=r*r+l*l,a=e-t,c=s-i,f=-a*r-c*l;if(f<=0||f>=h)return r=n-t,l=o-i,Math.min(a*a+c*c,r*r+l*l);{const u=r*c-l*a;return u*u/h}}static distanceSquared(t,i,e,s){const n=e-t,o=s-i;return n*n+o*o}static direction(t,i,e,s){const n=e-t,o=s-i;if(n===0)return o>0?90:o<0?270:0;if(o===0)return n>0?0:180;{if(isNaN(n)||isNaN(o))return 0;let r=Math.atan(Math.abs(o/n))*180/Math.PI;return n<0?o<0?r+=180:r=180-r:o<0&&(r=360-r),r}}get x(){return this.b}set x(t){this.b=t}get y(){return this.k}set y(t){this.k=t}isReal(){return isFinite(this.x)&&isFinite(this.y)}static Po=new Point(0,0).it();static ZN=new Point(-1/0,-1/0).it();static QN=new Point(1/0,1/0).it();static _N=new Point(6,6).it();static Ak=new Point(NaN,NaN).it();static Tk=[];static l(){const t=Point.Tk.pop();return t===void 0?new Point:t}static X(t,i){const e=Point.Tk.pop();return e===void 0?new Point(t,i):(e.x=t,e.y=i,e)}static s(t){Point.Tk.push(t)}}class Size{j;H;h;constructor(t,i){t===void 0?(this.j=0,this.H=0):typeof t=="number"&&(t>=0||isNaN(t))&&typeof i=="number"&&(i>=0||isNaN(i))?(this.j=t,this.H=i):Util.o("Invalid arguments to Size constructor: "+t+", "+i),this.h=!1}a(t){return this.j=t.j,this.H=t.H,this}e(t,i){return this.j=t,this.H=i,this}setTo(t,i){return this.j=t,this.H=i,this}set(t){return this.j=t.j,this.H=t.H,this}copy(){const t=new Size;return t.j=this.j,t.H=this.H,t}it(){return this.h=!0,Object.freeze(this),this}N(){return this.h||Object.isFrozen(this)?this:this.copy().g()}g(){return this.h=!0,this}ot(){return Object.isFrozen(this)&&Util.o("cannot thaw constant: "+this),this.h=!1,this}dw(t){}static parse(t){if(typeof t=="string"){const i=t.split(" ");let e=0,s=0;for(;i[e]==="";)e++;let n=i[e++];n&&(s=parseFloat(n));let o=0;for(;i[e]==="";)e++;return n=i[e++],n&&(o=parseFloat(n)),new Size(s,o)}else return new Size}static stringify(t){return t.width.toString()+" "+t.height.toString()}static stringifyFixed(t){return Util.i(t,"number",Size,"stringifyFixed:digits"),i=>i.width.toFixed(t)+" "+i.height.toFixed(t)}toString(){return"Size("+this.width+","+this.height+")"}equals(t){return t instanceof Size?this.j===t.width&&this.H===t.height:!1}equalTo(t,i){return this.j===t&&this.H===i}equalsApprox(t){return Geo.u(this.j,t.width)&&Geo.u(this.H,t.height)}inflate(t,i){const e=this.width+t;this.j=e>=0?e:0;const s=this.height+i;return this.H=s>=0?s:0,this}get width(){return this.j}set width(t){t<0&&Util._(t,">= 0",Size,"width"),this.j=t}get height(){return this.H}set height(t){t<0&&Util._(t,">= 0",Size,"height"),this.H=t}isReal(){return isFinite(this.width)&&isFinite(this.height)}static ru=new Size(0,0).it();static Dk=new Size(1,1).it();static tC=new Size(6,6).it();static lu=new Size(8,8).it();static iC=new Size(10,10).it();static eC=new Size(1/0,1/0).it();static gw=new Size(NaN,NaN).it();static sC=[];static l(){const t=Size.sC.pop();return t===void 0?new Size:t}static s(t){Size.sC.push(t)}}class Rect{b;k;j;H;h;constructor(t,i,e,s){if(t===void 0)this.b=0,this.k=0,this.j=0,this.H=0;else if(typeof t=="number"&&typeof i=="number"&&typeof e=="number"&&(e>=0||isNaN(e))&&typeof s=="number"&&(s>=0||isNaN(s)))this.b=t,this.k=i,this.j=e,this.H=s;else if(t instanceof Point){const n=t.x,o=t.y;if(i instanceof Point){const r=i.x,l=i.y;this.b=Math.min(n,r),this.k=Math.min(o,l),this.j=Math.abs(n-r),this.H=Math.abs(o-l)}else i instanceof Size?(this.b=n,this.k=o,this.j=i.width,this.H=i.height):Util.o("Incorrect second argument supplied to Rect constructor "+i)}else Util.o("Invalid arguments to Rect constructor: "+t+", "+i+", "+e+", "+s);this.h=!1}a(t){return this.b=t.b,this.k=t.k,this.j=t.j,this.H=t.H,this}e(t,i,e,s){return this.b=t,this.k=i,this.j=e,this.H=s,this}En(t,i){return this.j=t,this.H=i,this}setTo(t,i,e,s){return this.b=t,this.k=i,this.j=e,this.H=s,this}set(t){return this.b=t.b,this.k=t.k,this.j=t.j,this.H=t.H,this}setPoint(t){return this.b=t.x,this.k=t.y,this}setSize(t){return this.j=t.width,this.H=t.height,this}copy(){const t=new Rect;return t.b=this.b,t.k=this.k,t.j=this.j,t.H=this.H,t}it(){return this.h=!0,Object.freeze(this),this}N(){return this.h||Object.isFrozen(this)?this:this.copy().g()}g(){return this.h=!0,this}ot(){return Object.isFrozen(this)&&Util.o("cannot thaw constant: "+this),this.h=!1,this}dw(t){}static parse(t){if(typeof t=="string"){const i=t.split(" ");let e=0,s=0;for(;i[e]==="";)e++;let n=i[e++];n&&(s=parseFloat(n));let o=0;for(;i[e]==="";)e++;n=i[e++],n&&(o=parseFloat(n));let r=0;for(;i[e]==="";)e++;n=i[e++],n&&(r=parseFloat(n));let l=0;for(;i[e]==="";)e++;return n=i[e++],n&&(l=parseFloat(n)),new Rect(s,o,r,l)}else return new Rect}static stringify(t){return t.x.toString()+" "+t.y.toString()+" "+t.width.toString()+" "+t.height.toString()}static stringifyFixed(t){return Util.i(t,"number",Rect,"stringifyFixed:digits"),i=>i.x.toFixed(t)+" "+i.y.toFixed(t)+" "+i.width.toFixed(t)+" "+i.height.toFixed(t)}toString(){return"Rect("+this.x+","+this.y+","+this.width+","+this.height+")"}equals(t){return t instanceof Rect?this.b===t.x&&this.k===t.y&&this.j===t.width&&this.H===t.height:!1}equalTo(t,i,e,s){return this.b===t&&this.k===i&&this.j===e&&this.H===s}equalsApprox(t){return Geo.u(this.b,t.x)&&Geo.u(this.k,t.y)&&Geo.u(this.j,t.width)&&Geo.u(this.H,t.height)}equalsApproxTo(t,i,e,s){return Geo.u(this.b,t)&&Geo.u(this.k,i)&&Geo.u(this.j,e)&&Geo.u(this.H,s)}equalsApproxClose(t){return Geo.K(this.b,t.x)&&Geo.K(this.k,t.y)&&Geo.K(this.j,t.width)&&Geo.K(this.H,t.height)}containsPoint(t){return this.b<=t.x&&this.b+this.j>=t.x&&this.k<=t.y&&this.k+this.H>=t.y}containsRect(t){return this.b<=t.x&&t.x+t.width<=this.b+this.j&&this.k<=t.y&&t.y+t.height<=this.k+this.H}contains(t,i,e,s){return e===void 0&&(e=0),s===void 0&&(s=0),this.b<=t&&t+e<=this.b+this.j&&this.k<=i&&i+s<=this.k+this.H}offset(t,i){return this.b+=t,this.k+=i,this}inflate(t,i){return this.mw(i,t,i,t)}addMargin(t){return this.mw(t.top,t.right,t.bottom,t.left)}subtractMargin(t){return this.mw(-t.top,-t.right,-t.bottom,-t.left)}grow(t,i,e,s){return this.mw(t,i,e,s)}mw(t,i,e,s){const n=this.j;i+s<=-n?(this.b+=n/2,this.j=0):(this.b-=s,this.j+=i+s);const o=this.H;return t+e<=-o?(this.k+=o/2,this.H=0):(this.k-=t,this.H+=t+e),this}intersectRect(t){return this.nC(t.x,t.y,t.width,t.height)}intersect(t,i,e,s){return this.nC(t,i,e,s)}nC(t,i,e,s){const n=Math.max(this.b,t),o=Math.max(this.k,i),r=Math.min(this.b+this.j,t+e),l=Math.min(this.k+this.H,i+s);return this.b=n,this.k=o,this.j=Math.max(0,r-n),this.H=Math.max(0,l-o),this}intersectsRect(t){return this.intersects(t.x,t.y,t.width,t.height)}intersects(t,i,e,s){let n=this.j;const o=this.b;if(n!==1/0&&e!==1/0&&(n+=o,e+=t,isNaN(e)||isNaN(n)||o>e||t>n))return!1;let r=this.H;const l=this.k;return!(r!==1/0&&s!==1/0&&(r+=l,s+=i,isNaN(s)||isNaN(r)||l>s||i>r))}intersectsRectPlus(t,i){let e=this.j,s=t.width+i+i;const n=this.b,o=t.x-i;if(e+=n,s+=o,n>s||o>e)return!1;let r=this.H,l=t.height+i+i;const h=this.k,a=t.y-i;return r+=h,l+=a,!(h>l||a>r)}unionPoint(t){return this.unionNoCheck(t.x,t.y,0,0)}unionRect(t){return this.unionNoCheck(t.b,t.k,t.j,t.H)}union(t,i,e,s){return e===void 0&&(e=0),s===void 0&&(s=0),this.unionNoCheck(t,i,e,s)}unionNoCheck(t,i,e,s){const n=Math.min(this.b,t),o=Math.min(this.k,i),r=Math.max(this.b+this.j,t+e),l=Math.max(this.k+this.H,i+s);return this.b=n,this.k=o,this.j=r-n,this.H=l-o,this}setSpot(t,i,e){return this.b=t-e.offsetX-e.x*this.j,this.k=i-e.offsetY-e.y*this.H,this}static contains(t,i,e,s,n,o,r,l){return r===void 0&&(r=0),l===void 0&&(l=0),t<=n&&n+r<=t+e&&i<=o&&o+l<=i+s}static intersects(t,i,e,s,n,o,r,l){let h=e,a=r;const c=t,f=n;if(h+=c,a+=f,c>a||f>h)return!1;let u=s,d=l;const m=i,g=o;return u+=m,d+=g,!(m>d||g>u)}static intersectsLineSegment(t,i,e,s,n,o,r,l){return Geo.oC(t,i,e,s,n,o,r,l)}get x(){return this.b}set x(t){this.b=t}get y(){return this.k}set y(t){this.k=t}get width(){return this.j}set width(t){t<0&&Util._(t,">= 0",Rect,"width"),this.j=t}get height(){return this.H}set height(t){t<0&&Util._(t,">= 0",Rect,"height"),this.H=t}get left(){return this.b}set left(t){this.b=t}get top(){return this.k}set top(t){this.k=t}get right(){return this.b+this.j}set right(t){this.b+=t-(this.b+this.j)}get bottom(){return this.k+this.H}set bottom(t){this.k+=t-(this.k+this.H)}get position(){return new Point(this.b,this.k)}set position(t){this.b=t.x,this.k=t.y}get size(){return new Size(this.j,this.H)}set size(t){this.j=t.width,this.H=t.height}get center(){return new Point(this.b+this.j/2,this.k+this.H/2)}set center(t){this.b=t.x-this.j/2,this.k=t.y-this.H/2}get centerX(){return this.b+this.j/2}set centerX(t){this.b=t-this.j/2}get centerY(){return this.k+this.H/2}set centerY(t){this.k=t-this.H/2}isReal(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.width)&&isFinite(this.height)}isEmpty(){return this.width===0&&this.height===0}static pw=new Rect(0,0,0,0).it();static DD=new Rect(NaN,NaN,NaN,NaN).it();static Fk=[];static l(){const t=Rect.Fk.pop();return t===void 0?new Rect:t}static X(t,i,e,s){const n=Rect.Fk.pop();return n===void 0?new Rect(t,i,e,s):n.e(t,i,e,s)}static s(t){Rect.Fk.push(t)}}class Margin{nn;on;rn;ln;h;constructor(t,i,e,s){t===void 0?(this.nn=0,this.on=0,this.rn=0,this.ln=0):i===void 0?(i=t,e=t,s=t,this.top=t,this.right=i,this.bottom=e,this.left=s):e===void 0?(e=t,s=i,this.top=t,this.right=i,this.bottom=e,this.left=s):s!==void 0?(this.top=t,this.right=i,this.bottom=e,this.left=s):Util.o("Invalid arguments to Margin constructor: "+t+", "+i+", "+e+", "+s),this.h=!1}a(t){return this.nn=t.nn,this.on=t.on,this.rn=t.rn,this.ln=t.ln,this}setTo(t,i,e,s){return this.nn=t,this.on=i,this.rn=e,this.ln=s,this}set(t){return this.nn=t.nn,this.on=t.on,this.rn=t.rn,this.ln=t.ln,this}copy(){const t=new Margin;return t.nn=this.nn,t.on=this.on,t.rn=this.rn,t.ln=this.ln,t}it(){return this.h=!0,Object.freeze(this),this}N(){return this.h||Object.isFrozen(this)?this:this.copy().g()}g(){return this.h=!0,this}ot(){return Object.isFrozen(this)&&Util.o("cannot thaw constant: "+this),this.h=!1,this}dw(t){}static parse(t){if(typeof t=="string"){const i=t.split(" ");let e=0,s=NaN;for(;i[e]==="";)e++;let n=i[e++];if(n&&(s=parseFloat(n)),isNaN(s))return new Margin;let o=NaN;for(;i[e]==="";)e++;if(n=i[e++],n&&(o=parseFloat(n)),isNaN(o))return new Margin(s);let r=NaN;for(;i[e]==="";)e++;if(n=i[e++],n&&(r=parseFloat(n)),isNaN(r))return new Margin(s,o);let l=NaN;for(;i[e]==="";)e++;return n=i[e++],n&&(l=parseFloat(n)),isNaN(l)?new Margin(s,o):new Margin(s,o,r,l)}else return new Margin}static stringify(t){return t.top.toString()+" "+t.right.toString()+" "+t.bottom.toString()+" "+t.left.toString()}static stringifyFixed(t){return Util.i(t,"number",Margin,"stringifyFixed:digits"),i=>i.top.toFixed(t)+" "+i.right.toFixed(t)+" "+i.bottom.toFixed(t)+" "+i.left.toFixed(t)}toString(){return"Margin("+this.top+","+this.right+","+this.bottom+","+this.left+")"}equals(t){return t instanceof Margin?this.nn===t.top&&this.on===t.right&&this.rn===t.bottom&&this.ln===t.left:!1}equalTo(t,i,e,s){return this.nn===t&&this.on===i&&this.rn===e&&this.ln===s}equalsApprox(t){return Geo.u(this.nn,t.top)&&Geo.u(this.on,t.right)&&Geo.u(this.rn,t.bottom)&&Geo.u(this.ln,t.left)}get top(){return this.nn}set top(t){this.nn=t}get right(){return this.on}set right(t){this.on=t}get bottom(){return this.rn}set bottom(t){this.rn=t}get left(){return this.ln}set left(t){this.ln=t}isReal(){return isFinite(this.top)&&isFinite(this.right)&&isFinite(this.bottom)&&isFinite(this.left)}static Ug=new Margin(0,0,0,0).it();static rC=new Margin(2,2,2,2).it();static lC=[];static l(){const t=Margin.lC.pop();return t===void 0?new Margin:t}static s(t){Margin.lC.push(t)}}class Spot{b;k;As;Ts;h;constructor(t,i,e,s){t===void 0?(this.b=0,this.k=0,this.As=0,this.Ts=0):(i===void 0&&(i=0),e===void 0&&(e=0),s===void 0&&(s=0),this.x=t,this.y=i,this.offsetX=e,this.offsetY=s),this.h=!1}a(t){return this.b=t.b,this.k=t.k,this.As=t.As,this.Ts=t.Ts,this}setTo(t,i,e,s){return this.b=t,this.k=i,this.As=e,this.Ts=s,this}set(t){return this.b=t.b,this.k=t.k,this.As=t.As,this.Ts=t.Ts,this}copy(){const t=new Spot;return t.b=this.b,t.k=this.k,t.As=this.As,t.Ts=this.Ts,t}it(){return this.h=!0,Object.freeze(this),this}N(){return this.h||Object.isFrozen(this)?this:this.copy().g()}g(){return this.h=!0,this}ot(){return Object.isFrozen(this)&&Util.o("cannot thaw constant: "+this),this.h=!1,this}dw(t){}Ee(t){return this.b=NaN,this.k=NaN,this.As=t,this}tE(t,i){(isNaN(t)||t>1||t<0)&&Util._(t,"0 <= "+i+" <= 1",Spot,i)}iE(t,i){(isNaN(t)||t===1/0||t===-1/0)&&Util._(t,"real number, not NaN or Infinity",Spot,i)}static parse(t){if(typeof t=="string"){if(t=t.trim(),t==="None")return Spot.None;if(t==="TopLeft")return Spot.TopLeft;if(t==="Top"||t==="TopCenter"||t==="MiddleTop")return Spot.TopCenter;if(t==="TopRight")return Spot.TopRight;if(t==="Left"||t==="LeftCenter"||t==="MiddleLeft")return Spot.LeftCenter;if(t==="Center")return Spot.Center;if(t==="Right"||t==="RightCenter"||t==="MiddleRight")return Spot.RightCenter;if(t==="BottomLeft")return Spot.BottomLeft;if(t==="Bottom"||t==="BottomCenter"||t==="MiddleBottom")return Spot.BottomCenter;if(t==="BottomRight")return Spot.BottomRight;if(t==="TopSide")return Spot.TopSide;if(t==="LeftSide")return Spot.LeftSide;if(t==="RightSide")return Spot.RightSide;if(t==="BottomSide")return Spot.BottomSide;if(t==="TopBottomSides")return Spot.TopBottomSides;if(t==="LeftRightSides")return Spot.LeftRightSides;if(t==="TopLeftSides")return Spot.TopLeftSides;if(t==="TopRightSides")return Spot.TopRightSides;if(t==="BottomLeftSides")return Spot.BottomLeftSides;if(t==="BottomRightSides")return Spot.BottomRightSides;if(t==="NotTopSide")return Spot.NotTopSide;if(t==="NotLeftSide")return Spot.NotLeftSide;if(t==="NotRightSide")return Spot.NotRightSide;if(t==="NotBottomSide")return Spot.NotBottomSide;if(t==="AllSides")return Spot.AllSides;if(t==="Default")return Spot.Default;const i=t.split(" ");let e=0,s=0;for(;i[e]==="";)e++;let n=i[e++];n!==void 0&&n.length>0&&(s=parseFloat(n));let o=0;for(;i[e]==="";)e++;n=i[e++],n!==void 0&&n.length>0&&(o=parseFloat(n));let r=0;for(;i[e]==="";)e++;n=i[e++],n!==void 0&&n.length>0&&(r=parseFloat(n));let l=0;for(;i[e]==="";)e++;return n=i[e++],n!==void 0&&n.length>0&&(l=parseFloat(n)),new Spot(s,o,r,l)}else return new Spot}static stringify(t){return t.isSpot()?t.x.toString()+" "+t.y.toString()+" "+t.offsetX.toString()+" "+t.offsetY.toString():t.toString()}static stringifyFixed(t){return Util.i(t,"number",Spot,"stringifyFixed:digits"),i=>i.x.toFixed(t)+" "+i.y.toFixed(t)+" "+i.offsetX.toFixed(t)+" "+i.offsetY.toFixed(t)}toString(){return this.isSpot()?this.As===0&&this.Ts===0?"Spot("+this.x+","+this.y+")":"Spot("+this.x+","+this.y+","+this.offsetX+","+this.offsetY+")":this.equals(Spot.None)?"None":this.equals(Spot.TopLeft)?"TopLeft":this.equals(Spot.TopCenter)?"Top":this.equals(Spot.TopRight)?"TopRight":this.equals(Spot.LeftCenter)?"Left":this.equals(Spot.Center)?"Center":this.equals(Spot.RightCenter)?"Right":this.equals(Spot.BottomLeft)?"BottomLeft":this.equals(Spot.BottomCenter)?"Bottom":this.equals(Spot.BottomRight)?"BottomRight":this.equals(Spot.TopSide)?"TopSide":this.equals(Spot.LeftSide)?"LeftSide":this.equals(Spot.RightSide)?"RightSide":this.equals(Spot.BottomSide)?"BottomSide":this.equals(Spot.TopBottomSides)?"TopBottomSides":this.equals(Spot.LeftRightSides)?"LeftRightSides":this.equals(Spot.TopLeftSides)?"TopLeftSides":this.equals(Spot.TopRightSides)?"TopRightSides":this.equals(Spot.BottomLeftSides)?"BottomLeftSides":this.equals(Spot.BottomRightSides)?"BottomRightSides":this.equals(Spot.NotTopSide)?"NotTopSide":this.equals(Spot.NotLeftSide)?"NotLeftSide":this.equals(Spot.NotRightSide)?"NotRightSide":this.equals(Spot.NotBottomSide)?"NotBottomSide":this.equals(Spot.AllSides)?"AllSides":this.equals(Spot.Default)?"Default":"None"}equals(t){return t instanceof Spot?(this.b===t.x||isNaN(this.b)&&isNaN(t.x))&&(this.k===t.y||isNaN(this.k)&&isNaN(t.y))&&this.As===t.offsetX&&this.Ts===t.offsetY:!1}opposite(){return new Spot(.5-(this.b-.5),.5-(this.k-.5),-this.As,-this.Ts)}includesSide(t){if(!this.isSide())return!1;if(!t.isSide())if(t.equals(Spot.Left))t=Spot.LeftSide;else if(t.equals(Spot.Right))t=Spot.RightSide;else if(t.equals(Spot.Top))t=Spot.TopSide;else if(t.equals(Spot.Bottom))t=Spot.BottomSide;else return!1;const i=this.Ts,e=t.offsetY;return(i&e)===e}get x(){return this.b}set x(t){this.b=t}get y(){return this.k}set y(t){this.k=t}get offsetX(){return this.As}set offsetX(t){this.As=t}get offsetY(){return this.Ts}set offsetY(t){this.Ts=t}isSpot(){return!isNaN(this.x)&&!isNaN(this.y)}isNoSpot(){return isNaN(this.x)||isNaN(this.y)}isSide(){return isNaN(this.x)&&isNaN(this.y)&&this.offsetX===1&&this.offsetY!==0}isNone(){return isNaN(this.x)&&isNaN(this.y)&&this.offsetX===0&&this.offsetY===0}isDefault(){return isNaN(this.x)&&isNaN(this.y)&&this.offsetX===-1&&this.offsetY===0}static None=new Spot(0,0,0,0).Ee(0).it();static Default=new Spot(0,0,-1,0).Ee(-1).it();static TopLeft=new Spot(0,0,0,0).it();static TopCenter=new Spot(.5,0,0,0).it();static TopRight=new Spot(1,0,0,0).it();static LeftCenter=new Spot(0,.5,0,0).it();static Center=new Spot(.5,.5,0,0).it();static RightCenter=new Spot(1,.5,0,0).it();static BottomLeft=new Spot(0,1,0,0).it();static BottomCenter=new Spot(.5,1,0,0).it();static BottomRight=new Spot(1,1,0,0).it();static MiddleTop=Spot.TopCenter;static MiddleLeft=Spot.LeftCenter;static MiddleRight=Spot.RightCenter;static MiddleBottom=Spot.BottomCenter;static Top=Spot.TopCenter;static Left=Spot.LeftCenter;static Right=Spot.RightCenter;static Bottom=Spot.BottomCenter;static TopSide=new Spot(0,0,1,1).Ee(1).it();static LeftSide=new Spot(0,0,1,2).Ee(1).it();static RightSide=new Spot(0,0,1,4).Ee(1).it();static BottomSide=new Spot(0,0,1,8).Ee(1).it();static TopBottomSides=new Spot(0,0,1,9).Ee(1).it();static LeftRightSides=new Spot(0,0,1,6).Ee(1).it();static TopLeftSides=new Spot(0,0,1,3).Ee(1).it();static TopRightSides=new Spot(0,0,1,5).Ee(1).it();static BottomLeftSides=new Spot(0,0,1,10).Ee(1).it();static BottomRightSides=new Spot(0,0,1,12).Ee(1).it();static NotTopSide=new Spot(0,0,1,14).Ee(1).it();static NotLeftSide=new Spot(0,0,1,13).Ee(1).it();static NotRightSide=new Spot(0,0,1,11).Ee(1).it();static NotBottomSide=new Spot(0,0,1,7).Ee(1).it();static AllSides=new Spot(0,0,1,15).Ee(1).it();static Rk=new Spot(.156,.156).it();static vk=new Spot(.844,.844).it();static hC=[];static l(){const t=Spot.hC.pop();return t===void 0?new Spot:t}static s(t){Spot.hC.push(t)}}class Transform{m11;m12;m21;m22;dx;dy;constructor(){this.m11=1,this.m12=0,this.m21=0,this.m22=1,this.dx=0,this.dy=0}set(t){return this.m11=t.m11,this.m12=t.m12,this.m21=t.m21,this.m22=t.m22,this.dx=t.dx,this.dy=t.dy,this}setTo(t,i,e,s,n,o){return this.m11=t,this.m12=i,this.m21=e,this.m22=s,this.dx=n,this.dy=o,this}copy(){const t=new Transform;return t.m11=this.m11,t.m12=this.m12,t.m21=this.m21,t.m22=this.m22,t.dx=this.dx,t.dy=this.dy,t}toString(){return"Transform("+this.m11+","+this.m12+","+this.m21+","+this.m22+","+this.dx+","+this.dy+")"}equals(t){return this.m11===t.m11&&this.m12===t.m12&&this.m21===t.m21&&this.m22===t.m22&&this.dx===t.dx&&this.dy===t.dy}Ok(){return this.dx===0&&this.dy===0&&this.m11===1&&this.m12===0&&this.m21===0&&this.m22===1}vi(){return this.m11=1,this.m12=0,this.m21=0,this.m22=1,this.dx=0,this.dy=0,this}ic(t){const i=this.m11*t.m11+this.m21*t.m12,e=this.m12*t.m11+this.m22*t.m12,s=this.m11*t.m21+this.m21*t.m22,n=this.m12*t.m21+this.m22*t.m22;return this.dx=this.m11*t.dx+this.m21*t.dy+this.dx,this.dy=this.m12*t.dx+this.m22*t.dy+this.dy,this.m11=i,this.m12=e,this.m21=s,this.m22=n,this}aC(t){const i=1/(t.m11*t.m22-t.m12*t.m21),e=t.m22*i,s=-t.m12*i,n=-t.m21*i,o=t.m11*i,r=i*(t.m21*t.dy-t.m22*t.dx),l=i*(t.m12*t.dx-t.m11*t.dy),h=this.m11*e+this.m21*s,a=this.m12*e+this.m22*s,c=this.m11*n+this.m21*o,f=this.m12*n+this.m22*o;return this.dx=this.m11*r+this.m21*l+this.dx,this.dy=this.m12*r+this.m22*l+this.dy,this.m11=h,this.m12=a,this.m21=c,this.m22=f,this}yw(){const t=1/(this.m11*this.m22-this.m12*this.m21),i=this.m22*t,e=-this.m12*t,s=-this.m21*t,n=this.m11*t,o=t*(this.m21*this.dy-this.m22*this.dx),r=t*(this.m12*this.dx-this.m11*this.dy);return this.m11=i,this.m12=e,this.m21=s,this.m22=n,this.dx=o,this.dy=r,this}cs(t,i,e){if(t>=360?t-=360:t<0&&(t+=360),t===0)return this;this.Ds(i,e);let s=0,n=0;if(t===90)s=0,n=1;else if(t===180)s=-1,n=0;else if(t===270)s=0,n=-1;else{const a=t*Math.PI/180;s=Math.cos(a),n=Math.sin(a)}const o=this.m11*s+this.m21*n,r=this.m12*s+this.m22*n,l=this.m11*-n+this.m21*s,h=this.m12*-n+this.m22*s;return this.m11=o,this.m12=r,this.m21=l,this.m22=h,this.Ds(-i,-e),this}Ds(t,i){return this.dx+=this.m11*t+this.m21*i,this.dy+=this.m12*t+this.m22*i,this}et(t,i){return i===void 0&&(i=t),this.m11*=t,this.m12*=t,this.m21*=i,this.m22*=i,this}FD(){if(this.m11===1&&this.m12===0)return 0;let t=Math.atan2(this.m12,this.m11)*180/Math.PI;return t<0&&(t+=360),t}xt(t){const i=t.x,e=t.y;return t.e(i*this.m11+e*this.m21+this.dx,i*this.m12+e*this.m22+this.dy)}ts(t){const i=1/(this.m11*this.m22-this.m12*this.m21),e=this.m22*i,s=-this.m12*i,n=-this.m21*i,o=this.m11*i,r=t.x-this.dx,l=t.y-this.dy;return t.e(r*e+l*n,r*s+l*o)}ww(t){const i=1/(this.m11*this.m22-this.m12*this.m21),e=this.m22*i,s=-this.m12*i,n=-this.m21*i,o=this.m11*i,r=i*(this.m21*this.dy-this.m22*this.dx),l=i*(this.m12*this.dx-this.m11*this.dy),h=t.x*1.25,a=t.y*1.2;return t.e(h*e+a*n+r,h*s+a*o+l)}Vg(t){const i=t.x,e=t.y,s=i+t.width,n=e+t.height,o=this.m11,r=this.m12,l=this.m21,h=this.m22,a=this.dx,c=this.dy,f=i*o+e*l+a,u=i*r+e*h+c,d=s*o+e*l+a,m=s*r+e*h+c,g=i*o+n*l+a,p=i*r+n*h+c,y=s*o+n*l+a,x=s*r+n*h+c;let k=f,b=f,P=u,M=u;return k=Math.min(k,d),b=Math.max(b,d),P=Math.min(P,m),M=Math.max(M,m),k=Math.min(k,g),b=Math.max(b,g),P=Math.min(P,p),M=Math.max(M,p),k=Math.min(k,y),b=Math.max(b,y),P=Math.min(P,x),M=Math.max(M,x),t.e(k,P,b-k,M-P),t}static cC=[];static l(){const t=Transform.cC.pop();return t===void 0?new Transform:t}static s(t){Transform.cC.push(t)}static Ik="54a702f3e53909c447824c6706603faf4c"}const Geo={RD:"7da71ca0ad381e90",Bn:4*((Math.sqrt(2)-1)/3),fC:null,xw:w=>{if(w<=0)return 0;let t=Geo.fC;if(t===null){t=[];for(let i=0;i<=2e3;i++)t[i]=Math.sqrt(i);Geo.fC=t}if(w<1){const i=1/w;return i<=2e3?1/t[i|0]:Math.sqrt(w)}else return w<=2e3?t[w|0]:Math.sqrt(w)},u:(w,t)=>{const i=w-t;return i<.5&&i>-.5},K:(w,t)=>{const i=w-t;return i<5e-8&&i>-5e-8},Oi:(w,t,i,e,s,n,o)=>{s<=0&&(s=1e-6);let r=0,l=0,h=0,a=0;if(w<i?(l=w,r=i):(l=i,r=w),t<e?(a=t,h=e):(a=e,h=t),w===i)return a<=o&&o<=h&&w-s<=n&&n<=w+s;if(t===e)return l<=n&&n<=r&&t-s<=o&&o<=t+s;const c=r+s,f=l-s;if(f<=n&&n<=c){const u=h+s,d=a-s;if(d<=o&&o<=u)if(c-f>u-d)if(w-i>s||i-w>s){const g=(e-t)/(i-w)*(n-w)+t;if(g-s<=o&&o<=g+s)return!0}else return!0;else if(t-e>s||e-t>s){const g=(i-w)/(e-t)*(o-t)+w;if(g-s<=n&&n<=g+s)return!0}else return!0}return!1},bw:(w,t,i,e,s,n,o,r,l,h,a,c)=>{if(!Geo.Oi(w,t,o,r,c,i,e)||!Geo.Oi(w,t,o,r,c,s,n)){const f=(w+i)/2,u=(t+e)/2,d=(i+s)/2,m=(e+n)/2,g=(s+o)/2,p=(n+r)/2,y=(f+d)/2,x=(u+m)/2,k=(d+g)/2,b=(m+p)/2,P=(y+k)/2,M=(x+b)/2;return Geo.bw(w,t,f,u,y,x,P,M,l,h,a,c)||Geo.bw(P,M,k,b,g,p,o,r,l,h,a,c)}else return Geo.Oi(w,t,o,r,c,h,a)},uC:(w,t,i,e,s,n,o,r,l)=>{const h=(w+i)/2,a=(t+e)/2,c=(i+s)/2,f=(e+n)/2,u=(s+o)/2,d=(n+r)/2,m=(h+c)/2,g=(a+f)/2,p=(c+u)/2,y=(f+d)/2;return l.e((m+p)/2,(g+y)/2),l},vD:(w,t,i,e,s,n,o,r)=>{const l=(w+i)/2,h=(t+e)/2,a=(i+s)/2,c=(e+n)/2,f=(s+o)/2,u=(n+r)/2,d=(l+a)/2,m=(h+c)/2,g=(a+f)/2,p=(c+u)/2;return Point.direction(d,m,g,p)},hu:(w,t,i,e,s,n,o,r,l,h)=>{if(!Geo.Oi(w,t,o,r,l,i,e)||!Geo.Oi(w,t,o,r,l,s,n)){const a=(w+i)/2,c=(t+e)/2,f=(i+s)/2,u=(e+n)/2,d=(s+o)/2,m=(n+r)/2,g=(a+f)/2,p=(c+u)/2,y=(f+d)/2,x=(u+m)/2,k=(g+y)/2,b=(p+x)/2;Geo.hu(w,t,a,c,g,p,k,b,l,h),Geo.hu(k,b,y,x,d,m,o,r,l,h)}else h.unionNoCheck(w,t,0,0),h.unionNoCheck(o,r,0,0);return h},Un:(w,t,i,e,s,n,o,r,l,h)=>{if(!Geo.Oi(w,t,o,r,l,i,e)||!Geo.Oi(w,t,o,r,l,s,n)){const a=(w+i)/2,c=(t+e)/2,f=(i+s)/2,u=(e+n)/2,d=(s+o)/2,m=(n+r)/2,g=(a+f)/2,p=(c+u)/2,y=(f+d)/2,x=(u+m)/2,k=(g+y)/2,b=(p+x)/2;Geo.Un(w,t,a,c,g,p,k,b,l,h),Geo.Un(k,b,y,x,d,m,o,r,l,h)}else h.length===0&&(h.push(w),h.push(t)),h.push(o),h.push(r);return h},Ek:(w,t,i,e,s,n,o,r,l,h)=>{if(Geo.Oi(w,t,s,n,h,i,e))return Geo.Oi(w,t,s,n,h,r,l);{const a=(w+i)/2,c=(t+e)/2,f=(i+s)/2,u=(e+n)/2,d=(a+f)/2,m=(c+u)/2;return Geo.Ek(w,t,a,c,d,m,o,r,l,h)||Geo.Ek(d,m,f,u,s,n,o,r,l,h)}},eE:(w,t,i,e,s,n,o)=>{const r=(w+i)/2,l=(t+e)/2,h=(i+s)/2,a=(e+n)/2;return o.e((r+h)/2,(l+a)/2),o},Bk:(w,t,i,e,s,n,o,r)=>{if(Geo.Oi(w,t,s,n,o,i,e))r.unionNoCheck(w,t,0,0),r.unionNoCheck(s,n,0,0);else{const l=(w+i)/2,h=(t+e)/2,a=(i+s)/2,c=(e+n)/2,f=(l+a)/2,u=(h+c)/2;Geo.Bk(w,t,l,h,f,u,o,r),Geo.Bk(f,u,a,c,s,n,o,r)}return r},zg:(w,t,i,e,s,n,o,r)=>{if(Geo.Oi(w,t,s,n,o,i,e))r.length===0&&(r.push(w),r.push(t)),r.push(s),r.push(n);else{const l=(w+i)/2,h=(t+e)/2,a=(i+s)/2,c=(e+n)/2,f=(l+a)/2,u=(h+c)/2;Geo.zg(w,t,l,h,f,u,o,r),Geo.zg(f,u,a,c,s,n,o,r)}return r},Xg:(w,t,i,e,s,n,o,r,l,h,a,c,f,u)=>{if(!Geo.Oi(w,t,o,r,f,i,e)||!Geo.Oi(w,t,o,r,f,s,n)){const d=(w+i)/2,m=(t+e)/2,g=(i+s)/2,p=(e+n)/2,y=(s+o)/2,x=(n+r)/2,k=(d+g)/2,b=(m+p)/2,P=(g+y)/2,M=(p+x)/2,L=(k+P)/2,C=(b+M)/2;let S=1/0,N=!1,T=0,A=0;if(Geo.Xg(w,t,d,m,k,b,L,C,l,h,a,c,f,u)){const D=(u.x-l)*(u.x-l)+(u.y-h)*(u.y-h);D<S&&(S=D,N=!0,T=u.x,A=u.y)}if(Geo.Xg(L,C,P,M,y,x,o,r,l,h,a,c,f,u)){const D=(u.x-l)*(u.x-l)+(u.y-h)*(u.y-h);D<S&&(S=D,N=!0,T=u.x,A=u.y)}return N&&(u.x=T,u.y=A),N}else{if(!Geo.ou(w,t,o,r,l,h,a,c))return!1;const d=(w-o)*(h-c)-(t-r)*(l-a);if(d===0)return!1;const m=((w*r-t*o)*(l-a)-(w-o)*(l*c-h*a))/d,g=((w*r-t*o)*(h-c)-(t-r)*(l*c-h*a))/d;return u.e(m,g),!0}},Kg:(w,t,i,e,s,n,o,r,l,h,a,c,f)=>{let u=0;if(!Geo.Oi(w,t,o,r,f,i,e)||!Geo.Oi(w,t,o,r,f,s,n)){const d=(w+i)/2,m=(t+e)/2,g=(i+s)/2,p=(e+n)/2,y=(s+o)/2,x=(n+r)/2,k=(d+g)/2,b=(m+p)/2,P=(g+y)/2,M=(p+x)/2,L=(k+P)/2,C=(b+M)/2;u+=Geo.Kg(w,t,d,m,k,b,L,C,l,h,a,c,f),u+=Geo.Kg(L,C,P,M,y,x,o,r,l,h,a,c,f)}else{const d=(w-o)*(h-c)-(t-r)*(l-a);if(d===0)return u;const m=((w*r-t*o)*(l-a)-(w-o)*(l*c-h*a))/d,g=((w*r-t*o)*(h-c)-(t-r)*(l*c-h*a))/d;if(m>=a)return u;let p=0,y=0;if((l>a?l-a:a-l)<(h>c?h-c:c-h)){if(t<r?(p=t,y=r):(p=r,y=t),g<p||g>y)return u}else if(w<o?(p=w,y=o):(p=o,y=w),m<p||m>y)return u;d>0?u++:d<0&&u--}return u},gl:(w,t,i,e,s,n,o)=>{if(Geo.K(w,i)){let r=0,l=0;t<e?(r=t,l=e):(r=e,l=t);const h=n;return h<r?(o.e(w,r),!1):h>l?(o.e(w,l),!1):(o.e(w,h),!0)}else if(Geo.K(t,e)){let r=0,l=0;w<i?(r=w,l=i):(r=i,l=w);const h=s;return h<r?(o.e(r,t),!1):h>l?(o.e(l,t),!1):(o.e(h,t),!0)}else{const r=(i-w)*(i-w)+(e-t)*(e-t),l=((w-s)*(w-i)+(t-n)*(t-e))/r;if(l<-5e-6)return o.e(w,t),!1;if(l>1.000005)return o.e(i,e),!1;{const h=w+l*(i-w),a=t+l*(e-t);return o.e(h,a),!0}}},Vn:(w,t,i,e,s,n,o,r,l)=>{if(Geo.u(w,i)&&Geo.u(t,e))return l.e(w,t),!1;if(Geo.K(s,o)){if(Geo.K(w,i))return Geo.gl(w,t,i,e,s,n,l),!1;{const a=(e-t)/(i-w)*(s-w)+t;return Geo.gl(w,t,i,e,s,a,l)}}else{const h=(r-n)/(o-s);if(Geo.K(w,i)){const a=h*(w-s)+n;let c=0,f=0;return t<e?(c=t,f=e):(c=e,f=t),a<c?(l.e(w,c),!1):a>f?(l.e(w,f),!1):(l.e(w,a),!0)}else{const a=(e-t)/(i-w);if(Geo.K(h,a))return Geo.gl(w,t,i,e,s,n,l),!1;{const c=(a*w-h*s+n-t)/(a-h);if(Geo.K(a,0)){let f=0,u=0;return w<i?(f=w,u=i):(f=i,u=w),c<f?(l.e(f,t),!1):c>u?(l.e(u,t),!1):(l.e(c,t),!0)}else{const f=a*(c-w)+t;return Geo.gl(w,t,i,e,c,f,l)}}}}},sE:(w,t,i,e,s)=>Geo.Vn(i.x,i.y,e.x,e.y,w.x,w.y,t.x,t.y,s),nE:(w,t,i,e,s,n,o,r,l,h)=>{let a=1/0;function c(P,M){const L=(P-w)*(P-w)+(M-t)*(M-t);L<a&&(a=L,l.e(P,M))}c(l.x,l.y);let f=0,u=0,d=0,m=0;s<o?(f=s,u=o):(f=o,u=s),n<r?(d=s,m=o):(d=o,m=s);const g=u-f,p=m-d,y=g/2+h,x=p/2+h,k=(s+o)/2,b=(n+r)/2;if(y===0||x===0)return l;if((i>w?i-w:w-i)<.5){const P=1-(i-k)*(i-k)/(y*y);if(P<0)return l;const M=Math.sqrt(P),L=x*M+b,C=-x*M+b;c(i,L),c(i,C)}else{const P=(e-t)/(i-w),M=1/(y*y)+P*P/(x*x),L=2*P*(t-P*w)/(x*x)-2*P*b/(x*x)-2*k/(y*y),C=2*P*w*b/(x*x)-2*t*b/(x*x)+b*b/(x*x)+k*k/(y*y)-1+(t-P*w)*(t-P*w)/(x*x),S=L*L-4*M*C;if(S<0)return l;const N=Math.sqrt(S),T=(-L+N)/(2*M);c(T,P*T-P*w+t);const A=(-L-N)/(2*M);c(A,P*A-P*w+t)}return l},ml:(w,t,i,e,s,n,o,r,l)=>{let h=1e21,a=w,c=t;if(Geo.Vn(w,t,w,e,s,n,o,r,l)){const f=(l.x-s)*(l.x-s)+(l.y-n)*(l.y-n);f<h&&(h=f,a=l.x,c=l.y)}if(Geo.Vn(i,t,i,e,s,n,o,r,l)){const f=(l.x-s)*(l.x-s)+(l.y-n)*(l.y-n);f<h&&(h=f,a=l.x,c=l.y)}if(Geo.Vn(w,t,i,t,s,n,o,r,l)){const f=(l.x-s)*(l.x-s)+(l.y-n)*(l.y-n);f<h&&(h=f,a=l.x,c=l.y)}if(Geo.Vn(w,e,i,e,s,n,o,r,l)){const f=(l.x-s)*(l.x-s)+(l.y-n)*(l.y-n);f<h&&(h=f,a=l.x,c=l.y)}return l.e(a,c),h<1e21},kw:(w,t,i)=>Geo.oC(w.x,w.y,w.width,w.height,t.x,t.y,i.x,i.y),oC:(w,t,i,e,s,n,o,r)=>{const l=w,h=w+i,a=t,c=t+e;if(s===o){let f=0,u=0;return n<r?(f=n,u=r):(f=r,u=n),l<=s&&s<=h&&f<=c&&u>=a}if(n===r){let f=0,u=0;return s<o?(f=s,u=o):(f=o,u=s),a<=n&&n<=c&&f<=h&&u>=l}return!!(Rect.contains(w,t,i,e,s,n)||Rect.contains(w,t,i,e,o,r)||Geo.ou(l,a,h,a,s,n,o,r)||Geo.ou(h,a,h,c,s,n,o,r)||Geo.ou(h,c,l,c,s,n,o,r)||Geo.ou(l,c,l,a,s,n,o,r))},ou:(w,t,i,e,s,n,o,r)=>w===i&&t===e&&s===o&&n===r?w===s&&t===n:Geo.nu(w,t,i,e,s,n)*Geo.nu(w,t,i,e,o,r)<=0&&Geo.nu(s,n,o,r,w,t)*Geo.nu(s,n,o,r,i,e)<=0,nu:(w,t,i,e,s,n)=>{const o=i-w,r=e-t;let l=s-w,h=n-t,a=l*r-h*o;return a===0&&(a=l*o+h*r,a>0&&(l-=o,h-=r,a=l*o+h*r,a<0&&(a=0))),a},Yg:w=>(w<0&&(w+=360),w>=360&&(w-=360),w),dC:(w,t,i,e,s,n)=>{const o=Math.PI;n||(e=e*(o/180),s=s*(o/180));const r=e>s?-1:1,l=1e-5,h=o*2,a=[],c=o/2;let f=e,u=Math.min(h,Math.abs(s-e));if(u<l){const d=f+r*Math.min(u,c),m=w+i*Math.cos(f),g=t+i*Math.sin(f),p=w+i*Math.cos(d),y=t+i*Math.sin(d),x=(m+p)/2,k=(g+y)/2;return a.push([m,g,x,k,x,k,p,y]),a}for(;u>l;){const d=f+r*Math.min(u,c);a.push(Geo.OD(i,f,d,w,t)),u-=Math.abs(d-f),f=d}return a},OD:(w,t,i,e,s)=>{const n=(i-t)/2,o=w*Math.cos(n),r=w*Math.sin(n),l=o,h=-r,a=l*l+h*h,c=a+l*o+h*r,f=4/3*(Math.sqrt(2*a*c)-c)/(l*r-h*o),u=l-f*h,d=h+f*l,m=u,g=-d,p=n+t,y=Math.cos(p),x=Math.sin(p);return[e+w*Math.cos(t),s+w*Math.sin(t),e+u*y-d*x,s+u*x+d*y,e+m*y-g*x,s+m*x+g*y,e+w*Math.cos(i),s+w*Math.sin(i)]},Bg:(w,t,i,e,s,n,o)=>{const r=s,l=n,h=Math.floor((w-i)/r)*r+i,a=Math.floor((t-e)/l)*l+e;let c=h;h+r-w<r/2&&(c=h+r);let f=a;return a+l-t<l/2&&(f=a+l),o.e(c,f),o},gC:(w,t)=>{let i=Math.max(w,t),e=Math.min(w,t),s=1,n=1;do s=i%e,n=e,i=e,e=s;while(s>0);return n},ID:(w,t,i,e)=>{const s=i<0,n=e<0;let o=0,r=0,l=0;w<t?(r=1,l=0):(r=0,l=1);let h=0,a=0,c=0,f=0;return o=r,h=o===0?w:t,c=o===0?i:e,(o===0?s:n)&&(c=-c),o=l,a=o===0?w:t,f=o===0?i:e,(o===0?s:n)&&(f=-f),Geo.ED(h,a,c,f,0,0)},ED:(w,t,i,e,s,n)=>{let o=0;if(e>0)if(i>0){const r=w*w,l=t*t,h=w*i,a=t*e;let c=-l+a,f=-l+Math.sqrt(h*h+a*a),u=c;const d=9999999999;for(let p=0;p<d&&(u=.5*(c+f),!(u===c||u===f));++p){const y=h/(u+r),x=a/(u+l),k=y*y+x*x-1;if(k>0)c=u;else if(k<0)f=u;else break}s=r*i/(u+r),n=l*e/(u+l);const m=s-i,g=n-e;o=Math.sqrt(m*m+g*g)}else s=0,n=t,o=Math.abs(e-t);else{const r=w*w-t*t,l=w*i;if(l<r){const h=l/r,a=h*h;s=w*h,n=t*Math.sqrt(Math.abs(1-a));const c=s-i;o=Math.sqrt(c*c+n*n)}else s=w,n=0,o=Math.abs(i-w)}return o},Mo:new PropertyCollection,Gg:new PropertyCollection,ar:new PropertyCollection,cr:0,jg:100};Geo.za=Geo.RD;var GeometryType=(w=>(w[w.Line=1]="Line",w[w.Rectangle=2]="Rectangle",w[w.Ellipse=3]="Ellipse",w[w.Path=4]="Path",w))(GeometryType||{}),GeometryStretch=(w=>(w[w.None=0]="None",w[w.Default=1]="Default",w[w.Fill=2]="Fill",w[w.Uniform=6]="Uniform",w))(GeometryStretch||{});class Geometry{n;Hg;qg;ec;au;cu;zn;Xn;Kn;$;xe;be;Qi;_i;Fs;sc;nc;constructor(t){GSet.ji(this),this.n=2,t===void 0&&(t=4),this.$=t,this.xe=0,this.be=0,this.Qi=0,this._i=0,t===4?this.Fs=new List:this.Fs=Geometry.Pw,this.Hg=this.Fs.ht,this.qg=new Rect().g(),this.ec=null,this.au=null,this.cu=NaN,this.zn=Spot.TopLeft,this.Xn=Spot.BottomRight,this.sc=NaN,this.nc=NaN,this.Kn=2}copy(){const t=new Geometry;if(t.n=this.n&-2,t.$=this.$,t.xe=this.xe,t.be=this.be,t.Qi=this.Qi,t._i=this._i,this.$===4){const i=this.Fs.r,e=t.Fs;for(let s=0;s<i.length;s++){const n=i[s];e.add(n.copy())}t.Fs=e}else t.Fs=this.Fs;return t.Hg=this.Hg,t.qg.a(this.qg),t.ec=this.ec,t.au=this.au,t.cu=this.cu,t.zn=this.zn.N(),t.Xn=this.Xn.N(),t.sc=this.sc,t.nc=this.nc,t.Kn=this.Kn,t}static Line=1;static Rectangle=2;static Ellipse=3;static Path=4;static Pw=new List().g();get h(){return(this.n&1)!==0}set h(t){t?this.n|=1:this.n&=-2}get bt(){return(this.n&2)!==0}set bt(t){t?this.n|=2:this.n&=-3}it(){return this.g(),Object.freeze(this),this}g(){if(this.h=!0,this.type!==4)return this;const t=this.figures;t.g();for(const i of t)i.g();return this}ot(){if(Object.isFrozen(this)&&Util.o("cannot thaw constant: "+this),this.h=!1,this.type!==4)return this;const t=this.figures;t.ot();for(const i of t)i.ot();return this}equalsApprox(t){if(!(t instanceof Geometry))return!1;if(this.type!==t.type)return this.type===1&&t.type===4?this.mC(t):t.type===1&&this.type===4?t.mC(this):!1;if(this.type===4){const i=this.figures.r,e=t.figures.r,s=i.length;if(s!==e.length)return!1;for(let n=0;n<s;n++){const o=i[n],r=e[n];if(!o.equalsApprox(r))return!1}return!0}else return Geo.u(this.startX,t.startX)&&Geo.u(this.startY,t.startY)&&Geo.u(this.endX,t.endX)&&Geo.u(this.endY,t.endY)}mC(t){if(this.type!==1||t.type!==4)return!1;if(t.figures.count===1){const i=t.figures.elt(0);if(i.segments.count===1&&Geo.u(this.startX,i.startX)&&Geo.u(this.startY,i.startY)){const e=i.segments.elt(0);if(e.type===2&&Geo.u(this.endX,e.endX)&&Geo.u(this.endY,e.endY))return!0}}return!1}static stringify(t){return t.toString()}static stringifyFixed(t){return Util.i(t,"number",Geometry,"stringifyFixed:digits"),i=>i.toString(t)}li(t){t in GeometryType?this.type=t:Util.rr(this,t)}toString(t){t===void 0&&(t=-1);const i=s=>s===0?"0":s.toFixed(t);let e;switch(this.type){case 1:return t<0?"M"+this.startX.toString()+" "+this.startY.toString()+"L"+this.endX.toString()+" "+this.endY.toString():"M"+i(this.startX)+" "+i(this.startY)+"L"+i(this.endX)+" "+i(this.endY);case 2:return e=new Rect(this.startX,this.startY,0,0),e.union(this.endX,this.endY,0,0),t<0?"M"+e.x.toString()+" "+e.y.toString()+"H"+e.right.toString()+"V"+e.bottom.toString()+"H"+e.left.toString()+"z":"M"+i(e.x)+" "+i(e.y)+"H"+i(e.right)+"V"+i(e.bottom)+"H"+i(e.left)+"z";case 3:if(e=new Rect(this.startX,this.startY,0,0),e.union(this.endX,this.endY,0,0),t<0){const r=e.left.toString()+" "+(e.y+e.height/2).toString(),l=e.right.toString()+" "+(e.y+e.height/2).toString();return"M"+r+"A"+(e.width/2).toString()+" "+(e.height/2).toString()+" 0 0 1 "+l+"A"+(e.width/2).toString()+" "+(e.height/2).toString()+" 0 0 1 "+r}else{const r=i(e.left)+" "+i(e.y+e.height/2),l=i(e.right)+" "+i(e.y+e.height/2);return"M"+r+"A"+i(e.width/2)+" "+i(e.height/2)+" 0 0 1 "+l+"A"+i(e.width/2)+" "+i(e.height/2)+" 0 0 1 "+r}case 4:let s="";const n=this.figures.r,o=n.length;for(let r=0;r<o;r++){const l=n[r];r>0&&(s+=" x "),l.isFilled&&(s+="F "),s+=l.toString(t)}return s;default:return GeometryType[this.type]}}static fillPath(t){typeof t!="string"&&Util.we(t,"string",Geometry,"fillPath:str");const i=t.split(/[Xx]/),e=i.length;let s="";for(let n=0;n<e;n++){const o=i[n];if(o.match(/[Ff]/)!==null){n===0?s+=o:s+="X"+(o[0]===" "?"":" ")+o;continue}s+=(n===0?"":"X ")+"F"+(o[0]===" "?"":" ")+o}return s}static Wg="UuBbMmZzLlHhVvCcSsQqTtAaFfXx";static parse(t,i){i===void 0&&(i=!1),typeof t!="string"&&Util.we(t,"string",Geometry,"parse:str");const e=new RegExp("(["+Geometry.Wg+"])(["+Geometry.Wg+"])","gm"),s=new RegExp("(["+Geometry.Wg+"])([^s])","gm"),n=new RegExp("([^s])(["+Geometry.Wg+"])","gm");t=t.replace(/,/gm," "),t=t.replace(e,"$1 $2"),t=t.replace(e,"$1 $2"),t=t.replace(s,"$1 $2"),t=t.replace(n,"$1 $2"),t=t.replace(/([0-9])([+\-])/gm,"$1 $2"),t=t.replace(/[\s\r\t\n]+/gm," "),t=t.replace(/^\s+|\s+$/g,"");const o=t.split(" ");for(let A=0;A<o.length;A++){const D=o[A];if(D.match(/(\.[0-9]*)(\.)/gm)!==null){const F=Util.nt();let R="",v=!1;for(let O=0;O<D.length;O++){const B=D[O];B==="."&&!v?(v=!0,R+=B):B==="."?(F.push(R),R="."):R+=B}F.push(R),o.splice(A,1);for(let O=0;O<F.length;O++)o.splice(A+O,0,F[O]);A+=F.length-1,Util.tt(F)}}let r=-1,l="",h="";const a=new Point(0,0),c=new Point(0,0),f=new Point(0,0);let u=!0;function d(){return r>=k-1||o[r+1].match(N)!==null?!0:(u=!1,!1)}function m(){return r++,o[r]}function g(A){let D=parseFloat(m()),F=parseFloat(m());l===l.toLowerCase()&&(D=f.x+D,F=f.y+F),A.e(D,F)}function p(){return g(f),f}function y(){return g(c),c}function x(){const A=h.toLowerCase();return A==="c"||A==="s"||A==="q"||A==="t"?new Point(2*f.x-c.x,2*f.y-c.y):new Point(f.x,f.y)}const k=o.length,b=GeoStream.pC(null);let P=!1,M=!1,L=!1,C=!0,S=null;const N=new RegExp("["+Geometry.Wg+"]");for(;!(r>=k-1);){if(h=l,l=m(),l==="")continue;u=!0;let A=!1;switch(l.toUpperCase()){case"X":C=!0,P=!1,M=!1;break;case"M":for(S=p(),b.Pi===null||C===!0?(b.fu(S.x,S.y,P,!1,!M,L),C=!1):b.BD(S.x,S.y),a.a(f);!d();)S=p(),b.fr(S.x,S.y);break;case"L":for(;!d();)S=p(),b.fr(S.x,S.y);u&&(A=!0);break;case"H":for(;!d();)f.e((l===l.toLowerCase()?f.x:0)+parseFloat(m()),f.y),b.fr(f.x,f.y);break;case"V":for(;!d();)f.e(f.x,(l===l.toLowerCase()?f.y:0)+parseFloat(m())),b.fr(f.x,f.y);u&&(A=!0);break;case"C":for(;!d();){const D=new Point;g(D);const F=y(),R=p();b.ur(D.x,D.y,F.x,F.y,R.x,R.y)}u&&(A=!0);break;case"S":for(;!d();){const D=x(),F=y(),R=p();b.ur(D.x,D.y,F.x,F.y,R.x,R.y)}u&&(A=!0);break;case"Q":for(;!d();){const D=y(),F=p();b.Mw(D.x,D.y,F.x,F.y)}u&&(A=!0);break;case"T":for(;!d();){const D=x();c.a(D);const F=p();b.Mw(D.x,D.y,F.x,F.y),c.a(F)}u&&(A=!0);break;case"B":for(;!d();){const D=parseFloat(m()),F=parseFloat(m());let R=parseFloat(m()),v=parseFloat(m());const O=parseFloat(m());let B=O,X=!1;d()||(B=parseFloat(m()),d()||(X=parseFloat(m())!==0)),l===l.toLowerCase()&&(R+=f.x,v+=f.y),b.UD(D,F,R,v,O,B,X)}u&&(A=!0);break;case"A":for(;!d();){const D=Math.abs(parseFloat(m())),F=Math.abs(parseFloat(m())),R=parseFloat(m());let v=!1,O=!1,B=0,X=0;const E=m();E.length===1?(v=!!parseFloat(E),O=!!parseFloat(m()),B=parseFloat(m()),X=parseFloat(m())):E.length===2?(v=!!parseFloat(E[0]),O=!!parseFloat(E[1]),B=parseFloat(m()),X=parseFloat(m())):(v=!!parseFloat(E[0]),O=!!parseFloat(E[1]),B=parseFloat(E.slice(2)),X=parseFloat(m())),l===l.toLowerCase()&&(B=f.x+B,X=f.y+X),f.e(B,X),b.VD(D,F,R,v,O,B,X)}u&&(A=!0);break;case"Z":b.zD(),f.a(a);break;case"F":{let D="",F=1;for(;o[r+F];){if(o[r+F]==="0"){L=!0,F++;continue}if(o[r+F].match(/[Uu]/)!==null){F++;continue}if(o[r+F].match(N)===null){F++;continue}D=o[r+F];break}D.match(/[Mm]/)?P=!0:b.XD();break}case"U":{let D="",F=1;for(;o[r+F];){if(o[r+F].match(/[Ff]/)!==null){F++;continue}if(o[r+F].match(N)===null){F++;continue}D=o[r+F];break}D.match(/[Mm]/)?M=!0:b.KD(!1);break}default:if(l==="0"||l==="1")break;Util.ei("Unknown geometry command: "+l);break}if(A){Util.ei(`Bad geometry command: ${l}, next token: ${m()},
string: ${t}`);break}}const T=b.Jg;if(GeoStream.yC(b),i){const A=T.figures.iterator;for(;A.next();){const D=A.value;D.isFilled=!0}}return T}static wC(t,i){const e=t.length,s=Point.l();for(let n=0;n<e;n++){const o=t[n];s.x=o[0],s.y=o[1],i.xt(s),o[0]=s.x,o[1]=s.y,s.x=o[2],s.y=o[3],i.xt(s),o[2]=s.x,o[3]=s.y,s.x=o[4],s.y=o[5],i.xt(s),o[4]=s.x,o[5]=s.y,s.x=o[6],s.y=o[7],i.xt(s),o[6]=s.x,o[7]=s.y}Point.s(s)}Uk(){if(this.bt)return!0;if(this.type===4){const t=this.figures;if(this.Hg!==t.ht)return!0;const i=this.figures.r,e=i.length;for(let s=0;s<e;s++)if(i[s].Uk())return!0}return!1}Sw(){if(this.bt=!1,this.ec=null,this.au=null,this.cu=NaN,this.type===4){const i=this.figures;this.Hg=i.ht;const e=this.figures.r,s=e.length;for(let n=0;n<s;n++)e[n].YD()}const t=this.qg;t.ot(),isNaN(this.sc)||isNaN(this.nc)?t.e(0,0,0,0):t.e(0,0,this.sc,this.nc),this.xC(t,!1),t.unionNoCheck(0,0,0,0),t.g()}computeBoundsWithoutOrigin(){const t=new Rect;return this.xC(t,!0),t}xC(t,i){switch(this.type){case 1:case 2:case 3:i?t.e(this.xe,this.be,0,0):t.unionNoCheck(this.xe,this.be,0,0),t.unionNoCheck(this.Qi,this._i,0,0);break;case 4:const e=this.figures,s=e.r,n=e.length;for(let o=0;o<n;o++){const r=s[o];i&&o===0?t.e(r.startX,r.startY,0,0):t.unionNoCheck(r.startX,r.startY,0,0);const h=r.segments.r,a=h.length;let c=r.startX,f=r.startY;for(let u=0;u<a;u++){const d=h[u];switch(d.type){case 2:case 1:c=d.endX,f=d.endY,t.unionNoCheck(c,f,0,0);break;case 3:Geo.hu(c,f,d.point1X,d.point1Y,d.point2X,d.point2Y,d.endX,d.endY,.5,t),c=d.endX,f=d.endY;break;case 4:Geo.Bk(c,f,d.point1X,d.point1Y,d.endX,d.endY,.5,t),c=d.endX,f=d.endY;break;case 5:case 6:const m=d.type===5?d.So(r):d.Eh(r,c,f),g=m.length;if(g===0){c=d.type===5?d.centerX:d.endX,f=d.type===5?d.centerY:d.endY,t.unionNoCheck(c,f,0,0);break}let p=null;for(let y=0;y<g;y++)p=m[y],Geo.hu(p[0],p[1],p[2],p[3],p[4],p[5],p[6],p[7],.5,t);p!==null&&(c=p[6],f=p[7]);break;default:Util.o("Unknown Segment type: "+d.type)}}}break;default:Util.o("Unknown Geometry type: "+this.type)}}GD(t,i){const e=this.bounds;let s=t/e.width,n=i/e.height;return isFinite(s)||(s=1),isFinite(n)||(n=1),s===1&&n===1?this:this.copy().scale(s,n)}normalize(){this.h&&Util.T(this);const t=this.computeBoundsWithoutOrigin();return this.offset(-t.x,-t.y),new Point(-t.x,-t.y)}offset(t,i){return this.h&&Util.T(this),this.D(1,0,0,1,t,i),this}scale(t,i){return this.h&&Util.T(this),this.D(t,0,0,i,0,0),this}rotate(t,i,e){this.h&&Util.T(this),i===void 0&&(i=0),e===void 0&&(e=0);const s=Transform.l();return s.vi(),s.cs(t,i,e),this.D(s.m11,s.m12,s.m21,s.m22,s.dx,s.dy),Transform.s(s),this}D(t,i,e,s,n,o){let r=0,l=0;switch(this.type){case 1:case 2:case 3:r=this.xe,l=this.be,this.xe=r*t+l*e+n,this.be=r*i+l*s+o,r=this.Qi,l=this._i,this.Qi=r*t+l*e+n,this._i=r*i+l*s+o;break;case 4:const a=this.figures.r,c=a.length;for(let f=0;f<c;f++){const u=a[f];r=u.startX,l=u.startY,u.startX=r*t+l*e+n,u.startY=r*i+l*s+o;const m=u.segments.r,g=m.length;for(let p=0;p<g;p++){const y=m[p];switch(y.type){case 2:case 1:r=y.endX,l=y.endY,y.endX=r*t+l*e+n,y.endY=r*i+l*s+o;break;case 3:r=y.point1X,l=y.point1Y,y.point1X=r*t+l*e+n,y.point1Y=r*i+l*s+o,r=y.point2X,l=y.point2Y,y.point2X=r*t+l*e+n,y.point2Y=r*i+l*s+o,r=y.endX,l=y.endY,y.endX=r*t+l*e+n,y.endY=r*i+l*s+o;break;case 4:r=y.point1X,l=y.point1Y,y.point1X=r*t+l*e+n,y.point1Y=r*i+l*s+o,r=y.endX,l=y.endY,y.endX=r*t+l*e+n,y.endY=r*i+l*s+o;break;case 5:if(r=y.centerX,l=y.centerY,y.centerX=r*t+l*e+n,y.centerY=r*i+l*s+o,i!==0){let x=Math.atan2(i,t)*180/Math.PI;x<0&&(x+=360),y.startAngle+=x}t<0&&(y.startAngle=180-y.startAngle,y.sweepAngle=-y.sweepAngle),s<0&&(y.startAngle=-y.startAngle,y.sweepAngle=-y.sweepAngle),y.radiusX*=Math.sqrt(t*t+e*e),y.radiusY!==void 0&&(y.radiusY*=Math.sqrt(i*i+s*s));break;case 6:if(r=y.endX,l=y.endY,y.endX=r*t+l*e+n,y.endY=r*i+l*s+o,y.radiusX===0||y.radiusY===0)break;if(i!==0){let x=Math.atan2(i,t)*180/Math.PI;x<0&&(x+=360),y.xAxisRotation+=x}t<0&&(y.xAxisRotation=180-y.xAxisRotation,y.isClockwiseArc=!y.isClockwiseArc),s<0&&(y.xAxisRotation=-y.xAxisRotation,y.isClockwiseArc=!y.isClockwiseArc),y.radiusX*=Math.sqrt(t*t+e*e),y.radiusY*=Math.sqrt(i*i+s*s);break;default:Util.o("Unknown Segment type: "+y.type)}}}break}return this.bt=!0,this}containsPoint(t,i){i===void 0&&(i=0);const e=this.xe,s=this.be,n=this.Qi,o=this._i;switch(this.type){case 1:return Geo.Oi(e,s,n,o,i,t.x,t.y);case 2:{const r=Math.min(e,n)-i,l=Math.min(s,o)-i,h=Math.abs(n-e)+i*2,a=Math.abs(o-s)+i*2,c=Rect.X(r,l,h,a),f=c.containsPoint(t);return Rect.s(c),f}case 3:{let r=Math.min(e,n)-i,l=Math.min(s,o)-i;const h=Math.abs(n-e)+i*2,a=Math.abs(o-s)+i*2,c=h/2,f=a/2;return c<=0||f<=0?!1:(r=t.x-(r+c),l=t.y-(l+f),r*r/(c*c)+l*l/(f*f)<=1)}case 4:return this.Vk(t,i,!0,!1);default:return!1}}Vk(t,i,e,s){const n=t.x,o=t.y,r=this.bounds.x-20,l=o;let h=0,a=0,c=0,f=0,u=0,d=0;const m=this.figures.r,g=m.length;for(let p=0;p<g;p++){const y=m[p],x=!y.isEvenOdd;if(y.isFilled){if(e&&y.zk(n,o,i))return!0}else{if(y.zk(n,o,s?i:i+2))return!0;continue}const k=y.segments;a=y.startX,c=y.startY;let b=a,P=c;const M=k.r;for(let L=0;L<=k.length;L++){let C,S;switch(L!==k.length?(C=M[L],S=C.type,u=C.endX,d=C.endY):(S=2,u=b,d=P),S){case 1:{const N=this.Nw(n,o,r,l,a,c,b,P);if(isNaN(N))return!0;h+=N,b=u,P=d;break}case 2:{const N=this.Nw(n,o,r,l,a,c,u,d);if(isNaN(N))return!0;h+=N;break}case 3:f=Geo.Kg(a,c,C.point1X,C.point1Y,C.point2X,C.point2Y,u,d,r,l,n,o,.5),h+=f;break;case 4:{const N=(a+2*C.point1X)/3,T=(c+2*C.point1Y)/3,A=(C.point1X*2+u)/3,D=(C.point1Y*2+d)/3;f=Geo.Kg(a,c,N,T,A,D,u,d,r,l,n,o,.5),h+=f;break}case 5:case 6:{const N=C.type===5?C.So(y):C.Eh(y,a,c),T=N.length;if(T===0){const D=this.Nw(n,o,r,l,a,c,C.type===5?C.centerX:C.endX,C.type===5?C.centerY:C.endY);if(isNaN(D))return!0;h+=D;break}let A=null;for(let D=0;D<T;D++){if(A=N[D],D===0){const F=this.Nw(n,o,r,l,a,c,A[0],A[1]);if(isNaN(F))return!0;h+=F}f=Geo.Kg(A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],r,l,n,o,.5),h+=f}A!==null&&(u=A[6],d=A[7]);break}default:Util.o("Unknown Segment type: "+C.type)}a=u,c=d}if(x){if(h!==0)return!0}else if(h%2!==0)return!0;h=0}return!1}Nw(t,i,e,s,n,o,r,l){if(Geo.Oi(n,o,r,l,.05,t,i))return NaN;const h=(t-e)*(o-l);if(h===0)return 0;const a=((t*s-i*e)*(n-r)-(t-e)*(n*l-o*r))/h,c=(t*s-i*e)*(o-l)/h;if(a>=t)return 0;if((n>r?n-r:r-n)<(o>l?o-l:l-o)){if(o<l){if(c<o||c>l)return 0}else if(c<l||c>o)return 0}else if(n<r){if(a<n||a>r)return 0}else if(a<r||a>n)return 0;return h>0?1:-1}bC(t,i,e){const s=this.figures.r,n=s.length;for(let o=0;o<n;o++)if(s[o].zk(t,i,e))return!0;return!1}getPointAlongPath(t,i){if(t<0?t=0:t>1&&(t=1),i===void 0&&(i=new Point),this.type===1)return i.e(this.startX+t*(this.endX-this.startX),this.startY+t*(this.endY-this.startY)),i;const e=this.flattenedSegments,s=this.flattenedLengths,n=this.flattenedTotalLength,o=e.length,r=n*t;let l=0;for(let h=0;h<o;h++){const a=s[h],c=a.length;for(let f=0;f<c;f++){const u=a[f];if(l+u>=r){const d=r-l,m=u===0?0:d/u,g=e[h],p=g[f*2],y=g[f*2+1],x=g[f*2+2],k=g[f*2+3];return i.e(p+(x-p)*m,y+(k-y)*m),i}l+=u}}return i}getAngleAlongPath(t){if(t<0?t=0:t>1&&(t=1),this.type===1)return Math.atan2(this.endY-this.startY,this.endX-this.startX)*180/Math.PI;const i=this.flattenedSegments,e=this.flattenedLengths,s=this.flattenedTotalLength,n=i.length,o=s*t;let r=0;for(let l=0;l<n;l++){const h=e[l],a=h.length;for(let c=0;c<a;c++){const f=h[c];if(r+f>=o){const u=i[l],d=u[c*2],m=u[c*2+1],g=u[c*2+2],p=u[c*2+3];return Math.abs(g-d)<1&&Math.abs(p-m)<1?0:Math.abs(g-d)<1?p-m>=0?90:270:Math.abs(p-m)<1?g-d>=0?0:180:Math.atan2(p-m,g-d)*180/Math.PI}r+=f}}return NaN}getPointAndAngleAlongPath(t,i){if(t<0?t=0:t>1&&(t=1),i===void 0&&(i=[]),i.length=3,this.type===1)return i[0]=this.startX+t*(this.endX-this.startX),i[1]=this.startY+t*(this.endY-this.startY),i[2]=Math.atan2(this.endY-this.startY,this.endX-this.startX)*180/Math.PI,i;const e=this.flattenedSegments,s=this.flattenedLengths,n=this.flattenedTotalLength,o=e.length,r=n*t;let l=0;for(let h=0;h<o;h++){const a=s[h],c=a.length;for(let f=0;f<c;f++){const u=a[f];if(l+u>=r){const d=r-l,m=u===0?0:d/u,g=e[h],p=g[f*2],y=g[f*2+1],x=g[f*2+2],k=g[f*2+3];i[0]=p+(x-p)*m,i[1]=y+(k-y)*m;let b;return Math.abs(x-p)<1&&Math.abs(k-y)<1?b=0:Math.abs(x-p)<1?b=k-y>=0?90:270:Math.abs(k-y)<1?b=x-p>=0?0:180:b=Math.atan2(k-y,x-p)*180/Math.PI,i[2]=b,i}l+=u}}return i}getFractionForPoint(t){if(this.type===1){const i=this.startX,e=this.startY,s=this.endX,n=this.endY;if(i===s&&e===n)return 0;{const o=t.x,r=t.y;let l=0,h=0;if(i===s)return e<n?(l=e,h=n):(l=n,h=e),r<=l?l===e?0:1:r>=h?h===e?0:1:Math.abs(r-e)/(h-l);if(e===n)return i<s?(l=i,h=s):(l=s,h=i),o<=l?l===i?0:1:o>=h?h===i?0:1:Math.abs(o-i)/(h-l);{const a=(s-i)*(s-i)+(n-e)*(n-e),c=Point.l();Geo.gl(i,e,s,n,o,r,c);const f=c.x,u=c.y;return Point.s(c),Math.sqrt(((f-i)*(f-i)+(u-e)*(u-e))/a)}}}else if(this.type===2){const i=this.startX,e=this.startY,s=this.endX,n=this.endY;if(i===s&&e===n)return 0;{const o=s-i,r=n-e,l=o*2+r*2;let h=t.x,a=t.y;h=Math.min(Math.max(h,i),s),a=Math.min(Math.max(a,e),n);const c=Math.abs(h-i),f=Math.abs(h-s),u=Math.abs(a-e),d=Math.abs(a-n),m=Math.min(c,f,u,d);if(m===u)return h/l;if(m===f)return(o+a)/l;if(m===d)return(o*2+r-h)/l;if(m===c)return(o*2+r*2-a)/l}}else{const i=this.flattenedSegments,e=this.flattenedLengths,s=this.flattenedTotalLength,n=Point.l();let o=1/0,r=0,l=0;const h=i.length;let a=0,c=0;for(let u=0;u<h;u++){const d=i[u],m=e[u],g=d.length;for(let p=0;p<g;p+=2){const y=d[p],x=d[p+1];if(p===0){a=y,c=x;continue}Geo.gl(a,c,y,x,t.x,t.y,n);const k=(n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y);k<o&&(o=k,r=l,r+=Math.sqrt((n.x-a)*(n.x-a)+(n.y-c)*(n.y-c))),l+=m[(p-2)/2],a=y,c=x}}Point.s(n);const f=r/s;return f<0?0:f>1?1:f}return 0}get flattenedSegments(){return this.kC(),this.ec}kC(){if(this.ec===null){const t=this.ec=[],i=this.au=[];this.jD(t,i)}}get flattenedLengths(){return this.kC(),this.au}get flattenedTotalLength(){let t=this.cu;if(isNaN(t)){if(this.type===1){const i=Math.abs(this.endX-this.startX),e=Math.abs(this.endY-this.startY);t=Math.sqrt(i*i+e*e)}else if(this.type===2){const i=Math.abs(this.endX-this.startX),e=Math.abs(this.endY-this.startY);t=i*2+e*2}else{const i=this.flattenedLengths,e=i.length;t=0;for(let s=0;s<e;s++){const n=i[s],o=n.length;for(let r=0;r<o;r++)t+=n[r]}}this.cu=t}return t}Xk(t){const i=[];let e=0,s=0;const n=t.length;for(let o=0;o<n;o+=2){const r=t[o],l=t[o+1];if(o===0){e=r,s=l;continue}const h=Math.sqrt(Point.distanceSquared(e,s,r,l));i.push(h),e=r,s=l}return i}jD(t,i){let e=[];const s=[];if(this.type===1)e.push(this.startX),e.push(this.startY),e.push(this.endX),e.push(this.endY),t.push(e),s.push(Math.sqrt((this.startX-this.endX)*(this.startX-this.endX)+(this.startY-this.endY)*(this.startY-this.endY))),i.push(s);else if(this.type===2)e.push(this.startX),e.push(this.startY),e.push(this.endX),e.push(this.startY),e.push(this.endX),e.push(this.endY),e.push(this.startX),e.push(this.endY),e.push(this.startX),e.push(this.startY),t.push(e),s.push(Math.abs(this.startX-this.endX)),s.push(Math.abs(this.startY-this.endY)),s.push(Math.abs(this.startX-this.endX)),s.push(Math.abs(this.startY-this.endY)),i.push(s);else if(this.type===3){const n=new PathFigure;n.startX=this.endX,n.startY=(this.startY+this.endY)/2;const o=new PathSegment(5);o.startAngle=0,o.sweepAngle=360,o.centerX=(this.startX+this.endX)/2,o.centerY=(this.startY+this.endY)/2,o.radiusX=Math.abs(this.startX-this.endX)/2,o.radiusY=Math.abs(this.startY-this.endY)/2,n.add(o);const r=o.So(n),l=r.length;if(l===0)e.push(o.centerX),e.push(o.centerY);else{let h=n.startX,a=n.startY;for(let c=0;c<l;c++){const f=r[c];Geo.Un(h,a,f[2],f[3],f[4],f[5],f[6],f[7],.5,e),h=f[6],a=f[7]}}t.push(e),i.push(this.Xk(e))}else{const n=this.figures.iterator;for(;n.next();){const o=n.value;e=[],e.push(o.startX),e.push(o.startY);let r=o.startX,l=o.startY,h=r,a=l;const c=o.segments.r,f=c.length;for(let u=0;u<f;u++){const d=c[u];switch(d.type){case 1:e.length>=4&&(t.push(e),i.push(this.Xk(e))),e=[],e.push(d.endX),e.push(d.endY),r=d.endX,l=d.endY,h=r,a=l;break;case 2:e.push(d.endX),e.push(d.endY),r=d.endX,l=d.endY;break;case 3:Geo.Un(r,l,d.point1X,d.point1Y,d.point2X,d.point2Y,d.endX,d.endY,.5,e),r=d.endX,l=d.endY;break;case 4:Geo.zg(r,l,d.point1X,d.point1Y,d.endX,d.endY,.5,e),r=d.endX,l=d.endY;break;case 5:{const m=d.So(o),g=m.length;if(g===0){e.push(d.centerX),e.push(d.centerY),r=d.centerX,l=d.centerY;break}for(let p=0;p<g;p++){const y=m[p];Geo.Un(r,l,y[2],y[3],y[4],y[5],y[6],y[7],.5,e),r=y[6],l=y[7]}break}case 6:{const m=d.Eh(o,r,l),g=m.length,p=d.endX,y=d.endY;if(g===0){e.push(p),e.push(y),r=p,l=y;break}for(let x=0;x<g;x++){const k=m[x];Geo.Un(r,l,k[2],k[3],k[4],k[5],k[6],k[7],.5,e),r=k[6],l=k[7]}break}default:Util.o("Segment not of valid type: "+d.type)}d.isClosed&&(e.push(h),e.push(a))}e.length>=4&&(t.push(e),i.push(this.Xk(e)))}}}get type(){return this.$}set type(t){this.$!==t&&(this.h&&Util.T(this,t),this.$=t,t===4?this.Fs=new List:(Geometry.Pw===null&&(Geometry.Pw=new List().g()),this.Fs=Geometry.Pw),this.bt=!0)}get startX(){return this.xe}set startX(t){this.xe!==t&&(this.h&&Util.T(this,t),this.xe=t,this.bt=!0)}get startY(){return this.be}set startY(t){this.be!==t&&(this.h&&Util.T(this,t),this.be=t,this.bt=!0)}get endX(){return this.Qi}set endX(t){this.Qi!==t&&(this.h&&Util.T(this,t),this.Qi=t,this.bt=!0)}get endY(){return this._i}set endY(t){this._i!==t&&(this.h&&Util.T(this,t),this._i=t,this.bt=!0)}get figures(){return this.Fs}set figures(t){this.Fs!==t&&(this.h&&Util.T(this,t),this.Fs=t,this.bt=!0)}add(t){return this.Fs.add(t),this}setSpots(t,i,e,s,n,o,r,l){return this.h&&Util.T(this),this.zn=new Spot(t,i,n,o).g(),this.Xn=new Spot(e,s,r,l).g(),this}get spot1(){return this.zn}set spot1(t){this.h&&Util.T(this,t),this.zn=t.N()}get spot2(){return this.Xn}set spot2(t){this.h&&Util.T(this,t),this.Xn=t.N()}get defaultStretch(){return this.Kn}set defaultStretch(t){this.Kn=t}get bounds(){return this.Uk()&&this.Sw(),this.qg}}Geometry.stringify=Geometry.stringify;Geometry.stringifyFixed=Geometry.stringifyFixed;Geometry.fillPath=Geometry.fillPath;Geometry.parse=Geometry.parse;class PathFigure{n;xe;be;oc;$g;Be;constructor(t,i,e,s,n){e===void 0&&(e=!0),s===void 0&&(s=!0),n===void 0&&(n=!1),this.n=2|(e?4:0)|(s?8:0)|(n?16:0),t!==void 0?this.xe=t:this.xe=0,i!==void 0?this.be=i:this.be=0,this.oc=new List,this.$g=this.oc.ht,this.Be=null}copy(){const t=new PathFigure;t.n=this.n&-2,t.xe=this.xe,t.be=this.be;const i=this.oc.r,e=i.length,s=t.oc;for(let n=0;n<e;n++){const r=i[n].copy();s.add(r)}return t.$g=this.$g,t.Be=this.Be,t}equalsApprox(t){if(!(t instanceof PathFigure)||!Geo.u(this.startX,t.startX)||!Geo.u(this.startY,t.startY))return!1;const i=this.segments.r,e=t.segments.r,s=i.length;if(s!==e.length)return!1;for(let n=0;n<s;n++){const o=i[n],r=e[n];if(!o.equalsApprox(r))return!1}return!0}toString(t){t===void 0&&(t=-1);let i="";if(t<0)i="M"+this.startX.toString()+" "+this.startY.toString();else{const n=o=>o===0?"0":o.toFixed(t);i="M"+n(this.startX)+" "+n(this.startY)}const e=this.segments.r,s=e.length;for(let n=0;n<s;n++){const o=e[n];i+=" "+o.toString(t)}return i}get h(){return(this.n&1)!==0}set h(t){t?this.n|=1:this.n&=-2}get bt(){return(this.n&2)!==0}set bt(t){t?this.n|=2:this.n&=-3}g(){this.h=!0;const t=this.segments;t.g();const i=t.r,e=t.length;for(let s=0;s<e;s++)i[s].g();return this}ot(){this.h=!1;const t=this.segments;t.ot();const i=t.r,e=i.length;for(let s=0;s<e;s++)i[s].ot();return this}Uk(){if(this.bt)return!0;const t=this.segments;if(this.$g!==t.ht)return!0;for(const i of t)if(i.bt)return!0;return!1}YD(){this.bt=!1,this.Be=null;const t=this.segments;this.$g=t.ht;for(const i of t)i.bt=!1,i.Rs=null}get isFilled(){return(this.n&4)!==0}set isFilled(t){this.h&&Util.T(this,t),t?this.n|=4:this.n&=-5}get isShadowed(){return(this.n&8)!==0}set isShadowed(t){this.h&&Util.T(this,t),t?this.n|=8:this.n&=-9}get isEvenOdd(){return(this.n&16)!==0}set isEvenOdd(t){this.h&&Util.T(this,t),t?this.n|=16:this.n&=-17}get startX(){return this.xe}set startX(t){this.h&&Util.T(this,t),this.xe=t,this.Be=null,this.bt=!0}get startY(){return this.be}set startY(t){this.h&&Util.T(this,t),this.be=t,this.Be=null,this.bt=!0}get segments(){return this.oc}set segments(t){this.h&&Util.T(this,t),this.oc=t,this.Be=null,this.bt=!0}add(t){return this.oc.add(t),this.Be=null,this}zk(t,i,e){const s=this;let n=s.startX,o=s.startY,r=n,l=o;const h=s.segments.r,a=h.length;for(let c=0;c<a;c++){const f=h[c];switch(f.type){case 1:r=f.endX,l=f.endY,n=f.endX,o=f.endY;break;case 2:if(Geo.Oi(n,o,f.endX,f.endY,e,t,i))return!0;n=f.endX,o=f.endY;break;case 3:if(Geo.bw(n,o,f.point1X,f.point1Y,f.point2X,f.point2Y,f.endX,f.endY,.5,t,i,e))return!0;n=f.endX,o=f.endY;break;case 4:if(Geo.Ek(n,o,f.point1X,f.point1Y,f.endX,f.endY,.5,t,i,e))return!0;n=f.endX,o=f.endY;break;case 5:case 6:const u=f.type===5?f.So(s):f.Eh(s,n,o),d=u.length,m=f.type===5?f.centerX:f.endX,g=f.type===5?f.centerY:f.endY;if(d===0){if(Geo.Oi(n,o,m,g,e,t,i))return!0;n=m,o=g;break}let p=null;for(let y=0;y<d;y++)if(p=u[y],y===0&&Geo.Oi(n,o,p[0],p[1],e,t,i)||Geo.bw(p[0],p[1],p[2],p[3],p[4],p[5],p[6],p[7],.5,t,i,e))return!0;p!==null&&(n=p[6],o=p[7]);break;default:Util.o("Unknown Segment type: "+f.type)}if(f.isClosed&&(n!==r||o!==l)&&Geo.Oi(n,o,r,l,e,t,i))return!0}return!1}}var SegmentType=(w=>(w[w.Move=1]="Move",w[w.Line=2]="Line",w[w.Bezier=3]="Bezier",w[w.QuadraticBezier=4]="QuadraticBezier",w[w.Arc=5]="Arc",w[w.SvgArc=6]="SvgArc",w))(SegmentType||{});class PathSegment{$;n;Qi;_i;hn;pl;yl;dr;Rs;constructor(t,i,e,s,n,o,r,l){if(GSet.ji(this),t===void 0&&(t=2),this.$=t,this.n=2,i!==void 0?this.Qi=i:this.Qi=0,e!==void 0?this._i=e:this._i=0,s===void 0&&(s=0),n===void 0&&(n=0),o===void 0&&(o=0),r===void 0&&(r=0),t===6){let h=o;h=h%360,h<0&&(h+=360),this.hn=h,this.pl=0,this.yl=Math.max(s,0),this.dr=Math.max(n,0),typeof r=="boolean"?r&&(this.isLargeArc=!0):typeof r=="number"&&r&&(this.isLargeArc=!0),l&&(this.isClockwiseArc=!0)}else this.hn=s,this.pl=n,t===5&&(o=Math.max(o,0)),this.yl=o,typeof r=="number"?(t===5&&(r=Math.max(r,0)),this.dr=r):this.dr=0;this.Rs=null}copy(){const t=new PathSegment;return t.$=this.$,t.n=this.n&-2,t.Qi=this.Qi,t._i=this._i,t.hn=this.hn,t.pl=this.pl,t.yl=this.yl,t.dr=this.dr,t}equalsApprox(t){if(!(t instanceof PathSegment)||this.type!==t.type||this.isClosed!==t.isClosed)return!1;switch(this.type){case 1:case 2:return Geo.u(this.endX,t.endX)&&Geo.u(this.endY,t.endY);case 3:return Geo.u(this.endX,t.endX)&&Geo.u(this.endY,t.endY)&&Geo.u(this.point1X,t.point1X)&&Geo.u(this.point1Y,t.point1Y)&&Geo.u(this.point2X,t.point2X)&&Geo.u(this.point2Y,t.point2Y);case 4:return Geo.u(this.endX,t.endX)&&Geo.u(this.endY,t.endY)&&Geo.u(this.point1X,t.point1X)&&Geo.u(this.point1Y,t.point1Y);case 5:return Geo.u(this.startAngle,t.startAngle)&&Geo.u(this.sweepAngle,t.sweepAngle)&&Geo.u(this.centerX,t.centerX)&&Geo.u(this.centerY,t.centerY)&&Geo.u(this.radiusX,t.radiusX)&&Geo.u(this.radiusY,t.radiusY);case 6:return this.isClockwiseArc===t.isClockwiseArc&&this.isLargeArc===t.isLargeArc&&Geo.u(this.xAxisRotation,t.xAxisRotation)&&Geo.u(this.endX,t.endX)&&Geo.u(this.endY,t.endY)&&Geo.u(this.radiusX,t.radiusX)&&Geo.u(this.radiusY,t.radiusY);default:return!1}}li(t){t in SegmentType?this.type=t:Util.rr(this,t)}toString(t){t===void 0&&(t=-1);const i=s=>s===0?"0":s.toFixed(t);let e="";switch(this.type){case 1:t<0?e="M"+this.endX.toString()+" "+this.endY.toString():e="M"+i(this.endX)+" "+i(this.endY);break;case 2:t<0?e="L"+this.endX.toString()+" "+this.endY.toString():e="L"+i(this.endX)+" "+i(this.endY);break;case 3:t<0?e="C"+this.point1X.toString()+" "+this.point1Y.toString()+" "+this.point2X.toString()+" "+this.point2Y.toString()+" "+this.endX.toString()+" "+this.endY.toString():e="C"+i(this.point1X)+" "+i(this.point1Y)+" "+i(this.point2X)+" "+i(this.point2Y)+" "+i(this.endX)+" "+i(this.endY);break;case 4:t<0?e="Q"+this.point1X.toString()+" "+this.point1Y.toString()+" "+this.endX.toString()+" "+this.endY.toString():e="Q"+i(this.point1X)+" "+i(this.point1Y)+" "+i(this.endX)+" "+i(this.endY);break;case 5:t<0?e="B"+this.startAngle.toString()+" "+this.sweepAngle.toString()+" "+this.centerX.toString()+" "+this.centerY.toString()+" "+this.radiusX.toString()+" "+this.radiusY.toString():e="B"+i(this.startAngle)+" "+i(this.sweepAngle)+" "+i(this.centerX)+" "+i(this.centerY)+" "+i(this.radiusX)+" "+i(this.radiusY);break;case 6:t<0?e="A"+this.radiusX.toString()+" "+this.radiusY.toString()+" "+this.xAxisRotation.toString()+" "+(this.isLargeArc?1:0)+" "+(this.isClockwiseArc?1:0)+" "+this.endX.toString()+" "+this.endY.toString():e="A"+i(this.radiusX)+" "+i(this.radiusY)+" "+i(this.xAxisRotation)+" "+(this.isLargeArc?1:0)+" "+(this.isClockwiseArc?1:0)+" "+i(this.endX)+" "+i(this.endY);break;default:e=SegmentType[this.type]}return e+(this.isClosed?"z":"")}static Move=1;static Line=2;static Bezier=3;static QuadraticBezier=4;static Arc=5;static SvgArc=6;get h(){return(this.n&1)!==0}set h(t){t?this.n|=1:this.n&=-2}get bt(){return(this.n&2)!==0}set bt(t){t?this.n|=2:this.n&=-3}g(){return this.h=!0,this}ot(){return this.h=!1,this}close(){return this.isClosed=!0,this}So(t){if(this.Rs!==null&&t.bt===!1)return this.Rs;const i=this.radiusX;let e=this.radiusY;if(e===void 0&&(e=i),i===0||e===0)return this.Rs=[],this.Rs;const s=this.hn,n=this.pl,o=Geo.dC(0,0,i<e?i:e,this.startAngle,this.startAngle+this.sweepAngle,!1);if(i!==e){const l=Transform.l();l.vi(),i<e?l.et(1,e/i):l.et(i/e,1),Geometry.wC(o,l),Transform.s(l)}const r=o.length;for(let l=0;l<r;l++){const h=o[l];h[0]+=s,h[1]+=n,h[2]+=s,h[3]+=n,h[4]+=s,h[5]+=n,h[6]+=s,h[7]+=n}return this.Rs=o,this.Rs}Eh(t,i,e){if(this.Rs!==null&&t.bt===!1)return this.Rs;if(this.radiusX===0||this.radiusY===0)return this.Rs=[],this.Rs;const s=i,n=e;let o=this.yl,r=this.dr;o===0&&(o=1e-4),r===0&&(r=1e-4);const l=this.hn*(Math.PI/180),h=this.isLargeArc,a=this.isClockwiseArc,c=this.Qi,f=this._i,u=Math.cos(l),d=Math.sin(l),m=u*(s-c)/2+d*(n-f)/2,g=-d*(s-c)/2+u*(n-f)/2,p=m*m/(o*o)+g*g/(r*r);p>1&&(o*=Math.sqrt(p),r*=Math.sqrt(p));let y=(h===a?-1:1)*Math.sqrt((o*o*r*r-o*o*g*g-r*r*m*m)/(o*o*g*g+r*r*m*m));isNaN(y)&&(y=0);let x=y*o*g/r,k=y*-r*m/o;isNaN(x)&&(x=0),isNaN(k)&&(k=0);const b=(s+c)/2+u*x-d*k,P=(n+f)/2+d*x+u*k,M=(V,U)=>Math.sqrt(V*V+U*U),L=(V,U,Y,G)=>(V*Y+U*G)/(M(V,U)*M(Y,G)),C=(V,U,Y,G)=>(V*G<U*Y?-1:1)*Math.acos(L(V,U,Y,G)),S=C(1,0,(m-x)/o,(g-k)/r),N=(m-x)/o,T=(g-k)/r,A=(-m-x)/o,D=(-g-k)/r;let F=C(N,T,A,D);const R=L(N,T,A,D);R<=-1?F=Math.PI:R>=1&&(F=0),!a&&F>0&&(F=F-2*Math.PI),a&&F<0&&(F=F+2*Math.PI);const v=o>r?o:r,O=o>r?1:o/r,B=o>r?r/o:1,X=Geo.dC(0,0,v,S,S+F,!0),E=Transform.l();return E.vi(),E.Ds(b,P),E.cs(this.hn,0,0),E.et(O,B),Geometry.wC(X,E),Transform.s(E),this.Rs=X,this.Rs}get isClosed(){return(this.n&8)!==0}set isClosed(t){this.isClosed!==t&&(t?this.n|=8:this.n&=-9,this.bt=!0)}get type(){return this.$}set type(t){this.h&&Util.T(this,t),this.$=t,this.bt=!0}get endX(){return this.Qi}set endX(t){this.h&&Util.T(this,t),this.Qi=t,this.bt=!0}get endY(){return this._i}set endY(t){this.h&&Util.T(this,t),this._i=t,this.bt=!0}get point1X(){return this.hn}set point1X(t){this.h&&Util.T(this,t),this.hn=t,this.bt=!0}get point1Y(){return this.pl}set point1Y(t){this.h&&Util.T(this,t),this.pl=t,this.bt=!0}get point2X(){return this.yl}set point2X(t){this.h&&Util.T(this,t),this.yl=t,this.bt=!0}get point2Y(){return this.dr}set point2Y(t){this.h&&Util.T(this,t),this.dr=t,this.bt=!0}get centerX(){return this.hn}set centerX(t){this.h&&Util.T(this,t),this.hn=t,this.bt=!0}get centerY(){return this.pl}set centerY(t){this.h&&Util.T(this,t),this.pl=t,this.bt=!0}get radiusX(){return this.yl}set radiusX(t){t<0&&Util._(t,">= zero",PathSegment,"radiusX"),this.h&&Util.T(this,t),this.yl=t,this.bt=!0}get radiusY(){return this.dr}set radiusY(t){t<0&&Util._(t,">= zero",PathSegment,"radiusY"),this.h&&Util.T(this,t),this.dr=t,this.bt=!0}get startAngle(){return this.Qi}set startAngle(t){this.h&&Util.T(this,t),t=t%360,t<0&&(t+=360),this.Qi=t,this.bt=!0}get sweepAngle(){return this._i}set sweepAngle(t){this.h&&Util.T(this,t),t>360&&(t=360),t<-360&&(t=-360),this._i=t,this.bt=!0}get isClockwiseArc(){return(this.n&4)!==0}set isClockwiseArc(t){this.h&&Util.T(this,t),t?this.n|=4:this.n&=-5,this.bt=!0}get isLargeArc(){return(this.n&16)!==0}set isLargeArc(t){this.h&&Util.T(this,t),t?this.n|=16:this.n&=-17,this.bt=!0}get xAxisRotation(){return this.hn}set xAxisRotation(t){this.h&&Util.T(this,t),t=t%360,t<0&&(t+=360),this.hn=t,this.bt=!0}}class InputEvent{p;Cw;Lw;Zg;Qg;_g;tm;im;em;sm;nm;om;rm;lm;No;hm;am;cm;ke;constructor(){this.p=null,this.Cw=new Point(0,0).g(),this.Lw=new Point(0,0).g(),this.Zg=0,this.Qg=0,this._g=1,this.tm="",this.im="",this.em=!1,this.sm=!1,this.nm=0,this.om=0,this.rm=!1,this.lm=!1,this.No=!1,this.hm=null,this.am=0,this.cm=null,this.ke=null}copy(){const t=new InputEvent;return this.clone(t)}clone(t){return t.p=this.p,t.Cw.a(this.viewPoint),t.Lw.a(this.documentPoint),t.Zg=this.Zg,t.Qg=this.Qg,t._g=this._g,t.tm=this.tm,t.im=this.im,t.em=this.em,t.sm=this.sm,t.nm=this.nm,t.om=this.om,t.rm=this.rm,t.lm=this.lm,t.No=this.No,t.hm=this.hm,t.am=this.am,t.cm=this.cm,t.ke=this.ke,t}toString(){let t="^";return this.modifiers!==0&&(t+="M:"+this.modifiers),this.button!==0&&(t+="B:"+this.button),this.key!==""&&(t+="K:"+this.key),this.clickCount!==0&&(t+="C:"+this.clickCount),this.delta!==0&&(t+="D:"+this.delta),this.handled&&(t+="h"),this.bubbles&&(t+="b"),this.documentPoint!==null&&(t+="@"+this.documentPoint.toString()),t}get diagram(){return this.p}set diagram(t){this.p=t}get viewPoint(){return this.Cw}set viewPoint(t){this.Cw.a(t)}get documentPoint(){return this.Lw}set documentPoint(t){this.Lw.a(t)}getMultiTouchViewPoint(t,i){const e=this.diagram;return e===null||e.PC(this.event,t,i),i}getMultiTouchDocumentPoint(t,i){const e=this.diagram;return e===null||(e.PC(this.event,t,i),i.a(e.transformViewToDoc(i))),i}get modifiers(){return this.Zg}set modifiers(t){this.Zg=t}get button(){return this.Qg}set button(t){if(this.Qg=t,this.event===null)switch(t){case 0:this.buttons=1;return;case 1:this.buttons=4;return;case 2:this.buttons=2;return}}get buttons(){return this._g}set buttons(t){this._g=t}get key(){return this.tm}set key(t){this.tm=t}get code(){return this.im}set code(t){this.im=t}get down(){return this.em}set down(t){this.em=t}get up(){return this.sm}set up(t){this.sm=t}get clickCount(){return this.nm}set clickCount(t){this.nm=t}get delta(){return this.om}set delta(t){this.om=t}get isMultiTouch(){return this.rm}set isMultiTouch(t){this.rm=t}get handled(){return this.lm}set handled(t){this.lm=t}get bubbles(){return this.No}set bubbles(t){this.No=t}get event(){return this.hm}set event(t){this.hm=t}get isTouchEvent(){const t=this.event;return t===null?!1:t.pointerType==="touch"||t.pointerType==="pen"}get timestamp(){return this.am}set timestamp(t){this.am=t}get targetDiagram(){return this.cm}set targetDiagram(t){this.cm=t}get targetObject(){return this.ke}set targetObject(t){this.ke=t}get control(){return(this.modifiers&1)!==0}set control(t){this.modifiers=t?this.modifiers|1:this.modifiers&-2}get shift(){return(this.modifiers&4)!==0}set shift(t){this.modifiers=t?this.modifiers|4:this.modifiers&-5}get alt(){return(this.modifiers&2)!==0}set alt(t){this.modifiers=t?this.modifiers|2:this.modifiers&-3}get meta(){return(this.modifiers&8)!==0}set meta(t){this.modifiers=t?this.modifiers|8:this.modifiers&-9}get left(){const t=this.event;return t!==null&&(t.type==="mousedown"||t.type==="mouseup"||t.type==="pointerdown"||t.type==="pointerup")?this.button===0:(this.buttons&1)!==0}set left(t){t?this.buttons|=1:this.buttons&=-2}get right(){const t=this.event;return t!==null&&(t.type==="mousedown"||t.type==="mouseup"||t.type==="pointerdown"||t.type==="pointerup")?this.button===2:(this.buttons&2)!==0}set right(t){t?this.buttons|=2:this.buttons&=-3}get middle(){const t=this.event;return t!==null&&(t.type==="mousedown"||t.type==="mouseup"||t.type==="pointerdown"||t.type==="pointerup")?this.button===1:(this.buttons&4)!==0}set middle(t){t?this.buttons|=4:this.buttons&=-5}get commandKey(){const t=this.code,i=this.key;return"cxvyzagCXVYZAG".includes(i)?i.toLowerCase():t==="KeyC"?"c":t==="KeyX"?"x":t==="KeyV"?"v":t==="KeyY"?"y":t==="KeyZ"?"z":t==="KeyA"?"a":t==="KeyG"?"g":t!==""?t:i}}class DiagramEvent{p;St;fm;um;constructor(){this.p=null,this.St="",this.fm=null,this.um=null}copy(){const t=new DiagramEvent;return t.p=this.p,t.St=this.St,t.fm=this.fm,t.um=this.um,t}toString(){let t="*"+this.name;return this.subject!==null&&(t+=":"+this.subject.toString()),this.parameter!==null&&(t+="("+this.parameter.toString()+")"),t}get diagram(){return this.p}set diagram(t){this.p=t}get name(){return this.St}set name(t){this.St=t}get subject(){return this.fm}set subject(t){this.fm=t}get parameter(){return this.um}set parameter(t){this.um=t}}var ChangeType=(w=>(w[w.Transaction=1]="Transaction",w[w.Property=2]="Property",w[w.Insert=3]="Insert",w[w.Remove=4]="Remove",w))(ChangeType||{});class ChangedEvent{uu;dm;an;Mi;p;du;rc;lc;hc;ac;constructor(){this.uu=2,this.dm="",this.an="",this.Mi=null,this.p=null,this.du=null,this.rc=null,this.lc=null,this.hc=null,this.ac=null}static Transaction=1;static Property=2;static Insert=3;static Remove=4;clear(){this.Mi=null,this.p=null,this.du=null,this.rc=null,this.lc=null,this.hc=null,this.ac=null}copy(){const t=new ChangedEvent;t.uu=this.uu,t.dm=this.dm,t.an=this.an,t.Mi=this.Mi,t.p=this.p,t.du=this.du;let i=this.rc;return Util.wt(i)&&typeof i.copyFrozen=="function"?t.rc=i.copyFrozen():t.rc=i,i=this.lc,Util.wt(i)&&typeof i.copyFrozen=="function"?t.lc=i.copyFrozen():t.lc=i,i=this.hc,Util.wt(i)&&typeof i.copyFrozen=="function"?t.hc=i.copyFrozen():t.hc=i,i=this.ac,Util.wt(i)&&typeof i.copyFrozen=="function"?t.ac=i.copyFrozen():t.ac=i,t}li(t){t in ChangeType?this.change=t:Util.rr(this,t)}toString(){let t="";return this.change===1?t+="* ":this.change===2?t+=this.model!==null?"!m":"!d":t+=(this.model!==null?"!m":"!d")+this.change,this.propertyName&&typeof this.propertyName=="string"&&(t+=" "+this.propertyName),this.modelChange&&this.modelChange!==this.propertyName&&(t+=" "+this.modelChange),t+=": ",this.change===1?this.oldValue!==null&&(t+=" "+this.oldValue):(this.object!==null&&(t+=Util.toString(this.object)),this.oldValue!==null&&(t+="  old: "+Util.toString(this.oldValue)),this.oldParam!==null&&(t+=" "+this.oldParam),this.newValue!==null&&(t+="  new: "+Util.toString(this.newValue)),this.newParam!==null&&(t+=" "+this.newParam)),t}getValue(t){return t?this.oldValue:this.newValue}getParam(t){return t?this.oldParam:this.newParam}canUndo(){return this.model!==null||this.diagram!==null}undo(){this.canUndo()&&(this.model!==null?this.model.changeState(this,!0):this.diagram!==null&&this.diagram.MC(this,!0))}canRedo(){return this.model!==null||this.diagram!==null}redo(){this.canRedo()&&(this.model!==null?this.model.changeState(this,!1):this.diagram!==null&&this.diagram.MC(this,!1))}get model(){return this.Mi}set model(t){this.Mi=t}get diagram(){return this.p}set diagram(t){this.p=t}get change(){return this.uu}set change(t){this.uu=t}get modelChange(){return this.dm}set modelChange(t){this.dm=t}get propertyName(){return this.an}set propertyName(t){this.an=t}get isTransactionFinished(){return this.uu===1&&(this.an==="CommittedTransaction"||this.an==="FinishedUndo"||this.an==="FinishedRedo")}get object(){return this.du}set object(t){this.du=t}get oldValue(){return this.rc}set oldValue(t){this.rc=t}get oldParam(){return this.lc}set oldParam(t){this.lc=t}get newValue(){return this.hc}set newValue(t){this.hc=t}get newParam(){return this.ac}set newParam(t){this.ac=t}}class Transaction{SC;St;Kk;constructor(){this.SC=new List().g(),this.St="",this.Kk=!1}toString(t){let i="Transaction: "+this.name+" "+this.changes.count.toString()+(this.isComplete?"":", incomplete");if(t!==void 0&&t>0){const e=this.changes.count;for(let s=0;s<e;s++){const n=this.changes.elt(s);n!==null&&(i+=`
  `+n.toString())}}return i}clear(){const t=this.changes;t.ot();for(let i=t.count-1;i>=0;i--){const e=t.elt(i);e!==null&&e.clear()}t.clear(),t.g()}canUndo(){return this.isComplete}undo(){if(this.canUndo())for(let t=this.changes.count-1;t>=0;t--){const i=this.changes.elt(t);i!==null&&i.undo()}}canRedo(){return this.isComplete}redo(){if(!this.canRedo())return;const t=this.changes.count;for(let i=0;i<t;i++){const e=this.changes.elt(i);e!==null&&e.redo()}}HD(t){const i=this.changes;for(let e=i.count-1;e>=t;e--){const s=i.elt(e);s!==null&&s.undo(),i.ot(),i.removeAt(e)}i.g()}optimize(){if(!this.isComplete)return;const t=this.changes;t.ot();const i=new GMap;for(let s=0;s<t.count;s++){const n=t.elt(s);if(n===null||n.change!==2||!n.object)continue;let o=i.get(n.object);o||(o=new GMap,i.set(n.object,o));const r=o.get(n.propertyName);r===null?o.set(n.propertyName,-1):(r>0&&t.setElt(r,null),o.set(n.propertyName,s))}let e=0;for(let s=0;s<t.count;s++){const n=t.elt(s);n!==null&&(s>e&&t.setElt(e,n),e++)}for(;t.length>e;)t.pop();t.g()}get changes(){return this.SC}get name(){return this.St}set name(t){this.St=t}get isComplete(){return this.Kk}set isComplete(t){this.Kk=t}}class UndoManager{Aw;Ii;NC;vs;Yk;gm;Yn;Gk;jk;cn;cc;Tw;Os;Dw;Fw;mm;Rw;constructor(t){this.Aw=new GSet,this.Ii=!1,this.NC=new List().g(),this.vs=-1,this.Yk=999,this.Os=!1,this.gm=null,this.Yn=0,this.Gk=!1,this.jk=23,this.cn=new List().g(),this.cc=new List,this.Tw=!0,this.Dw=!1,this.Fw=!1,this.mm=!1,this.Rw=!1,t&&Object.assign(this,t)}toString(t){let i="UndoManager "+this.historyIndex+"<"+this.history.count+"<="+this.maxHistoryLength;i+="[";let e=this.nestedTransactionNames.count;for(let s=0;s<e;s++)s>0&&(i+=" "),i+=this.nestedTransactionNames.elt(s);if(i+="]",t!==void 0&&t>0){e=this.history.count;for(let s=0;s<e;s++)i+=`
 `+this.history.elt(s).toString(t-1)}return i}clear(){const t=this.history;t.ot();for(let i=t.count-1;i>=0;i--){const e=t.elt(i);e!==null&&e.clear()}t.clear(),this.vs=-1,t.g(),this.Os=!1,this.gm=null,this.Yn=0,this.cn.ot(),this.cn.clear(),this.cn.g(),this.cc.clear(),this.Dw=!1,this.Fw=!1,this.mm=!1,this.Rw=!1}copyProperties(t){this.isEnabled=t.isEnabled,this.maxHistoryLength=t.maxHistoryLength,this.pm=t.pm}addModel(t){this.Aw.add(t)}removeModel(t){this.Aw.delete(t)}startTransaction(t){if(t===void 0&&(t=""),t===null&&(t=""),this.isUndoingRedoing)return!1;this.Tw===!0&&(this.Tw=!1,this.Yn++,this.wl||this.t("StartingFirstTransaction",t,this.currentTransaction),this.Yn>0&&this.Yn--),this.isEnabled&&(this.cn.ot(),this.cn.add(t),this.cn.g(),this.currentTransaction===null?this.cc.add(0):this.cc.add(this.currentTransaction.changes.count)),this.Yn++;const i=this.transactionLevel===1;return i&&(this.wl||this.t("StartedTransaction",t,this.currentTransaction)),i}commitTransaction(t){return t===void 0&&(t=""),this.CC(!0,t)}rollbackTransaction(){return this.CC(!1,"")}CC(t,i){if(this.isUndoingRedoing)return!1;this.pm&&this.transactionLevel<1&&Util.ei("Ending transaction without having started a transaction: "+i);const e=this.transactionLevel===1;let s=this.currentTransaction;e&&t&&(this.wl||this.t("CommittingTransaction",i,s));let n=0;if(this.transactionLevel>0&&(this.Yn--,this.isEnabled)){const o=this.cn.count;o>0&&(i===""&&(i=this.cn.elt(0)),this.cn.ot(),this.cn.removeAt(o-1),this.cn.g());const r=this.cc.count;r>0&&(n=this.cc.elt(r-1),this.cc.removeAt(r-1))}if(e){if(t){if(this.mm=!1,s===null&&i!==""&&(s=this.currentTransaction),this.isEnabled&&s!==null){const o=s;o.isComplete||(o.isComplete=!0,o.name=i),this.discardHistoryAfterIndex();const r=this.history;r.ot();const l=this.maxHistoryLength;if(l>=0){if(l===0)r.clear();else if(r.count>=l){const h=r.elt(0);h!==null&&h.clear(),r.removeAt(0),this.vs--}}l!==0&&(r.count===0||r.get(r.count-1)!==o)&&(r.add(o),this.vs++),r.g(),s=o}this.wl||this.t("CommittedTransaction",i,s)}else{this.Os=!0;try{this.isEnabled&&s!==null&&(s.isComplete=!0,s.undo())}finally{this.wl||this.t("RolledBackTransaction",i,s),this.Os=!1}s!==null&&s.clear()}return this.gm=null,this.vw&&this.clear(),this.vw=!1,this.Ow=!1,!0}else return this.isEnabled&&!t&&s!==null&&s.HD(n),!1}discardHistoryAfterIndex(){if(this.isUndoingRedoing||!this.canRedo())return;const t=this.history;t.ot();for(let i=t.count-1;i>this.historyIndex;i--){const e=t.elt(i);e!==null&&e.clear(),t.removeAt(i),this.mm=!0}t.g()}oE(t){this.Yn+=t,this.Yn<0&&(this.Yn=0)}canUndo(){if(!this.isEnabled||this.transactionLevel>0)return!1;const t=this.transactionToUndo;return!!(t!==null&&t.canUndo())}undo(){if(!this.canUndo())return;const t=this.transactionToUndo;try{this.Os=!0,this.t("StartingUndo","Undo",t),this.vs--,t.undo()}catch(i){Util.ei("undo error: "+i.toString())}finally{this.t("FinishedUndo","Undo",t),this.Os=!1}}canRedo(){if(!this.isEnabled||this.transactionLevel>0)return!1;const t=this.transactionToRedo;return!!(t!==null&&t.canRedo())}redo(){if(!this.canRedo())return;const t=this.transactionToRedo;try{this.Os=!0,this.t("StartingRedo","Redo",t),this.vs++,t.redo()}catch(i){Util.ei("redo error: "+i.toString())}finally{this.t("FinishedRedo","Redo",t),this.Os=!1}}t(t,i,e){e===void 0&&(e=null);const s=new ChangedEvent;s.change=1,s.propertyName=t,s.object=e,s.oldValue=i;const n=this.models;for(;n.next();){const o=n.value;s.model=o,o.Iw(s)}}handleChanged(t){if(this.isEnabled&&!this.isUndoingRedoing&&!this.skipsEvent(t)){let i=this.currentTransaction;i===null&&(i=new Transaction,this.gm=i);const e=t.copy(),s=i.changes;if(s.ot(),s.add(e),s.g(),this.pm&&this.jk>0&&this.transactionLevel<=0&&!this.Tw){const n=t.diagram;if(n!==null&&n.Bh===!1)return;Util.ei("Change not within a transaction: "+e.toString()),this.jk--}}}skipsEvent(t){if(t===null||t.change===1)return!0;const i=t.object;if(i===null)return!1;if(i.layer!==void 0){const e=i.layer;if(e!==null&&e.isTemporary)return!0}else if(i.isTemporary)return!0;return!1}get models(){return this.Aw.iterator}get isEnabled(){return this.Ii}set isEnabled(t){this.Ii=t}get transactionToUndo(){return this.historyIndex>=0&&this.historyIndex<=this.history.count-1?this.history.elt(this.historyIndex):null}get transactionToRedo(){return this.historyIndex<this.history.count-1?this.history.elt(this.historyIndex+1):null}get isUndoingRedoing(){return this.Os}get history(){return this.NC}get maxHistoryLength(){return this.Yk}set maxHistoryLength(t){this.Yk=t}get historyIndex(){return this.vs}get currentTransaction(){return this.gm}get transactionLevel(){return this.Yn}get isInTransaction(){return this.Yn>0}get pm(){return this.Gk}set pm(t){this.Gk=t}get nestedTransactionNames(){return this.cn}get vw(){return this.Dw}set vw(t){this.Dw=t}get Ow(){return this.Fw}set Ow(t){this.Fw=t}get wl(){return this.Rw}set wl(t){this.Rw=t}get isJustDiscarded(){return this.mm}}class Tool{p;St;Ii;Hk;qk;ym;LC;constructor(){GSet.ji(this),this.p=Diagram.wm(),this.St="",this.Ii=!0,this.Hk=!1,this.qk=null,this.LC=new InputEvent,this.ym=-1}get diagram(){return this.p}set diagram(t){t instanceof Diagram&&(this.p=t)}toString(){return this.name!==""?this.name+" Tool":Util.sn(this.constructor)}updateAdornments(t){}canStart(){return this.isEnabled}doStart(){}doActivate(){this.isActive=!0}doDeactivate(){this.isActive=!1}doStop(){}doCancel(){this.transactionResult=null,this.stopTool()}stopTool(){const t=this.diagram;t.currentTool===this&&(t.currentTool=null,t.currentCursor="")}doMouseDown(){!this.isActive&&this.canStart()&&this.doActivate()}doMouseMove(){}doMouseUp(){this.stopTool()}doMouseWheel(){}canStartMultiTouch(){return!0}standardPinchZoomStart(){const t=this.diagram,i=t.lastInput,e=i.getMultiTouchViewPoint(0,Point.X(NaN,NaN)),s=i.getMultiTouchViewPoint(1,Point.X(NaN,NaN));if(!e.isReal()||!s.isReal()){Point.s(e),Point.s(s);return}if(this.doCancel(),t.getInputOption("hasGestureZoom")){t.Wk=t.scale;const n=s.x-e.x,o=s.y-e.y,r=Math.sqrt(n*n+o*o);t.Jk=r,i.bubbles=!1}Point.s(e),Point.s(s)}standardPinchZoomMove(){const t=this.diagram,i=t.lastInput,e=i.getMultiTouchViewPoint(0,Point.X(NaN,NaN)),s=i.getMultiTouchViewPoint(1,Point.X(NaN,NaN));if(!e.isReal()||!s.isReal()){Point.s(e),Point.s(s);return}if(this.doCancel(),t.getInputOption("hasGestureZoom")){const n=s.x-e.x,o=s.y-e.y,l=Math.sqrt(n*n+o*o)/t.Jk,h=new Point((Math.min(s.x,e.x)+Math.max(s.x,e.x))/2,(Math.min(s.y,e.y)+Math.max(s.y,e.y))/2),a=t.Wk*l,c=t.commandHandler;if(a!==t.scale&&c.canResetZoom(a)){const f=t.zoomPoint;t.zoomPoint=h,c.resetZoom(a),t.zoomPoint=f}i.bubbles=!1}Point.s(e),Point.s(s)}doKeyDown(){this.diagram.lastInput.code==="Escape"&&this.doCancel()}doKeyUp(){}startTransaction(t){return t===void 0&&(t=this.name),this.transactionResult=null,this.diagram.startTransaction(t)}stopTransaction(){const t=this.diagram;return this.transactionResult===null?t.rollbackTransaction():t.commitTransaction(this.transactionResult)}standardMouseSelect(){const t=this.diagram;if(!t.allowSelect)return;const i=t.lastInput,e=t.findPartAt(i.documentPoint,!1);if(e!==null){if(Util.or?i.meta:i.control){t.v("ChangingSelection",t.selection);let s=e;for(;s!==null&&!s.canSelect();)s=s.containingGroup;s!==null&&(s.isSelected=!s.isSelected),t.v("ChangedSelection",t.selection)}else if(i.shift){if(!e.isSelected){t.v("ChangingSelection",t.selection);let s=e;for(;s!==null&&!s.canSelect();)s=s.containingGroup;s!==null&&(s.isSelected=!0),t.v("ChangedSelection",t.selection)}}else if(!e.isSelected){let s=e;for(;s!==null&&!s.canSelect();)s=s.containingGroup;s!==null&&t.select(s)}}else i.left&&!(Util.or?i.meta:i.control)&&!i.shift&&t.clearSelection()}standardMouseClick(t,i){t===void 0&&(t=null),i===void 0&&(i=o=>!o.layer.isTemporary);const e=this.diagram,s=e.lastInput,n=e.findObjectAt(s.documentPoint,t,i);return s.targetObject=n,this.qD(n,s,e),s.handled}qD(t,i,e){if(i.handled=!1,t!==null&&!t.isEnabledObject())return;let s=0;i.left?i.clickCount===1?s=1:i.clickCount===2?s=2:s=1:i.right&&i.clickCount===1&&(s=3);let n="ObjectSingleClicked";if(t!==null){switch(s){case 1:n="ObjectSingleClicked";break;case 2:n="ObjectDoubleClicked";break;case 3:n="ObjectContextClicked";break}s!==0&&e.v(n,t)}else{switch(s){case 1:n="BackgroundSingleClicked";break;case 2:n="BackgroundDoubleClicked";break;case 3:n="BackgroundContextClicked";break}s!==0&&e.v(n)}if(t!==null)for(;t!==null;){let o=null;switch(s){case 1:o=t.click;break;case 2:o=t.doubleClick?t.doubleClick:t.click;break;case 3:o=t.contextClick;break}if(o!==null&&(o(i,t),i.handled))break;t=t.panel}else{let o=null;switch(s){case 1:o=e.click;break;case 2:o=e.doubleClick?e.doubleClick:e.click;break;case 3:o=e.contextClick;break}o!==null&&o(i)}}standardMouseOver(){const t=this.diagram,i=t.lastInput;if(t.animationManager.wi===!0)return;const e=t.skipsUndoManager;t.skipsUndoManager=!0;let s=t.viewportBounds.containsPoint(i.documentPoint)?t.findObjectAt(i.documentPoint,null,null):null;i.event&&(i.event.type==="pointercancel"||i.event.type==="pointerout")&&(s=null),i.targetObject=s;let n=!1;if(s!==t.fc){let o=t.fc;const r=o;for(t.fc=s,this.doCurrentObjectChanged(o,s),i.handled=!1;o!==null;){const l=o.mouseLeave;if(l!==null&&(s===o||s!==null&&s.isContainedBy(o)||(l(i,o,s),n=!0,i.handled)))break;o=o.panel}for(o=r,i.handled=!1;s!==null;){const l=s.mouseEnter;if(l!==null&&(o===s||o!==null&&o.isContainedBy(s)||(l(i,s,o),n=!0,i.handled)))break;s=s.panel}s=t.fc}if(s!==null){let o=s,r="";for(;o!==null&&(r=o.cursor,r==="");)o=o.panel;for(t.currentCursor=r,i.handled=!1,o=s;o!==null;){const l=o.mouseOver;if(l!==null&&(l(i,o),n=!0,i.handled))break;o=o.panel}}else{this.doUpdateCursor(null);const o=t.mouseOver;o!==null&&(o(i),n=!0)}n&&t.requestUpdate(),t.skipsUndoManager=e}doUpdateCursor(t){const i=this.diagram;i&&(i.currentCursor="")}doCurrentObjectChanged(t,i){}standardMouseWheel(){const t=this.diagram,i=t.lastInput;let e=i.delta;if(e===0||!t.documentBounds.isReal())return;const s=t.commandHandler,n=t.toolManager.mouseWheelBehavior;if(s!==null&&(n===2&&!i.shift||n===1&&i.control)){if(e>0?s.canIncreaseZoom():s.canDecreaseZoom()){const o=t.zoomPoint;t.zoomPoint=i.viewPoint,e>0?s.increaseZoom():s.decreaseZoom(),t.zoomPoint=o}i.bubbles=!1}else if(n===2&&i.shift||n===1&&!i.control){const o=t.position.copy(),r=i.event,l=r.deltaMode;let h=r.deltaX,a=r.deltaY,c="pixel";if((h!==0||a!==0)&&!i.shift){switch(l){case 0:c="pixel";break;case 1:c="line";break;case 2:c="page";break}if(h!==0&&t.allowHorizontalScroll){const f=t.scrollHorizontalLineChange;h=h*(f/16),t.scroll(c,h>0?"right":"left",Math.abs(h))}if(a!==0&&t.allowVerticalScroll){const f=t.scrollVerticalLineChange;a=a*(f/16),t.scroll(c,a>0?"down":"up",Math.abs(a))}}else!i.shift&&t.allowVerticalScroll?(e=e*3*t.scrollVerticalLineChange,t.scroll(c,e>0?"up":"down",Math.abs(e))):i.shift&&t.allowHorizontalScroll&&(e=e*3*t.scrollHorizontalLineChange,t.scroll(c,e>0?"left":"right",Math.abs(e)));this.doWheelChange(t,o,i)}}doWheelChange(t,i,e){(!t.position.equals(i)||e.event.wheelDeltaX!==0)&&(e.bubbles=!1)}standardWaitAfter(t,i){i===void 0&&(i=this.diagram.lastInput),this.cancelWaitAfter();const e=this,s=i.clone(this.LC);this.ym=Util.Oh(()=>e.doWaitAfter(s),t)}cancelWaitAfter(){this.ym!==-1&&Util.Ig(this.ym),this.ym=-1}doWaitAfter(t){}findToolHandleAt(t,i){const s=this.diagram.findObjectAt(t,n=>{for(;n!==null&&!(n.panel instanceof Adornment);)n=n.panel;return n});return s===null?null:s.part.category===i?s:null}isBeyondDragSize(t,i){const e=this.diagram;t===void 0&&(t=e.firstInput.viewPoint),i===void 0&&(i=e.lastInput.viewPoint);const s=e.toolManager.dragSize;let n=s.width,o=s.height;return e.firstInput.isTouchEvent&&(n+=6,o+=6),Math.abs(i.x-t.x)>n||Math.abs(i.y-t.y)>o}get name(){return this.St}set name(t){Util.i(t,"string",Tool,"name"),this.St=t}get isEnabled(){return this.Ii}set isEnabled(t){Util.i(t,"boolean",Tool,"isEnabled"),this.Ii=t}get isActive(){return this.Hk}set isActive(t){Util.i(t,"boolean",Tool,"isActive"),this.Hk=t}get transactionResult(){return this.qk}set transactionResult(t){t!==null&&Util.i(t,"string",Tool,"transactionResult"),this.qk=t}}var WheelMode=(w=>(w[w.Scroll=1]="Scroll",w[w.Zoom=2]="Zoom",w[w.None=3]="None",w))(WheelMode||{}),GestureMode=(w=>(w[w.Zoom=1]="Zoom",w[w.Cancel=2]="Cancel",w[w.None=3]="None",w))(GestureMode||{});class ToolManager extends Tool{AC;TC;DC;$k;Zk;Qk;_k;tP;iP;eP;xm;Uh;constructor(t){super(),this.name="ToolManager",this.AC=new List,this.TC=new List,this.DC=new List,this.$k=850,this.Zk=850,this.Qk=new Size(2,2).it(),this._k=5e3,this.tP=1,this.iP=1,this.eP=null,this.xm=null,this.Uh=-1,t&&Object.assign(this,t)}static WheelScroll=1;static WheelZoom=2;static WheelNone=3;static GestureZoom=1;static GestureCancel=2;static GestureNone=3;get mouseWheelBehavior(){return this.tP}set mouseWheelBehavior(t){this.tP=t}get gestureBehavior(){return this.iP}set gestureBehavior(t){this.iP=t}initializeStandardTools(){}updateAdornments(t){const i=this.currentToolTip;if(i instanceof Adornment&&this.xm===t){const e=i.adornedObject;(t!==null?e.part===t:e===null)?this.showToolTip(i,e):this.hideToolTip()}}doMouseDown(){const t=this.diagram,i=t.lastInput;if(i.isTouchEvent&&this.gestureBehavior===2&&(i.bubbles=!1),i.isMultiTouch){if(this.cancelWaitAfter(),this.gestureBehavior===3){i.bubbles=!0;return}if(this.gestureBehavior===2)return;if(t.currentTool.canStartMultiTouch()){t.currentTool.standardPinchZoomStart();return}}const e=t.undoManager,s=this.mouseDownTools.length;for(let n=0;n<s;n++){const o=this.mouseDownTools.elt(n);if(o.diagram=this.diagram,o.canStart()){t.doFocus(),t.currentTool=o,t.currentTool===o&&(o.isActive||o.doActivate(),o.doMouseDown());return}}t.lastInput.button===1&&(this.mouseWheelBehavior===1?this.mouseWheelBehavior=2:this.mouseWheelBehavior===2&&(this.mouseWheelBehavior=1)),this.doActivate(),this.standardWaitAfter(this.holdDelay,i)}doMouseMove(){const t=this.diagram,i=t.lastInput;if(i.isMultiTouch){if(this.gestureBehavior===3){i.bubbles=!0;return}if(this.gestureBehavior===2)return;if(t.currentTool.canStartMultiTouch()){t.currentTool.standardPinchZoomMove();return}}if(this.isActive){const s=this.mouseMoveTools.length;for(let n=0;n<s;n++){const o=this.mouseMoveTools.elt(n);if(o.diagram=this.diagram,o.canStart()){t.doFocus(),t.currentTool=o,t.currentTool===o&&(o.isActive||o.doActivate(),o.doMouseMove());return}}}this.standardMouseActivity(t);const e=i.event;e!==null&&(e.type==="pointermove"||!e.cancelable)&&(i.bubbles=!0)}standardMouseActivity(t){this.standardMouseOver(),this.isBeyondDragSize()&&this.standardWaitAfter(this.isActive?this.holdDelay:this.hoverDelay,t.lastInput)}doCurrentObjectChanged(t,i){const e=this.currentToolTip;e!==null&&(i!==null&&e instanceof Adornment&&(i===e||i.isContainedBy(e))||this.hideToolTip())}doWaitAfter(t){const i=this.diagram;if(i.WD()&&(this.doMouseHover(),this.isActive||this.doToolTip(),t.isTouchEvent&&!i.lastInput.handled)){const e=t.copy();e.button=2,i.lastInput=e,i.Ew=!0,i.doMouseUp();return}}doMouseHover(){const t=this.diagram,i=t.lastInput;i.targetObject===null&&(i.targetObject=t.findObjectAt(i.documentPoint,null,null));let e=i.targetObject;if(e!==null)for(i.handled=!1;e!==null;){const s=this.isActive?e.mouseHold:e.mouseHover;if(s!==null&&(s(i,e),i.handled))break;e=e.panel}else{const s=this.isActive?t.mouseHold:t.mouseHover;s!==null&&s(i)}}doToolTip(){const t=this.diagram,i=t.lastInput;i.targetObject===null&&(i.targetObject=t.findObjectAt(i.documentPoint,null,null));let e=i.targetObject;if(e!==null){const s=this.currentToolTip;if(s instanceof Adornment&&(e===s||e.isContainedBy(s)))return;for(;e!==null;){const n=e.toolTip;if(n!==null){this.showToolTip(n,e);return}e=e.panel}this.hideToolTip()}else{const s=t.toolTip;s!==null?this.showToolTip(s,null):this.hideToolTip()}}showToolTip(t,i){const e=this.diagram;if(t!==this.currentToolTip&&this.hideToolTip(),t instanceof Adornment){t.layerName="Tool",t.selectable=!1,t.scale=1/e.scale,t.category="ToolTip",t.hasPlaceholder()&&(t.placeholder.scale=e.scale);const n=t.diagram;n!==null&&n!==e&&n.remove(t),e.add(t),i!==null?t.adornedObject=i:t.data=e.model,t.ensureBounds(),this.positionToolTip(t,i)}else t instanceof HTMLInfo&&t!==this.currentToolTip&&t.show(i,e,this);this.currentToolTip=t,this.Uh!==-1&&(Util.Ig(this.Uh),this.Uh=-1);const s=this.toolTipDuration;if(s>0&&s!==1/0){const n=this;this.Uh=Util.Oh(()=>n.hideToolTip(),s)}}positionToolTip(t,i){if(t.hasPlaceholder())return;const e=t,s=this.diagram,n=s.lastInput.documentPoint.copy(),o=e.measuredBounds,r=s.viewportBounds;s.lastInput.isTouchEvent&&(n.x-=o.width),n.x+o.width>r.right&&(n.x-=o.width+5/s.scale),n.x<r.x&&(n.x=r.x),n.y+20/s.scale+o.height>r.bottom?n.y-=o.height+5/s.scale:n.y+=20/s.scale,n.y<r.y&&(n.y=r.y),e.position=n}hideToolTip(){this.Uh!==-1&&(Util.Ig(this.Uh),this.Uh=-1);const t=this.diagram,i=this.currentToolTip;i!==null&&(i instanceof Adornment?(t.remove(i),this.xm!==null&&this.xm.removeAdornment(i.category),i.data=null,i.adornedObject=null):i instanceof HTMLInfo&&i.hide!==null&&i.hide(t,this),this.currentToolTip=null)}get currentToolTip(){return this.eP}set currentToolTip(t){this.eP=t,this.xm=t!==null&&t instanceof Adornment?t.adornedPart:null}doMouseUp(){this.cancelWaitAfter();const t=this.diagram;if(this.isActive){const i=this.mouseUpTools.length;for(let e=0;e<i;e++){const s=this.mouseUpTools.elt(e);if(s.diagram=this.diagram,s.canStart()){t.doFocus(),t.currentTool=s,t.currentTool===s&&(s.isActive||s.doActivate(),s.doMouseUp());return}}}t.doFocus(),this.doDeactivate()}doMouseWheel(){this.standardMouseWheel()}doKeyDown(){const t=this.diagram;t.commandHandler!==null&&t.commandHandler.doKeyDown()}doKeyUp(){const t=this.diagram;t.commandHandler!==null&&t.commandHandler.doKeyUp()}findTool(t){Util.i(t,"string",ToolManager,"findTool:name");let i=this.mouseDownTools.length;for(let e=0;e<i;e++){const s=this.mouseDownTools.elt(e);if(s.name===t)return s}i=this.mouseMoveTools.length;for(let e=0;e<i;e++){const s=this.mouseMoveTools.elt(e);if(s.name===t)return s}i=this.mouseUpTools.length;for(let e=0;e<i;e++){const s=this.mouseUpTools.elt(e);if(s.name===t)return s}return null}replaceTool(t,i){Util.i(t,"string",ToolManager,"replaceTool:name"),i!==null&&(i.diagram=this.diagram);let e=this.mouseDownTools.length;for(let s=0;s<e;s++){const n=this.mouseDownTools.elt(s);if(n.name===t)return i!==null?this.mouseDownTools.setElt(s,i):this.mouseDownTools.removeAt(s),n}e=this.mouseMoveTools.length;for(let s=0;s<e;s++){const n=this.mouseMoveTools.elt(s);if(n.name===t)return i!==null?this.mouseMoveTools.setElt(s,i):this.mouseMoveTools.removeAt(s),n}e=this.mouseUpTools.length;for(let s=0;s<e;s++){const n=this.mouseUpTools.elt(s);if(n.name===t)return i!==null?this.mouseUpTools.setElt(s,i):this.mouseUpTools.removeAt(s),n}return null}replaceStandardTool(t,i,e){this.$t(t,i,e)}$t(t,i,e){Util.i(t,"string",ToolManager,"replaceStandardTool:name"),i!==null&&(i.name=t,i.diagram=this.diagram),this.findTool(t)?this.replaceTool(t,i):i!==null&&e.add(i)}get mouseDownTools(){return this.AC}get mouseMoveTools(){return this.TC}get mouseUpTools(){return this.DC}get hoverDelay(){return this.$k}set hoverDelay(t){Util.i(t,"number",ToolManager,"hoverDelay"),this.$k=t}get holdDelay(){return this.Zk}set holdDelay(t){Util.i(t,"number",ToolManager,"holdDelay"),this.Zk=t}get dragSize(){return this.Qk}set dragSize(t){this.Qk=t.N()}get toolTipDuration(){return this._k}set toolTipDuration(t){Util.i(t,"number",ToolManager,"toolTipDuration"),this._k=t}get actionTool(){return this.findTool("Action")}set actionTool(t){this.$t("Action",t,this.mouseDownTools)}get relinkingTool(){return this.findTool("Relinking")}set relinkingTool(t){this.$t("Relinking",t,this.mouseDownTools)}get linkReshapingTool(){return this.findTool("LinkReshaping")}set linkReshapingTool(t){this.$t("LinkReshaping",t,this.mouseDownTools)}get resizingTool(){return this.findTool("Resizing")}set resizingTool(t){this.$t("Resizing",t,this.mouseDownTools)}get rotatingTool(){return this.findTool("Rotating")}set rotatingTool(t){this.$t("Rotating",t,this.mouseDownTools)}get linkingTool(){return this.findTool("Linking")}set linkingTool(t){this.$t("Linking",t,this.mouseMoveTools)}get draggingTool(){return this.findTool("Dragging")}set draggingTool(t){this.$t("Dragging",t,this.mouseMoveTools)}get dragSelectingTool(){return this.findTool("DragSelecting")}set dragSelectingTool(t){this.$t("DragSelecting",t,this.mouseMoveTools)}get panningTool(){return this.findTool("Panning")}set panningTool(t){this.$t("Panning",t,this.mouseMoveTools)}get contextMenuTool(){return this.findTool("ContextMenu")}set contextMenuTool(t){this.$t("ContextMenu",t,this.mouseUpTools)}get textEditingTool(){return this.findTool("TextEditing")}set textEditingTool(t){this.$t("TextEditing",t,this.mouseUpTools)}get clickCreatingTool(){return this.findTool("ClickCreating")}set clickCreatingTool(t){this.$t("ClickCreating",t,this.mouseUpTools)}get clickSelectingTool(){return this.findTool("ClickSelecting")}set clickSelectingTool(t){this.$t("ClickSelecting",t,this.mouseUpTools)}}class DraggingTool extends Tool{sP;nP;fn;oP;rP;lP;hP;uc;bm;aP;Vh;gr;FC;cP;gu;mu;fP;uP;dP;gP;constructor(t){super(),this.name="Dragging",this.sP=!0,this.gP=!0,this.nP=!0,this.fn=null,this.oP=null,this.rP=null,this.lP=null,this.hP=!1,this.gu=!1,this.uc=new Point(NaN,NaN),this.bm=new Point,this.aP=!0,this.Vh=100,this.gr=[],this.FC=new GSet().g(),this.cP=new DraggingOptions,this.mu=null,this.fP="copy",this.uP="",this.dP="no-drop",t&&Object.assign(this,t)}get isCopyEnabled(){return this.sP}set isCopyEnabled(t){Util.i(t,"boolean",DraggingTool,"isCopyEnabled"),this.sP=t}get copiesEffectiveCollection(){return this.nP}set copiesEffectiveCollection(t){Util.i(t,"boolean",DraggingTool,"copiesEffectiveCollection"),this.nP=t}get dragOptions(){return this.cP}set dragOptions(t){this.cP=t}get isGridSnapEnabled(){return this.dragOptions.isGridSnapEnabled}set isGridSnapEnabled(t){Util.i(t,"boolean",DraggingTool,"isGridSnapEnabled"),this.dragOptions.isGridSnapEnabled=t}get isComplexRoutingRealtime(){return this.aP}set isComplexRoutingRealtime(t){this.aP=t;const i=this.diagram.findRouter("AvoidsLinks");i!==null&&(i.isRealtime=t)}get isGridSnapRealtime(){return this.dragOptions.isGridSnapRealtime}set isGridSnapRealtime(t){Util.i(t,"boolean",DraggingTool,"isGridSnapRealtime"),this.dragOptions.isGridSnapRealtime=t}get gridSnapCellSize(){return this.dragOptions.gridSnapCellSize}set gridSnapCellSize(t){this.dragOptions.gridSnapCellSize.equals(t)||(t=t.N(),this.dragOptions.gridSnapCellSize=t)}get gridSnapCellSpot(){return this.dragOptions.gridSnapCellSpot}set gridSnapCellSpot(t){this.dragOptions.gridSnapCellSpot.equals(t)||(t=t.N(),this.dragOptions.gridSnapCellSpot=t)}get gridSnapOrigin(){return this.dragOptions.gridSnapOrigin}set gridSnapOrigin(t){this.dragOptions.gridSnapOrigin.equals(t)||(t=t.N(),this.dragOptions.gridSnapOrigin=t)}get dragsLink(){return this.dragOptions.dragsLink}set dragsLink(t){Util.i(t,"boolean",DraggingTool,"dragsLink"),this.dragOptions.dragsLink=t}get dragsTree(){return this.dragOptions.dragsTree}set dragsTree(t){Util.i(t,"boolean",DraggingTool,"dragsTree"),this.dragOptions.dragsTree=t}get copyCursor(){return this.fP}set copyCursor(t){this.fP=t}get moveCursor(){return this.uP}set moveCursor(t){this.uP=t}get nodropCursor(){return this.dP}set nodropCursor(t){this.dP=t}get currentPart(){return this.oP}set currentPart(t){this.oP=t}get copiedParts(){return this.lP}set copiedParts(t){this.lP=t}get draggedParts(){return this.rP}set draggedParts(t){this.rP=t}get draggingParts(){return this.copiedParts!==null?this.copiedParts.toKeySet():this.draggedParts!==null?this.draggedParts.toKeySet():this.FC}get draggedLink(){return this.diagram.draggedLink}set draggedLink(t){this.diagram.draggedLink=t}get isDragOutStarted(){return this.hP}set isDragOutStarted(t){this.hP=t}get startPoint(){return this.bm}set startPoint(t){this.bm.equals(t)||this.bm.a(t)}get delay(){return this.Vh}set delay(t){Util.i(t,"number",DraggingTool,"delay"),this.Vh=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(t===null||t.isReadOnly&&!t.allowDragOut||!t.allowMove&&!t.allowCopy&&!t.allowDragOut||!t.allowSelect)return!1;const i=t.lastInput;return!i.left||t.currentTool!==this&&(!this.isBeyondDragSize()||i.isTouchEvent&&i.timestamp-t.firstInput.timestamp<this.Vh)?!1:this.findDraggablePart()!==null}findDraggablePart(){const t=this.diagram;let i=t.findPartAt(t.firstInput.documentPoint,!1);if(i===null)return null;for(;i!==null&&!i.canSelect();)i=i.containingGroup;return i!==null&&(i.canMove()||i.canCopy())?i:null}standardMouseSelect(){const t=this.diagram;if(!t.allowSelect)return;let i=t.findPartAt(t.firstInput.documentPoint,!1);if(i!==null){for(;i!==null&&!i.canSelect();)i=i.containingGroup;if(this.currentPart=i,this.currentPart!==null&&!this.currentPart.isSelected){t.v("ChangingSelection",t.selection);const e=t.lastInput;!(Util.or?e.meta:e.control)&&!e.shift&&t.clearSelection(!0),this.currentPart.isSelected=!0,t.v("ChangedSelection",t.selection)}}}doActivate(){const t=this.diagram;this.mu=null,this.currentPart===null&&this.standardMouseSelect();const i=this.currentPart;if(i===null||!i.canMove()&&!i.canCopy())return;t.cacheGroupExternalLinks(!0),DraggingTool.yt=null,this.isActive=!0,this.uc.set(t.position),this.mP(t.selection),this.gr.length=0,t.animationManager.stopAnimation();const e=this.computeEffectiveCollection(t.selection,this.dragOptions);this.draggedParts=e,this.gP=this.diagram.layout.isRealtime,this.diagram.layout.isRealtime=!1,t.dc=!0,t.getRenderingHint("temporaryPixelRatio")===!0&&t.avgSpf>30&&t.Bw(),t.Uw(this.draggedParts),t.pu=!0,this.startTransaction("Drag"),this.startPoint=t.firstInput.documentPoint,t.isMouseCaptured=!0,t.allowDragOut&&this.JD()}mP(t){if(!this.dragsLink)return;const i=this.diagram,e=i.model.gc(),s=t.first();e&&t.count===1&&s instanceof Link&&this.mayDragLink(s)?(this.draggedLink=s,this.draggedLink.canRelinkFrom()&&this.draggedLink.canRelinkTo()&&this.draggedLink.clearAdornments(),this.fn=i.toolManager.findTool("Relinking"),this.fn===null&&(this.fn=new RelinkingTool,this.fn.diagram=i),this.fn.originalLink=this.draggedLink):(this.draggedLink=null,this.fn=null)}mayDragLink(t){const i=this.diagram;return i!==null&&i.allowRelink}computeEffectiveCollection(t,i){return this.diagram.commandHandler.computeEffectiveCollection(t,i)}Is(t){return t===void 0?new DraggingInfo(Point.Po):this.isGridSnapEnabled?new DraggingInfo(new Point(Math.round(t.x*1e3)/1e3,Math.round(t.y*1e3)/1e3)):new DraggingInfo(t.copy())}doDeactivate(){this.isActive=!1;const t=this.diagram;this.diagram.layout.isRealtime=this.gP,t.pu=!1,t.xl=!0,t.cacheGroupExternalLinks(!1),t.stopAutoScroll(),this.pP(),t.km(this.draggedParts),this.mu=null,this.currentPart=null,this.draggedParts=null,this.isDragOutStarted=!1,this.gu=!1,DraggingTool.$D(),this.RC(),this.uc.e(NaN,NaN),DraggingTool.zh!==null&&(DraggingTool.zh.currentCursor=""),DraggingTool.zh=null,DraggingTool.yt=null,this.bl(),t.isMouseCaptured=!1,t.currentCursor="",t.dc=!1,this.stopTransaction(),t.yP(!0)}stopTransaction(){const t=this.diagram,i=super.stopTransaction();return i&&t.undoManager.transactionToUndo!==null&&t.undoManager.transactionToUndo.optimize(),i}pP(){const t=this.diagram,i=t.skipsUndoManager;t.skipsUndoManager=!0;const e=t.lastInput;this.vC(e,null),t.skipsUndoManager=i,this.gr.length=0}OC(){this.bl(),this.wP();const t=this.diagram;this.uc.isReal()&&(t.position=this.uc),t.stopAutoScroll()}doCancel(){this.bl(),this.wP();const t=this.diagram;this.uc.isReal()&&(t.position=this.uc),this.stopTool()}doKeyDown(){const t=this.diagram,i=t.lastInput;this.isActive&&(i.code==="Escape"?this.doCancel():i.code!==t.previousInput.code&&this.doMouseMove())}doKeyUp(){this.isActive&&this.doMouseMove()}ZD(t,i){let e=1/0,s=1/0,n=-1/0,o=-1/0;const r=t.iterator;for(;r.next();){const l=r.value;if(!l.isVisible())continue;const h=l.location,a=h.x,c=h.y;isNaN(a)||isNaN(c)||(a<e&&(e=a),c<s&&(s=c),a>n&&(n=a),c>o&&(o=c))}return e===1/0?i.e(0,0,0,0):i.e(e,s,n-e,o-s),i}xP(t){if(this.copiedParts!==null)return;const i=this.diagram;if(t&&(i.isReadOnly||i.isModelReadOnly)||this.draggedParts===null)return;const e=i.undoManager;e.isEnabled&&e.isInTransaction?e.currentTransaction!==null&&e.currentTransaction.changes.count>0&&(i.undoManager.rollbackTransaction(),i.startTransaction("Drag")):this.wP(),i.skipsUndoManager=!t,i.partManager.addsToTemporaryLayer=!t,this.startPoint=i.firstInput.documentPoint;const s=this.copiesEffectiveCollection?this.draggedParts.toKeySet():i.selection,n=i.copyParts(s,i,!0),o=new GMap,r=this.draggedParts.iterator;for(;r.next();){const h=r.key;if(h.Pe()&&h.canCopy()){const a=n.get(h);if(a===null)continue;a.location=h.location,a.ensureBounds(),o.set(a,this.Is(a.location))}}const l=n.iterator;for(;l.next();){const h=l.value;h instanceof Link&&h.canCopy()&&o.set(h,this.Is())}if(this.copiedParts=o,this.mP(o.toKeySet()),this.draggedLink!==null){const h=this.draggedLink,a=h.routeBounds;h.mr(this.startPoint.x-(a.x+a.width/2),this.startPoint.y-(a.y+a.height/2))}this.doUpdateCursor(null)}bl(){const t=this.diagram;if(this.copiedParts!==null){if(t.removeParts(this.copiedParts.toKeySet(),!1),this.copiedParts=null,this.draggedParts!==null){const i=this.draggedParts.iterator;for(;i.next();)if(i.key instanceof Link){const s=i.value;s.point=new Point(0,0)}}this.doUpdateCursor(null)}t.skipsUndoManager=!1,t.partManager.addsToTemporaryLayer=!1,this.startPoint=t.firstInput.documentPoint}RC(){this.draggedLink!==null&&(this.dragsLink&&this.fn!==null&&(this.fn.stopDraggingMouseMove(),this.fn.originalLink=null),this.draggedLink=null,this.fn=null)}mc(t,i){const e=this.diagram,s=this.startPoint,n=Point.l();n.a(e.lastInput.documentPoint),this.moveParts(t,n.subtract(s),i),Point.s(n),e.getRenderingHint("temporaryPixelRatio")===!0&&e.kl===null&&e.avgSpf>30&&(e.Bw(),e.yu())}moveParts(t,i,e){e===void 0&&(e=!1);const s=this.diagram;s!==null&&s.bP(t,i,this.dragOptions,e)}wP(){if(this.draggedParts===null)return;const t=this.diagram;let i=this.draggedParts.iterator;for(;i.next();){const e=i.key;e.Pe()&&(e.location=i.value.point)}for(i=this.draggedParts.iterator;i.next();){const e=i.key;if(e instanceof Link&&e.suspendsRouting){const s=i.value.point;this.draggedParts.set(e,this.Is()),e.mr(-s.x,-s.y)}}t.maybeUpdate()}QD(t){if(t===null)return!0;const i=t.part;return!!(i===null||i instanceof Adornment||i.layer.isTemporary||this.draggedParts&&this.draggedParts.has(i)||this.copiedParts&&this.copiedParts.has(i))}kP(t){const i=this.diagram;this.dragsLink&&(this.draggedLink!==null&&(this.draggedLink.fromNode=null,this.draggedLink.toNode=null),this.IC(!1));const e=this.findDragOverObject(t),s=i.lastInput;s.targetObject=e,this.doUpdateCursor(e);const n=i.skipsUndoManager;let o=!1;try{if(i.skipsUndoManager=!0,o=this.vC(s,e),!this.isActive&&DraggingTool.yt===null)return;const r=e!==null?e.part:null;if(r===null||i.handlesDragDropForTopLevelParts&&r.isTopLevel&&!(r instanceof Group)){const l=i.mouseDragOver;l!==null&&(l(s),o=!0)}if(!this.isActive&&DraggingTool.yt===null||(this.doDragOver(t,e),!this.isActive&&DraggingTool.yt===null))return}finally{i.skipsUndoManager=n,o&&i.maybeUpdate()}this.mu=e,!i.isReadOnly&&(i.allowMove||i.allowCopy)&&(i.allowHorizontalScroll||i.allowVerticalScroll)&&i.doAutoScroll(s.viewPoint)}findDragOverObject(t){return this.diagram.PP(t,null,i=>!this.QD(i))}doUpdateCursor(t){const i=this.diagram;(t===null||this.mu!==t)&&(!this.diagram.currentTool.isActive||this.mayCopy()?i.currentCursor=this.copyCursor:this.mayMove()?i.currentCursor=this.moveCursor:this.mayDragOut()&&(i.currentCursor=this.nodropCursor))}vC(t,i){let e=!1,s=this.gr.length;const n=s>0?this.gr[0]:null;if(i===n)return!1;t.handled=!1;for(let r=0;r<s;r++){const l=this.gr[r],h=l.mouseDragLeave;if(h!==null&&(h(t,l,i),e=!0,t.handled))break}if(this.gr.length=0,!this.isActive&&DraggingTool.yt===null||i===null)return e;t.handled=!1;let o=i;for(;o!==null;)this.gr.push(o),o=this.EC(o);s=this.gr.length;for(let r=0;r<s;r++){const l=this.gr[r],h=l.mouseDragEnter;if(h!==null&&(h(t,l,n),e=!0,t.handled))break}return e}rE(t,i){return t===null?!1:!!(t===i||t.isContainedBy(i)||i instanceof Group&&!(t instanceof Group)&&i.handlesDragDropForMembers&&t.part.isMemberOf(i))}EC(t){const i=t.panel;if(i!==null)return i;if(t instanceof Part&&!(t instanceof Group)){const e=t.containingGroup;if(e!==null&&e.handlesDragDropForMembers)return e}return null}BC(t,i){const e=this.diagram,s=this.fn;if(s===null)return null;const n=s.portGravity,o=e.findObjectsNear(t,n,a=>s.findValidLinkablePort(a,i)),r=Point.l();let l=1/0,h=null;for(const a=o.iterator;a.next();){const c=a.value;if(c.part===null)continue;const u=c.getDocumentPoint(Spot.Center,r),d=t.distanceSquaredPoint(u);d<l&&(h=c,l=d)}return Point.s(r),h}IC(t){const i=this.draggedLink;if(i!==null){if(i.pointsCount<2)return;const e=this.diagram;if(e.isReadOnly)return;const s=this.fn;if(s===null)return;let n=null,o=null;i.fromNode===null&&(n=this.BC(i.getPoint(0),!1),n!==null&&(o=n.part));let r=null,l=null;i.toNode===null&&(r=this.BC(i.getPoint(i.pointsCount-1),!0),r!==null&&(l=r.part)),s.isValidLink(o,n,l,r)?t?(i.defaultFromPoint=i.getPoint(0),i.defaultToPoint=i.getPoint(i.pointsCount-1),i.suspendsRouting=!1,i.fromNode=o,n!==null&&(i.fromPortId=n.portId),i.toNode=l,r!==null&&(i.toPortId=r.portId),i.fromPort!==e.MP&&e.v("LinkRelinked",i,e.MP),i.toPort!==e.SP&&e.v("LinkRelinked",i,e.SP)):s.doDraggingMouseMove(o,n,l,r):s.doDraggingMouseMove(null,null,null,null)}}doDragOver(t,i){}UC(t){const i=this.diagram;this.dragsLink&&this.IC(!0),this.pP();const e=this.findDragOverObject(t),s=i.lastInput;if(s.targetObject=e,e!==null){s.handled=!1;let l=e;for(;l!==null;){const h=l.mouseDrop;if(h!==null&&(h(s,l),s.handled))break;this._D(s,l),l=this.EC(l)}}else{const l=i.mouseDrop;l!==null&&l(s)}if(!this.isActive&&DraggingTool.yt===null)return;const n=(this.copiedParts||this.draggedParts).iterator;for(;n.next();){const l=n.key;l instanceof Node&&l.linksConnected.each(h=>h.suspendsRouting=!1)}if(this.doDropOnto(t,e),!this.isActive&&DraggingTool.yt===null)return;const o=Rect.l(),r=i.selection.iterator;for(;r.next();){const l=r.value;l instanceof Node&&this.tF(i,l,o)}Rect.s(o)}_D(t,i){const e=this.diagram,s=i.part;if(e.handlesDragDropForTopLevelParts&&s.isTopLevel&&!(s instanceof Group)){const n=e.mouseDrop;n!==null&&n(t)}}tF(t,i,e){if(!i.canAvoid())return;let s=!1;e=i.getAvoidableRect(e),t.viewportBounds.containsRect(e)&&(s=!0);const n=this.copiedParts||this.draggedParts,o=t.NP(e,l=>l.part,l=>l instanceof Link,!0,l=>l instanceof Link,s);if(o.count===0)return;const r=o.iterator;for(;r.next();){const l=r.value;n.has(l)&&n.has(i)||!l.isMemberOf(i)&&l.isAvoiding&&l.invalidateRoute()}}doDropOnto(t,i){}doMouseMove(){if(!this.isActive)return;const t=this.diagram,i=t.lastInput;if(this.simulatedMouseMove(i.event,i.documentPoint,i.targetDiagram))return;this.currentPart!==null&&this.draggedParts!==null&&(this.mayCopy()?(this.xP(!1),t.Uw(this.copiedParts),this.mc(this.copiedParts,!1),t.km(this.copiedParts)):this.mayMove()?(this.bl(),this.mc(this.draggedParts,!0)):this.mayDragOut()?(this.xP(!1),this.mc(this.copiedParts,!1)):this.bl(),this.kP(t.lastInput.documentPoint))}doMouseUp(){if(!this.isActive)return;const t=this.diagram,i=t.lastInput;if(this.simulatedMouseUp(i.event,i.documentPoint,i.targetDiagram))return;let e=!1;const s=this.mayCopy();if(s&&this.copiedParts!==null?(this.bl(),this.xP(!0),t.Uw(this.copiedParts),this.mc(this.copiedParts,!1),t.km(this.copiedParts),this.copiedParts!==null&&(t.v("ChangingSelection",t.selection),t.clearSelection(!0),this.copiedParts.iteratorKeys.each(n=>{n.isSelected=!0}))):(e=!0,this.bl(),this.mayMove()&&(this.mc(this.draggedParts,!0),this.kP(t.lastInput.documentPoint))),this.gu=!0,this.UC(t.lastInput.documentPoint),this.isActive){const n=s?this.copiedParts.toKeySet():this.draggedParts.toKeySet();this.copiedParts=null,e&&this.iF(),t.invalidateDocumentBounds(),t.km(this.draggedParts),this.transactionResult=s?"Copy":"Move",t.v(s?"SelectionCopied":"SelectionMoved",n)}this.stopTool(),s&&t.v("ChangedSelection",t.selection)}simulatedMouseMove(t,i,e){if(DraggingTool.yt===null)return!1;const s=DraggingTool.yt.diagram;e instanceof Diagram||(e=null);const n=DraggingTool.zh;if(e!==n){if(n!==null&&n!==s){n.stopAutoScroll(),DraggingTool.yt.isDragOutStarted=!1;const r=n.toolManager.findTool("Dragging");r!==null&&r.doSimulatedDragLeave()}if(DraggingTool.zh=e,e!==null&&e!==s){DraggingTool.yt.OC();const r=e.toolManager.findTool("Dragging");r!==null&&(r.VC(),r.doSimulatedDragEnter())}this.doUpdateCursor(null)}if(e===null||e===s||!e.allowDrop||e.isReadOnly||!e.allowInsert)return!1;const o=e.toolManager.findTool("Dragging");if(o!==null){let r=i;t!==null&&(t.targetTouches!==void 0&&(t.targetTouches.length>0?t=t.targetTouches[0]:t.changedTouches.length>0&&(t=t.changedTouches[0])),r=e.getMouse(t)),e.lastInput.documentPoint=r,e.lastInput.viewPoint=e.transformDocToView(r),e.lastInput.down=!1,e.lastInput.up=!1,o.doSimulatedDragOver()}return!0}simulatedMouseUp(t,i,e){if(DraggingTool.yt===null)return!1;const s=DraggingTool.zh,n=DraggingTool.yt.diagram;if(e===null)return DraggingTool.yt.doCancel(),!0;if(e!==s){const o=s.toolManager.findTool("Dragging");if(s!==null&&s!==n&&o!==null)return s.stopAutoScroll(),DraggingTool.yt.isDragOutStarted=!1,o.doSimulatedDragLeave(),!1;DraggingTool.zh=e;const r=e.toolManager.findTool("Dragging");r!==null&&(DraggingTool.yt.OC(),r.VC(),r.doSimulatedDragEnter())}if(e!==this.diagram){let o=i;t!==null?(t.targetTouches!==void 0&&(t.targetTouches.length>0?t=t.targetTouches[0]:t.changedTouches.length>0&&(t=t.changedTouches[0])),o=e.getMouse(t)):o===null&&(o=new Point),e.lastInput.documentPoint=o,e.lastInput.viewPoint=e.transformDocToView(o),e.lastInput.down=!1,e.lastInput.up=!0;const r=e.toolManager.findTool("Dragging");r!==null&&r.doSimulatedDrop();const l=DraggingTool.yt;if(l!==null){const h=l.mayCopy();l.transactionResult=h?"Copy":"Move",l.stopTool()}return!0}return!1}iF(){if(this.draggedParts===null)return;const t=this.draggedParts.iterator;for(;t.next();){const i=t.key;if(i instanceof Node){const e=i.containingGroup;e!==null&&e.hasPlaceholder()&&!this.draggedParts.has(e)&&e.placeholder.c()}}}mayCopy(){if(!this.isCopyEnabled)return!1;const t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowInsert||!t.allowCopy||!(Util.or?t.lastInput.alt:t.lastInput.control))return!1;const i=t.selection.iterator;for(;i.next();)if(i.value.canCopy())return!0;return!!(this.draggedLink!==null&&this.dragsLink&&this.draggedLink.canCopy())}mayDragOut(){if(!this.isCopyEnabled)return!1;const t=this.diagram;if(!t.allowDragOut||!t.allowCopy||t.allowMove)return!1;const i=t.selection.iterator;for(;i.next();)if(i.value.canCopy())return!0;return!!(this.draggedLink!==null&&this.dragsLink&&this.draggedLink.canCopy())}mayMove(){const t=this.diagram;if(t.isReadOnly||!t.allowMove)return!1;const i=t.selection.iterator;for(;i.next();)if(i.value.canMove())return!0;return!!(this.draggedLink!==null&&this.dragsLink&&this.draggedLink.canMove())}VC(){DraggingTool.Vw.has(this)||DraggingTool.Vw.add(this)}static $D(){if(DraggingTool.Vw.count>0){const t=DraggingTool.Vw,i=t.length;for(let e=0;e<i;e++){const s=t.elt(e);s.RC(),s.bl(),s.pP(),s.diagram.stopAutoScroll()}t.clear()}}computeBorder(t,i,e){return!this.gu&&this.draggedParts!==null&&!this.draggedParts.has(t)?e.a(i):null}getDraggingSource(){return DraggingTool.yt}mayDragIn(){const t=this.diagram;if(!t.allowDrop||t.isReadOnly||t.isModelReadOnly||!t.allowInsert)return!1;const i=DraggingTool.yt;return!(i===null||i.diagram.model.dataFormat!==t.model.dataFormat)}doSimulatedDragEnter(){if(!this.mayDragIn())return;const t=this.diagram;t.animationManager.stopAnimation(),t.pr(),t.animationManager.stopAnimation();const i=DraggingTool.yt;i!==null&&(this.diagram.dc=!0,t.lastInput.event===null&&(t.lastInput.event=i.diagram.lastInput.event)),this.doUpdateCursor(null)}doSimulatedDragLeave(){const t=DraggingTool.yt;t!==null&&t.doSimulatedDragOut(),this.diagram.dc=!1,this.doCancel()}doSimulatedDragOver(){const t=this.diagram;t.animationManager.wu=!0;const i=DraggingTool.yt;if(i!==null&&i.draggedParts!==null){if(!this.mayDragIn())return;this.zC(i.draggedParts.toKeySet(),!1,t.firstInput),this.mc(this.copiedParts,!1),this.kP(t.lastInput.documentPoint)}t.animationManager.wu=!1}doSimulatedDrop(){const t=this.diagram,i=DraggingTool.yt;if(i!==null){const e=i.diagram;if(i.gu=!0,this.bl(),!this.mayDragIn())return;t.animationManager.wu=!0,t.v("ChangingSelection",t.selection),this.startTransaction("Drop"),this.zC(i.draggedParts.toKeySet(),!0,t.lastInput),this.mc(this.copiedParts,!1);const s=new GSet;this.copiedParts!==null&&(t.clearSelection(!0),this.copiedParts.iteratorKeys.each(n=>{n.isSelected=!0,s.add(n)})),this.UC(t.lastInput.documentPoint),t.invalidateDocumentBounds(),this.copiedParts!==null&&(this.transactionResult="ExternalCopy"),this.copiedParts=null,t.doFocus(),t.dc=!1,t.v("ExternalObjectsDropped",s,e),this.stopTransaction(),t.v("ChangedSelection",t.selection)}t.animationManager.wu=!1}zC(t,i,e){if(this.copiedParts!==null)return;const s=this.diagram;if(s.isReadOnly||s.isModelReadOnly)return;s.skipsUndoManager=!i,s.partManager.addsToTemporaryLayer=!i,this.startPoint=e.documentPoint;const n=s.copyParts(t,s,!0),o=Rect.l();this.ZD(t,o);const r=o.x+o.width/2,l=o.y+o.height/2;Rect.s(o);const h=this.bm,a=new GMap,c=Point.l(),f=t.iterator;for(;f.next();){const d=f.value;if(d instanceof Link&&d.canCopy()){const m=n.get(d);if(m===null)continue;m.points=d.points,m.mr(h.x-r,h.y-l),m.suspendsRouting=!0,a.set(m,this.Is())}}const u=t.iterator;for(;u.next();){const d=u.value;if(d.Pe()&&d.canCopy()){const m=n.get(d);if(m===null)continue;const g=d.location;c.e(h.x-(r-g.x),h.y-(l-g.y)),m.location=c,m.ensureBounds(),a.set(m,this.Is(c))}}if(Point.s(c),this.copiedParts=a,this.mP(a.toKeySet()),this.draggedLink!==null){const d=this.draggedLink,m=d.routeBounds;d.mr(this.startPoint.x-(m.x+m.width/2),this.startPoint.y-(m.y+m.height/2))}this.doUpdateCursor(null)}JD(){this.isDragOutStarted=!0,this.gu=!1,DraggingTool.yt=this,DraggingTool.zh=this.diagram,this.doSimulatedDragOut()}doSimulatedDragOut(){const t=this.diagram;t.dc=!1,!this.mayCopy()&&!this.mayMove()?t.currentCursor=this.nodropCursor:t.currentCursor="",this.mu=null}computeMove(t,i,e,s){const n=this.diagram;return n!==null?n.computeMove(t,i,this.dragOptions,s):new Point}static Vw=new List;static yt=null;static zh=null}ToolManager.prototype.doCancel=function(){DraggingTool.yt!==null&&DraggingTool.yt.doCancel(),Tool.prototype.doCancel.call(this)};class LinkingBaseTool extends Tool{CP;LP;Pl;AP;TP;Xh;DP;Kh;FP;RP;vP;OP;IP;EP;XC;BP;Ml;UP;constructor(){super(),this.CP=100,this.LP=!1,this.Pl="pointer",this.AP=new Link({layerName:"Tool"}).add(new Shape({isPanelMain:!0,stroke:"blue"}).theme("stroke","tempLink"),new Shape({toArrow:"Standard",fill:"blue",stroke:"blue"}).theme("fill","tempLink").theme("stroke","tempLink")).Vt(),this.Xh=new Shape("Rectangle",{portId:"",fill:null,stroke:"magenta",strokeWidth:2,desiredSize:Size.Dk}).theme("stroke","tempPort"),this.TP=new Node({selectable:!1,layerName:"Tool"}).add(this.Xh).Vt(),this.Kh=new Shape("Rectangle",{portId:"",fill:null,stroke:"magenta",strokeWidth:2,desiredSize:Size.Dk}).theme("stroke","tempPort"),this.DP=new Node({selectable:!1,layerName:"Tool"}).add(this.Kh).Vt(),this.FP=null,this.RP=null,this.vP=null,this.OP=null,this.IP=null,this.EP=!0,this.XC=new GMap,this.BP=null,this.Ml=null,this.UP=null}doStop(){this.diagram.stopAutoScroll(),this.originalLink=null,this.originalFromNode=null,this.originalFromPort=null,this.originalToNode=null,this.originalToPort=null,this.validPortsCache.clear(),this.targetPort=null}get portGravity(){return this.CP}set portGravity(t){Util.i(t,"number",LinkingBaseTool,"portGravity"),t>=0&&(this.CP=t)}get isUnconnectedLinkValid(){return this.LP}set isUnconnectedLinkValid(t){Util.i(t,"boolean",LinkingBaseTool,"isUnconnectedLinkValid"),this.LP=t}get linkingCursor(){return this.Pl}set linkingCursor(t){this.Pl=t}get temporaryLink(){return this.AP}set temporaryLink(t){t.Vt(),this.AP=t}get temporaryFromNode(){return this.TP}set temporaryFromNode(t){t.Vt(),this.TP=t,t&&(this.Xh=t.port)}get temporaryFromPort(){return this.Xh}set temporaryFromPort(t){if(this.Xh!==null){const i=this.Xh.panel;if(i!==null){const e=i.L.indexOf(this.Xh);i.removeAt(e),i.insertAt(e,t)}}this.Xh=t}get temporaryToNode(){return this.DP}set temporaryToNode(t){t.Vt(),this.DP=t,t&&(this.Kh=t.port)}get temporaryToPort(){return this.Kh}set temporaryToPort(t){if(this.Kh!==null){const i=this.Kh.panel;if(i!==null){const e=i.L.indexOf(this.Kh);i.removeAt(e),i.insertAt(e,t)}}this.Kh=t}get originalLink(){return this.FP}set originalLink(t){this.FP=t}get originalFromNode(){return this.RP}set originalFromNode(t){this.RP=t}get originalFromPort(){return this.vP}set originalFromPort(t){this.vP=t}get originalToNode(){return this.OP}set originalToNode(t){this.OP=t}get originalToPort(){return this.IP}set originalToPort(t){this.IP=t}get isForwards(){return this.EP}set isForwards(t){this.EP=t}get validPortsCache(){return this.XC}get targetPort(){return this.BP}set targetPort(t){this.BP=t}copyPortProperties(t,i,e,s,n){if(t===null||i===null||e===null||s===null)return;const o=i.getDocumentScale(),r=Size.l();r.width=i.naturalBounds.width*o,r.height=i.naturalBounds.height*o,s.desiredSize=r,Size.s(r),n?(s.toSpot=i.toSpot,s.toEndSegmentLength=i.toEndSegmentLength):(s.fromSpot=i.fromSpot,s.fromEndSegmentLength=i.fromEndSegmentLength),e.locationSpot=Spot.Center;const l=Point.l();e.location=i.getDocumentPoint(Spot.Center,l),Point.s(l),s.angle=i.getDocumentAngle(),this.portTargeted!==null&&this.portTargeted(t,i,e,s,n)}setNoTargetPortProperties(t,i,e){i!==null&&(i.desiredSize=Size.Dk,i.fromSpot=Spot.None,i.toSpot=Spot.None),t!==null&&(t.location=this.diagram.lastInput.documentPoint),this.portTargeted!==null&&this.portTargeted(null,null,t,i,e)}doMouseDown(){this.isActive&&this.doMouseMove()}doMouseMove(){if(this.isActive){const t=this.diagram;if(this.targetPort=this.findTargetPort(this.isForwards),this.targetPort!==null&&this.targetPort.part instanceof Node){const i=this.targetPort.part;this.isForwards?this.copyPortProperties(i,this.targetPort,this.temporaryToNode,this.temporaryToPort,!0):this.copyPortProperties(i,this.targetPort,this.temporaryFromNode,this.temporaryFromPort,!1)}else this.isForwards?this.setNoTargetPortProperties(this.temporaryToNode,this.temporaryToPort,!0):this.setNoTargetPortProperties(this.temporaryFromNode,this.temporaryFromPort,!1);(t.allowHorizontalScroll||t.allowVerticalScroll)&&t.doAutoScroll(t.lastInput.viewPoint)}}findValidLinkablePort(t,i){if(t===null)return null;const e=t.part;if(!(e instanceof Node))return null;for(;t!==null;){const s=i?t.toLinkable:t.fromLinkable;if(s===!0&&(t.portId!==null||t instanceof Node)&&(i?this.isValidTo(e,t):this.isValidFrom(e,t)))return t;if(s===!1)return null;t=t.panel}return null}findTargetPort(t){const i=this.diagram,e=i.lastInput.documentPoint;let s=this.portGravity;s<=0&&(s=.1);const n=this,o=i.findObjectsNear(e,s,a=>n.findValidLinkablePort(a,t),null,!0);let r=1/0,l=null;const h=o.iterator;for(;h.next();){const a=h.value,c=a.part;if(!(c instanceof Node))continue;const f=a.getDocumentPoint(Spot.Center,Point.l()),u=e.x-f.x,d=e.y-f.y;Point.s(f);const m=u*u+d*d;if(m<r){const g=this.validPortsCache.get(a);g!==null?g&&(l=a,r=m):t&&this.isValidLink(this.originalFromNode,this.originalFromPort,c,a)||!t&&this.isValidLink(c,a,this.originalToNode,this.originalToPort)?(this.validPortsCache.set(a,!0),l=a,r=m):this.validPortsCache.set(a,!1)}}if(l!==null){const a=l.part;if(a instanceof Node&&(a.layer===null||a.layer.allowLink))return l}return null}isValidFrom(t,i){if(t===null||i===null)return this.isUnconnectedLinkValid;if(this.diagram.currentTool===this&&(t.layer!==null&&!t.layer.allowLink||i.fromLinkable!==!0))return!1;const e=i.fromMaxLinks;if(e<1/0){if(this.originalLink!==null&&t===this.originalFromNode&&i===this.originalFromPort)return!0;let s=i.portId;if(s===null&&(s=""),t.findLinksOutOf(s).count>=e)return!1}return!0}isValidTo(t,i){if(t===null||i===null)return this.isUnconnectedLinkValid;if(this.diagram.currentTool===this&&(t.layer!==null&&!t.layer.allowLink||i.toLinkable!==!0))return!1;const e=i.toMaxLinks;if(e<1/0){if(this.originalLink!==null&&t===this.originalToNode&&i===this.originalToPort)return!0;let s=i.portId;if(s===null&&(s=""),t.findLinksInto(s).count>=e)return!1}return!0}isInSameNode(t,i){if(t===null||i===null)return!1;if(t===i)return!0;const e=t.part,s=i.part;return e!==null&&e===s}isLinked(t,i){if(t===null||i===null)return!1;const e=t.part;if(!(e instanceof Node))return!1;let s=t.portId;s===null&&(s="");const n=i.part;if(!(n instanceof Node))return!1;let o=i.portId;o===null&&(o="");const r=n.findLinksInto(o);for(;r.next();){const l=r.value;if(l.fromNode===e&&l.fromPortId===s)return!0}return!1}isValidLink(t,i,e,s){if(!this.isValidFrom(t,i)||!this.isValidTo(e,s)||i!==null&&s!==null&&(!(i.fromLinkableSelfNode&&s.toLinkableSelfNode)&&this.isInSameNode(i,s)||!(i.fromLinkableDuplicates&&s.toLinkableDuplicates)&&this.isLinked(i,s))||this.originalLink!==null&&(t!==null&&this.isLabelDependentOnLink(t,this.originalLink)||e!==null&&this.isLabelDependentOnLink(e,this.originalLink))||t!==null&&e!==null&&(t.data===null&&e.data!==null||t.data!==null&&e.data===null)||!this.isValidCycle(t,e,this.originalLink))return!1;let n;return t!==null&&(n=t.linkValidation,n!==null&&!n(t,i,e,s,this.originalLink))||e!==null&&(n=e.linkValidation,n!==null&&!n(t,i,e,s,this.originalLink))?!1:(n=this.linkValidation,n!==null?n(t,i,e,s,this.originalLink):!0)}isLabelDependentOnLink(t,i){if(t===null)return!1;const e=t.labeledLink;if(e===null)return!1;if(e===i)return!0;const s=new GSet;return s.add(t),this.VP(e,i,s)}VP(t,i,e){if(t===i)return!0;const s=t.fromNode;if(s!==null&&s.isLinkLabel&&(e.add(s),this.VP(s.labeledLink,i,e)))return!0;const n=t.toNode;return!!(n!==null&&n.isLinkLabel&&(e.add(n),this.VP(n.labeledLink,i,e)))}isValidCycle(t,i,e){if(e===void 0&&(e=null),t===null||i===null)return this.isUnconnectedLinkValid;const s=this.diagram;let n=1;if(s&&(s.model.pc()?n=s.isTreePathToChildren?5:6:n=s.validCycle),n===1)return!0;if(n===5){const o=e||this.temporaryLink;if(o!==null&&!o.isTreeLink)return!0;const r=i.linksConnected;for(;r.next();){const l=r.value;if(l!==e&&l.isTreeLink&&l.toNode===i)return!1}return!this.xu(t,i,e,!0)}else if(n===6){const o=e||this.temporaryLink;if(o!==null&&!o.isTreeLink)return!0;const r=t.linksConnected;for(;r.next();){const l=r.value;if(l!==e&&l.isTreeLink&&l.fromNode===t)return!1}return!this.xu(t,i,e,!0)}else{if(n===2)return!this.eF(t,i,e);if(n===3)return!this.xu(t,i,e,!1);if(n===4)return!this.sF(t,i,e)}return!0}xu(t,i,e,s){if(t===i)return!0;if(t===null||i===null)return!1;const n=t.linksConnected;for(;n.next();){const o=n.value;if(o===e||s&&!o.isTreeLink||o.toNode!==t)continue;const r=o.fromNode;if(r!==t&&this.xu(r,i,e,s))return!0}return!1}eF(t,i,e){if(t===i)return!0;const s=new GSet;return s.add(i),this.KC(s,t,i,e)}KC(t,i,e,s){if(i===e)return!0;if(i===null||e===null||t.has(i))return!1;t.add(i);const n=i.linksConnected;for(;n.next();){const o=n.value;if(o===s||o.toNode!==i)continue;const r=o.fromNode;if(r!==i&&this.KC(t,r,e,s))return!0}return!1}sF(t,i,e){if(t===i)return!0;const s=new GSet;return s.add(i),this.YC(s,t,i,e)}YC(t,i,e,s){if(i===e)return!0;if(i===null||e===null||t.has(i))return!1;t.add(i);const n=i.linksConnected;for(;n.next();){const o=n.value;if(o===s)continue;const r=o.fromNode,l=o.toNode,h=r===i?l:r;if(h!==i&&this.YC(t,h,e,s))return!0}return!1}get linkValidation(){return this.Ml}set linkValidation(t){t!==null&&Util.i(t,"function",LinkingBaseTool,"linkValidation"),this.Ml=t}get portTargeted(){return this.UP}set portTargeted(t){t!==null&&Util.i(t,"function",LinkingBaseTool,"portTargeted"),this.UP=t}}var LinkingDirection=(w=>(w[w.Either=1]="Either",w[w.ForwardsOnly=2]="ForwardsOnly",w[w.BackwardsOnly=3]="BackwardsOnly",w))(LinkingDirection||{});class LinkingTool extends LinkingBaseTool{zP;XP;S;KP;constructor(t){super(),this.name="Linking",this.zP={},this.XP=null,this.S=1,this.KP=null,t&&Object.assign(this,t)}static Either=1;static ForwardsOnly=2;static BackwardsOnly=3;get archetypeLinkData(){return this.zP}set archetypeLinkData(t){t!==null&&Util.i(t,"object",LinkingTool,"archetypeLinkData"),this.zP=t}get archetypeLabelNodeData(){return this.XP}set archetypeLabelNodeData(t){t!==null&&Util.i(t,"object",LinkingTool,"archetypeLabelNodeData"),this.XP=t}get direction(){return this.S}set direction(t){this.S=t}get startObject(){return this.KP}set startObject(t){this.KP=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return t.isReadOnly||t.isModelReadOnly||!t.allowLink||!t.model.zw()||!t.lastInput.left||t.currentTool!==this&&!this.isBeyondDragSize()?!1:this.findLinkablePort()!==null}findLinkablePort(){const t=this.diagram;let i=this.startObject;if(i===null&&(i=t.findObjectAt(t.firstInput.documentPoint,null,null)),i===null)return null;const e=i.part;if(!(e instanceof Node))return null;const s=this.direction;if(s===1||s===2){const n=this.findValidLinkablePort(i,!1);if(n!==null)return this.isForwards=!0,n;if(this.startObject===e){const o=e.port;if(this.findValidLinkablePort(o,!1))return this.isForwards=!0,o}}if(s===1||s===3){const n=this.findValidLinkablePort(i,!0);if(n!==null)return this.isForwards=!1,n;if(this.startObject===e){const o=e.port;if(this.findValidLinkablePort(o,!0))return this.isForwards=!1,o}}return null}doActivate(){const t=this.diagram,i=this.findLinkablePort();if(i===null){this.stopTool();return}if(this.startTransaction(this.name),t.isMouseCaptured=!0,t.currentCursor=this.linkingCursor,this.isForwards){this.temporaryToNode!==null&&(this.temporaryToNode.location=t.lastInput.documentPoint),this.originalFromPort=i;const e=this.originalFromPort.part;e instanceof Node&&(this.originalFromNode=e),this.copyPortProperties(this.originalFromNode,this.originalFromPort,this.temporaryFromNode,this.temporaryFromPort,!1)}else{this.temporaryFromNode!==null&&(this.temporaryFromNode.location=t.lastInput.documentPoint),this.originalToPort=i;const e=this.originalToPort.part;e instanceof Node&&(this.originalToNode=e),this.copyPortProperties(this.originalToNode,this.originalToPort,this.temporaryToNode,this.temporaryToPort,!0)}t.add(this.temporaryFromNode),this.temporaryFromNode&&this.temporaryFromNode.ensureBounds(),t.add(this.temporaryToNode),this.temporaryToNode&&this.temporaryToNode.ensureBounds(),this.temporaryLink!==null&&(this.temporaryFromNode!==null&&(this.temporaryLink.fromNode=this.temporaryFromNode),this.temporaryToNode!==null&&(this.temporaryLink.toNode=this.temporaryToNode),this.temporaryLink.isTreeLink=this.isNewTreeLink(),this.temporaryLink.invalidateRoute(),t.add(this.temporaryLink)),this.isActive=!0}doDeactivate(){this.isActive=!1;const t=this.diagram;t.remove(this.temporaryLink),t.remove(this.temporaryFromNode),t.remove(this.temporaryToNode),t.isMouseCaptured=!1,t.currentCursor="",this.stopTransaction()}doStop(){super.doStop(),this.startObject=null}doMouseUp(){if(this.isActive){const t=this.diagram;this.transactionResult=null;let i=null,e=null,s=null,n=null,o=null;try{this.targetPort=this.findTargetPort(this.isForwards);const r=this.targetPort;if(r!==null){const l=r.part;l instanceof Node&&(this.isForwards?(this.originalFromNode!==null&&(i=this.originalFromNode,e=this.originalFromPort),s=l,n=r):(i=l,e=r,this.originalToNode!==null&&(s=this.originalToNode,n=this.originalToPort)))}else this.isForwards?this.originalFromNode!==null&&this.isUnconnectedLinkValid&&(i=this.originalFromNode,e=this.originalFromPort):this.originalToNode!==null&&this.isUnconnectedLinkValid&&(s=this.originalToNode,n=this.originalToPort);i!==null||s!==null?(o=this.insertLink(i,e,s,n),o!==null?(r===null&&(this.isForwards?o.defaultToPoint=t.lastInput.documentPoint:o.defaultFromPoint=t.lastInput.documentPoint),t.allowSelect&&(t.v("ChangingSelection",t.selection),t.clearSelection(!0),o.isSelected=!0),this.transactionResult=this.name,t.v("LinkDrawn",o)):this.doNoLink(i,e,s,n)):this.isForwards?this.doNoLink(this.originalFromNode,this.originalFromPort,null,null):this.doNoLink(null,null,this.originalToNode,this.originalToPort)}finally{this.stopTool(),o&&t.allowSelect&&t.v("ChangedSelection",t.selection)}}}isNewTreeLink(){const t=this.archetypeLinkData;if(t===null)return!0;if(t instanceof Link)return t.isTreeLink;const i=this.diagram;if(i===null)return!0;const e=i.partManager.getLinkCategoryForData(t),s=i.partManager.findLinkTemplateForCategory(e);return s!==null?s.isTreeLink:!0}insertLink(t,i,e,s){return this.diagram.partManager.insertLink(t,i,e,s)}doNoLink(t,i,e,s){}}class RelinkingTool extends LinkingBaseTool{GC;jC;YP;GP;fs;jP;constructor(t){super(),this.name="Relinking",this.fromHandleArchetype=new Shape("Diamond",{desiredSize:Size.lu,fill:"lightblue",stroke:"dodgerblue",cursor:this.linkingCursor,segmentIndex:0}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.toHandleArchetype=new Shape("Diamond",{desiredSize:Size.lu,fill:"lightblue",stroke:"dodgerblue",cursor:this.linkingCursor,segmentIndex:-1}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.fs=null,this.jP=new Rect,t&&Object.assign(this,t)}updateAdornments(t){if(t===null||!(t instanceof Link))return;let i="RelinkFrom",e=null;if(t.isSelected&&!this.diagram.isReadOnly){const s=t.selectionObject;s!==null&&t.canRelinkFrom()&&t.actualBounds.isReal()&&t.isVisible()&&s.actualBounds.isReal()&&s.isVisibleObject()&&(e=t.findAdornment(i),e===null&&(e=this.makeAdornment(s,!1),t.addAdornment(i,e)))}if(e===null&&t.removeAdornment(i),i="RelinkTo",e=null,t.isSelected&&!this.diagram.isReadOnly){const s=t.selectionObject;s!==null&&t.canRelinkTo()&&t.actualBounds.isReal()&&t.isVisible()&&s.actualBounds.isReal()&&s.isVisibleObject()&&(e=t.findAdornment(i),e===null?(e=this.makeAdornment(s,!0),t.addAdornment(i,e)):e.c())}e===null&&t.removeAdornment(i)}makeAdornment(t,i){let e=i?this.GP:this.YP;return e&&(e=e.copy(),e.adornedObject=t),e}get fromHandleArchetype(){return this.GC}set fromHandleArchetype(t){this.GC=t,t!==null?this.YP=new Adornment(Panel.Link).add(t).Vt():this.YP=null}get toHandleArchetype(){return this.jC}set toHandleArchetype(t){this.jC=t,t!==null?this.GP=new Adornment(Panel.Link).add(t).Vt():this.GP=null}get handle(){return this.fs}set handle(t){if(t!==null&&!(t.part instanceof Adornment))throw new Error("new handle is not in an Adornment: "+t);this.fs=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowRelink||!t.model.zw()||!t.lastInput.left)return!1;let e=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkFrom");return e===null&&(e=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkTo")),e!==null}doActivate(){const t=this.diagram;if(this.originalLink===null){let i=this.handle;if(i===null&&(i=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkFrom"),i===null&&(i=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkTo"))),i===null)return;const e=i.part;if(!(e instanceof Adornment)||!(e.adornedPart instanceof Link))return;this.handle=i,this.isForwards=e===null||e.category==="RelinkTo",this.originalLink=e.adornedPart}this.startTransaction(this.name),t.isMouseCaptured=!0,t.currentCursor=this.linkingCursor,this.originalFromPort=this.originalLink.fromPort,this.originalFromNode=this.originalLink.fromNode,this.originalToPort=this.originalLink.toPort,this.originalToNode=this.originalLink.toNode,this.jP.set(this.originalLink.actualBounds),this.originalLink!==null&&this.originalLink.pointsCount>0&&(this.originalLink.fromNode===null&&(this.temporaryFromPort!==null&&(this.temporaryFromPort.desiredSize=Size.ru),this.temporaryFromNode!==null&&(this.temporaryFromNode.location=this.originalLink.getPoint(0))),this.originalLink.toNode===null&&(this.temporaryToPort!==null&&(this.temporaryToPort.desiredSize=Size.ru),this.temporaryToNode!==null&&(this.temporaryToNode.location=this.originalLink.getPoint(this.originalLink.pointsCount-1)))),this.copyPortProperties(this.originalFromNode,this.originalFromPort,this.temporaryFromNode,this.temporaryFromPort,!1),this.copyPortProperties(this.originalToNode,this.originalToPort,this.temporaryToNode,this.temporaryToPort,!0),t.add(this.temporaryFromNode),t.add(this.temporaryToNode),this.temporaryLink!==null&&(this.temporaryFromNode!==null&&(this.temporaryLink.fromNode=this.temporaryFromNode),this.temporaryToNode!==null&&(this.temporaryLink.toNode=this.temporaryToNode),this.copyLinkProperties(this.originalLink,this.temporaryLink),this.temporaryLink.invalidateRoute(),t.add(this.temporaryLink)),this.isActive=!0}copyLinkProperties(t,i){if(t===null||i===null)return;i.adjusting=t.adjusting,i.corner=t.corner;let e=t.curve;(e===11||e===10)&&(e=0),i.curve=e,i.curviness=t.curviness,i.isTreeLink=t.isTreeLink,i.points=t.points,i.routing=t.routing,i.smoothness=t.smoothness,i.fromSpot=t.fromSpot,i.fromEndSegmentLength=t.fromEndSegmentLength,i.fromShortLength=t.fromShortLength,i.toSpot=t.toSpot,i.toEndSegmentLength=t.toEndSegmentLength,i.toShortLength=t.toShortLength}doDeactivate(){this.isActive=!1;const t=this.diagram;t.remove(this.temporaryLink),t.remove(this.temporaryFromNode),t.remove(this.temporaryToNode),t.isMouseCaptured=!1,t.currentCursor="",this.stopTransaction()}doStop(){super.doStop(),this.handle=null}doMouseUp(){if(this.isActive){const t=this.diagram;this.transactionResult=null;let i=this.originalFromNode,e=this.originalFromPort,s=this.originalToNode,n=this.originalToPort,o=this.originalLink;try{if(this.targetPort=this.findTargetPort(this.isForwards),this.targetPort!==null){const r=this.targetPort.part;r instanceof Node&&(this.isForwards?(s=r,n=this.targetPort):(i=r,e=this.targetPort))}else this.isUnconnectedLinkValid?this.isForwards?(s=null,n=null):(i=null,e=null):o=null;o!==null?(this.reconnectLink(o,this.isForwards?s:i,this.isForwards?n:e,this.isForwards),this.targetPort===null&&(this.isForwards?o.defaultToPoint=t.lastInput.documentPoint:o.defaultFromPoint=t.lastInput.documentPoint,o.invalidateRoute()),this.transactionResult=this.name,t.v("LinkRelinked",o,this.isForwards?this.originalToPort:this.originalFromPort)):this.doNoRelink(this.originalLink,this.isForwards),this.originalLink.invalidateOtherJumpOvers(this.jP)}finally{this.stopTool()}}}reconnectLink(t,i,e,s){const n=e!==null&&e.portId!==null?e.portId:"";return s?(t.toNode=i,t.toPortId=n):(t.fromNode=i,t.fromPortId=n),!0}doNoRelink(t,i){}doDraggingMouseMove(t,i,e,s){t!==null?(this.copyPortProperties(t,i,this.temporaryFromNode,this.temporaryFromPort,!1),this.diagram.add(this.temporaryFromNode)):this.diagram.remove(this.temporaryFromNode),e!==null?(this.copyPortProperties(e,s,this.temporaryToNode,this.temporaryToPort,!0),this.diagram.add(this.temporaryToNode)):this.diagram.remove(this.temporaryToNode)}stopDraggingMouseMove(){this.diagram.remove(this.temporaryFromNode),this.diagram.remove(this.temporaryToNode)}}var ReshapingBehavior=(w=>(w[w.None=0]="None",w[w.Horizontal=1]="Horizontal",w[w.Vertical=2]="Vertical",w[w.All=3]="All",w))(ReshapingBehavior||{});class LinkReshapingTool extends Tool{yr;HP;qP;fs;Xw;WP;Pm;constructor(t){super(),this.name="LinkReshaping",this.yr=new Shape("Rectangle",{desiredSize:Size.tC,fill:"lightblue",stroke:"dodgerblue"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.HP=new Shape("Diamond",{desiredSize:Size.lu,fill:"lightblue",stroke:"dodgerblue",cursor:"move"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.qP=3,this.fs=null,this.Xw=null,this.WP=new Point,this.Pm=new List,t&&Object.assign(this,t)}static None=0;static Horizontal=1;static Vertical=2;static All=3;getReshapingBehavior(t){return t?t.wr:0}setReshapingBehavior(t,i){t.wr=i}updateAdornments(t){if(t===null||!(t instanceof Link))return;let i=null;if(t.isSelected&&!this.diagram.isReadOnly){const e=t.path;e!==null&&t.canReshape()&&t.actualBounds.isReal()&&t.isVisible()&&e.actualBounds.isReal()&&e.isVisibleObject()&&(i=t.findAdornment(this.name),(i===null||i.JP!==t.pointsCount||i.$P!==t.resegmentable)&&(i=this.makeAdornment(e),i!==null&&(i.JP=t.pointsCount,i.$P=t.resegmentable,t.addAdornment(this.name,i))))}i===null&&t.removeAdornment(this.name)}makeAdornment(t){const i=t.part,e=i.points,s=i.pointsCount,n=i.isOrthogonal;let o=null;if(e!==null&&s>1){o=new Adornment,o.type=Panel.Link;const r=i.firstPickIndex,l=i.lastPickIndex,h=n?1:0;if(i.resegmentable&&i.computeCurve()!==9)for(let a=r+h;a<l-h;a++){const c=this.makeResegmentHandle(t,a);c!==null&&(c.segmentIndex=a,c.segmentFraction=.5,c.fromMaxLinks=999,o.add(c))}for(let a=r+1;a<l;a++){const c=this.makeHandle(t,a);if(c!==null){if(c.segmentIndex=a,a!==r)if(a===r+1&&n){const f=i.getPoint(r);let u=i.getPoint(r+1);Geo.u(f.x,u.x)&&Geo.u(f.y,u.y)?(u=i.getPoint(r-1),Geo.u(f.x,u.x)?(this.setReshapingBehavior(c,2),c.cursor="n-resize"):Geo.u(f.y,u.y)&&(this.setReshapingBehavior(c,1),c.cursor="w-resize")):Geo.u(f.x,u.x)?(this.setReshapingBehavior(c,2),c.cursor="n-resize"):Geo.u(f.y,u.y)&&(this.setReshapingBehavior(c,1),c.cursor="w-resize")}else if(a===l-1&&n){let f=i.getPoint(l-1);const u=i.getPoint(l);Geo.u(f.x,u.x)&&Geo.u(f.y,u.y)?(f=i.getPoint(l+1),Geo.u(f.x,u.x)?(this.setReshapingBehavior(c,2),c.cursor="n-resize"):Geo.u(f.y,u.y)&&(this.setReshapingBehavior(c,1),c.cursor="w-resize")):Geo.u(f.x,u.x)?(this.setReshapingBehavior(c,2),c.cursor="n-resize"):Geo.u(f.y,u.y)&&(this.setReshapingBehavior(c,1),c.cursor="w-resize")}else a===l||(this.setReshapingBehavior(c,3),c.cursor="move");o.add(c)}}o.adornedObject=t}return o}makeHandle(t,i){const e=this.handleArchetype;return e===null?null:e.copy().ZP()}get handleArchetype(){return this.yr}set handleArchetype(t){this.yr=t}makeResegmentHandle(t,i){const e=this.midHandleArchetype;return e===null?null:e.copy().ZP()}get midHandleArchetype(){return this.HP}set midHandleArchetype(t){this.HP=t}get handle(){return this.fs}set handle(t){if(t!==null&&!(t.part instanceof Adornment))throw new Error("new handle is not in an Adornment: "+t);this.fs=t}get adornedLink(){return this.Xw}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return t.isReadOnly||!t.allowReshape||!t.lastInput.left?!1:this.findToolHandleAt(t.firstInput.documentPoint,this.name)!==null}doActivate(){const t=this.diagram;if(this.handle===null&&(this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name)),this.handle===null)return;const i=this.handle.part.adornedPart;if(i instanceof Link){if(this.Xw=i,t.isMouseCaptured=!0,this.startTransaction(this.name),i.resegmentable&&this.handle.fromMaxLinks===999){const e=i.points.copy(),s=this.getResegmentingPoint();if(e.insertAt(this.handle.segmentIndex+1,s),i.isOrthogonal&&e.insertAt(this.handle.segmentIndex+1,s),i.points=e,i.invalidateAdornments(),i.updateAdornments(),this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name),this.handle===null){this.doDeactivate();return}}this.WP=i.getPoint(this.handle.segmentIndex),this.Pm=i.points.copy(),this.isActive=!0}}doDeactivate(){this.stopTransaction(),this.handle=null,this.Xw=null;const t=this.diagram;t.isMouseCaptured=!1,this.isActive=!1}stopTransaction(){const t=this.diagram,i=super.stopTransaction();return i&&t.undoManager.transactionToUndo!==null&&t.undoManager.transactionToUndo.optimize(),i}doCancel(){const t=this.adornedLink;t!==null&&(t.points=this.Pm),this.stopTool()}getResegmentingPoint(){return this.handle.getDocumentPoint(Spot.Center)}doMouseMove(){const t=this.diagram;if(this.isActive){const i=this.computeReshape(t.lastInput.documentPoint);this.reshape(i)}}doMouseUp(){const t=this.diagram;if(this.isActive){const i=this.computeReshape(t.lastInput.documentPoint);this.reshape(i);const e=this.adornedLink;if(e!==null&&e.resegmentable){const s=this.handle.segmentIndex,n=e.getPoint(s-1),o=e.getPoint(s),r=e.getPoint(s+1);if(e.isOrthogonal){if(s>e.firstPickIndex+1&&s<e.lastPickIndex-1){let l=e.getPoint(s-2);if(this.isWithinResegmentingDistance(n,o)&&(this.isInLineOrtho(l,n,o,r,!0)||this.isInLineOrtho(l,n,o,r,!1))){const h=e.points.copy();this.isInLineOrtho(l,n,o,r,!0)?(h.setElt(s-2,new Point(l.x,(r.y+l.y)/2)),h.setElt(s+1,new Point(r.x,(r.y+l.y)/2))):(h.setElt(s-2,new Point((r.x+l.x)/2,l.y)),h.setElt(s+1,new Point((r.x+l.x)/2,r.y))),h.removeAt(s),h.removeAt(s-1),e.points=h,e.invalidateAdornments()}else if(l=e.getPoint(s+2),this.isWithinResegmentingDistance(o,r)&&(this.isInLineOrtho(n,o,r,l,!0)||this.isInLineOrtho(n,o,r,l,!1))){const h=e.points.copy();this.isInLineOrtho(n,o,r,l,!0)?(h.setElt(s-1,new Point(n.x,(n.y+l.y)/2)),h.setElt(s+2,new Point(l.x,(n.y+l.y)/2))):(h.setElt(s-1,new Point((n.x+l.x)/2,n.y)),h.setElt(s+2,new Point((n.x+l.x)/2,l.y))),h.removeAt(s+1),h.removeAt(s),e.points=h,e.invalidateAdornments()}}}else{const l=Point.l();if(Geo.gl(n.x,n.y,r.x,r.y,o.x,o.y,l)&&l.distanceSquaredPoint(o)<this.resegmentingDistance*this.resegmentingDistance){const h=e.points.copy();h.removeAt(s),e.points=h,e.invalidateAdornments()}Point.s(l)}}t.invalidateDocumentBounds(),this.transactionResult=this.name,t.v("LinkReshaped",this.adornedLink,this.Pm)}this.stopTool()}isWithinResegmentingDistance(t,i){return Math.abs(t.x-i.x)<this.resegmentingDistance&&Math.abs(t.y-i.y)<this.resegmentingDistance}isInLineOrtho(t,i,e,s,n){return n?Math.abs(t.y-i.y)<this.resegmentingDistance&&Math.abs(i.y-e.y)<this.resegmentingDistance&&Math.abs(e.y-s.y)<this.resegmentingDistance:Math.abs(t.x-i.x)<this.resegmentingDistance&&Math.abs(i.x-e.x)<this.resegmentingDistance&&Math.abs(e.x-s.x)<this.resegmentingDistance}get resegmentingDistance(){return this.qP}set resegmentingDistance(t){Util.i(t,"number",LinkReshapingTool,"resegmentingDistance"),this.qP=t}reshape(t){const i=this.adornedLink;i.startRoute();let e=this.handle.segmentIndex;const s=this.getReshapingBehavior(this.handle);if(i.isOrthogonal)if(e===i.firstPickIndex+1){const n=i.firstPickIndex+1;s===2?(i.setPointAt(n,i.getPoint(n-1).x,t.y),i.setPointAt(n+1,i.getPoint(n+2).x,t.y)):s===1&&(i.setPointAt(n,t.x,i.getPoint(n-1).y),i.setPointAt(n+1,t.x,i.getPoint(n+2).y))}else if(e===i.lastPickIndex-1){const n=i.lastPickIndex-1;s===2?(i.setPointAt(n-1,i.getPoint(n-2).x,t.y),i.setPointAt(n,i.getPoint(n+1).x,t.y)):s===1&&(i.setPointAt(n-1,t.x,i.getPoint(n-2).y),i.setPointAt(n,t.x,i.getPoint(n+1).y))}else{let n=e;const o=i.getPoint(n),r=i.getPoint(n-1),l=i.getPoint(n+1);Geo.u(r.x,o.x)&&Geo.u(o.y,l.y)?(Geo.u(r.x,i.getPoint(n-2).x)&&!Geo.u(r.y,i.getPoint(n-2).y)?(i.insertPointAt(n,t.x,r.y),e++,n++):i.setPointAt(n-1,t.x,r.y),Geo.u(l.y,i.getPoint(n+2).y)&&!Geo.u(l.x,i.getPoint(n+2).x)?i.insertPointAt(n+1,l.x,t.y):i.setPointAt(n+1,l.x,t.y)):Geo.u(r.y,o.y)&&Geo.u(o.x,l.x)?(Geo.u(r.y,i.getPoint(n-2).y)&&!Geo.u(r.x,i.getPoint(n-2).x)?(i.insertPointAt(n,r.x,t.y),e++,n++):i.setPointAt(n-1,r.x,t.y),Geo.u(l.x,i.getPoint(n+2).x)&&!Geo.u(l.y,i.getPoint(n+2).y)?i.insertPointAt(n+1,t.x,l.y):i.setPointAt(n+1,t.x,l.y)):Geo.u(r.x,o.x)&&Geo.u(o.x,l.x)?(Geo.u(r.x,i.getPoint(n-2).x)&&!Geo.u(r.y,i.getPoint(n-2).y)?(i.insertPointAt(n,t.x,r.y),e++,n++):i.setPointAt(n-1,t.x,r.y),Geo.u(l.x,i.getPoint(n+2).x)&&!Geo.u(l.y,i.getPoint(n+2).y)?i.insertPointAt(n+1,t.x,l.y):i.setPointAt(n+1,t.x,l.y)):Geo.u(r.y,o.y)&&Geo.u(o.y,l.y)&&(Geo.u(r.y,i.getPoint(n-2).y)&&!Geo.u(r.x,i.getPoint(n-2).x)?(i.insertPointAt(n,r.x,t.y),e++,n++):i.setPointAt(n-1,r.x,t.y),Geo.u(l.y,i.getPoint(n+2).y)&&!Geo.u(l.x,i.getPoint(n+2).x)?i.insertPointAt(n+1,l.x,t.y):i.setPointAt(n+1,l.x,t.y)),i.setPointAt(e,t.x,t.y)}else{i.setPointAt(e,t.x,t.y);let n=i.fromNode,o=i.fromPort;if(n!==null){const h=n.findVisibleNode();h!==null&&h!==n&&(n=h,o=n.port)}if(e===1&&i.computeSpot(!0,o).isNoSpot()){const h=o.getDocumentPoint(Spot.Center,Point.l()),a=i.getLinkPointFromPoint(n,o,h,t,!0,Point.l());i.setPointAt(0,a.x,a.y),Point.s(h),Point.s(a)}let r=i.toNode,l=i.toPort;if(r!==null){const h=r.findVisibleNode();h!==null&&h!==r&&(r=h,l=r.port)}if(e===i.pointsCount-2&&i.computeSpot(!1,l).isNoSpot()){const h=l.getDocumentPoint(Spot.Center,Point.l()),a=i.getLinkPointFromPoint(r,l,h,t,!1,Point.l());i.setPointAt(i.pointsCount-1,a.x,a.y),Point.s(h),Point.s(a)}}i.commitRoute()}computeReshape(t){const i=this.adornedLink,e=this.handle.segmentIndex;switch(this.getReshapingBehavior(this.handle)){case 3:return t;case 2:{const s=i.getPoint(e);return new Point(s.x,t.y)}case 1:{const s=i.getPoint(e);return new Point(t.x,s.y)}default:case 0:return i.getPoint(e)}}get originalPoint(){return this.WP}get originalPoints(){return this.Pm}}class ResizingTool extends Tool{xr;br;Co;yc;QP;us;yr;fs;Mm;_P;wc;Kw;Yw;Gw;constructor(t){super(),this.name="Resizing",this.xr=new Size(1,1).g(),this.br=new Size(9999,9999).g(),this.Co=new Size(NaN,NaN).g(),this.yc=!1,this.QP=!0,this.us=null,this.yr=new Shape("Rectangle",{alignmentFocus:Spot.Center,desiredSize:Size.tC,fill:"lightblue",stroke:"dodgerblue",strokeWidth:1,cursor:"pointer"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.fs=null,this.Mm=new Point,this._P=new Size,this.wc=new Point,this.Kw=new Size(0,0),this.Yw=new Size(1/0,1/0),this.Gw=new Size(1,1),t&&Object.assign(this,t)}updateAdornments(t){if(!(t===null||t instanceof Link)){if(t.isSelected&&!this.diagram.isReadOnly){const i=t.resizeObject;let e=t.findAdornment(this.name);if(i!==null&&t.canResize()&&t.actualBounds.isReal()&&t.isVisible()&&i.actualBounds.isReal()&&i.isVisibleObject()&&((e===null||e.adornedObject!==i)&&(e=this.makeAdornment(i)),e!==null)){const s=i.getDocumentAngle();t.Sl()&&this.updateResizeHandles(e,s),t.addAdornment(this.name,e);return}}t.removeAdornment(this.name)}}makeAdornment(t){let i=null;const e=t.part.resizeAdornmentTemplate;if(e===null){i=new Adornment,i.type=Panel.Spot,i.locationSpot=Spot.Center;const s=new Placeholder;s.isPanelMain=!0,i.add(s),i.add(this.makeHandle(t,Spot.TopLeft)),i.add(this.makeHandle(t,Spot.TopRight)),i.add(this.makeHandle(t,Spot.BottomRight)),i.add(this.makeHandle(t,Spot.BottomLeft)),i.add(this.makeHandle(t,Spot.MiddleTop)),i.add(this.makeHandle(t,Spot.MiddleRight)),i.add(this.makeHandle(t,Spot.MiddleBottom)),i.add(this.makeHandle(t,Spot.MiddleLeft))}else if(i=e.copy(),i===null)return null;return i.adornedObject=t,i}makeHandle(t,i){const e=this.handleArchetype;if(e===null)return null;const s=e.copy().ZP();return s.alignment=i,s}updateResizeHandles(t,i){if(t!==null){if(!t.alignment.isDefault()&&(t.cursor==="pointer"||t.cursor.indexOf("resize")>0))this.nF(t,i);else if(t instanceof Panel){const e=t.elements;for(;e.next();){const s=e.value;this.updateResizeHandles(s,i)}}}}nF(t,i){let e=t.alignment;e.isNoSpot()&&(e=Spot.Center);let s=i;if(e.x<=0)e.y<=0?s+=225:e.y>=1?s+=135:s+=180;else if(e.x>=1)e.y<=0?s+=315:e.y>=1&&(s+=45);else if(e.y<=0)s+=270;else if(e.y>=1)s+=90;else return;s<0?s+=360:s>=360&&(s-=360),s<22.5?t.cursor="e-resize":s<67.5?t.cursor="se-resize":s<112.5?t.cursor="s-resize":s<157.5?t.cursor="sw-resize":s<202.5?t.cursor="w-resize":s<247.5?t.cursor="nw-resize":s<292.5?t.cursor="n-resize":s<337.5?t.cursor="ne-resize":t.cursor="e-resize"}get handleArchetype(){return this.yr}set handleArchetype(t){this.yr=t}get handle(){return this.fs}set handle(t){if(t!==null&&!(t.part instanceof Adornment))throw new Error("new handle is not in an Adornment: "+t);this.fs=t}get adornedObject(){return this.us}set adornedObject(t){if(t!==null&&t.part instanceof Adornment)throw new Error("new handle must not be in an Adornment: "+t);this.us=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return t.isReadOnly||!t.allowResize||!t.lastInput.left?!1:this.findToolHandleAt(t.firstInput.documentPoint,this.name)!==null}doActivate(){const t=this.diagram;this.handle===null&&(this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name)),this.handle!==null&&(this.adornedObject=this.handle.part.adornedObject,this.adornedObject!==null&&(t.isMouseCaptured=!0,t.animationManager.stopAnimation(),t.pu=!0,this.startTransaction(this.name),this.Mm.set(this.adornedObject.getDocumentPoint(this.handle.alignment.opposite())),this.wc.set(this.adornedObject.part.location),this._P.set(this.adornedObject.desiredSize),this.Gw=this.computeCellSize(),this.Kw=this.computeMinSize(),this.Yw=this.computeMaxSize(),this.isActive=!0))}doDeactivate(){const t=this.diagram;t.pu=!1,t.xl=!0,this.stopTransaction(),this.handle=null,this.us=null,t.isMouseCaptured=!1,this.isActive=!1}stopTransaction(){const t=this.diagram,i=super.stopTransaction();return i&&t.undoManager.transactionToUndo!==null&&t.undoManager.transactionToUndo.optimize(),i}doCancel(){this.adornedObject!==null&&(this.adornedObject.desiredSize=this.originalDesiredSize,this.adornedObject.part.location=this.originalLocation),this.stopTool()}doMouseMove(){const t=this.diagram;if(!this.isActive)return;const i=this.Kw,e=this.Yw,s=this.Gw,n=t.lastInput.documentPoint,o=this.adornedObject.getLocalPoint(n,Point.l()),r=this.computeReshape(),l=this.computeResize(o,this.handle.alignment,i,e,s,r);this.resize(l),t.maybeUpdate(),Point.s(o)}doMouseUp(){const t=this.diagram;if(this.isActive){const i=this.Kw,e=this.Yw,s=this.Gw,n=this.adornedObject.getLocalPoint(t.lastInput.documentPoint,Point.l()),o=this.computeReshape(),r=this.computeResize(n,this.handle.alignment,i,e,s,o);this.resize(r),Point.s(n),t.invalidateDocumentBounds(),this.transactionResult=this.name,t.v("PartResized",this.adornedObject,this.originalDesiredSize)}this.stopTool()}resize(t){const i=this.diagram,e=this.adornedObject;if(e===null)return;e.desiredSize=t.size;const s=e.part;s.ensureBounds();const n=e.getDocumentPoint(this.handle.alignment.opposite());if(s instanceof Group){const o=new List;o.add(s);let r;!this.dragsMembers&&!s.hasPlaceholder()&&(r=new DraggingOptions,r.dragsMembers=!1),i.moveParts(o,this.oppositePoint.copy().subtract(n),!0,r)}else s.location=s.location.copy().subtract(n).add(this.oppositePoint);i.maybeUpdate()}computeResize(t,i,e,s,n,o){i.isNoSpot()&&(i=Spot.Center);const r=this.adornedObject.naturalBounds,l=r.x,h=r.y,a=r.x+r.width,c=r.y+r.height;let f=1;if(!o){let m=r.width,g=r.height;m<=0&&(m=1),g<=0&&(g=1),f=g/m}const u=Point.l();Geo.Bg(t.x,t.y,l,h,n.width,n.height,u);const d=r.copy();return i.x<=0?i.y<=0?(d.x=Math.max(u.x,a-s.width),d.x=Math.min(d.x,a-e.width),d.width=Math.max(a-d.x,e.width),d.y=Math.max(u.y,c-s.height),d.y=Math.min(d.y,c-e.height),d.height=Math.max(c-d.y,e.height),o||(d.height/d.width>=1?(d.height=Math.max(Math.min(f*d.width,s.height),e.height),d.width=d.height/f):(d.width=Math.max(Math.min(d.height/f,s.width),e.width),d.height=f*d.width),d.x=a-d.width,d.y=c-d.height)):i.y>=1?(d.x=Math.max(u.x,a-s.width),d.x=Math.min(d.x,a-e.width),d.width=Math.max(a-d.x,e.width),d.height=Math.max(Math.min(u.y-h,s.height),e.height),o||(d.height/d.width>=1?(d.height=Math.max(Math.min(f*d.width,s.height),e.height),d.width=d.height/f):(d.width=Math.max(Math.min(d.height/f,s.width),e.width),d.height=f*d.width),d.x=a-d.width)):(d.x=Math.max(u.x,a-s.width),d.x=Math.min(d.x,a-e.width),d.width=a-d.x,o||(d.height=Math.max(Math.min(f*d.width,s.height),e.height),d.width=d.height/f,d.y=h+.5*(c-h-d.height))):i.x>=1?i.y<=0?(d.width=Math.max(Math.min(u.x-l,s.width),e.width),d.y=Math.max(u.y,c-s.height),d.y=Math.min(d.y,c-e.height),d.height=Math.max(c-d.y,e.height),o||(d.height/d.width>=1?(d.height=Math.max(Math.min(f*d.width,s.height),e.height),d.width=d.height/f):(d.width=Math.max(Math.min(d.height/f,s.width),e.width),d.height=f*d.width),d.y=c-d.height)):i.y>=1?(d.width=Math.max(Math.min(u.x-l,s.width),e.width),d.height=Math.max(Math.min(u.y-h,s.height),e.height),o||(d.height/d.width>=1?(d.height=Math.max(Math.min(f*d.width,s.height),e.height),d.width=d.height/f):(d.width=Math.max(Math.min(d.height/f,s.width),e.width),d.height=f*d.width))):(d.width=Math.max(Math.min(u.x-l,s.width),e.width),o||(d.height=Math.max(Math.min(f*d.width,s.height),e.height),d.width=d.height/f,d.y=h+.5*(c-h-d.height))):i.y<=0?(d.y=Math.max(u.y,c-s.height),d.y=Math.min(d.y,c-e.height),d.height=c-d.y,o||(d.width=Math.max(Math.min(d.height/f,s.width),e.width),d.height=f*d.width,d.x=l+.5*(a-l-d.width))):i.y>=1&&(d.height=Math.max(Math.min(u.y-h,s.height),e.height),o||(d.width=Math.max(Math.min(d.height/f,s.width),e.width),d.height=f*d.width,d.x=l+.5*(a-l-d.width))),Point.s(u),d}computeReshape(){let t=0;return this.adornedObject instanceof Shape&&(t=this.adornedObject.tM()),!(t===6||this.diagram.lastInput.shift)}computeMinSize(){const t=this.adornedObject.minSize.copy(),i=this.minSize;return!isNaN(i.width)&&i.width>t.width&&(t.width=i.width),!isNaN(i.height)&&i.height>t.height&&(t.height=i.height),t}computeMaxSize(){const t=this.adornedObject.maxSize.copy(),i=this.maxSize;return!isNaN(i.width)&&i.width<t.width&&(t.width=i.width),!isNaN(i.height)&&i.height<t.height&&(t.height=i.height),t}computeCellSize(){const t=new Size(NaN,NaN),i=this.adornedObject.part;if(i!==null){const n=i.resizeCellSize;!isNaN(n.width)&&n.width>0&&(t.width=n.width),!isNaN(n.height)&&n.height>0&&(t.height=n.height)}let e=this.cellSize;isNaN(t.width)&&!isNaN(e.width)&&e.width>0&&(t.width=e.width),isNaN(t.height)&&!isNaN(e.height)&&e.height>0&&(t.height=e.height);const s=this.diagram;if((isNaN(t.width)||isNaN(t.height))&&s){const n=s.grid;n!==null&&n.visible&&this.isGridSnapEnabled&&(e=n.gridCellSize,isNaN(t.width)&&!isNaN(e.width)&&e.width>0&&(t.width=e.width),isNaN(t.height)&&!isNaN(e.height)&&e.height>0&&(t.height=e.height))}return(isNaN(t.width)||t.width===0||t.width===1/0)&&(t.width=1),(isNaN(t.height)||t.height===0||t.height===1/0)&&(t.height=1),t}get minSize(){return this.xr}set minSize(t){if(!this.xr.equals(t)){let e=t.width;isNaN(e)&&(e=0);let s=t.height;isNaN(s)&&(s=0),this.xr.e(e,s)}}get maxSize(){return this.br}set maxSize(t){if(!this.br.equals(t)){let e=t.width;isNaN(e)&&(e=1/0);let s=t.height;isNaN(s)&&(s=1/0),this.br.e(e,s)}}get cellSize(){return this.Co}set cellSize(t){this.Co.equals(t)||this.Co.a(t)}get isGridSnapEnabled(){return this.yc}set isGridSnapEnabled(t){Util.i(t,"boolean",ResizingTool,"isGridSnapEnabled"),this.yc=t}get dragsMembers(){return this.QP}set dragsMembers(t){Util.i(t,"boolean",ResizingTool,"dragsMembers"),this.QP=t}get oppositePoint(){return this.Mm}set oppositePoint(t){this.Mm.equals(t)||this.Mm.a(t)}get originalDesiredSize(){return this._P}get originalLocation(){return this.wc}}class RotatingTool extends Tool{iM;eM;us;yr;jw;fs;sM;Sm;wc;nM;oM;constructor(t){super(),this.name="Rotating",this.iM=45,this.eM=2,this.wc=new Point,this.us=null,this.handleArchetype=new Shape("Ellipse",{desiredSize:Size.lu,fill:"lightblue",stroke:"dodgerblue",strokeWidth:1,cursor:"pointer"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.fs=null,this.sM=0,this.Sm=new Point(NaN,NaN),this.nM=0,this.oM=50,t&&Object.assign(this,t)}updateAdornments(t){if(t!==null){if(t.Nl()){const i=t.rotateObject;if(i===t||i===t.path||i.isPanelMain)return}if(t.isSelected&&!this.diagram.isReadOnly){const i=t.rotateObject;if(i!==null&&t.canRotate()&&t.actualBounds.isReal()&&t.isVisible()&&i.actualBounds.isReal()&&i.isVisibleObject()){let e=t.findAdornment(this.name);if((e===null||e.adornedObject!==i)&&(e=this.makeAdornment(i)),e!==null){e.angle=i.getDocumentAngle(),e.hasPlaceholder()||(e.location=this.computeAdornmentLocation(i)),t.addAdornment(this.name,e);return}}}t.removeAdornment(this.name)}}makeAdornment(t){let i=null;const e=t.part.rotateAdornmentTemplate;return e!==null?i=e.copy():this.jw!==null&&(i=this.jw.copy()),i===null?null:(i.adornedObject=t,i)}get handleArchetype(){return this.yr}set handleArchetype(t){this.yr=t,t!==null?this.jw=new Adornment(Panel.Position,{locationSpot:Spot.Center}).add(t).Vt():this.jw=null}get handle(){return this.fs}set handle(t){if(t!==null&&!(t.part instanceof Adornment))throw new Error("new handle is not in an Adornment: "+t);this.fs=t}get adornedObject(){return this.us}set adornedObject(t){if(t!==null&&t.part instanceof Adornment)throw new Error("new handle must not be in an Adornment: "+t);this.us=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return t.isReadOnly||!t.allowRotate||!t.lastInput.left?!1:this.findToolHandleAt(t.firstInput.documentPoint,this.name)!==null}doActivate(){const t=this.diagram;if(this.adornedObject===null){if(this.handle===null&&(this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name)),this.handle===null)return;this.adornedObject=this.handle.part.adornedObject}this.adornedObject!==null&&(t.isMouseCaptured=!0,t.delaysLayout=!0,this.startTransaction(this.name),this.sM=this.adornedObject.angle,this.Sm=this.computeRotationPoint(this.adornedObject),this.wc=this.adornedObject.part.location.copy(),this.isActive=!0)}computeRotationPoint(t){const i=t.part,e=i.locationObject;return i.rotationSpot.isSpot()?t.getDocumentPoint(i.rotationSpot):t===i||t===e?e.getDocumentPoint(i.locationSpot):t.getDocumentPoint(Spot.Center)}computeAdornmentLocation(t){let i=this.rotationPoint;i.isReal()||(i=this.computeRotationPoint(t));const e=t.getLocalPoint(i);let s=this.handleAngle;s<0?s+=360:s>=360&&(s-=360),s=Math.round(Math.round(s/45)*45);const n=this.handleDistance;return s===0?e.x=t.naturalBounds.width+n:s===45?(e.x=t.naturalBounds.width+n,e.y=t.naturalBounds.height+n):s===90?e.y=t.naturalBounds.height+n:s===135?(e.x=-n,e.y=t.naturalBounds.height+n):s===180?e.x=-n:s===225?(e.x=-n,e.y=-n):s===270?e.y=-n:s===315&&(e.x=t.naturalBounds.width+n,e.y=-n),t.getDocumentPoint(e)}doDeactivate(){const t=this.diagram;this.stopTransaction(),this.handle=null,this.us=null,this.Sm=new Point(NaN,NaN),t.isMouseCaptured=!1,this.isActive=!1}stopTransaction(){const t=this.diagram,i=super.stopTransaction();return i&&t.undoManager.transactionToUndo!==null&&t.undoManager.transactionToUndo.optimize(),i}doCancel(){const t=this.diagram;t.delaysLayout=!1,this.rotate(this.originalAngle),this.stopTool()}doMouseMove(){const t=this.diagram;if(this.isActive){const i=this.computeRotate(t.lastInput.documentPoint);this.rotate(i)}}doMouseUp(){const t=this.diagram;if(this.isActive){t.delaysLayout=!1;const i=this.computeRotate(t.lastInput.documentPoint);this.rotate(i),t.invalidateDocumentBounds(),this.transactionResult=this.name,t.v("PartRotated",this.adornedObject,this.originalAngle)}this.stopTool()}rotate(t){const i=this.adornedObject;if(i===null)return;i.angle=t;const e=i.part;e.ensureBounds();const s=e.locationObject,n=e.rotateObject;if(s===n||s.isContainedBy(n)){const o=this.wc.copy();e.location=o.subtract(this.rotationPoint).rotate(t-this.originalAngle).add(this.rotationPoint)}this.diagram.maybeUpdate()}computeRotate(t){let i=this.rotationPoint.directionPoint(t)-this.handleAngle;const e=this.adornedObject.panel;e!==null&&(i-=e.getDocumentAngle()),i>=360?i-=360:i<0&&(i+=360);const s=Math.min(Math.abs(this.snapAngleMultiple),180),n=Math.min(Math.abs(this.snapAngleEpsilon),s/2);return!this.diagram.lastInput.shift&&s>0&&n>0&&(i%s<n?i=Math.floor(i/s)*s:i%s>s-n&&(i=(Math.floor(i/s)+1)*s)),i>=360?i-=360:i<0&&(i+=360),i}get snapAngleMultiple(){return this.iM}set snapAngleMultiple(t){Util.i(t,"number",RotatingTool,"snapAngleMultiple"),this.iM=t}get snapAngleEpsilon(){return this.eM}set snapAngleEpsilon(t){Util.i(t,"number",RotatingTool,"snapAngleEpsilon"),this.eM=t}get originalAngle(){return this.sM}get rotationPoint(){return this.Sm}set rotationPoint(t){this.Sm=t.copy()}get handleAngle(){return this.nM}set handleAngle(t){Util.i(t,"number",RotatingTool,"handleAngle"),this.nM=t}get handleDistance(){return this.oM}set handleDistance(t){Util.i(t,"number",RotatingTool,"handleDistance"),this.oM=t}}class ClickSelectingTool extends Tool{constructor(t){super(),this.name="ClickSelecting",t&&Object.assign(this,t)}canStart(){return!(!this.isEnabled||this.isBeyondDragSize())}doMouseUp(){this.isActive&&(this.standardMouseSelect(),this.standardMouseClick()||this.diagram.lastInput.isTouchEvent&&this.diagram.toolManager.doToolTip()),this.stopTool()}}class ActionTool extends Tool{xc;constructor(t){super(),this.name="Action",this.xc=null,t&&Object.assign(this,t)}canStart(){if(!this.isEnabled)return!1;const t=this.diagram,i=t.lastInput,e=t.findObjectAt(i.documentPoint,s=>{for(;s.panel!==null;){if(s.isActionable)return s;s=s.panel}return s});return e!==null&&e.isActionable?(this.xc=e,t.fc=t.findObjectAt(i.documentPoint,null,null),!0):!1}doMouseDown(){if(!this.isActive)this.canStart()&&this.doActivate();else{const i=this.diagram.lastInput,e=this.xc;if(e===null)return;i.targetObject=e,e.actionDown!==null&&e.actionDown(i,e)}}doMouseMove(){if(this.isActive){const i=this.diagram.lastInput,e=this.xc;if(e===null)return;i.targetObject=e,e.actionMove!==null&&e.actionMove(i,e)}}doMouseUp(){if(this.isActive){const i=this.diagram.lastInput,e=this.xc;if(e===null)return;i.targetObject=e,e.actionUp!==null&&e.actionUp(i,e),this.standardMouseClick(s=>{for(;s.panel!==null;){if(s.isActionable&&s===e)return s;s=s.panel}return s},s=>s===e)}this.stopTool()}doCancel(){const i=this.diagram.lastInput,e=this.xc;e!==null&&(i.targetObject=e,e.actionCancel!==null&&e.actionCancel(i,e),this.stopTool())}doStop(){this.xc=null}}class ClickCreatingTool extends Tool{Cl;rM;yc;lM;constructor(t){super(),this.name="ClickCreating",this.Cl=null,this.rM=!0,this.yc=!1,this.lM=new Point(0,0),t&&Object.assign(this,t)}canStart(){if(!this.isEnabled||this.archetypeNodeData===null)return!1;const t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowInsert||!t.lastInput.left||this.isBeyondDragSize())return!1;if(this.isDoubleClick){if(t.lastInput.clickCount===1&&(this.lM=t.lastInput.viewPoint.copy()),t.lastInput.clickCount!==2||this.isBeyondDragSize(this.lM))return!1}else if(t.lastInput.clickCount!==1)return!1;return!(t.currentTool!==this&&t.findPartAt(t.lastInput.documentPoint,!0)!==null)}doMouseUp(){const t=this.diagram;this.isActive&&this.insertPart(t.lastInput.documentPoint),this.stopTool()}insertPart(t){const i=this.diagram,e=this.archetypeNodeData;if(e===null)return null;let s=null;try{if(i.v("ChangingSelection",i.selection),this.startTransaction(this.name),e instanceof Part)e.Pe()&&(e.Vt(),s=e.copy(),s!==null&&i.add(s));else if(e!==null){const n=i.model.copyNodeData(e);Util.wt(n)&&(i.model.addNodeData(n),s=i.findPartForData(n))}if(s!==null){const n=Point.X(t.x,t.y);this.isGridSnapEnabled&&this.diagram.hM(s,t,n),s.location=n,i.allowSelect&&(i.clearSelection(!0),s.isSelected=!0),Point.s(n)}i.invalidateDocumentBounds(),this.transactionResult=this.name,i.v("PartCreated",s)}finally{this.stopTransaction(),i.v("ChangedSelection",i.selection)}return s}get archetypeNodeData(){return this.Cl}set archetypeNodeData(t){t!==null&&Util.i(t,"object",ClickCreatingTool,"archetypeNodeData"),this.Cl=t}get isDoubleClick(){return this.rM}set isDoubleClick(t){Util.i(t,"boolean",ClickCreatingTool,"isDoubleClick"),this.rM=t}get isGridSnapEnabled(){return this.yc}set isGridSnapEnabled(t){Util.i(t,"boolean",ClickCreatingTool,"isGridSnapEnabled"),this.yc=t}}class DragSelectingTool extends Tool{Vh;aM;Ll;constructor(t){super(),this.name="DragSelecting",this.Vh=175,this.aM=!1,this.Ll=new Part({layerName:"Tool",selectable:!1}).add(new Shape("Rectangle",{name:"SHAPE",fill:null,stroke:"magenta"}).theme("stroke","dragSelect")).Vt(),t&&Object.assign(this,t)}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(!t.allowSelect)return!1;const i=t.lastInput;return!(!i.left||t.currentTool!==this&&(!this.isBeyondDragSize()||i.timestamp-t.firstInput.timestamp<this.delay||t.findPartAt(i.documentPoint,!0)!==null))}doActivate(){const t=this.diagram;this.isActive=!0,t.isMouseCaptured=!0,t.skipsUndoManager=!0,t.add(this.box),this.doMouseMove()}doDeactivate(){const t=this.diagram;t.stopAutoScroll(),t.remove(this.box),t.skipsUndoManager=!1,t.isMouseCaptured=!1,this.isActive=!1}doMouseMove(){const t=this.diagram;if(this.isActive&&this.box!==null){const i=this.computeBoxBounds();let e=this.box.findObject("SHAPE");e===null&&(e=this.box.findMainElement());const s=Size.l().e(i.width,i.height);e.desiredSize=s,this.box.bc(i.x,i.y,!1),Size.s(s),(t.allowHorizontalScroll||t.allowVerticalScroll)&&t.doAutoScroll(t.lastInput.viewPoint)}}doMouseUp(){if(this.isActive){const t=this.diagram;t.remove(this.box);try{t.currentCursor="wait",t.v("ChangingSelection",t.selection),this.selectInRect(this.computeBoxBounds()),t.v("ChangedSelection",t.selection)}finally{t.currentCursor=""}}this.stopTool()}computeBoxBounds(){const t=this.diagram;return new Rect(t.firstInput.documentPoint,t.lastInput.documentPoint)}selectInRect(t){const i=this.diagram,e=i.lastInput,s=i.findPartsIn(t,this.isPartialInclusion);if(Util.or?e.meta:e.control)if(e.shift){const n=s.iterator;for(;n.next();){const o=n.value;o.isSelected&&(o.isSelected=!1)}}else{const n=s.iterator;for(;n.next();){const o=n.value;o.isSelected=!o.isSelected}}else if(e.shift){const n=s.iterator;for(;n.next();){const o=n.value;o.isSelected||(o.isSelected=!0)}}else{const n=new List,o=i.selection.iterator;for(;o.next();){const h=o.value;s.has(h)||n.add(h)}const r=n.iterator;for(;r.next();){const h=r.value;h.isSelected=!1}const l=s.iterator;for(;l.next();){const h=l.value;h.isSelected||(h.isSelected=!0)}}}get delay(){return this.Vh}set delay(t){Util.i(t,"number",DragSelectingTool,"delay"),this.Vh=t}get isPartialInclusion(){return this.aM}set isPartialInclusion(t){Util.i(t,"boolean",DragSelectingTool,"isPartialInclusion"),this.aM=t}get box(){return this.Ll}set box(t){t!==null&&t.Vt(),this.Ll=t}}class PanningTool extends Tool{Hw;HC;No;cM;constructor(t){super(),this.name="Panning",this.Hw=new Point,this.HC=new Point,this.No=!1;const i=this;this.cM=()=>{const e=i.diagram;e!==null&&e.Si(root.document,"scroll",i.cM,!1),i.stopTool()},t&&Object.assign(this,t)}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return!(!t.allowHorizontalScroll&&!t.allowVerticalScroll||!t.lastInput.left||t.currentTool!==this&&!this.isBeyondDragSize())}doActivate(){const t=this.diagram;this.No?(t.lastInput.bubbles=!0,t.zt(root.document,"scroll",this.cM,!1)):(t.currentCursor="move",t.isMouseCaptured=!0,this.Hw.a(t.position)),this.isActive=!0}doDeactivate(){const t=this.diagram;t.currentCursor="",t.isMouseCaptured=!1,this.isActive=!1}doCancel(){const t=this.diagram;t.position=this.Hw,t.isMouseCaptured=!1,this.stopTool()}doMouseMove(){this.qC()}doMouseUp(){this.qC(),this.stopTool()}qC(){const t=this.diagram;if(this.isActive&&t){if(this.No){t.lastInput.bubbles=!0;return}const i=t.position,e=t.firstInput.documentPoint,s=t.lastInput.documentPoint;let n=i.x+e.x-s.x,o=i.y+e.y-s.y;t.allowHorizontalScroll||(n=i.x),t.allowVerticalScroll||(o=i.y),t.position=this.HC.e(n,o)}}get bubbles(){return this.No}set bubbles(t){Util.i(t,"boolean",PanningTool,"bubbles"),this.No=t}get originalPosition(){return this.Hw}}class HTMLInfo{qw;Ww;fM;uM;constructor(t){this.qw=null,this.Ww=null,this.fM=null,this.uM=null,t&&Object.assign(this,t)}get mainElement(){return this.fM}set mainElement(t){this.fM=t}get show(){return this.qw}set show(t){this.qw!==t&&(t!==null&&Util.i(t,"function",HTMLInfo,"show"),this.qw=t)}get hide(){return this.Ww}set hide(t){this.Ww!==t&&(t!==null&&Util.i(t,"function",HTMLInfo,"hide"),this.Ww=t)}get valueFunction(){return this.uM}set valueFunction(t){this.uM=t}}class ContextMenuButtonInfo{hi;Nm;kc;constructor(t,i,e){this.hi=t,this.Nm=i,this.kc=e}}class ContextMenuTool extends Tool{dM;Jw;gM;mM;$w;Zw;Cm;constructor(t){super(),this.name="ContextMenu",this.dM=null,this.Jw=null,this.gM=null,this.mM=new Point,this.$w=null,this.Cm=!1;const i=this;this.Zw=()=>i.stopTool(),t&&Object.assign(this,t)}oF(){const t=new HTMLInfo;t.show=(r,l,h)=>h.showDefaultContextMenu(),t.hide=(r,l)=>l.hideDefaultContextMenu(),ContextMenuTool.bu=t;const i=this;this.Zw=()=>i.stopTool();const e=Util.en("div"),s=Util.en("div");e.style.cssText="top: 0px;z-index:10002;position: fixed;display: none;text-align: center;left: 25%;width: 50%;background-color: #F5F5F5;padding: 16px;border: 16px solid #444;border-radius: 10px;margin-top: 10px",s.style.cssText="z-index:10001;position: fixed;display: none;top: 0;left: 0;width: 100%;height: 100%;background-color: black;opacity: 0.8;";const n=Util.en("style");root.document.getElementsByTagName("head")[0].appendChild(n),n.sheet.insertRule(".goCXul { list-style: none; }",0),n.sheet.insertRule(".goCXli {font:700 1.5em Helvetica, Arial, sans-serif;position: relative;min-width: 60px; }",0),n.sheet.insertRule(".goCXa {color: #444;display: inline-block;padding: 4px;text-decoration: none;margin: 2px;border: 1px solid gray;border-radius: 10px; }",0);const o=this.diagram;o!==null&&(o.zt(e,"contextmenu",ContextMenuTool.Yh,!1),o.zt(e,"selectstart",ContextMenuTool.Yh,!1),o.zt(s,"contextmenu",ContextMenuTool.Yh,!1)),e.className="goCXforeground",s.className="goCXbackground",root.document.body&&(root.document.body.appendChild(e),root.document.body.appendChild(s)),ContextMenuTool.Lm=e,ContextMenuTool.Am=s,ContextMenuTool.pM=!0}static bu=null;static pM=!1;static Am=null;static Lm=null;static Yh(t){return t.preventDefault(),!1}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;return this.isBeyondDragSize()||!t.lastInput.right||t.lastInput.clickCount>1?!1:!!(t.lastInput.isTouchEvent&&this.defaultTouchContextMenu!==null||this.findObjectWithContextMenu()!==null)}doStart(){const t=this.diagram;this.mM.set(t.firstInput.documentPoint)}doStop(){this.hideContextMenu(),this.currentObject=null,this.Cm=!1}findObjectWithContextMenu(t){t===void 0&&(t=null);const i=this.diagram,e=i.lastInput;let s=null;if(t instanceof Diagram||(t instanceof GraphObject?s=t:s=i.findObjectAt(e.documentPoint,null,n=>!n.layer.isTemporary)),s!==null){let n=s;for(;n!==null;){if(n.contextMenu!==null)return n;n=n.panel}if(i.lastInput.isTouchEvent&&this.defaultTouchContextMenu)return s.part}else if(i.contextMenu!==null)return i;return null}doActivate(){}doMouseDown(){if(super.doMouseDown(),this.isActive&&this.currentContextMenu instanceof Adornment){const t=this.diagram.toolManager.findTool("Action");t!==null&&t.canStart()&&(t.doActivate(),t.doMouseDown(),t.doDeactivate())}this.diagram.toolManager.mouseDownTools.has(this)&&this.doContextClick()}doMouseUp(){if(this.isActive&&this.currentContextMenu instanceof Adornment){const t=this.diagram.toolManager.findTool("Action");t!==null&&t.canStart()&&(t.doActivate(),t.doCancel(),t.doDeactivate())}this.doContextClick()}doContextClick(){const t=this.diagram;if(!this.isActive)this.canStart()&&(this.openMenu(!0),this.isActive||this.stopTool());else{const i=this.currentContextMenu;if(i===null)return;let e=null;i instanceof HTMLInfo||(e=t.findObjectAt(t.lastInput.documentPoint,null,null),e!==null&&e.isContainedBy(i)&&this.standardMouseClick(null,null)),this.maybeStopTool(e)}}maybeStopTool(t){this.stopTool(),this.canStart()&&(this.diagram.currentTool=this,this.doMouseUp())}openMenu(t,i){if(i===void 0&&(i=null),this.Cm)return;this.Cm=!0,t&&this.standardMouseSelect();const e=this.standardMouseClick();if(this.Cm=!1,!e){this.isActive=!0;const s=ContextMenuTool.bu;if(i===null&&(i=this.findObjectWithContextMenu()),i!==null){const n=i.contextMenu;n!==null?(this.currentObject=i instanceof GraphObject?i:null,this.showContextMenu(n,this.currentObject)):s!==null&&this.showContextMenu(s,this.currentObject)}else s!==null&&this.showContextMenu(s,null);this.currentContextMenu instanceof Adornment&&!this.currentContextMenu.visible&&this.stopTool()}}doMouseMove(){const t=this.diagram.toolManager.findTool("Action");t!==null&&t.doMouseMove(),this.isActive&&this.diagram.toolManager.doMouseMove()}showContextMenu(t,i){const e=this.diagram;if(t!==this.currentContextMenu&&this.hideContextMenu(),t instanceof Adornment){const s=t;s.layerName="Tool",s.selectable=!1,s.scale=1/e.scale,s.category=this.name,s.hasPlaceholder()&&(s.placeholder.scale=e.scale);const n=s.diagram;n!==null&&n!==e&&n.remove(s),e.add(s),i!==null?s.adornedObject=i:s.data=e.model,s.ensureBounds(),this.positionContextMenu(s,i)}else t instanceof HTMLInfo&&t.show(i,e,this);this.currentContextMenu=t}positionContextMenu(t,i){if(t.hasPlaceholder())return;const e=t,s=this.diagram,n=s.lastInput.documentPoint.copy(),o=e.measuredBounds,r=s.viewportBounds;s.lastInput.isTouchEvent&&(n.x-=o.width),n.x+o.width>r.right&&(n.x-=o.width+5/s.scale),n.x<r.x&&(n.x=r.x),n.y+o.height>r.bottom&&(n.y-=o.height+5/s.scale),n.y<r.y&&(n.y=r.y),e.position=n}hideContextMenu(){const t=this.diagram,i=this.currentContextMenu;i!==null&&(i instanceof Adornment?(t.remove(i),this.Jw!==null&&this.Jw.removeAdornment(i.category),i.data=null,i.adornedObject=null):i instanceof HTMLInfo&&(i.hide!==null?i.hide(t,this):i.mainElement!==null&&(i.mainElement.style.display="none")),this.currentContextMenu=null,this.standardMouseOver())}rF(){const t=this,i=new List;return i.add(new ContextMenuButtonInfo("Copy",e=>e.commandHandler.copySelection(),e=>e.commandHandler.canCopySelection())),i.add(new ContextMenuButtonInfo("Cut",e=>e.commandHandler.cutSelection(),e=>e.commandHandler.canCutSelection())),i.add(new ContextMenuButtonInfo("Delete",e=>e.commandHandler.deleteSelection(),e=>e.commandHandler.canDeleteSelection())),i.add(new ContextMenuButtonInfo("Paste",e=>e.commandHandler.pasteSelection(t.mouseDownPoint),e=>e.commandHandler.canPasteSelection(t.mouseDownPoint))),i.add(new ContextMenuButtonInfo("Select All",e=>e.commandHandler.selectAll(),e=>e.commandHandler.canSelectAll())),i.add(new ContextMenuButtonInfo("Undo",e=>e.commandHandler.undo(),e=>e.commandHandler.canUndo())),i.add(new ContextMenuButtonInfo("Redo",e=>e.commandHandler.redo(),e=>e.commandHandler.canRedo())),i.add(new ContextMenuButtonInfo("Scroll To Part",e=>e.commandHandler.scrollToPart(),e=>e.commandHandler.canScrollToPart())),i.add(new ContextMenuButtonInfo("Zoom To Fit",e=>e.commandHandler.zoomToFit(),e=>e.commandHandler.canZoomToFit())),i.add(new ContextMenuButtonInfo("Reset Zoom",e=>e.commandHandler.resetZoom(),e=>e.commandHandler.canResetZoom())),i.add(new ContextMenuButtonInfo("Group Selection",e=>e.commandHandler.groupSelection(),e=>e.commandHandler.canGroupSelection())),i.add(new ContextMenuButtonInfo("Ungroup Selection",e=>e.commandHandler.ungroupSelection(),e=>e.commandHandler.canUngroupSelection())),i.add(new ContextMenuButtonInfo("Edit Text",e=>e.commandHandler.editTextBlock(),e=>e.commandHandler.canEditTextBlock())),i}showDefaultContextMenu(){const t=this.diagram;this.$w===null&&(this.$w=this.rF()),ContextMenuTool.Lm.innerHTML="",ContextMenuTool.Am.addEventListener("pointerdown",this.Zw,!1);const i=this,e=Util.en("ul");e.className="goCXul",ContextMenuTool.Lm.appendChild(e),e.innerHTML="";const s=this.$w.iterator;for(;s.next();){const n=s.value,o=n.Nm,r=n.kc;if(typeof o!="function"||typeof r=="function"&&!r(t))continue;const l=Util.en("li");l.className="goCXli";const h=Util.en("a");h.className="goCXa",h.href="#",h.Nm=n.Nm,h.addEventListener("pointerdown",function(a){return this.Nm(t),i.stopTool(),a.preventDefault(),!1},!1),h.textContent=n.hi,l.appendChild(h),e.appendChild(l)}ContextMenuTool.Lm.style.display="block",ContextMenuTool.Am.style.display="block"}hideDefaultContextMenu(){if(this.currentContextMenu===null||this.currentContextMenu!==ContextMenuTool.bu)return;ContextMenuTool.Lm.style.display="none",ContextMenuTool.Am.style.display="none";const t=this.diagram;t!==null&&t.Si(ContextMenuTool.Am,"pointerdown",this.Zw,!1),this.currentContextMenu=null}get currentContextMenu(){return this.dM}set currentContextMenu(t){this.dM=t,this.Jw=t instanceof Adornment?t.adornedPart:null}get defaultTouchContextMenu(){return ContextMenuTool.pM===!1&&ContextMenuTool.bu===null&&Diagram.isUsingDOM()&&this.oF(),ContextMenuTool.bu}set defaultTouchContextMenu(t){t===null&&(ContextMenuTool.pM=!0),ContextMenuTool.bu=t}get currentObject(){return this.gM}set currentObject(t){this.gM=t}get mouseDownPoint(){return this.mM}}var TextEditingAccept=(w=>(w[w.LostFocus=1]="LostFocus",w[w.MouseDown=2]="MouseDown",w[w.Tab=3]="Tab",w[w.Enter=4]="Enter",w))(TextEditingAccept||{}),TextEditingStarting=(w=>(w[w.SingleClick=1]="SingleClick",w[w.SingleClickSelected=2]="SingleClickSelected",w[w.DoubleClick=3]="DoubleClick",w))(TextEditingStarting||{}),TextEditingState=(w=>(w[w.None=1]="None",w[w.Active=2]="Active",w[w.Editing=3]="Editing",w[w.Validating=4]="Validating",w[w.Invalid=5]="Invalid",w[w.Validated=6]="Validated",w))(TextEditingState||{});class TextEditingTool extends Tool{Me;yM;wM;Al;Gt;xM;bM;kM;Qw;_w;constructor(t){super(),this.name="TextEditing",this.Me=new TextBlock,this.yM=null,this.wM=2,this.Al=null,this.Gt=1,this.xM=1,this.bM=!0,this.kM=null,this.Qw=new HTMLInfo,this._w=null,this.lF(this.Qw),t&&Object.assign(this,t)}static LostFocus=1;static MouseDown=2;static Tab=3;static Enter=4;static SingleClick=1;static SingleClickSelected=2;static DoubleClick=3;static StateNone=1;static StateActive=2;static StateEditing=3;static StateValidating=4;static StateInvalid=5;static StateValidated=6;lF(t){if(!Diagram.isUsingDOM())return;const i=Util.en("textarea");this._w=i;const e=this;i.addEventListener("input",function(s){if(e.textBlock===null)return;const n=e.measureTemporaryTextBlock(this.value),o=this.textScale;this.style.width=20+Math.max(e.textBlock.measuredBounds.width,n.measuredBounds.width)*o+"px",this.rows=Math.max(e.textBlock.lineCount,n.lineCount)},!1),i.addEventListener("keydown",function(s){if(s.isComposing||e.textBlock===null)return;const n=s.key;if(n==="Enter"){e.textBlock.isMultiline===!1&&s.preventDefault(),e.acceptText(4);return}else if(n==="Tab"){e.acceptText(3),s.preventDefault();return}else n==="Escape"&&(e.doCancel(),e.diagram!==null&&e.diagram.doFocus())},!1),i.addEventListener("focus",function(s){e.hF(s)},!1),i.addEventListener("blur",function(s){e.aF(s)},!1),t.valueFunction=()=>i.value,t.mainElement=i,t.show=(s,n,o)=>{if(!(s instanceof TextBlock)||!n||!n.div||!(o instanceof TextEditingTool))return;if(o.state===5){i.style.border="3px solid red",i.focus();return}const r=s.getDocumentPoint(Spot.Center),l=n.position,h=n.scale;let a=s.getDocumentScale()*h;a<o.minimumEditorScale&&(a=o.minimumEditorScale);const c=s.naturalBounds.width*a+6,f=s.naturalBounds.height*a+2,u=(r.x-l.x)*h,d=(r.y-l.y)*h,m=s.verticalAlignment,p=(s.lineHeight+s.spacingAbove+s.spacingBelow)*s.lineCount*a,y=.5*f-.5*p,x=m.y*f-m.y*p+m.offsetY-y-p/2;i.value=s.text,n.div.style.font=s.font;const k=1;i.style.position="absolute",i.style.zIndex="100",i.style.font="inherit",i.style.fontSize=a*100+"%",i.style.lineHeight="normal",i.style.width=c+"px",i.style.left=(u-c/2|0)-k+"px",i.style.top=(d+x|0)-k+"px",i.style.textAlign=s.textAlign,i.style.margin="0",i.style.padding=k+"px",i.style.border="0",i.style.outline="none",i.style.whiteSpace="pre-wrap",i.style.overflow="hidden",i.rows=s.lineCount,i.textScale=a,i.className="goTXarea",n.div.appendChild(i),i.focus(),o.selectsTextOnActivate&&(i.select(),i.setSelectionRange(0,9999))},t.hide=(s,n)=>{s.div&&s.div.removeChild(i)}}get textBlock(){return this.yM}set textBlock(t){this.yM=t}get currentTextEditor(){return this.kM}set currentTextEditor(t){this.kM=t}get defaultTextEditor(){return this.Qw}set defaultTextEditor(t){this.Qw=t}get starting(){return this.wM}set starting(t){this.wM=t}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(t===null||t.isReadOnly||TextEditingTool.Pc&&TextEditingTool.Pc!==this&&(TextEditingTool.Pc.acceptText(2),TextEditingTool.Pc&&TextEditingTool.Pc!==this)||!t.lastInput.left||this.isBeyondDragSize())return!1;const i=t.lastInput.documentPoint,e=t.findObjectAt(i);if(e===null||!(e instanceof TextBlock)||!e.editable||!e.part.canEdit())return!1;const s=e.part;return!(s===null||this.starting===2&&!s.isSelected||this.starting===3&&t.lastInput.clickCount<2)}doStart(){TextEditingTool.Pc=this,this.textBlock!==null&&this.doActivate()}doActivate(){if(this.isActive)return;const t=this.diagram;if(t===null)return;let i=this.textBlock;if(i===null&&(i=t.findObjectAt(t.lastInput.documentPoint)),i===null||!(i instanceof TextBlock)||(this.textBlock=i,i.part===null))return;t.animationManager.stopAnimation(),this.isActive=!0,this.Gt=2;let s=this.defaultTextEditor;i.textEditor!==null&&(s=i.textEditor),this.Me=this.textBlock.copy();const n=new Rect(this.textBlock.getDocumentPoint(Spot.TopLeft),this.textBlock.getDocumentPoint(Spot.BottomRight));t.scrollToRect(n),s.show(i,t,this),this.currentTextEditor=s}doCancel(){this.stopTool()}doMouseUp(){this.canStart()&&this.doActivate()}doMouseDown(){this.isActive&&this.acceptText(2)}acceptText(t){switch(t){case 2:this.Gt===6?this.currentTextEditor instanceof HTMLElement&&this.currentTextEditor.focus():(this.Gt===2||this.Gt===5||this.Gt===3)&&(this.Gt=4,this.WC());break;case 1:case 4:case 3:if(t===4&&this.textBlock.isMultiline===!0)return;(this.Gt===2||this.Gt===5||this.Gt===3)&&(this.Gt=4,this.WC());break}}WC(){const t=this.textBlock,i=this.diagram,e=this.currentTextEditor;if(t!==null&&e!==null){const s=t.text;let n="";if(e.valueFunction!==null&&(n=e.valueFunction()),!this.isValidText(t,s,n)){this.Gt=5,this.doError(s,n);return}this.startTransaction(this.name),this.Gt=6,this.transactionResult=this.name,t.text=n,this.doSuccess(s,n),i!==null&&i.v("TextEdited",t,s),this.stopTransaction(),this.stopTool(),i!==null&&i.doFocus()}}doError(t,i){const e=this.textBlock;e.errorFunction!==null&&e.errorFunction(this,t,i);const s=this.currentTextEditor;s&&s.show(e,this.diagram,this)}doSuccess(t,i){const e=this.textBlock;e.textEdited!==null&&e.textEdited(e,t,i)}doDeactivate(){const t=this.diagram;t!==null&&(this.Gt=1,this.currentTextEditor!==null&&this.currentTextEditor.hide(t,this),this.textBlock=null,this.isActive=!1)}doStop(){TextEditingTool.Pc=null}hF(t){if(this.currentTextEditor===null||this.state===1)return;const i=this._w;this.Gt===2&&(this.Gt=3),typeof i.select=="function"&&this.selectsTextOnActivate&&(i.select(),i.setSelectionRange(0,9999))}aF(t){if(this.currentTextEditor===null||this.state===1)return;const i=this._w;typeof i.focus=="function"&&i.focus(),typeof i.select=="function"&&this.selectsTextOnActivate&&(i.select(),i.setSelectionRange(0,9999))}isValidText(t,i,e){const s=this.textValidation;if(s!==null&&!s(t,i,e))return!1;const n=t.textValidation;return!(n!==null&&!n(t,i,e))}get textValidation(){return this.Al}set textValidation(t){t!==null&&Util.i(t,"function",TextEditingTool,"textValidation"),this.Al=t}get minimumEditorScale(){return this.xM}set minimumEditorScale(t){t!==null&&Util.i(t,"number",TextEditingTool,"minimumEditorScale"),this.xM=t}get selectsTextOnActivate(){return this.bM}set selectsTextOnActivate(t){t!==null&&Util.i(t,"boolean",TextEditingTool,"selectsTextOnActivate"),this.bM=t}get state(){return this.Gt}set state(t){this.Gt!==t&&(this.Gt=t)}measureTemporaryTextBlock(t){const i=this.Me;return i.text=t,i.ut(this.textBlock.Tl,1/0),i}static Pc=null}var AnimationStyle=(w=>(w[w.Default=1]="Default",w[w.AnimateLocations=2]="AnimateLocations",w[w.None=3]="None",w))(AnimationStyle||{});class AnimationManager{p;Ni;Ii;kr;Gn;Lo;PM;MM;Tm;wi;Mc;un;Dm;Gh;tx;Fm;ix;Sc;wu;Rm;constructor(t){this.p=Diagram.wm(),this.Ni=!1,this.Tm=!1,this.wi=!1,this.Mc=!1,this.ix=!0,this.Sc=1,this.wu=!1,this.Ii=!0,this.kr=!0,this.Lo=600,this.PM=!1,this.MM=!1,this.Gn=new GSet,this.un=new Animation,this.Dm=new Animation,this.un.ds=this,this.Gh=new GSet,this.tx=new GSet,this.Fm=new GSet,this.Rm=new GSet,t&&Object.assign(this,t)}Ao(t){this.p=t}lE(){return this.p}canStart(t){return!0}Dl(t){return!this.Ii||!this.canStart(t)?!1:(this.Gn.add(t),this.defaultAnimation.isAnimating&&this.stopAnimation(),this.p.Ci(),this.wi=!0,!0)}getBundleAnimation(){return this.Dm}SM(){if(!this.Ii||(this.Dm.ce.count>0&&this.Dm.start(),!this.wi))return;const t=this.un,i=this.p,e=this.Gn.has("Model");if(e&&(this.Mc=!0,this.Sc===1?(t.isViewportUnconstrained=!0,t.ce.clear(),t.add(i,"position",i.position.copy().offset(0,-200),i.position),t.add(i,"opacity",0,1)):this.Sc===3&&t.ce.clear(),this.Sc===2&&i.ex.equals(i.at)?this.ix=!0:this.ix=!1,i.v("InitialAnimationStarting",this)),e&&!this.kr||t.ce.count===0){this.Gn.clear(),this.wi=!1,t.ce.clear(),t.sx(i),this.Mc=!1,i.C();return}this.Gn.clear(),i.Pr=!1;const s=t.ce.get(i);i.autoScale!==1&&s!==null&&(delete s.ni.scale,delete s.gs.scale);const n=this;root.requestAnimationFrame(()=>{n.wi===!1||t.Ni||(i.getRenderingHint("temporaryPixelRatio")&&i.Bw(),i.NM(),n.wi=!1,t.start(),t.Ni&&(n.ku(),i.invalidateDocumentBounds(),t.JC(0),i.pr(!0),n.Pu(),i.v("AnimationStarting",n)))})}CM(){return this.Gn.has("Trigger")&&this.Gn.count===1}$C(t,i,e,s){this.isTicking||this.CM()||t instanceof Link&&(t.fromNode!==null||t.toNode!==null)||this.un.add(t,"position",i,e,s)}nx(t){return this.un.nx(t)}LM(t){return this.un.LM(t)}cF(t){const i=this.Gh,e=this;function s(){if(e.Fm.count>0&&(i.addAll(e.Fm),e.Fm.clear(),e.Ni=!0),e.Ni===!1||i.count===0)return;e.tx.addAll(i);const n=e.tx.iterator;for(;n.next();){const o=n.value;o.Ni!==!1&&(o.fF()?o.ZC(!1):o.Nc=!0)}if(e.tx.clear(),e.Ni===!1){root.requestAnimationFrame(s);return}e.ku(),e.p.pr(),e.Pu(),root.requestAnimationFrame(s)}this.Ni?this.uF(t):(this.Ni=!0,i.add(t),root.requestAnimationFrame(()=>s()))}uF(t){this.Fm.add(t)}dF(){const t=this.Gh.iterator;for(;t.next();)t.value.Nc=!1}ku(){if(this.Tm)return;const t=this.p;this.PM=t.skipsUndoManager,this.MM=t.fe,t.skipsUndoManager=!0,t.fe=!0,this.Tm=!0}Pu(){const t=this.p;t.skipsUndoManager=this.PM,t.fe=this.MM,this.Tm=!1}stopAnimation(t){const i=this.un;if(this.wi===!0&&(this.wi=!1,this.Mc=!1,this.Gn.clear(),i.gF()&&this.p.requestUpdate()),!this.Ni){i.ce.clear(),i.sx(this.p);return}if(i.Mu(!0),i.sx(null),t===!0){const e=this.Gh.toArray();for(let s=0;s<e.length;s++)e[s].Mu(!0)}}Mu(t){this.Gh.delete(t),this.Gh.count===0&&(this.Ni=!1,this.p.requestUpdate()),t===this.defaultAnimation&&this.p.v("AnimationFinished",this)}Cc(t,i){this.wi&&(!this.Gn.has("Expand Tree")&&!this.Gn.has("Expand SubGraph")||(this.un.Cc(t,i),this.QC(t)))}Lc(t,i){this.wi&&(!this.Gn.has("Collapse Tree")&&!this.Gn.has("Collapse SubGraph")||(this.un.Lc(t,i),this.un.AM(i,"position",i.position,i.position),this.QC(t)))}_C(t,i){!this.wi||t.equals(i)||this.CM()||(this.p.Bh||(t=i.copy()),this.un.AM(this.p,"position",t,i))}tL(t,i){this.wi&&(this.CM()||this.un.add(this.p,"scale",t,i))}TM(t,i){t.Se&&(t.Mr=i,this.Rm.add(t))}QC(t){const i=t.findLinksConnected();for(;i.next();){const e=i.value;e.Se&&(e.Mr=e.points.copy(),this.Rm.add(e))}}get isEnabled(){return this.Ii}set isEnabled(t){Util.i(t,"boolean",AnimationManager,"isEnabled"),this.Ii=t,t&&this.Gh.each(i=>{!i.isAnimating&&i.runCount===1/0&&i.start()})}get duration(){return this.Lo}set duration(t){Util.i(t,"number",AnimationManager,"duration"),t<1&&Util._(t,">= 1",AnimationManager,"duration"),this.Lo=t}get isAnimating(){return this.Ni}get isTicking(){return this.Tm}get isInitial(){return this.kr}set isInitial(t){Util.i(t,"boolean",AnimationManager,"isInitial"),this.kr=t}get defaultAnimation(){return this.un}get activeAnimations(){return this.Gh}get initialAnimationStyle(){return this.Sc}set initialAnimationStyle(t){this.Sc=t}static ox=new GMap;static defineAnimationEffect(t,i){AnimationManager.ox.set(t,i)}static DM(t,i,e,s,n){t===null&&(t=[0,0,0,0]),i===null&&(i=[0,0,0,0]);let o=t[0],r=t[1];const l=t[2],h=t[3];let a=i[0],c=i[1];const f=i[2],u=i[3];l===0||l===100?(o=a,r=c):(f===0||f===100)&&(a=o,c=r),Math.abs(a-o)>180&&(a>o?o+=360:a+=360);const d=n(e,o,a-o,s)%360,m=n(e,r,c-r,s),g=n(e,l,f-l,s),p=n(e,h,u-h,s);return"hsla("+d+", "+m+"%, "+g+"%, "+p+")"}static{const t=AnimationManager.ox,i=(e,s,n,o,r,l)=>{e.position=new Point(o(r,s.x,n.x-s.x,l),o(r,s.y,n.y-s.y,l))};t.set("position:diagram",i),t.set("position",i),t.set("position:part",(e,s,n,o,r,l)=>{r<l?e.bc(o(r,s.x,n.x-s.x,l),o(r,s.y,n.y-s.y,l),!1):e.position=new Point(o(r,s.x,n.x-s.x,l),o(r,s.y,n.y-s.y,l))}),t.set("location",(e,s,n,o,r,l)=>{r<l?e.bc(o(r,s.x,n.x-s.x,l),o(r,s.y,n.y-s.y,l),!0):e.location=new Point(o(r,s.x,n.x-s.x,l),o(r,s.y,n.y-s.y,l))}),t.set("position:placeholder",(e,s,n,o,r,l)=>{r<l?e.bc(o(r,s.x,n.x-s.x,l),o(r,s.y,n.y-s.y,l),!1):e.position=new Point(o(r,s.x,n.x-s.x,l),o(r,s.y,n.y-s.y,l))}),t.set("position:nodeCollapse",(e,s,n,o,r,l)=>{const h=e.actualBounds,a=n.actualBounds,c=a.x+a.width/2-h.width/2,f=a.y+a.height/2-h.height/2;r<l?e.bc(o(r,s.x,c-s.x,l),o(r,s.y,f-s.y,l),!1):e.position=new Point(o(r,s.x,c-s.x,l),o(r,s.y,f-s.y,l))}),t.set("desiredSize",(e,s,n,o,r,l)=>{e.desiredSize=new Size(o(r,s.width,n.width-s.width,l),o(r,s.height,n.height-s.height,l))}),t.set("width",(e,s,n,o,r,l)=>{e.width=o(r,s,n-s,l)}),t.set("height",(e,s,n,o,r,l)=>{e.height=o(r,s,n-s,l)}),t.set("fill",(e,s,n,o,r,l)=>{e.fill=AnimationManager.DM(s,n,r,l,o)}),t.set("stroke",(e,s,n,o,r,l)=>{e.stroke=AnimationManager.DM(s,n,r,l,o)}),t.set("strokeWidth",(e,s,n,o,r,l)=>{e.strokeWidth=o(r,s,n-s,l)}),t.set("strokeDashOffset",(e,s,n,o,r,l)=>{e.strokeDashOffset=o(r,s,n-s,l)}),t.set("background",(e,s,n,o,r,l)=>{e.background=AnimationManager.DM(s,n,r,l,o)}),t.set("opacity",(e,s,n,o,r,l)=>{e.opacity=o(r,s,n-s,l)}),t.set("scale",(e,s,n,o,r,l)=>{e.scale=o(r,s,n-s,l)}),t.set("angle",(e,s,n,o,r,l)=>{e.angle=o(r,s,n-s,l)})}static Default=1;static AnimateLocations=2;static None=3}class Animation{rx;vm;Ni;Su;Lo;ms;iL;Ac;ce;lx;ni;jn;Nu;Tc;hx;ax;Nc;FM;cx;ds;p;RM;vM;OM;constructor(t){this.p=null,this.ds=null,this.FM=null,this.cx=null,this.RM=!1,this.Ni=!1,this.Nc=!1,this.ni=0,this.jn=0,this.rx=Animation.EaseInOutQuad,this.vm=Animation.EaseInOutQuad,this.Nu=!1,this.Tc=!1,this.hx=1,this.ax=0,this.Lo=NaN,this.ms=NaN,this.vM=0,this.Su=null,this.iL=Point.Po,this.ce=new GMap,this.lx=new GMap,this.Ac=new GSet,this.OM=1,t&&Object.assign(this,t)}suspend(){this.Nc=!0}advanceTo(t,i){i&&(this.Nc=!1),this.Nu&&t>=this.ms&&(this.Tc=!0,t=t-this.ms),this.vM=t,this.ZC(!0),this.ds.ku(),this.p.pr(),this.ds.Pu(),this.p.redraw()}sx(t){if(this.lx.clear(),this.Tc=!1,this.ax=0,this.ms=NaN,this.Ac.count>0&&this.Ac.clear(),t!==null){const i=t.links;for(;i.next();)i.value.Mr=null}}gF(){return this.ce.count>0}start(){if(this.ce.count===0)return this;if(this.Ni)return this;let t=this.p;const i=this.ce.iterator;for(;i.next();){const s=i.key;t===null&&(s instanceof Diagram?t=s:s instanceof GraphObject&&(t=s.diagram))}if(t!==null)this.p=t,this.ds=t.animationManager;else return this;const e=this.ds;return e.isEnabled===!1?this:(this.ms=isNaN(this.Lo)?e.duration:this.Lo,this.vm=this.rx,e.Mc&&e.Sc===1&&this===e.defaultAnimation&&(this.vm=Animation.EaseOutExpo,this.ms=isNaN(this.Lo)?e.duration===600?900:e.duration:this.Lo),this.OM=t.scrollMode,this.isViewportUnconstrained&&(t.jh=2),e.ku(),this.Ac.each(s=>{s.data=null,t.add(s)}),e.Pu(),this.Ni=!0,this.ni=+new Date,this.jn=this.ni+this.ms,e.cF(this),this)}addTemporaryPart(t,i){return t.Pe()?(this.Ac.add(t),this.p=i,this):this}add(t,i,e,s,n){if(this.p===null&&(t instanceof Diagram?this.p=t:t instanceof GraphObject&&t.diagram!==null&&(this.p=t.diagram)),t instanceof Part){if(!t.isAnimated)return this;i==="position"&&(i="position:part")}return this.AM(t,i,e,s,n),this}AM(t,i,e,s,n){const o=this.ce;let r,l,h;if(t instanceof Diagram&&i==="position"&&(i="position:diagram"),(i==="fill"||i==="stroke"||i==="background")&&(Brush.To(e),Brush.IM(),e=[Brush.Ei.n0,Brush.Ei.n1,Brush.Ei.n2,Brush.Ei.n3],Brush.To(s),Brush.IM(),s=[Brush.Ei.n0,Brush.Ei.n1,Brush.Ei.n2,Brush.Ei.n3]),o.has(t))r=o.get(t),l=r.ni,h=r.gs,l[i]===void 0&&(l[i]=this.Cu(e)),h[i]=this.Cu(s);else{if(i==="position"&&e.equalsApprox(s))return;l={},h={},l[i]=this.Cu(e),h[i]=this.Cu(s),r=new AnimationState(l,h,n),o.set(t,r)}const a=l[i];a instanceof Point&&!a.isReal()&&a.a(this.iL),n&&i.indexOf("position:")===0&&t instanceof Part?r.fx.location=this.Cu(t.location):n&&(r.fx[i]=this.Cu(e))}Cu(t){return t instanceof Point||t instanceof Size?t.copy():t}mF(t){const i=this.ce;if(i.has(t)){const e=i.get(t);e.ux=!0}}nx(t){if(!this.Ni)return!1;const i=this.ce.get(t);return i!==null&&i.ux}LM(t){if(!this.Ni)return!1;const i=this.ce.get(t);return i!==null&&!!(i.ni.position||i.ni["position:part"]||i.ni.location)}fF(){if(this.Ac.count>0)return!0;const t=this.ce.iterator;for(;t.next();){const i=t.key;if(i instanceof GraphObject&&i.diagram!==null||i instanceof Diagram)return!0}return!1}ZC(t){if(this.Nc&&!t)return;const i=this.ds;if(this.Ni===!1)return;const e=+new Date;let s=e>this.jn?this.ms:e-this.ni;t&&(s=this.vM,s<this.ms?(this.ni=+new Date-s,this.jn=this.ni+this.ms):s=this.ms),i.ku(),this.JC(s),this.p.pr(!0),i.Pu(),e>this.jn&&(this.Nu&&!this.Tc?(this.ni=+new Date,this.jn=this.ni+this.ms,this.Tc=!0):this.Mu(!1))}JC(t){const i=this.ms,e=this.ce.iterator,s=this.Tc;for(;e.next();){const n=e.key;if(n instanceof GraphObject&&n.diagram===null)continue;const o=e.value,r=s?o.gs:o.ni,l=s?o.ni:o.gs,h=AnimationManager.ox;for(const a in l)a==="position"&&(l["position:placeholder"]||l["position:nodeCollapse"])||h.get(a)!==null&&h.get(a)(n,r[a],l[a],this.vm,t,i,this)}}stop(){return this.Ni?(this.Mu(!0),this):this}Mu(t){if(this.cx!==null&&this.cx.pF(this.FM),!this.Ni)return;const i=this.p,e=this.ds;e.Mc=!1,this.Ni=!1,this.Nc=!1,e.ku();const s=this.ce,n=this.Ac.iterator;for(;n.next();)i.remove(n.value);const o=this.Nu,r=s.iterator,l=AnimationManager.ox;for(;r.next();){const a=r.key,c=r.value,f=o?c.gs:c.ni,u=o?c.ni:c.gs,d=c.fx;for(const m in u)if(l.get(m)!==null){let g=m;c.gx&&(g==="position:nodeCollapse"||g==="position:placeholder")&&(g="position"),l.get(g)(a,f[m],d[m]!==void 0?d[m]:c.gx?f[m]:u[m],this.vm,this.ms,this.ms,this)}c.gx&&d.location!==void 0&&a instanceof Part&&(a.location=d.location),c.ux&&a instanceof Part&&a.Bi(!1)}this.ax++;const h=!t&&this.hx>this.ax;if(!h&&(this===e.Dm||this===e.defaultAnimation)&&this.ce.clear(),i.mx.clear(),i.yP(!1),i.invalidateDocumentBounds(),i.C(),i.pr(!0),e.defaultAnimation===this){const a=e.Rm.iterator;for(;a.next();)a.value.yF();e.Rm.clear()}if(i.pr(!0),this.isViewportUnconstrained&&(i.scrollMode=this.OM),e.Pu(),h){this.Tc=!1,this.start();return}this.sx(null),i.eL(),e.Mu(this),this.Su&&this.Su(this),i.requestUpdate()}Cc(t,i){const e=i.actualBounds;let s=null;if(i instanceof Group&&(s=i.placeholder),s!==null&&s.visible){const n=s.getDocumentPoint(Spot.TopLeft),o=s.padding;n.x+=o.left,n.y+=o.top,this.add(t,"position",n,t.position,!1)}else this.add(t,"position",new Point(e.x+e.width/2,e.y+e.height/2),t.position,!1);this.add(t,"scale",.01,t.scale,!1),t instanceof Group&&this.wF(t,i)}wF(t,i){const e=t.memberParts;for(;e.next();){const s=e.value;s instanceof Node&&this.Cc(s,i)}}Lc(t,i){if(!t.isVisible())return;let e=null;if(i instanceof Group&&(e=i.placeholder),e!==null&&e.visible){const s=e.getDocumentPoint(Spot.TopLeft),n=e.padding;s.x+=n.left,s.y+=n.top,this.add(t,"position:placeholder",t.position,s,!0)}else this.add(t,"position:nodeCollapse",t.position,i,!0);this.add(t,"scale",t.scale,.01,!0),this.mF(t),t instanceof Group&&this.xF(t,i)}xF(t,i){const e=t.memberParts;for(;e.next();){const s=e.value;s instanceof Node&&this.Lc(s,i)}}get duration(){return this.Lo}set duration(t){Util.i(t,"number",Animation,"duration"),t<1&&Util._(t,">= 1",Animation,"duration"),this.Lo=t}get reversible(){return this.Nu}set reversible(t){this.Nu=t}get runCount(){return this.hx}set runCount(t){t>0?this.hx=t:Util.o("Animation.runCount value must be a positive integer.")}get finished(){return this.Su}set finished(t){this.Su!==t&&(t!==null&&Util.i(t,"function",Animation,"finished"),this.Su=t)}get easing(){return this.rx}set easing(t){this.rx=t}get isViewportUnconstrained(){return this.RM}set isViewportUnconstrained(t){this.RM=t}get isAnimating(){return this.Ni}getTemporaryState(t){let i=this.lx.get(t);return i===null&&(i={},this.lx.set(t,i)),i}static EaseLinear=(t,i,e,s)=>e*t/s+i;static EaseInOutQuad=(t,i,e,s)=>(t/=s/2,t<1?e/2*t*t+i:-e/2*(--t*(t-2)-1)+i);static EaseInQuad=(t,i,e,s)=>e*(t/=s)*t+i;static EaseOutQuad=(t,i,e,s)=>-e*(t/=s)*(t-2)+i;static EaseInExpo=(t,i,e,s)=>t===0?i:e*Math.pow(2,10*(t/s-1))+i;static EaseOutExpo=(t,i,e,s)=>t===s?i+e:e*(-Math.pow(2,-10*t/s)+1)+i}class AnimationState{ni;gs;fx;gx;ux;constructor(t,i,e){this.ni=t,this.gs=i,this.fx={},this.gx=e,this.ux=!1}}var TriggerStart=(w=>(w[w.Default=1]="Default",w[w.Immediate=2]="Immediate",w[w.Bundled=3]="Bundled",w))(TriggerStart||{});class AnimationTrigger{ke;an;Lu;Dc;constructor(t,i,e){this.ke=null,this.an=t,this.Lu=e||1,this.Dc=null,i!==void 0&&(this.Dc=i,e===void 0&&(this.Lu=2))}copy(){const t=new AnimationTrigger(this.an);t.Lu=this.Lu;const i=this.Dc;if(i!==null){const e={};i.duration!==void 0&&(e.duration=i.duration),i.finished!==void 0&&(e.finished=i.finished),i.easing!==void 0&&(e.easing=i.easing),t.Dc=e}return t}get propertyName(){return this.an}set propertyName(t){this.an=t}get animationSettings(){return this.Dc}set animationSettings(t){this.Dc=t}bF(t){const i=this.Dc;i!==null&&(i.duration&&(t.duration=i.duration),i.finished&&(t.finished=i.finished),i.easing&&(t.easing=i.easing))}get startCondition(){return this.Lu}set startCondition(t){this.Lu=t}static Default=1;static Immediate=2;static Bundled=3}class Layer{p;St;Jt;Sr;Fl;Rl;vl;Ol;Il;El;Bl;Ul;Vl;zl;Xl;Kl;kc;Yl;px;Om;Au;At;constructor(t){GSet.ji(this),this.p=null,this.At=new List,this.St="",this.Jt=1,this.Sr=!1,this.Fl=!0,this.Rl=!0,this.vl=!0,this.Ol=!0,this.Il=!0,this.El=!0,this.Bl=!0,this.Ul=!0,this.Vl=!0,this.zl=!0,this.Xl=!0,this.Kl=!0,this.kc=!0,this.Yl=!0,this.px=!0,this.Om=!1,this.Au=[],t&&Object.assign(this,t)}kF(){const t=this.At;for(let i=0;i<t.length;i++)t.r[i].EM(null);t.clear(),this.Au.length=0}Ao(t){this.p=t}toString(t){t===void 0&&(t=0);const i='Layer "'+this.name+'"';if(t<=0)return i;let e=0,s=0,n=0,o=0,r=0;const l=this.At.iterator;for(;l.next();){const a=l.value;a instanceof Group?n++:a instanceof Node?s++:a instanceof Link?o++:a instanceof Adornment?r++:e++}let h="";if(e>0&&(h+=e+" Parts "),s>0&&(h+=s+" Nodes "),n>0&&(h+=n+" Groups "),o>0&&(h+=o+" Links "),r>0&&(h+=r+" Adornments "),t>1){const a=this.At.iterator;for(;a.next();){const c=a.value;h+=`
    `+c.toString();const f=c.data;f!==null&&GSet.as(f)&&(h+=" #"+GSet.as(f)),c instanceof Node?h+=" "+Util.toString(f):c instanceof Link&&(h+=" "+Util.toString(c.fromNode)+" "+Util.toString(c.toNode))}}return i+" "+this.At.count+": "+h}findObjectAt(t,i,e){if(i===void 0&&(i=null),e===void 0&&(e=null),this.Yl===!1)return null;let s=!1;this.diagram!==null&&this.diagram.viewportBounds.containsPoint(t)&&(s=!0);const n=Point.l(),o=this.At.r,r=o.length;for(let l=r;l--;){const h=o[l];if(s===!0&&h.Sl()===!1||!h.isVisible())continue;n.a(t),n.Ie(h.Es);let a=h.sL(n,i,e);if(a!==null&&(i!==null&&(a=i(a)),a!==null&&(e===null||e(a))))return Point.s(n),a}return Point.s(n),null}findObjectsAt(t,i,e,s){if(i===void 0&&(i=null),e===void 0&&(e=null),!(s instanceof List)&&!(s instanceof GSet)&&(s=new GSet),this.Yl===!1)return s;let n=!1;this.diagram!==null&&this.diagram.viewportBounds.containsPoint(t)&&(n=!0);const o=Point.l(),r=this.At.r,l=r.length;for(let h=l;h--;){const a=r[h];if(n===!0&&a.Sl()===!1||!a.isVisible())continue;o.a(t),o.Ie(a.Es);let c=a;a.nL(o,i,e,s)&&(i!==null&&(c=i(c)),c!==null&&(e===null||e(c))&&s.add(c))}return Point.s(o),s}findObjectsIn(t,i,e,s,n){if(i===void 0&&(i=null),e===void 0&&(e=null),s===void 0&&(s=!1),!(n instanceof List)&&!(n instanceof GSet)&&(n=new GSet),this.Yl===!1)return n;let o=!1;this.diagram!==null&&this.diagram.viewportBounds.containsRect(t)&&(o=!0);const r=this.At.r,l=r.length;for(let h=l;h--;){const a=r[h];if(o===!0&&a.Sl()===!1||!a.isVisible())continue;let c=a;a.Im(t,i,e,s,n)&&(i!==null&&(c=i(c)),c!==null&&(e===null||e(c))&&n.add(c))}return n}NP(t,i,e,s,n,o,r){if(this.Yl===!1)return n;const l=this.At.r,h=l.length;for(let a=h;a--;){const c=l[a];if(r===!0&&c.Sl()===!1||!o(c)||!c.isVisible())continue;let f=c;c.Im(t,i,e,s,n)&&(i!==null&&(f=i(f)),f!==null&&(e===null||e(f))&&n.add(f))}return n}findObjectsNear(t,i,e,s,n,o){if(e===void 0&&(e=null),s===void 0&&(s=null),n===void 0&&(n=!0),n!==!1&&n!==!0&&((n instanceof List||n instanceof GSet)&&(o=n),n=!0),!(o instanceof List)&&!(o instanceof GSet)&&(o=new GSet),this.Yl===!1)return o;let r=!1;this.diagram!==null&&this.diagram.viewportBounds.containsPoint(t)&&(r=!0);const l=Point.l(),h=Point.l(),a=this.At.r,c=a.length;for(let f=c;f--;){const u=a[f];if(r===!0&&u.Sl()===!1||!u.isVisible())continue;l.a(t),l.Ie(u.Es),h.e(t.x+i,t.y),h.Ie(u.Es);let d=u;u.oL(l,h,e,s,n,o)&&(e!==null&&(d=e(d)),d!==null&&(s===null||s(d))&&o.add(d))}return Point.s(l),Point.s(h),o}BM(){return this.At.r}Bs(t,i){if(!this.visible)return;const e=this.At.r,s=e.length;if(s===0)return;const n=Util.nt(),o=Util.nt();for(let r=0;r<s;r++){const l=e[r];if(l.UM=r,l instanceof Link){if(l.Se===!1)continue}else if(l instanceof Adornment&&l.adornedPart!==null)continue;const h=l.actualBounds;l.isVisible()&&h.intersectsRectPlus(i,10)?(l.Bs(!0),n.push(l)):(l.Bs(!1),l.adornments!==null&&l.adornments.count>0&&o.push(l))}for(let r=0;r<n.length;r++){const l=n[r];l.VM();const h=l.adornments;for(;h.next();){const a=h.value;a.ut(1/0,1/0),a.Xt(),a.Bs(!0)}}for(let r=0;r<o.length;r++)o[r].VM();Util.tt(n),Util.tt(o)}Tu(t){let i=1;return this.Jt!==1&&(i=t.globalAlpha,t.globalAlpha=i*this.Jt),i}rL(t,i){for(let e=0;e<i;e++)t[e].Du()}Ui(t,i,e){if(!this.visible||this.Jt===0||(e===void 0&&(e=!0),!e&&this.isTemporary))return;const s=this.At.r,n=s.length;if(n===0)return;t.Sr&&this.rL(s,n);const o=this.Tu(t),r=this.Au;r.length=0;const l=i.scale,h=Rect.l();for(let a=0;a<n;a++){const c=s[a];this.Em(t,c,i,r,l,h,!0)}Rect.s(h),t.Sr&&this.rL(s,n),t.globalAlpha=o}hE(t,i,e){if(!this.visible||this.Jt===0)return;const s=this.At.r,n=s.length;if(n===0)return;const o=this.Tu(t),r=this.Au;r.length=0;const l=i.scale,h=Rect.l();for(let a=0;a<n;a++){const c=s[a];e.has(c)||this.Em(t,c,i,r,l,h,!0)}Rect.s(h),t.globalAlpha=o}PF(t,i,e,s){if(!this.visible||this.Jt===0||!s&&this.isTemporary)return;const n=this.At.r,o=n.length;if(o===0)return;const r=this.Tu(t),l=this.Au;l.length=0;const h=i.scale,a=Rect.l();for(let c=0;c<o;c++){const f=n[c];e.has(f)&&this.Em(t,f,i,l,h,a,!1)}Rect.s(a),t.globalAlpha=r}MF(t,i,e,s,n){if(!this.visible||this.opacity===0)return;const o=this.diagram.grid.part;if(!s&&this.isTemporary){if(n&&o.layer===this){const r=this.Tu(t);o.Ui(t,e),t.globalAlpha=r}}else{const r=this.Tu(t),l=e.scale,h=Rect.l(),a=this.At.r,c=a.length;for(let f=0;f<c;f++){const u=a[f];!n&&u===o||this.Em(t,u,e,null,l,h,!1)}Rect.s(h),t.globalAlpha=r}}aE(t,i,e){if(!this.visible||this.Jt===0)return;const s=this.Tu(t),n=this.Au;n.length=0;const o=i.scale,r=Rect.l(),l=this.At.r,h=l.length,a=e.length;for(let c=0;c<h;c++){const f=l[c],u=f.Hh(f.actualBounds);this.SF(u,e,a,o)&&this.Em(t,f,i,n,o,r,!0)}Rect.s(r),t.globalAlpha=s}Em(t,i,e,s,n,o,r){if(r&&!i.Sl()){t.removePartFromView(i);return}if(s!==null&&i instanceof Link&&(i.isOrthogonal&&s.push(i),i.Se===!1)){t.removePartFromView(i);return}let l=!1,h=i.containingGroup;for(;h!==null;)l?h.oi!==null&&o.intersectRect(h.oi):h.oi!==null&&(l=!0,o.a(h.oi)),h=h.containingGroup;const a=i.actualBounds;let c=!1;if(l&&i.isVisible()){if(!o.intersectsRect(a)){t.removePartFromView(i);return}c=!o.containsRect(a)}c&&(t.save(),t instanceof SVGContext?t.partClipRect=o.copy():(t.beginPath(),t.rect(o.x,o.y,o.width,o.height),t.clip())),a.width*n>e.Bm||a.height*n>e.Bm?i.Ui(t,e):this.NF(t,i,e),c&&(t.restore(),t.clearContextCache(!0))}NF(t,i,e){if(t instanceof SVGContext){i.Ui(t,e);return}const s=i.actualBounds,n=i.naturalBounds;if(s.width===0||s.height===0||isNaN(s.x)||isNaN(s.y)||!i.isVisible())return;const o=i.D;if(i.background===null){i.dn(t,"rgba(0,0,0,0.3)",!0,!1,n,s),t.fillRect(s.x,s.y,s.width,s.height);return}if(t.transform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),i.dn(t,i.background,!0,!1,n,s),t.fillRect(0,0,n.width/2,n.height/2),!o.Ok()){const r=1/(o.m11*o.m22-o.m12*o.m21);t.transform(o.m22*r,-o.m12*r,-o.m21*r,o.m11*r,r*(o.m21*o.dy-o.m22*o.dx),r*(o.m12*o.dx-o.m11*o.dy))}}SF(t,i,e,s){const n=2/s,o=4/s;for(let r=0;r<e;r++){const l=i[r];if(!(l.width===0||l.height===0)&&t.intersects(l.x-n,l.y-n,l.width+o,l.height+o))return!0}return!1}t(t,i,e,s,n){const o=this.diagram;o!==null&&o.raiseChangedEvent(2,t,this,i,e,s,n)}qh(t,i,e){const s=this.At;if(i.EM(this),t>=s.count)t=s.count;else if(s.elt(t)===i)return-1;s.insertAt(t,i),i.Um(e);const n=this.diagram;return n!==null&&(e?n.C():n.qh(i)),this.yx(t,i),t}te(t,i,e){if(!e&&i.layer!==this&&i.layer!==null)return i.layer.te(t,i,e);const s=this.At;if(t<0||t>=s.length){if(t=s.indexOf(i),t<0)return-1}else if(s.elt(t)!==i&&(t=s.indexOf(i),t<0))return-1;i.Vm(e),s.removeAt(t);const n=this.diagram;return n!==null&&(e?n.C():n.te(i)),i.EM(null),t}yx(t,i){t=this.CF(t,i),i instanceof Group&&this.LF(t,i),i.svg!==null&&i.svg.remove()}CF(t,i){const e=i.zOrder;if(isNaN(e))return t;const s=this.At,n=s.count;if(n<=1)return t;if(t<0&&(t=s.indexOf(i)),t<0)return-1;let o=t-1,r=NaN;for(;o>=0&&(r=s.elt(o).zOrder,!!isNaN(r));)o--;let l=t+1,h=NaN;for(;l<n&&(h=s.elt(l).zOrder,!!isNaN(h));)l++;if(!isNaN(r)&&r>e)for(;;){if(o===-1||r<=e)return o++,o===t?t:(s.removeAt(t),s.insertAt(o,i),o);for(r=NaN;--o>=0&&(r=s.elt(o).zOrder,!!isNaN(r)););}else if(!isNaN(h)&&h<e)for(;;){if(l===n||h>=e)return l--,l===t?t:(s.removeAt(t),s.insertAt(l,i),l);for(h=NaN;++l<n&&(h=s.elt(l).zOrder,!!isNaN(h)););}return t}LF(t,i){if(i===null||!isNaN(i.zOrder))return;this.AF(t,i);const e=i.containingGroup;e!==null&&this.yx(-1,e)}AF(t,i){if(i.memberParts.count===0)return;let e=-1;const s=this.At.r,n=s.length;for(let o=0;o<n;o++){const r=s[o];if(r===i&&(t=o,e>=0)||e<0&&r.containingGroup===i&&(e=o,t>=0))break}if(!(e<0)&&e<t){const o=this.At;o.removeAt(t),o.insertAt(e,i)}}get parts(){return this.At.iterator}get partsBackwards(){return this.At.iteratorBackwards}get diagram(){return this.p}get name(){return this.St}set name(t){Util.i(t,"string",Layer,"name");const i=this.St;if(i!==t){const e=this.diagram;if(e!==null){i===""&&Util.o("Cannot rename default Layer to: "+t);const n=e.layers;for(;n.next();)n.value.name===t&&Util.o("Layer.name is already present in this diagram: "+t)}this.St=t,this.t("name",i,t);const s=this.At.iterator;for(;s.next();){const n=s.value;n.layerName=this.St}}}get opacity(){return this.Jt}set opacity(t){const i=this.Jt;if(i!==t){Util.i(t,"number",Layer,"opacity"),(t<0||t>1)&&Util._(t,"0 <= value <= 1",Layer,"opacity"),this.Jt=t;const e=this.diagram;e!==null&&e.C(),this.t("opacity",i,t)}}get isViewportAligned(){return this.Om}set isViewportAligned(t){const i=this.Om;i!==t&&(this.Om=t,this.diagram&&(this.lL(),this.diagram.C()),this.t("isViewportAligned",i,t),t&&(this.isInDocumentBounds=!1))}lL(){if(!this.Om)return;const t=this.diagram,i=this.At.r,e=i.length,s=t.kt,n=t.Pt;for(let o=0;o<e;o++){const r=i[o],l=r.naturalBounds.width,h=r.naturalBounds.height;let a=r.alignment;(a.isDefault()||!a.isSpot())&&(a=Spot.BottomRight);let c=r.alignmentFocus;c.isDefault()&&(c=new Spot(a.x,a.y));const f=a.x*s+a.offsetX-(c.x*l+c.offsetX),u=a.y*n+a.offsetY-(c.y*h+c.offsetY),d=Point.X(f,u);t.TF(d),r.bc(d.x,d.y,!0),Point.s(d),r.et=1/t.scale}}get isTemporary(){return this.Sr}set isTemporary(t){const i=this.Sr;i!==t&&(Util.i(t,"boolean",Layer,"isTemporary"),this.Sr=t,this.t("isTemporary",i,t))}get visible(){return this.kc}set visible(t){const i=this.kc;if(i!==t){Util.i(t,"boolean",Layer,"visible"),this.kc=t;const e=this.At.iterator;for(;e.next();)e.value.Bi(t);const s=this.diagram;s!==null&&s.C(),this.t("visible",i,t)}}get pickable(){return this.Yl}set pickable(t){const i=this.Yl;i!==t&&(Util.i(t,"boolean",Layer,"pickable"),this.Yl=t,this.t("pickable",i,t))}get isInDocumentBounds(){return this.px}set isInDocumentBounds(t){const i=this.px;i!==t&&(this.px=t,this.diagram!==null&&this.diagram.invalidateDocumentBounds(),this.t("isInDocumentBounds",i,t))}get allowCopy(){return this.Fl}set allowCopy(t){const i=this.Fl;i!==t&&(Util.i(t,"boolean",Layer,"allowCopy"),this.Fl=t,this.t("allowCopy",i,t))}get allowDelete(){return this.Rl}set allowDelete(t){const i=this.Rl;i!==t&&(Util.i(t,"boolean",Layer,"allowDelete"),this.Rl=t,this.t("allowDelete",i,t))}get allowTextEdit(){return this.vl}set allowTextEdit(t){const i=this.vl;i!==t&&(Util.i(t,"boolean",Layer,"allowTextEdit"),this.vl=t,this.t("allowTextEdit",i,t))}get allowGroup(){return this.Ol}set allowGroup(t){const i=this.Ol;i!==t&&(Util.i(t,"boolean",Layer,"allowGroup"),this.Ol=t,this.t("allowGroup",i,t))}get allowUngroup(){return this.Il}set allowUngroup(t){const i=this.Il;i!==t&&(Util.i(t,"boolean",Layer,"allowUngroup"),this.Il=t,this.t("allowUngroup",i,t))}get allowLink(){return this.El}set allowLink(t){const i=this.El;i!==t&&(Util.i(t,"boolean",Layer,"allowLink"),this.El=t,this.t("allowLink",i,t))}get allowRelink(){return this.Bl}set allowRelink(t){const i=this.Bl;i!==t&&(Util.i(t,"boolean",Layer,"allowRelink"),this.Bl=t,this.t("allowRelink",i,t))}get allowMove(){return this.Ul}set allowMove(t){const i=this.Ul;i!==t&&(Util.i(t,"boolean",Layer,"allowMove"),this.Ul=t,this.t("allowMove",i,t))}get allowReshape(){return this.Vl}set allowReshape(t){const i=this.Vl;i!==t&&(Util.i(t,"boolean",Layer,"allowReshape"),this.Vl=t,this.t("allowReshape",i,t))}get allowResize(){return this.zl}set allowResize(t){const i=this.zl;i!==t&&(Util.i(t,"boolean",Layer,"allowResize"),this.zl=t,this.t("allowResize",i,t))}get allowRotate(){return this.Xl}set allowRotate(t){const i=this.Xl;i!==t&&(Util.i(t,"boolean",Layer,"allowRotate"),this.Xl=t,this.t("allowRotate",i,t))}get allowSelect(){return this.Kl}set allowSelect(t){const i=this.Kl;i!==t&&(Util.i(t,"boolean",Layer,"allowSelect"),this.Kl=t,this.t("allowSelect",i,t))}}var AutoScale=(w=>(w[w.None=1]="None",w[w.Uniform=2]="Uniform",w[w.UniformToFill=3]="UniformToFill",w))(AutoScale||{}),CycleMode=(w=>(w[w.All=1]="All",w[w.NotDirected=2]="NotDirected",w[w.NotDirectedFast=3]="NotDirectedFast",w[w.NotUndirected=4]="NotUndirected",w[w.DestinationTree=5]="DestinationTree",w[w.SourceTree=6]="SourceTree",w))(CycleMode||{}),ScrollMode=(w=>(w[w.Document=1]="Document",w[w.Infinite=2]="Infinite",w))(ScrollMode||{}),CollapsePolicy=(w=>(w[w.TreeParent=1]="TreeParent",w[w.AllParents=2]="AllParents",w[w.AnyParents=3]="AnyParents",w))(CollapsePolicy||{});class Diagram{ds;di;zM;wx;Nr;Fu;xx;bx;kx;Px;Mx;Sx;Fc;jh;Nx;Cx;Lx;Gl;Rc;Cr;zm;Ax;Tx;Ru;Hn;Lr;Wh;Do;Xm;vc;Km;Oc;vu;Ar;qn;XM;KM;Dx;Fx;YM;Rx;GM;jM;HM;vx;Ym;Tr;Dr;Fr;Rr;vr;Or;Ox;Ir;Ix;Er;Br;Ur;Vr;Ex;qM;Fo;WM;Bx;Ux;JM;Mi;$M;ZM;QM;vs;Ro;Ii;Vx;Fl;Rl;zx;Xx;vl;Ol;Il;Kx;El;Bl;Ul;Vl;zl;Xl;Kl;Yx;Gx;_M;Ou;Iu;jx;Hx;qx;Wx;Gm;Jx;$x;Zx;Zt;tS;Qx;iS;Eu;gn;Wn;ie;Jn;hL;jl;eS;sS;jm;_x;Bu;Hm;tb;zr;Hl;Jh;nS;oS;qm;ib;eb;is;Uu;Wm;Vu;ql;Ic;Jm;Xr;$h;rS;$m;qt;D;Ue;Pr;Vi;ps;lS;Wl;Kr;xl;Yr;Zh;Ec;hS;zu;Qh;Xu;jt;Jl;at;et;Ku;kt;Pt;dt;Bc;Ew;sb;_h;Uc;nb;ob;rb;DF;FF;zi;kl;Bm;Zm;aS;cS;aL;Qm;RF;vF;OF;lb;IF;EF;BF;ta;cL;$l;ia;ea;sa;na;yu;Yh;Qt;Tt;Vc;Wk;Jk;fc;Jt;static hb=null;static fL=new GMap;static fS;static uS=null;pu;ab;cb;fb;ub;db;_m;dS;t0;i0;e0;ex;gS;gb;zc;constructor(t,i){if(Diagram.uw||(Diagram.Ik(),Diagram.uw=!0),GSet.ji(this),Diagram.uL(this),this.qt=!0,this.Tt=null,this.kt=0,this.Pt=0,this.dt=null,Diagram.isUsingDOM()){const s=this,n=()=>{s.Si(root.document,"DOMContentLoaded",n,!1),s.setRTL()};root.document.body!==null?this.setRTL():s.zt(root.document,"DOMContentLoaded",n,!1)}this.Bc=null,Diagram.mS("Model",PartManager);const e=this;return this.$M=s=>e.partManager.doModelDataChanged(s),this.ZM=s=>e.partManager.doModelChanged(s),this.nb=null,this.ob=null,this.dL(),this.model=Model.initDiagramModel(),this.gb=null,this.themeManager=new ThemeManager,this.Fo=!0,this.gL(),this.layout=new Layout,this.Fo=!1,this.RF=null,this.vF=null,this.OF=null,this.lb=null,this.IF=null,this.EF=null,this.BF=null,this.ta=null,this.cL=null,this.$l=null,this.ia=null,this.ea=null,this.sa=null,this.na=null,this.yu=()=>{},this.Yh=null,this.Vu=!1,this.Vc=new DiagramHelper(this),t!==void 0&&(typeof t=="string"||root.Element&&t instanceof Element?this.pS(t):i=t),i&&this.setProperties(i),this.qt=!1,this.requestUpdate(),this}WD(){return this.dt!==null}get renderer(){return this.Ic}set renderer(t){if(this instanceof Overview)return;t===""&&(t="default");const i=t.toLowerCase(),e=this.Ic;if(i===e)return;this.Ic=i;let s=null;i==="default"||i==="canvas"?(s=this.ql.get("svg"),s!==null&&s.Ft.remove(),this.dt&&(this.Qt=this.dt.ai),this.Qt.clearContextCache(!0)):i==="svg"?(this.ql.has("svg")?s=this.ql.get("svg"):(s=new SVGSurface(this,root.document),this.addRenderer("svg",s)),this.div!==null&&this.div.appendChild(s.Ft),this.Qt=s.ai,this.dt&&(this.dt.ai.setTransform(this.zi,0,0,this.zi,0,0),this.dt.ai.clearRect(0,0,this.kt,this.Pt))):i==="debug"&&(this.ql.has("SVG")||(s=new SVGSurface(this,root.document),this.addRenderer("SVG",s),s.Ft.style.backgroundColor="whitesmoke",this.div!==null&&this.div.after(s.Ft))),this.qt||this.redraw()}dL(){this.zc=new List,this.setupRouters(),this.ds=new AnimationManager,this.ds.Ao(this),this.di=17,this.zM=!1,this.Ku=!1,this.wx="default",this.jt=new List,this.ql=new GMap,this.Ic="default",this.resetRenderingHints(),this.UF(),this.Jt=1,this.at=new Point(NaN,NaN).g(),this.ex=new Point(NaN,NaN),this.et=1,this.$m=1,this.xx=new Point(NaN,NaN).g(),this.bx=NaN,this.kx=1e-4,this.Px=100,this.D=new Transform,this.Mx=new Point(NaN,NaN).g(),this.Sx=new Rect(NaN,NaN,NaN,NaN).g(),this.Fc=new Margin(0,0,0,0).g(),this.jh=1,this.Nx=!1,this.Cx=null,this.Lx=null,this.Gl=1,this.Rc=Spot.Default,this.Cr=1,this.zm=Spot.Default,this.Ax=Spot.None,this.Tx=Spot.None,this.Ue=!0,this.Ru=!1,this.Hn=new Set,this.Lr=new GSet,this.Wh=new GSet,this.Do=!1,this.Jl=new GMap,this.zu=!0,this.Xm=250,this.vc=-1,this.Km=new Margin(16,16,16,16).g(),this.Pr=!1,this.Oc=!1,this.vu=!0,this.Jm=new InputEvent,this.Jm.diagram=this,this.Xr=new InputEvent,this.Xr.diagram=this,this.$h=new InputEvent,this.$h.diagram=this,this.Ar=null,this.qn=null,this.Ew=!1,this.VF(),this.Yr=new GSet,this.Dx=!0,this.Fx=1,this.YM=!1,this.Rx=1,this.vx="auto",this.Ym="auto",this.Tr=null,this.Dr=null,this.Fr=null,this.Rr=null,this.vr=null,this.Or=null,this.Ox=null,this.Ir=null,this.Ix=!1,this.Er=null,this.Br=null,this.Ur=null,this.Vr=null,this.Ex=!1,this.sb={},this._h=[null,null],this.Fo=!1,this.WM=!1,this.Bx=!1,this.Ux=!1,this.JM=!0,this.ps=!1,this.Qh=!1,this.QM=!0,this.vs=-2,this.Wl=new GMap,this.Xu=new List,this.Ro=!1,this.Ii=!0,this.Vx=!0,this.Fl=!0,this.Rl=!0,this.zx=!1,this.Xx=!0,this.vl=!0,this.Ol=!0,this.Il=!0,this.Kx=!0,this.El=!0,this.Bl=!0,this.Ul=!0,this.Vl=!0,this.zl=!0,this.Xl=!0,this.Kl=!0,this.Yx=!0,this.Gx=!0,this._M=!1,this.Uc=!1,this.Ou=!0,this.Iu=!0,this.jx=!0,this.Hx=!0,this.qx=16,this.Wx=16,this.Gm=!1,this.Jx=!1,this.$x=0,this.Zx=0,this.Zt=new Margin(5).g(),this.tS=new GSet().g(),this.Qx=999999999,this.iS=new GSet().g(),this.Zh=!0,this.Eu=!0,this.Ec=!0,this.gn=!1,this.Wn=!1,this.Kr=!0,this.xl=!1,this.Jn=!1,this.hL=new GSet,this.hS=new GSet,this.jl=null,this.eS=new Size(8,8),this.sS=999,this.jm=!1,this.Wk=1,this.Jk=0,this.Vi={scale:1,position:new Point,bounds:new Rect,canvasSize:new Size,newCanvasSize:new Size,isScroll:!1},this.Vi.canvasSize=this.Vi.canvasSize,this.Vi.newCanvasSize=this.Vi.newCanvasSize,this.Vi.isScroll=!1,this._x=new Rect(NaN,NaN,NaN,NaN).g(),this.Bu=new Size(NaN,NaN).g(),this.Hm=new Rect(NaN,NaN,NaN,NaN).g(),this.tb=!1,this.zF(),this.is=null,this.Uu=!1,this.fc=null,this.partManager=new PartManager,this.toolManager=new ToolManager,this.toolManager.initializeStandardTools(),this.defaultTool=this.toolManager,this.currentTool=this.defaultTool,this.cb=null,this.fb=new DraggingOptions,this.ub=null,this.db=null,this.ab=!1,this.pu=!1,this.commandHandler=new CommandHandler,this.i0=null,this.e0=Point.Ak,this.gS=!1,this.zi=1,this.kl=null,this.Bm=1,this._m=0,this.dS=[0,0,0,0,0],this.t0=0,this.Zm=1,this.aS=0,this.cS=new Point,this.aL=500,this.Wm=new Point,this.Qm=!1}static mL=root.document!==void 0;static isUsingDOM(){return Diagram.mL}static useDOM(t){Diagram.mL=t?root.document!==void 0:!1}static Ve=new WeakMap;clear(){this.animationManager.stopAnimation(),this.model.clear(),Diagram.pL(),this.yL(!1),this.Xu.clear(),this.wL(),this.jl=null,this.invalidateDocumentBounds(),this.ensureBounds(),this.C()}yL(t){this.animationManager.stopAnimation(!0),this.tS=new GSet().g(),this.iS=new GSet().g();const i=this.skipsUndoManager,e=this.Mi!==null&&this.Mi!==void 0;e&&(this.skipsUndoManager=!0);let s=null;this.is!==null&&(s=this.is.part,s!==null&&this.remove(s));const n=[],o=this.jt.length;if(t){for(let r=0;r<o;r++){const h=this.jt.r[r].parts;for(;h.next();){const a=h.value;a!==s&&a.data===null&&n.push(a)}}for(let r=0;r<n.length;r++){const l=n[r];this.remove(l)}}for(let r=0;r<o;r++)this.jt.r[r].kF();return this.partManager.clear(),this.Hn.clear(),this.Lr.clear(),this.Wh.clear(),this.Jl.clear(),this.Yr.clear(),this.fc=null,this.Xu.clear(),this.wL(),Util.Ck=[],s!==null&&(this.add(s),this.partManager.parts.delete(s)),e&&(this.skipsUndoManager=i),n}static s0=null;static mb="";static pL(){Diagram.s0=null,Diagram.mb=""}static cE(){return null}reset(){this.clear(),this.qt=!0,this.dL(),this.themeManager=new ThemeManager,this.Zl(),this.Fo=!0,this.gL(),this.layout=new Layout,this.Fo=!1,this.model=Model.initDiagramModel(),this.model.undoManager=new UndoManager,this.Vu=!1,this.qt=!1,this.C()}zF(){this.zr=new GMap,this.nS=new Node().add(new TextBlock({stroke:"black",font:"10pt sans-serif"}).bind("text","",Util.toString).theme("stroke","text").theme("font","normal")),this.zr.set("",this.nS),this.zr.set("Comment",new Node().add(new TextBlock({stroke:"brown",font:"10pt sans-serif"}).bind("text","",Util.toString).theme("stroke","comment").theme("font","normal"))),this.zr.set("LinkLabel",new Node({selectable:!1,avoidable:!1}).add(new Shape("Ellipse",{fill:"black",stroke:null,desiredSize:new Size(3,3).it()}).theme("fill","link"))),this.Jh=new GMap,this.lS=new Group(Panel.Vertical,{selectionObjectName:"GROUPPANEL"}).add(new TextBlock({stroke:"black",font:"bold 12pt sans-serif"}).bind("text","",Util.toString).theme("stroke","text").theme("font","bold"),new Panel(Panel.Auto,{name:"GROUPPPANEL"}).add(new Shape({fill:"rgba(128,128,128,0.2)",stroke:"black",strokeWidth:1}).theme("fill","group").theme("stroke","outline").theme("strokeWidth","group"),new Placeholder({padding:5}).theme("padding","group"))),this.Jh.set("",this.lS),this.Hl=new GMap,this.oS=new Link().add(new Shape({isPanelMain:!0,stroke:"black"}).theme("stroke","link"),new Shape({toArrow:"Standard",fill:"black",stroke:null,strokeWidth:0}).theme("toArrow").theme("fill","link")),this.Hl.set("",this.oS),this.Hl.set("Comment",new Link().add(new Shape({isPanelMain:!0,stroke:"brown"}).theme("stroke","comment"))),this.qm=new Adornment(Panel.Auto).add(new Shape({fill:null,stroke:"dodgerblue",strokeWidth:3}).theme("stroke","selection").theme("strokeWidth","selection"),new Placeholder({margin:1.5}).theme("margin","selection","numbers",null,t=>t?new Margin(t/2):1.5)),this.ib=this.qm,this.eb=new Adornment(Panel.Link).add(new Shape({isPanelMain:!0,fill:null,stroke:"dodgerblue",strokeWidth:3}).theme("stroke","selection").theme("strokeWidth","selection"))}setRTL(t){let i=t===void 0?this.div:t;i===null&&(i=root.document.body);const e=Util.en("div");e.dir="rtl",e.style.cssText="font-size: 14px; width: 1px; height: 1px; position: absolute; top: -1000px; overflow: scroll;",e.textContent="A",i.appendChild(e);let s="reverse";e.scrollLeft>0?s="default":(e.scrollLeft=1,e.scrollLeft===0&&(s="negative")),i.removeChild(e),this.wx=s}setScrollWidth(t){let i=t===void 0?this.div:t;i===null&&(i=root.document.body);let e=0;if(Diagram.isUsingDOM()){let s=Diagram.uS,n=Diagram.fS;s===null&&(Diagram.uS=Util.en("p"),s=Diagram.uS,s.style.width="100%",s.style.height="200px",s.style.boxSizing="content-box",Diagram.fS=Util.en("div"),n=Diagram.fS,n.style.position="absolute",n.style.visibility="hidden",n.style.width="200px",n.style.height="150px",n.style.boxSizing="content-box",n.appendChild(s)),n.style.overflow="hidden",i.appendChild(n);const o=s.offsetWidth;n.style.overflow="scroll";let r=s.offsetWidth;o===r&&(r=n.clientWidth),i.removeChild(n),e=o-r,e===0&&!Util.or&&(e=11)}this.di=e,this.zM=!0}li(t){t in AutoScale?this.autoScale=t:Util.rr(this,t)}toString(t){t===void 0&&(t=0);let i="";this.div&&this.div.id&&(i=this.div.id);let e='Diagram "'+i+'"';if(t<=0)return e;const s=this.jt.iterator;for(;s.next();){const n=s.value;e+=`
  `+n.toString(t-1)}return e}static uL(t){Diagram.hb=t}static wm(){return Diagram.hb}static fromDiv(t){let i=t;if(typeof t=="string"&&(i=root.document.getElementById(t)),i instanceof HTMLDivElement){const e=Diagram.Ve.get(i);if(e)return e}return null}get div(){return this.Tt}set div(t){if(this.Tt!==t){const i=this.Tt;if(i!==null){if(Diagram.Ve.delete(i),i.goDiagram=void 0,i.go=void 0,i.innerHTML="",this.dt!==null){const s=this.dt.Ft;this.Si(s,"pointermove",this.ia,!1),this.Si(s,"pointerdown",this.$l,!1),this.Si(s,"pointerup",this.ea,!1),this.Si(s,"pointerout",this.sa,!1),this.Si(s,"pointercancel",this.na,!1),this.dt.dispose()}this.Bc&&(this.Bc.disconnect(),this.Bc=null);const e=this.toolManager;e!==null&&(e.mouseDownTools.each(s=>s.cancelWaitAfter()),e.mouseMoveTools.each(s=>s.cancelWaitAfter()),e.mouseUpTools.each(s=>s.cancelWaitAfter())),e.cancelWaitAfter(),this.currentTool.doCancel(),this.dt=null,this.Si(root,"resize",this.lb,!1),this.Si(root,"wheel",this.ta,!0),Diagram.wm()===this&&Diagram.uL(null)}else this.$l===null&&(this.Jn=!1);if(this.Tt=null,t!==null){const e=Diagram.Ve.get(t);e&&(e.div=null),this.pS(t),this.yu(),this.themeManager&&this.themeManager.XF()}else this.themeManager&&this.themeManager.KF()}}setupRouters(){this.zc.push(new AvoidsNodesRouter)}pS(t){const i=this;if(!Diagram.isUsingDOM())return;t==null&&Util.o("Diagram setup requires an argument DIV."),i.Tt!==null&&Util.o("Diagram has already completed setup."),typeof t=="string"?i.Tt=root.document.getElementById(t):t instanceof HTMLDivElement?i.Tt=t:Util.o("No DIV or DIV id supplied: "+t),i.Tt===null&&Util.o("Invalid DIV id; could not get element with id: "+t);const e=Diagram.Ve.get(i.Tt);if(e&&e!==this&&Util.o("Invalid div id; div already has a Diagram associated with it."),!i.Bc&&root.ResizeObserver){const c=root.ResizeObserver,f=Util.Nk(()=>i.requestUpdate(),250,!1);i.Bc=new c(()=>f()),i.Bc.observe(i.Tt)}root.getComputedStyle(i.Tt,null).position==="static"&&(i.Tt.style.position="relative");let s=5;const n="rgba(2"+s+"5, 255, 255, 0)";s--,i.Tt.style["-webkit-tap-highlight-color"]=n,i.Tt.innerHTML="",Diagram.Ve.set(i.Tt,i),i.Tt.goDiagram=i,i.Tt.go=root.go;const o=new CanvasSurface(i);o.style!==void 0&&(o.style.position="absolute",o.style.top="0px",o.style.left="0px",root.getComputedStyle(i.Tt,null).getPropertyValue("direction")==="rtl"&&(i.Ku=!0),o.style.zIndex="2",o.style.userSelect="none",o.style.MozUserSelect="none",o.style.touchAction="none",o.style.letterSpacing="normal !important",o.style.wordSpacing="normal !important",o.style.lang="unknown"),i.dt=o,i.Qt=o.ai;const r=i.Qt;i.zi=i.computePixelRatio(),i.viewSize.isReal()||(i.kt=i.Tt.clientWidth||1,i.Pt=i.Tt.clientHeight||1),i.xL(i.kt,i.Pt);const l=i;i.Tt.insertBefore(o.Ft,i.Tt.firstChild);const h=new CanvasSurface(null);if(h.width=1,h.height=1,i.DF=h,i.FF=h.ai,Diagram.isUsingDOM()){const c=Util.en("div"),f=Util.en("div");c.style.position="absolute",c.style.overflow="auto",c.style.width=i.kt+"px",c.style.height=i.Pt+"px",c.style.zIndex="1",f.style.position="absolute",f.style.width="1px",f.style.height="1px",i.Tt.appendChild(c),c.appendChild(f),c.onscroll=Diagram.YF,c.addEventListener("pointerdown",Diagram.GF),c.p=i,c.jF=!0,c.HF=!0,i.nb=c,i.ob=f}i.yu=Util.Nk(()=>{i.kl=null,i.C()},300,!1),i.lb=Util.Nk(()=>{i.NM()},250,!1),i.Yh=c=>(c.preventDefault(),!1),i.ta=c=>{if(!l.isEnabled)return;const f=l.Xc(c,!0);f.bubbles=!0;let u=0,d=0;f.delta=0,c.deltaX!==void 0?(c.deltaX!==0&&(u=c.deltaX>0?1:-1),c.deltaY!==0&&(d=c.deltaY>0?1:-1),f.delta=Math.abs(c.deltaX)>Math.abs(c.deltaY)?-u:-d):c.wheelDeltaX!==void 0?(c.wheelDeltaX!==0&&(u=c.wheelDeltaX>0?-1:1),c.wheelDeltaY!==0&&(d=c.wheelDeltaY>0?-1:1),f.delta=Math.abs(c.wheelDeltaX)>Math.abs(c.wheelDeltaY)?-u:-d):c.wheelDelta!==void 0&&c.wheelDelta!==0&&(f.delta=c.wheelDelta>0?1:-1),l.doMouseWheel(),l.oa(f,c)},i.cL=c=>{if(!l.isEnabled)return;i.Uc=!1,l.Xc(c,!0);const f=l.currentTool;f.cancelWaitAfter(),f.standardMouseOver()},i.$l=c=>{if(!l.isEnabled)return;i.Uc=!0;const f=l.sb;f[c.pointerId]===void 0&&(f[c.pointerId]=c);const u=l._h;let d=!1;if(u[0]!==null&&(u[0].pointerId===c.pointerId||u[0].pointerType!==c.pointerType))u[0]=c;else if(u[1]!==null&&u[1].pointerId===c.pointerId)u[1]=c,d=!0;else if(u[0]===null)u[0]=c;else if(u[1]===null)u[1]=c,d=!0;else{c.preventDefault();return}const m=c.pointerType==="touch"||c.pointerType==="pen";m&&(l.Ew=!1,l.Qm=!0);const g=l.qF(c,c,d),p=l.cS,y=m?25:10;if(c.timeStamp-l.aS<l.aL&&!(Math.abs(p.x-c.screenX)>y||Math.abs(p.y-c.screenY)>y)?l.Zm++:l.Zm=1,g.clickCount=l.Zm,l.aS=c.timeStamp,l.cS.setTo(c.screenX,c.screenY),l.doMouseDown(),c.button===1){c.preventDefault();return}l.oa(g,c)},i.ia=c=>{if(!l.isEnabled)return;i.Uc=!0;const f=l._h;if(f[0]!==null&&(f[0].pointerId===c.pointerId||f[0].pointerType!==c.pointerType))f[0]=c;else if(f[1]!==null&&f[1].pointerId===c.pointerId){f[1]=c;return}else if(f[0]===null)f[0]=c;else return;if(f[0].pointerId!==c.pointerId)return;const u=l.WF(c,c,f[1]!==null);l.doMouseMove(),l.oa(u,c)},i.ea=c=>{if(!l.isEnabled)return;i.Uc=!0;const f=c.pointerType==="touch"||c.pointerType==="pen",u=l.sb;if(f&&l.Ew){delete u[c.pointerId],c.preventDefault();return}const d=l._h;if(d[0]!==null&&(d[0].pointerId===c.pointerId||d[0].pointerType!==c.pointerType))d[0]=null;else if(d[1]!==null&&d[1].pointerId===c.pointerId){d[1]=null;return}else return;const m=l.yS(c,!1,!0,!1,!0,!1);let g=root.document.elementFromPoint(c.clientX,c.clientY)||null;g!==null&&g.shadowRoot!==void 0&&g.shadowRoot!==null&&(g=g.shadowRoot.elementFromPoint(c.clientX,c.clientY)),g!==null&&g.p instanceof Diagram&&g.p!==l&&g.p.o0(c,m),g===null&&(g=c.target),l.o0(c,m),m.clickCount=l.Zm,m.targetDiagram=l.wS(c,g),m.targetObject=null,l.doMouseUp(),l.oa(m,c),f&&(l.Qm=!1)},i.sa=c=>{if(!l.isEnabled)return;i.Uc=!1;const f=l.sb;f[c.pointerId]&&delete f[c.pointerId];const u=l._h;if(u[0]!==null&&u[0].pointerId===c.pointerId&&(u[0]=null),u[1]!==null&&u[1].pointerId===c.pointerId&&(u[1]=null),c.pointerType==="touch"||c.pointerType==="pen")return;const d=l.currentTool;d.cancelWaitAfter(),d.standardMouseOver()},i.na=c=>{const f=l._h;f[0]!==null&&f[0].pointerId===c.pointerId?(f[0]=null,l.Qm=!1):f[1]!==null&&f[1].pointerId===c.pointerId&&(f[1]=null)};const a=r;if(i.rb=a.U[Util.Cs("7eba17a4ca3b1a8346")][Util.Cs("78a118b7")](a.U,Diagram.Yu,s,s),r.clearContextCache(!0),i.JF(),this.Ic==="svg"){const c=this.ql.get("svg");this.Tt.appendChild(c.Ft),this.Qt=c.ai}}addEventListener(t,i,e,s){t.addEventListener(i,e,{capture:s,passive:!1})}zt(t,i,e,s){t.addEventListener(i,e,{capture:s,passive:!1})}removeEventListener(t,i,e,s){t.removeEventListener(i,e,{capture:s})}Si(t,i,e,s){t.removeEventListener(i,e,{capture:s})}JF(){const t=this;let i=this.dt.Ft;i instanceof HTMLCanvasElement||(i=t.div),this.zt(i,"pointerdown",t.$l,!1),this.zt(i,"pointermove",t.ia,!1),this.zt(i,"pointerup",t.ea,!1),this.zt(i,"pointerout",t.sa,!1),this.zt(i,"pointercancel",t.na,!1),this.zt(i,"pointerenter",t.$F,!1),this.zt(i,"pointerleave",t.ZF,!1),this.zt(i,"wheel",t.ta,!1),this.zt(i,"keydown",t.QF,!1),this.zt(i,"keyup",t._F,!1),this.zt(i,"blur",t.tR,!1),this.zt(i,"focus",t.iR,!1),this.zt(i,"selectstart",e=>(e.preventDefault(),!1),!1),this.zt(i,"contextmenu",e=>(e.preventDefault(),!1),!1),this.zt(root,"resize",t.lb,!1)}Bw(){this._m>30&&(this.kl=1)}yP(t){this.kl!==null&&(this.kl=null,t&&this.yu(),this._m=0,this.dS=[0,0,0,0,0],this.t0=0)}computePixelRatio(){return this.kl!==null?this.kl:root.devicePixelRatio||1}get avgSpf(){return this._m}doMouseDown(){this.currentTool.doMouseDown()}doMouseMove(){this.currentTool.doMouseMove()}doMouseUp(){this.currentTool.doMouseUp()}doMouseWheel(){this.currentTool.doMouseWheel()}doKeyDown(){this.currentTool.doKeyDown()}doKeyUp(){this.currentTool.doKeyUp()}doFocus(){this.focus()}focus(){if(this.dt)if(this.scrollsPageOnFocus)this.dt.focus();else{const t=root.scrollX,i=root.scrollY;this.dt.focus(),root.scrollTo(t,i)}}iR(t){const i=Diagram.Ve.get(this);i&&i.v("GainedFocus")}tR(t){const i=Diagram.Ve.get(this);i&&i.v("LostFocus")}NM(){if(this.dt===null)return;const i=this.Tt;if(i===null||i.clientWidth===0||i.clientHeight===0)return;this.zM||this.setScrollWidth();const e=this.Wn?this.di:0,s=this.gn?this.di:0,n=this.zi;if(this.zi=this.computePixelRatio(),this.zi!==n&&(this.Ru=!0,this.requestUpdate()),i.clientWidth!==this.kt+e||i.clientHeight!==this.Pt+s){this.ra(),this.Ue=!0;const o=this.layout;o!==null&&o.isViewportSized&&this.autoScale===1&&(this.Oc=!0,o.invalidateLayout()),this.ps||this.requestUpdate()}}gL(){let t=0,i=new Layer;i.name="Grid",i.allowSelect=!1,i.pickable=!1,i.isTemporary=!0,i.isInDocumentBounds=!1,this.Gr(i,t++),i=new Layer,i.name="ViewportBackground",i.isViewportAligned=!0,i.isTemporary=!0,i.isInDocumentBounds=!1,this.Gr(i,t++),i=new Layer,i.name="Background",this.Gr(i,t++),i=new Layer,i.name="",this.Gr(i,t++),i=new Layer,i.name="Foreground",this.Gr(i,t++),i=new Layer,i.name="ViewportForeground",i.isViewportAligned=!0,i.isTemporary=!0,i.isInDocumentBounds=!1,this.Gr(i,t++),i=new Layer,i.name="Adornment",i.isTemporary=!0,i.isInDocumentBounds=!1,this.Gr(i,t++),i=new Layer,i.name="Tool",i.isTemporary=!0,i.isInDocumentBounds=!0,this.Gr(i,t++)}bL(){const t=new Panel(Panel.Grid,{name:"GRID"}).add(new Shape("LineH",{stroke:"lightgray",strokeWidth:.5,interval:1}).theme("stroke","gridMinor"),new Shape("LineV",{stroke:"lightgray",strokeWidth:.5,interval:1}).theme("stroke","gridMinor"),new Shape("LineH",{stroke:"gray",strokeWidth:.5,interval:5}).theme("stroke","gridMajor"),new Shape("LineV",{stroke:"gray",strokeWidth:.5,interval:5}).theme("stroke","gridMajor"),new Shape("LineH",{stroke:"gray",strokeWidth:1,interval:10}).theme("stroke","gridMajor"),new Shape("LineV",{stroke:"gray",strokeWidth:1,interval:10}).theme("stroke","gridMajor")),i=new Part({layerName:"Grid",zOrder:0,isInDocumentBounds:!1,isAnimated:!1,pickable:!1,locationObjectName:"GRID"}).add(t);return this.add(i),this.partManager.parts.delete(i),t.visible=!1,t}static YF(){const t=Diagram.Ve.get(this.parentElement||this);if(t){if(t.Jx){t.Jx=!1;return}if(!t.isEnabled){t.kL();return}t.diagramScroll(this)}}static GF(t){if(!this.p.isEnabled){this.p.updateScroll();return}this.p.$x=t.target.scrollTop,this.p.Zx=t.target.scrollLeft}diagramScroll(t){if(this.dt===null)return;const i=this.nb,e=this.ob;this.Gm=!0;let s=this.documentBounds,n=this.viewportBounds;const o=this.Fc;let r=s.x-o.left,l=s.y-o.top;const h=s.width+o.left+o.right,a=s.height+o.top+o.bottom;let c=s.right+o.right,f=s.bottom+o.bottom,u=n.x,d=n.y;const m=n.width,g=n.height;let p=n.right,y=n.bottom;const x=this.scale;let k,b=t.scrollLeft;if(this.Ku)switch(this.wx){case"negative":b=b+t.scrollWidth-t.clientWidth;break;case"reverse":b=t.scrollWidth-b-t.clientWidth;break}const P=b;if(m<h||g<a){k=Point.X(this.position.x,this.position.y),this.allowHorizontalScroll&&this.Zx!==P&&(k.x=P/x+r,this.Zx=P),this.allowVerticalScroll&&this.$x!==t.scrollTop&&(k.y=t.scrollTop/x+l,this.$x=t.scrollTop),this.position=k,Point.s(k),this.Gm=!1,this.Eu=!1;return}if(k=Point.l(),t.jF&&this.allowHorizontalScroll&&(r<u&&(this.position=k.e(P+r,this.position.y)),c>p)){const M=i.scrollWidth-this.kt;this.position=k.e(-M+P-this.kt/x+c,this.position.y)}if(t.HF&&this.allowVerticalScroll&&(l<d&&(this.position=k.e(this.position.x,t.scrollTop+l)),f>y)){const M=i.scrollHeight-this.Pt;this.position=k.e(this.position.x,-M+t.scrollTop-this.Pt/x+f)}Point.s(k),this.Ql(),this.Gm=!1,this.Eu=!1,s=this.documentBounds,n=this.viewportBounds,c=s.right,p=n.right,f=s.bottom,y=n.bottom,r=s.x,u=n.x,l=s.y,d=n.y,m>=h&&r>=u&&c<=p&&(e.style.width="1px"),g>=a&&l>=d&&f<=y&&(e.style.height="1px")}computeBounds(t){return t===void 0&&(t=new Rect),this.Ci(),this.PL(t)}PL(t){if(this.fixedBounds.isReal())return t.a(this.fixedBounds),t.addMargin(this.Zt),t;let i=!0;const e=this.jt.r,s=e.length;for(let n=0;n<s;n++){const o=e[n];if(!o.visible||!o.isInDocumentBounds)continue;const r=o.At.r,l=r.length;for(let h=0;h<l;h++){const a=r[h];if(!a.isInDocumentBounds||!a.isVisible())continue;const c=a.actualBounds;c.isReal()&&(i?(i=!1,t.a(c)):t.unionRect(c))}}return i&&t.e(0,0,0,0),t.addMargin(this.Zt),t}computePartsBounds(t,i){i===void 0&&(i=!1);let e=null;if(Array.isArray(t))for(let s=0;s<t.length;s++){const n=t[s];!i&&n instanceof Link||(n.ensureBounds(),e===null?e=n.actualBounds.copy():e.unionRect(n.actualBounds))}else{const s=t.iterator;for(;s.next();){const n=s.value;!i&&n instanceof Link||(n.ensureBounds(),e===null?e=n.actualBounds.copy():e.unionRect(n.actualBounds))}}return e===null?new Rect(NaN,NaN,0,0):e}Us(t){if(!t&&!this.Jn||this.qt||this.dt===null||!this.documentBounds.isReal())return;if(this.qt=!0,t){const f=this.initialPosition;if(f.isReal()){this.qt=!1,this.position=f;return}let u=this.initialDocumentSpot,d=this.initialViewportSpot;u.isNoSpot()&&(u=Spot.TopLeft),d.isNoSpot()&&(d=Spot.TopLeft);const m=Point.l();m.setRectSpot(this.documentBounds,u);const g=this.viewportBounds,p=Rect.X(0,0,g.width,g.height),y=Point.l();y.setRectSpot(p,d),y.e(m.x-y.x,m.y-y.y),this.qt=!1,this.position=y,Rect.s(p),Point.s(y)}let i=this.Gl;t&&this.Cr!==1&&(i=this.Cr);const e=i!==1?this.Gu(i):this.scale,s=this.at.x,n=this.at.y,o=this.kt/e,r=this.Pt/e;let l=this.Rc;const h=this.zm;if(t&&!l.isSpot()&&(h.isSpot()||h.isDefault())){const f=this.initialDocumentSpot.isSpot()&&this.initialViewportSpot.isSpot();l=h.isDefault()&&!f?Spot.Center:h}this.xS(this.documentBounds,o,r,l,t);const a=this.scale;this.scale=e,this.qt=!1;const c=this.viewportBounds;c.equalsApproxTo(s,n,o,r)||this.onViewportBoundsChanged(new Rect(s,n,o,r),c,a,!1)}Gu(t){const i=this.$m;if(this.dt===null)return i;this.ensureBounds();const e=this.documentBounds;if(!e.isReal())return i;const s=e.width,n=e.height,o=this.kt+(this.Wn?this.di:0),r=this.Pt+(this.gn?this.di:0),l=o/s,h=r/n;let a;return t===2?(a=Math.min(h,l),a>i&&(a=i),a<this.minScale&&(a=this.minScale),a>this.maxScale&&(a=this.maxScale),a):t===3?(a=0,h>l?a=(r-this.di)/n:a=(o-this.di)/s,a>i&&(a=i),a<this.minScale&&(a=this.minScale),a>this.maxScale&&(a=this.maxScale),a):this.scale}zoomToFit(){const t=this.jh;this.jh=1,this.scale=this.Gu(2),t!==1&&(this.Us(!1),this.xS(this.documentBounds,this.kt/this.et,this.Pt/this.et,this.Rc,!1)),this.jh=t}zoomToRect(t,i){i===void 0&&(i=2);const e=t.width,s=t.height;if(e===0||s===0||isNaN(e)&&isNaN(s))return;let n=1;if(i===2||i===3)if(isNaN(e))n=this.viewportBounds.height*this.scale/s;else if(isNaN(s))n=this.viewportBounds.width*this.scale/e;else{const o=this.kt,r=this.Pt;i===3?r/s>o/e?n=(r-(this.gn?this.di:0))/s:n=(o-(this.Wn?this.di:0))/e:n=Math.min(r/s,o/e)}this.scale=n,this.position=new Point(t.x,t.y)}get eR(){return this.qt}set eR(t){this.qt=t}alignDocument(t,i){this.ensureBounds();const e=this.documentBounds,s=this.viewportBounds;this.position=new Point(e.x+(t.x*e.width+t.offsetX)-(i.x*s.width-i.offsetX),e.y+(t.y*e.height+t.offsetY)-(i.y*s.height-i.offsetY))}focusObject(t){if(t instanceof GraphObject){this.i0=t;const i=Point.l();this.e0=this.transformDocToView(t.getDocumentPoint(Spot.TopLeft,i)),Point.s(i)}else this.i0=null,this.e0=Point.Ak}xS(t,i,e,s,n){const o=Point.X(this.at.x,this.at.y);let r=o.x,l=o.y;if(this.i0!==null){let h=Point.l();h=this.i0.getDocumentPoint(Spot.TopLeft,h),r=h.x-this.e0.x/this.scale,l=h.y-this.e0.y/this.scale,s=Spot.None,Point.s(h)}if(n||this.scrollMode===1){s.isSpot()&&(i>t.width&&(r=t.x+(s.x*t.width+s.offsetX)-(s.x*i-s.offsetX)),e>t.height&&(l=t.y+(s.y*t.height+s.offsetY)-(s.y*e-s.offsetY)));const h=this.Fc,a=i-t.width;if(i<t.width+h.left+h.right){let f=r+i/2;f=Math.min(f,t.right+Math.max(a,h.right)-i/2),f=Math.max(f,t.left-Math.max(a,h.left)+i/2),r=f-i/2}else r>t.left?r=t.left:r<t.right-i&&(r=t.right-i);const c=e-t.height;if(e<t.height+h.top+h.bottom){let f=l+e/2;f=Math.min(f,t.bottom+Math.max(c,h.bottom)-e/2),f=Math.max(f,t.top-Math.max(c,h.top)+e/2),l=f-e/2}else l>t.top?l=t.top:l<t.bottom-e&&(l=t.bottom-e)}if(o.x=isFinite(r)?r:-this.Zt.left,o.y=isFinite(l)?l:-this.Zt.top,this.positionComputation!==null){const h=this.positionComputation(this,o);o.x=h.x,o.y=h.y}this.ds._C(this.at,o),this.at.e(o.x,o.y),this.pb(),this.Zl(),this.sR(),Point.s(o)}findPartAt(t,i){if(i===void 0&&(i=!0),i){const e=this.PP(t,s=>s.part,s=>s.canSelect());if(e instanceof Part)return e}else{const e=this.PP(t,s=>s.part);if(e instanceof Part)return e}return null}findObjectAt(t,i,e){i===void 0&&(i=null),e===void 0&&(e=null),this.Ci();const s=this.jt.iteratorBackwards;for(;s.next();){const n=s.value;if(!n.visible)continue;const o=n.findObjectAt(t,i,e);if(o!==null)return o}return null}PP(t,i,e){i===void 0&&(i=null),e===void 0&&(e=null),this.Ci();const s=this.jt.iteratorBackwards;for(;s.next();){const n=s.value;if(!n.visible||n.isTemporary)continue;const o=n.findObjectAt(t,i,e);if(o!==null)return o}return null}findPartsAt(t,i,e){return i===void 0&&(i=!0),this.nR(t,s=>s.part,i?s=>s instanceof Part&&s.canSelect():null,e)}nR(t,i,e,s){i===void 0&&(i=null),e===void 0&&(e=null),!(s instanceof List)&&!(s instanceof GSet)&&(s=new GSet),this.Ci();const n=this.jt.iteratorBackwards;for(;n.next();){const o=n.value;!o.visible||o.isTemporary||o.findObjectsAt(t,i,e,s)}return s}findObjectsAt(t,i,e,s){i===void 0&&(i=null),e===void 0&&(e=null),!(s instanceof List)&&!(s instanceof GSet)&&(s=new GSet),this.Ci();const n=this.jt.iteratorBackwards;for(;n.next();){const o=n.value;o.visible&&o.findObjectsAt(t,i,e,s)}return s}findPartsIn(t,i,e,s){return i===void 0&&(i=!1),e===void 0&&(e=!0),this.oR(t,null,n=>n instanceof Part&&(!e||n.canSelect()),i,s)}findObjectsIn(t,i,e,s,n){i===void 0&&(i=null),e===void 0&&(e=null),s===void 0&&(s=!1),!(n instanceof List)&&!(n instanceof GSet)&&(n=new GSet),this.Ci();const o=this.jt.iteratorBackwards;for(;o.next();){const r=o.value;r.visible&&r.findObjectsIn(t,i,e,s,n)}return n}NP(t,i,e,s,n,o){const r=new GSet;this.Ci();const l=this.jt.iteratorBackwards;for(;l.next();){const h=l.value;h.visible&&h.NP(t,i,e,s,r,n,o)}return r}oR(t,i,e,s,n){i===void 0&&(i=null),e===void 0&&(e=null),s===void 0&&(s=!1),!(n instanceof List)&&!(n instanceof GSet)&&(n=new GSet),this.Ci();const o=this.jt.iteratorBackwards;for(;o.next();){const r=o.value;!r.visible||r.isTemporary||r.findObjectsIn(t,i,e,s,n)}return n}findPartsNear(t,i,e,s,n){return e===void 0&&(e=!0),s===void 0&&(s=!0),this.rR(t,i,null,o=>o instanceof Part&&(!s||o.canSelect()),e,n)}findObjectsNear(t,i,e,s,n,o){e===void 0&&(e=null),s===void 0&&(s=null),n===void 0&&(n=!0),n!==!1&&n!==!0&&((n instanceof List||n instanceof GSet)&&(o=n),n=!0),!(o instanceof List)&&!(o instanceof GSet)&&(o=new GSet),this.Ci();const r=this.jt.iteratorBackwards;for(;r.next();){const l=r.value;l.visible&&l.findObjectsNear(t,i,e,s,n,o)}return o}rR(t,i,e,s,n,o){e===void 0&&(e=null),s===void 0&&(s=null),n===void 0&&(n=!0),n!==!1&&n!==!0&&((n instanceof List||n instanceof GSet)&&(o=n),n=!0),!(o instanceof List)&&!(o instanceof GSet)&&(o=new GSet),this.Ci();const r=this.jt.iteratorBackwards;for(;r.next();){const l=r.value;!l.visible||l.isTemporary||l.findObjectsNear(t,i,e,s,n,o)}return o}acceptEvent(t){return this.Xc(t,t instanceof MouseEvent)}Xc(t,i){const e=this.Xr;this.Xr=this.$h,this.$h=e,e.diagram=this,e.event=t,i?this.o0(t,e):(e.viewPoint=this.Xr.viewPoint,e.documentPoint=this.Xr.documentPoint);let s=0;const n=t;return n.ctrlKey&&(s+=1),n.altKey&&(s+=2),n.shiftKey&&(s+=4),n.metaKey&&(s+=8),e.modifiers=s,e.button=n.button,n.buttons!==void 0&&(e.buttons=n.buttons),Util.or&&n.button===0&&n.ctrlKey&&(e.button=2),e.down=!1,e.up=!1,e.clickCount=1,e.delta=0,e.handled=!1,e.bubbles=!1,e.timestamp=t.timeStamp,e.isMultiTouch=!1,e.targetDiagram=this.wS(t,t.target),e.targetObject=null,e}wS(t,i){if(i===null)return null;const e=Diagram.Ve.get(i);if(e)return e;let s=t.path;if(!s&&typeof t.composedPath=="function"&&(s=t.composedPath()),s&&s[0]){const n=Diagram.Ve.get(s[0]);if(n)return n}return null}qF(t,i,e){const s=this.yS(t,!0,!1,!1,!0,e);return this.o0(i,s),s.targetDiagram=this.wS(t,t.target),s.targetObject=null,e||s.clone(this.Jm),s}WF(t,i,e){const s=this.yS(t,!1,!1,!1,!1,e);let n=root.document.elementFromPoint(i.clientX,i.clientY)||null;n!==null&&n.shadowRoot!==void 0&&n.shadowRoot!==null&&(n=n.shadowRoot.elementFromPoint(i.clientX,i.clientY));let o=this,r=t;if(n){const l=Diagram.Ve.get(n);l&&(r=i,o=l)}return s.targetDiagram=o,this.o0(r,s),s.targetObject=null,s}yS(t,i,e,s,n,o){const r=this.Xr;this.Xr=this.$h,this.$h=r,r.diagram=this,r.clickCount=1,r.delta=0;let l=0;return t.ctrlKey&&(l+=1),t.altKey&&(l+=2),t.shiftKey&&(l+=4),t.metaKey&&(l+=8),r.modifiers=l,r.event=t,r.timestamp=t.timeStamp,r.button=e?this.firstInput.button:t.button,r.buttons=t.buttons,Util.or&&t.button===0&&t.ctrlKey&&(r.button=2),r.down=i,r.up=e,r.handled=s,r.bubbles=n,r.isMultiTouch=o,r}oa(t,i){return t.bubbles?!0:(i.stopPropagation!==void 0&&i.stopPropagation(),i.cancelable!==!1&&i.preventDefault(),i.cancelBubble=!0,!1)}QF(t){const i=Diagram.Ve.get(this);if(!i||!i.isEnabled)return!1;const e=i.Xc(t,!1);return e.key=t.key,e.code=t.code,e.down=!0,i.doKeyDown(),i.oa(e,t)}_F(t){const i=Diagram.Ve.get(this);if(!i||!i.isEnabled)return!1;const e=i.Xc(t,!1);return e.key=t.key,e.code=t.code,e.up=!0,i.doKeyUp(),i.oa(e,t)}$F(t){const i=Diagram.Ve.get(this);if(!i||!i.isEnabled)return!1;const e=i.Xc(t,!0);return i.mouseEnter!==null&&i.mouseEnter(e),i.currentTool.standardMouseOver(),i.oa(e,t)}ZF(t){const i=Diagram.Ve.get(this);if(!i||!i.isEnabled)return!1;const e=i.Xc(t,!0);return i.mouseLeave!==null&&i.mouseLeave(e),i.oa(e,t)}getMouse(t){const i=this.dt;if(i===null)return new Point(0,0);const e=i.getBoundingClientRect(),s=(t.clientX-e.left)*(this.kt/e.width),n=(t.clientY-e.top)*(this.Pt/e.height);return new Point(s,n).Ie(this.D)}o0(t,i){const e=this.dt;let s=0,n=0;if(e!==null){const r=e.getBoundingClientRect();s=(t.clientX-r.left)*(this.kt/r.width),n=(t.clientY-r.top)*(this.Pt/r.height)}i.viewPoint.e(s,n);const o=Point.X(s,n);this.D.ts(o),i.documentPoint.a(o),Point.s(o)}PC(t,i,e){let s;if(this._h[0]!==null)s=this._h[i];else return;const n=this.dt;if(n!==null){const o=n.getBoundingClientRect();e.e((s.clientX-o.left)*(this.kt/o.width),(s.clientY-o.top)*(this.Pt/o.height))}}invalidateDocumentBounds(){this.Zh||(this.Zh=!0,this.requestUpdate(!1))}lR(){this.ps||this.Ci(),this.ensureBounds()}redraw(){this.qt||this.ps||(this.C(),this.maybeUpdate())}isUpdateRequested(){return this.Pr}delayInitialization(t){t===void 0&&(t=null);const i=this.animationManager,e=i.isEnabled;i.stopAnimation(),i.isEnabled=!1,this.pr(),this.Jn=!1,this.ex=new Point(NaN,NaN),i.isEnabled=e,this.ps=!0;const s=this;t!==null&&Util.Oh(()=>{s.ps=!1,i.Dl("Model"),t(s)},1)}requestUpdate(t){if(t===void 0&&(t=!1),this.Pr===!0||this.qt||t===!1&&this.ps)return;this.Pr=!0;const i=this;root.requestAnimationFrame(()=>{i.Pr&&i.maybeUpdate()})}maybeUpdate(){this.vu&&!this.Pr||(this.vu&&(this.vu=!1),this.pr())}bS(t,i){!this.Eu||this.qt||this.animationManager.defaultAnimation.isAnimating||this.kL()||(t&&this.Ci(),i&&this.Us(!1))}pr(t){if(this.ps||(this.Pr=!1,this.Tt===null&&!this.Bu.isReal()))return;this.ps=!0;const i=this.animationManager,e=this.Xu;if(!i.isAnimating&&e.length!==0){const c=e.r,f=c.length;for(let u=0;u<f;u++){const d=c[u];d.ue(!1),d.c()}e.clear()}const s=this.hS;s.count>0&&(s.each(c=>c.kS()),s.clear());let n=!1,o=!1;i.defaultAnimation.isAnimating&&(o=!0,n=this.skipsUndoManager,this.skipsUndoManager=!0),i.wi||this.NM(),t||this.bS(!1,!0);const r=!this.undoManager.isUndoingRedoing&&(this.xl||this.zc.count!==0&&this.Lr.size!==0),l=!this.Jn||this.Kr;this.Ci(!0);let h=!1;(l||r)&&(this.Jn?this.PS(!this.Oc,r):(this.startTransaction("Initial Layout"),i.isEnabled===!1&&i.stopAnimation(),this.PS(!1,r)),h=l),this.Oc=!1,this.xl=!1,this.Ci(),this.is!==null&&(this.is.visible&&!this.Uu&&(this._l(),this.Uu=!0),!this.is.visible&&this.Uu&&(this.Uu=!1)),this.Bx||this.lR(),t||this.bS(!0,!1);let a=!1;if(h){const c=Rect.l();c.a(this.viewportBounds),this.Jn||(this.Jn=!0,a=!0,this.skipsUndoManager||(this.undoManager.vw=!0),this.undoManager.Ow=!0,this.hR()),this.aR(),this.Ci(!1),t||this.bS(!0,!0),Rect.s(c)}else if(i.Mc&&i.ix){if(this.Cr!==1)this.scale=this.Gu(this.Cr);else if(this.Gl!==1)this.scale=this.Gu(this.Gl);else{const c=this.initialScale;isFinite(c)&&c>0&&(this.scale=c)}this.Us(!0)}h&&a&&this.commitTransaction("Initial Layout"),t||this.Ui(this.Qt),o&&(this.skipsUndoManager=n),this.ps=!1}get Bh(){return this.Jn}hR(){if(this.Cr!==1)this.scale=this.Gu(this.Cr);else if(this.Gl!==1)this.scale=this.Gu(this.Gl);else{const i=this.initialScale;isFinite(i)&&i>0&&(this.scale=i)}this.Us(!0);const t=this.jt.r;this.Bs(t,t.length,this,this.viewportBounds),this.v("InitialLayoutCompleted"),this.ex.a(this.at),this._l()}aR(){this.v("LayoutCompleted")}r0(t){this.Hn.add(t)}addInvalidRoute(t){this.Do?this.Wh.add(t):this.Lr.add(t)}Ci(t){if(this.Hn.size!==0&&!(!this.ps&&this.animationManager.isTicking)){if(this.ps||(this.xl=!0),t){this.ML(this.Hn);return}for(let i=0;i<23&&this.Hn.size!==0;i++){const e=new Set(this.Hn);this.Hn.clear(),this.kS(e,this.Hn)}this.nodes.each(i=>{i instanceof Group&&i.SL(!1)})}}ML(t,i){for(const e of t)!e.Pe()||e instanceof Group||(e.jr()?(e.ut(1/0,1/0),e.Xt()):i&&i.add(e));for(const e of t)if(e instanceof Group){if(!e.isVisible())continue;this.yb(e)}}kS(t,i){this.ML(t,i);for(const e of t){if(!(e instanceof Link))continue;const s=e;s.isVisible()&&(s.jr()?(s.ut(1/0,1/0),s.Xt()):i.add(s))}for(const e of t)e instanceof Adornment&&e.isVisible()&&(e.jr()?(e.ut(1/0,1/0),e.Xt()):i.add(e))}l0(t){const i=t instanceof Diagram,e=i?t.links:t.memberParts,s=this.Hn;if(i)this.Ci(!0);else{for(;e.next();){const n=e.value;s.has(n)&&(!n.Pe()||n instanceof Group||n.jr()&&(n.ut(1/0,1/0),n.Xt()))}for(e.reset();e.next();){const n=e.value;if(s.has(n)&&n instanceof Group){if(!n.isVisible())continue;this.yb(n)}}e.reset()}for(;e.next();){const n=e.value;n instanceof Link&&s.has(n)&&n.isVisible()&&n.jr()&&(n.ut(1/0,1/0),n.Xt())}}yb(t){const i=Util.nt(),e=Util.nt(),s=t.memberParts;for(;s.next();){const o=s.value;o.isVisible()&&(o instanceof Group?(o.vo()||o.es()||o.th())&&this.yb(o):o instanceof Link?o.fromNode===t||o.toNode===t?e.push(o):i.push(o):(o.ut(1/0,1/0),o.Xt()))}let n=i.length;for(let o=0;o<n;o++){const r=i[o];r.ut(1/0,1/0),r.Xt()}Util.tt(i),t.ut(1/0,1/0),t.Xt(),n=e.length;for(let o=0;o<n;o++){const r=e[o];r.ut(1/0,1/0),r.Xt()}Util.tt(e)}Bs(t,i,e,s){if(!(!this.Ec&&!this.animationManager.isAnimating)){for(let n=0;n<i;n++)t[n].Bs(e,s);this.Ci()}}Ui(t){if(this.Tt===null)return;this.dt===null&&Util.o("No canvas specified"),this.Ic==="svg"?this.cR(t):this.fR(t)}fR(t){const i=this.animationManager;if(i.wi||i.isAnimating&&!i.isTicking)return;const e=new Date;if(this.h0(),this.Tt.style.opacity==="0")return;const s=t!==this.Qt,n=this.jt.r,o=n.length,r=this;if(this.Bs(n,o,r,r.viewportBounds),s)t.clearContextCache(!0),this.Ql();else if(!this.Ue&&!i.isAnimating)return;const l=this.D,h=this.zi;t.setTransform(h,0,0,h,0,0),t.clearRect(0,0,this.kt,this.Pt),this.Jt!==1&&(t.globalAlpha=this.Jt),this.MS(t);for(let m=0;m<o;m++)t.setTransform(h,0,0,h,0,0),t.transform(l.m11,l.m12,l.m21,l.m22,l.dx,l.dy),t.commitTransform(),n[m].Ui(t,r);let a=!1;this.Vc?this.Vc.Yu(this)&&(a=this.rb()):a=!0,a&&(Transform.prototype.ts=Transform.prototype.ww),s?(this.Qt.clearContextCache(!0),this.Ql()):(this.Ec=!1,this.Ue=!1);const f=+new Date-+e,u=!1,d=this.dS;if(u||this.kl===null){d[this.t0]=f,this.t0=(this.t0+1)%d.length;let m=0;for(let g=0;g<d.length;g++)m+=d[g];this._m=m/d.length}if(this.Jt!==1&&(t.globalAlpha=1),u){t.setTransform(1,0,0,1,0,0);for(let m=0;m<d.length;m++)t.fillText(d[m].toString(),20,150+ +(m*20))}}cR(t){if(this.Tt===null)return;const i=this.animationManager;if(i.wi||i.isAnimating&&!i.isTicking)return;this.h0();const e=this.kt,s=this.Pt;t.surface.resize(e,s,e,s);const o=this.jt.r,r=o.length,l=this;if(this.Bs(o,r,l,l.viewportBounds),!this.Ue&&!i.isAnimating)return;const h=this.D;t.lastDrawnPart=null,t.setDiagramPosScale(h.m11,h.m12,h.m21,h.m22,h.dx,h.dy),this.Jt!==1&&(t.globalAlpha=this.Jt),this.MS(t);const a=this.zi;this.dt.ai.setTransform(a,0,0,a,0,0),this.dt.ai.clearRect(0,0,this.kt,this.Pt);for(let f=0;f<r;f++)o[f].Ui(t,l);let c=!1;this.Vc?this.Vc.Yu(this)&&(c=this.rb()):c=!0,c&&(Transform.prototype.ts=Transform.prototype.ww),this.Ec=!1,this.Ue=!1}wb(t,i,e,s,n,o,r,l,h){if(this.Tt===null)return;this.dt===null&&Util.o("No canvas specified"),o===void 0&&(o=null),r===void 0&&(r=null),l===void 0&&(l=!1),h===void 0&&(h=!1),this.h0(),this.Qt.clearContextCache(!0),this.Ql(),this.Qh=!0;const a=this.et;this.et=s;const c=this,f=this.jt.r,u=f.length;try{const d=new Rect(n.x,n.y,e.width/s,e.height/s),m=d.copy();m.addMargin(i),this._l(m),this.Ci(),this.Bs(f,u,c,d),t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,e.width,e.height),r!==null&&r!==""&&(t.fillStyle=r,t.fillBackground(0,0,e.width,e.height));const g=this.zi;t.scale(g,g);const p=Transform.l();p.vi(),p.Ds(i.left,i.top),p.et(s),(n.x!==0||n.y!==0)&&p.Ds(-n.x,-n.y),t.setTransform(p.m11,p.m12,p.m21,p.m22,p.dx,p.dy),t.commitTransform(),t instanceof SVGContext&&t.setDiagramPosScale(p.m11,p.m12,p.m21,p.m22,p.dx,p.dy),Transform.s(p),this.MS(t),t.globalAlpha=this.Jt;const y=this.findLayer("Grid");if(o){const x=new GSet,k=o.iterator;for(k.reset();k.next();){const b=k.value;b instanceof Part&&(!h&&b.layer===y||(b.Du(),x.add(b)))}for(let b=0;b<u;b++)f[b].PF(t,c,x,l);x.each(b=>b.Du())}else for(let x=0;x<u;x++){const k=f[x];k===y?h&&k.Ui(t,c,!0):k.Ui(t,c,l)}this.Qh=!1,this.Vc&&this.Vc.Yu(this)&&this.rb()}finally{this.et=a,this.Qt.clearContextCache(!0),this.Ql(),this.Bs(f,u,c,c.viewportBounds),this._l(),this.Qt instanceof SVGContext&&(this.Qt.diagramGroup.replaceChildren(),this.redraw())}}getRenderingHint(t){return this.Nr[t]}setRenderingHint(t,i){t==="minDrawingLength"&&(this.Bm=i),this.Nr[t]=i,this.redraw()}resetRenderingHints(){this.Nr=new PropertyCollection,this.Nr.drawShadows=!0,this.Nr.textGreeking=!0,this.Nr.viewportOptimizations=!Util.or,this.Nr.temporaryPixelRatio=!0,this.Nr.pictureRatioOptimization=!0,this.Nr.minDrawingLength=1,this.Bm=1}MS(t){const i=this.Nr;if(i===null)return;if(i.imageSmoothingEnabled!==void 0){const s=!!i.imageSmoothingEnabled;t.setImageSmoothingEnabled(s)}const e=i.defaultFont;e!=null&&(t.font=e)}getInputOption(t){return this.Fu[t]}setInputOption(t,i){this.Fu[t]=i}UF(){this.Fu=new PropertyCollection,this.Fu.extraTouchArea=10,this.Fu.extraTouchThreshold=10,this.Fu.hasGestureZoom=!0}set(t){return Object.assign(this,t),this}attach(t){return this.setProperties(t)}setProperties(t){return Diagram.a0(this,t),this}static a0(t,i){const e=t instanceof Panel,s=t instanceof Diagram;for(const n in i){n===""&&Util.o("Setting properties requires non-empty property names");let o=t,r=n;if(e||s){const h=n.indexOf(".");if(h>0){const a=n.substring(0,h);e?o=t.findObject(a):(o=t[a],o==null&&(o=t.toolManager[a])),Util.wt(o)?r=n.substring(h+1):Util.o("Unable to find object named: "+a+" in "+t.toString()+" when trying to set property: "+n)}}if(r[0]!=="_"&&!Util.fw(o,r))if(s&&r==="ModelChanged"){t.addModelChangedListener(i[r]);continue}else if(s&&r==="Changed"){t.addChangedListener(i[r]);continue}else if(s&&Util.fw(t.toolManager,r))o=t.toolManager;else if(s&&t.NL(r)){t.addDiagramListener(r,i[r]);continue}else if(t instanceof Model&&r==="Changed"){t.addChangedListener(i[r]);continue}else Util.o('Trying to set undefined property "'+r+'" on object: '+o.toString());const l=i[n];o[r]=l,r[0]==="_"&&o instanceof GraphObject&&o.addCopyProperty(r)}}eL(){if(this.Jl.count!==0&&!(this.undoManager.transactionLevel>1)){for(;this.Jl.count>0;){const t=this.Jl;this.Jl=new GMap;const i=t.iterator;for(;i.next();){const e=i.key;e.invalidateOtherJumpOvers(i.value),e.ee()}}this.C()}}C(t){if(t===void 0)this.Ue=!0,this.requestUpdate();else{const i=this.viewportBounds;t.isReal()&&i.intersectsRect(t)&&(this.Ue=!0,this.requestUpdate())}this.v("InvalidateDraw")}invalidateViewport(t,i){if(this.Ue===!0)return;if(this.Ue=!0,this.Ic==="svg"){this.maybeUpdate();return}this.getRenderingHint("temporaryPixelRatio")===!0?(this.Bw(),this.maybeUpdate(),this.yP(!0)):this.maybeUpdate()}ra(){this.Eu=!0}Ql(){this.Ec=!0}h0(){this.Ru!==!1&&(this.Ru=!1,this.xL(this.kt,this.Pt))}xL(t,i){this.Zl();const e=this.zi,s=t*e,n=i*e;this.dt.resize(s,n,t,i)&&(this.Ue=!0,this.Qt.clearContextCache(!0))}kL(){const t=this.dt;if(t===null||this.Bu.isReal())return!0;const i=this.kt,e=this.Pt,s=this.Tt;let n=!1,o=this.Wn?this.di:0,r=this.gn?this.di:0,l=s.clientWidth||i+o,h=s.clientHeight||e+r;const a=this.viewportBounds,c=a.x,f=a.y,u=a.width,d=a.height;if((l!==i+o||h!==e+r)&&(this.Wn=!1,this.gn=!1,o=0,r=0,this.kt=l,this.Pt=h,this.Ru=!0,n=!0,this.Zl()),!this.Jn||!this.viewportBounds.isReal())return!0;const m=this.nb,g=this.ob;if(this.Eu=!1,!n&&!this.Wn&&!this.gn&&!this.Ou&&!this.Iu)return!0;const p=this.documentBounds;let y=0,x=0,k=0,b=0;const P=a.width,M=a.height,L=this.Fc;this.contentAlignment.isSpot()?(p.width>P&&(y=L.left,x=L.right),p.height>M&&(k=L.top,b=L.bottom)):(y=L.left,x=L.right,k=L.top,b=L.bottom);const C=p.width+y+x,S=p.height+k+b,N=this.scale,T=N;let A=C>l/N,D=S>h/N;if(!n&&!this.Wn&&!this.gn&&!A&&!D)return!0;const F=p.x-y,R=a.x,v=p.right+x;let O=a.right+o;const B=p.y-k,X=a.y,E=p.bottom+b;let V=a.bottom+r,U="1px",Y="1px";if(this.scrollMode===1&&(A||D)){if(A&&this.hasHorizontalScrollbar&&this.allowHorizontalScroll){let z=1;F+1<R&&(z=Math.max((R-F)*N+this.kt,z)),v>O+1&&(z=Math.max((v-O)*N+this.kt,z)),P+o+1<C&&(z=Math.max((C-P)*N+this.kt,z)),U=z.toString()+"px"}if(D&&this.hasVerticalScrollbar&&this.allowVerticalScroll){let z=1;B+1<X&&(z=Math.max((X-B)*N+this.Pt,z)),E>V+1&&(z=Math.max((E-V)*N+this.Pt,z)),M+r+1<S&&(z=Math.max((S-M)*N+this.Pt,z)),Y=z.toString()+"px"}}let G=U!=="1px",H=Y!=="1px";if(!(G&&H)&&(G||H)){if(A=!(C<P+o),D=!(S<M+r),H&&(O-=this.di),G&&(V-=this.di),A&&this.hasHorizontalScrollbar&&this.allowHorizontalScroll){let W=1;F+1<R&&(W=Math.max((R-F)*N+this.kt,W)),v>O+1&&(W=Math.max((v-O)*N+this.kt,W)),P+1<C&&(W=Math.max((C-P)*N+this.kt,W)),U=W.toString()+"px"}G=U!=="1px";let z=this.Pt;if(G!==this.gn&&(z=G?this.Pt-this.di:this.Pt+this.di),D&&this.hasVerticalScrollbar&&this.allowVerticalScroll){let W=1;B+1<X&&(W=Math.max((X-B)*N+z,W)),E>V+1&&(W=Math.max((E-V)*N+z,W)),M+1<S&&(W=Math.max((S-M)*N+z,W)),Y=W.toString()+"px"}H=Y!=="1px"}if(this.Gm&&!(G!==this.gn||H!==this.Wn))return(i!==this.kt||e!==this.Pt)&&this.maybeUpdate(),!1;if(G!==this.gn&&(U==="1px"?this.Pt=this.Pt+this.di:this.Pt=Math.max(this.Pt-this.di,1),n=!0),this.gn=G,g.style.width=U,H!==this.Wn&&(Y==="1px"?this.kt=this.kt+this.di:this.kt=Math.max(this.kt-this.di,1),n=!0,this.Ku)){const z=Point.l();H?(t.style.left=this.di+"px",this.position=z.e(this.at.x+this.di/this.scale,this.at.y)):(t.style.left="0px",this.position=z.e(this.at.x-this.di/this.scale,this.at.y)),Point.s(z)}n&&this.Zl(),this.Wn=H,g.style.height=Y,this.Jx=!0,n&&(this.Ru=!0);let J=m.scrollLeft;if(this.hasHorizontalScrollbar&&this.allowHorizontalScroll&&(P+1<C?J=(this.position.x-F)*N:F+1<R?J=m.scrollWidth-m.clientWidth:v>O+1&&(J=this.position.x*N)),this.Ku)switch(this.wx){case"negative":J=-(m.scrollWidth-J-m.clientWidth);break;case"reverse":J=m.scrollWidth-J-m.clientWidth;break}if(m.scrollLeft=J,this.hasVerticalScrollbar&&this.allowVerticalScroll&&(M+1<S?m.scrollTop=(this.position.y-B)*N:B+1<X?m.scrollTop=m.scrollHeight-m.clientHeight:E>V+1&&(m.scrollTop=this.position.y*N)),l=this.kt,h=this.Pt,m.style.width=l+(this.Wn?this.di:0)+"px",m.style.height=h+(this.gn?this.di:0)+"px",i!==l||e!==h||this.animationManager.wi){const z=Rect.X(c,f,u,d);return this.onViewportBoundsChanged(z,this.viewportBounds,T,n),Rect.s(z),!1}return!0}add(t){const i=t.diagram;if(i===this)return;i!==null&&Util.o("Cannot add part "+t.toString()+" to "+this.toString()+". It is already a part of "+i.toString());let e=this.findLayer(t.layerName);if(e===null&&(e=this.findLayer("")),e===null&&Util.o('Cannot add a Part when unable find a Layer named "'+t.layerName+'" and there is no default Layer'),t.layer===e)return;const s=e.qh(99999999,t,t.diagram===this);s>=0&&this.raiseChangedEvent(3,"parts",e,null,t,null,s),e.isTemporary||this.invalidateDocumentBounds(),t.invalidateLayout(1);const n=t.layerChanged;n!==null&&n(t,null,e)}qh(t){this.partManager.qh(t);const i=this;t.Hr(s=>i.CL(s)),t.data||t.Oo(),t.hasPlaceholder()&&t.c(),t.data!==null&&t.Hr(s=>i.partManager.SS(s,null)),(t.es()===!0||t.th()===!0)&&this.r0(t),t.LL(!0,this),t.AL()?(t.actualBounds.isReal()&&this.C(t.Hh(t.actualBounds)),this.invalidateDocumentBounds()):t.isVisible()&&t.actualBounds.isReal()&&this.C(t.Hh(t.actualBounds)),this.requestUpdate()}te(t){t.clearAdornments(),this.partManager.te(t);const i=this;t.data!==null&&t.Hr(s=>i.partManager.NS(s,i)),this.Hn.delete(t),t instanceof Link&&this.Lr.delete(t),t.AL()?(t.actualBounds.isReal()&&this.C(t.Hh(t.actualBounds)),this.invalidateDocumentBounds()):t.isVisible()&&t.actualBounds.isReal()&&this.C(t.Hh(t.actualBounds)),this.requestUpdate()}remove(t){this.CS(t,!0)}CS(t,i){const e=t.layer;if(e===null||e.diagram!==this)return;t.isSelected=!1,t.isHighlighted=!1,t.invalidateLayout(2),i&&t.Kc();const s=e.te(-1,t,!1);s>=0&&this.raiseChangedEvent(4,"parts",e,t,null,s,null);const n=t.layerChanged;n!==null&&n(t,e,null)}removeParts(t,i){if(i===void 0&&(i=!1),Array.isArray(t)){const e=t.length;for(let s=0;s<e;s++){const n=t[s];i&&!n.canDelete()||this.remove(n)}}else{const e=new GSet;e.addAll(t);const s=e.iterator;for(;s.next();){const n=s.value;i&&!n.canDelete()||this.remove(n)}}}copyParts(t,i,e){return e===void 0&&(e=!1),this.partManager.copyParts(t,i,e)}moveParts(t,i,e,s){if(e===void 0&&(e=!1),s===void 0&&(s=this.c0()),this.toolManager===null)return;const o=new GMap;if(t!==null)if(Array.isArray(t))for(let r=0;r<t.length;r++)this.qr(o,t[r],e,s);else{const r=t.iterator;for(;r.next();)this.qr(o,r.value,e,s)}else{let r=this.parts;for(;r.next();){const l=r.value;this.qr(o,l,e,s)}for(r=this.nodes;r.next();){const l=r.value;this.qr(o,l,e,s)}for(r=this.links;r.next();){const l=r.value;this.qr(o,l,e,s)}}this.bP(o,i,s,e)}qr(t,i,e,s,n){if(!t.has(i)&&(n===void 0&&(n=!1),!(e&&!n&&!i.canMove()&&!i.canCopy())))if(s===void 0&&(s=this.c0()),i instanceof Node){if(t.set(i,this.Is(s,i,i.location)),i instanceof Group&&(i.hasPlaceholder()||s.dragsMembers)){const r=i.memberParts;for(;r.next();){const l=r.value;this.qr(t,l,e,s,s.groupsAlwaysMove)}}const o=i.linksConnected;for(;o.next();){const r=o.value;if(t.has(r))continue;const l=r.fromNode,h=r.toNode;l!==null&&t.has(l)&&h!==null&&t.has(h)&&this.qr(t,r,e,s)}if(s.dragsTree){const r=i.findTreeChildrenNodes();for(;r.next();){const l=r.value;this.qr(t,l,e,s)}}}else if(i instanceof Link){t.set(i,this.Is(s,i));const o=i.labelNodes;for(;o.next();){const r=o.value;this.qr(t,r,e,s)}}else i instanceof Adornment||t.set(i,this.Is(s,i,i.location))}bP(t,i,e,s){if(t===null||t.count===0)return;const n=Point.l(),o=Point.l();o.a(i),isNaN(o.x)&&(o.x=0),isNaN(o.y)&&(o.y=0);const r=this.ab;r||this.Uw(t);const l=Util.nt(),h=Util.nt(),a=t.iterator;let c=Point.l();for(;a.next();){const g=a.key,p=a.value;if(g.Pe()){const y=this.TL(g,t);if(y!==null)l.push(new DraggingNodeInfoPair(g,p,y));else if(!s||g.canMove()){const x=p.point;n.a(x),this.computeMove(g,n.add(o),e,c),g.location=c,p.shifted===void 0&&(p.shifted=new Point),p.shifted.a(c.subtract(x))}}else a.key instanceof Link&&h.push(new KeyValuePair(a.key,a.value))}Point.s(c);const f=l.length;for(let g=0;g<f;g++){const p=l[g],y=p.DL.point;n.a(y),p.xb.shifted===void 0&&(p.xb.shifted=new Point),p.de.location=n.add(p.xb.shifted)}const u=Point.l(),d=Point.l(),m=h.length;for(let g=0;g<m;g++){const p=h[g],y=p.key;if(y instanceof Link){if(y.suspendsRouting){y.Mr=null;const x=y.fromNode,k=y.toNode;if(this.draggedLink!==null&&e.dragsLink){const b=p.value.point;if(y.dragComputation===null){t.set(y,this.Is(e,y,o));const P=o.x-b.x,M=o.y-b.y;y.mr(P,M)}else{const P=Point.X(0,0),M=y.getPoint(0);M&&M.isReal()&&P.a(M),c=Point.l().a(P).add(o);let L=c;e.isGridSnapEnabled&&(e.isGridSnapRealtime||this.lastInput.up)&&(L=Point.l(),this.hM(y,c,L,e)),c.a(y.dragComputation(y,c,L)).subtract(P),t.set(y,this.Is(e,y,c));const C=c.x-b.x,S=c.y-b.y;y.mr(C,S),Point.s(P),Point.s(c),L!==c&&Point.s(L)}}else{if(x!==null){u.a(x.location);const b=t.get(x);b!==null&&u.subtract(b.point)}if(k!==null){d.a(k.location);const b=t.get(k);b!==null&&d.subtract(b.point)}if(x!==null&&k!==null)if(u.equalsApprox(d)){const b=p.value.point,P=n;P.a(u),P.subtract(b),t.set(y,this.Is(e,y,u)),y.mr(P.x,P.y)}else y.suspendsRouting=!1,y.invalidateRoute();else{const b=p.value.point;let P;x!==null?P=u:k!==null?P=d:P=o,t.set(y,this.Is(e,y,P));const M=P.x-b.x,L=P.y-b.y;y.mr(M,L)}}}else if(y.fromNode===null||y.toNode===null){const x=p.value.point;t.set(y,this.Is(e,y,o));const k=o.x-x.x,b=o.y-x.y;y.mr(k,b)}}}Point.s(n),Point.s(o),Point.s(u),Point.s(d),Util.tt(l),Util.tt(h),r||(this.Ci(),this.km(t))}computeMove(t,i,e,s){if(s===void 0&&(s=new Point),s.a(i),t===null)return s;let n=i;const o=e.isGridSnapEnabled;o&&(e.isGridSnapRealtime||this.lastInput.up)&&(n=Point.l(),this.hM(t,i,n,e));const r=t.dragComputation!==null?t.dragComputation(t,i,n):n,l=t.minLocation;let h=l.x;isNaN(h)&&(h=o?Math.round(t.location.x*1e3)/1e3:t.location.x);let a=l.y;isNaN(a)&&(a=o?Math.round(t.location.y*1e3)/1e3:t.location.y);const c=t.maxLocation;let f=c.x;isNaN(f)&&(f=o?Math.round(t.location.x*1e3)/1e3:t.location.x);let u=c.y;return isNaN(u)&&(u=o?Math.round(t.location.y*1e3)/1e3:t.location.y),s.e(Math.max(h,Math.min(r.x,f)),Math.max(a,Math.min(r.y,u))),n!==i&&Point.s(n),s}c0(){const t=this.toolManager.findTool("Dragging");return t instanceof DraggingTool?t.dragOptions:this.fb}hM(t,i,e,s){if(s===void 0&&(s=this.c0()),e.a(i),t===null)return e;const n=this.grid,o=s.gridSnapCellSize;let r=o.width,l=o.height;const h=s.gridSnapOrigin;let a=h.x,c=h.y;const f=s.gridSnapCellSpot;if(n!==null){const d=n.gridCellSize;isNaN(r)&&(r=d.width),isNaN(l)&&(l=d.height);const m=n.gridOrigin;isNaN(a)&&(a=m.x),isNaN(c)&&(c=m.y)}const u=Point.X(0,0);return u.setSpot(0,0,r,l,f),Geo.Bg(i.x,i.y,a+u.x,c+u.y,r,l,e),Point.s(u),e}Uw(t){if(t===null)return;this.ab=!0;const i=t.iterator;for(;i.next();){const e=i.key;e instanceof Link&&(e.suspendsRouting=!0)}}km(t){if(t===null)return;const i=t.iterator;for(;i.next();){const e=i.key;e instanceof Link&&(e.suspendsRouting=!1,e.FL()&&e.invalidateRoute())}this.ab=!1}get draggedLink(){return this.cb}set draggedLink(t){this.cb!==t&&(this.cb=t,t!==null&&(this.ub=t.fromPort,this.db=t.toPort))}get MP(){return this.ub}set MP(t){this.ub=t}get SP(){return this.db}set SP(t){this.db=t}TL(t,i){const e=t.containingGroup;if(e!==null){let s=this.TL(e,i);if(s!==null||(s=i.get(e),s!==null))return s}return null}Is(t,i,e){if(e===void 0)return new DraggingInfo(Point.Po);let s=t.isGridSnapEnabled;return!t.groupsSnapMembers&&i.containingGroup!==null&&(s=!1),s?new DraggingInfo(new Point(Math.round(e.x*1e3)/1e3,Math.round(e.y*1e3)/1e3)):new DraggingInfo(e.copy())}LS(t,i){if(t.diagram!==null&&t.diagram!==this&&Util.o("Cannot share a Layer with another Diagram: "+t+" of "+t.diagram),i===null?t.diagram!==null&&Util.o("Cannot add an existing Layer to this Diagram again: "+t):(i.diagram!==this&&Util.o("Existing Layer must be in this Diagram: "+i+" not in "+i.diagram),t===i&&Util.o("Cannot move a Layer before or after itself: "+t)),t.diagram===this)return;const e=t.name,s=this.jt,n=s.count;for(let o=0;o<n;o++)s.elt(o).name===e&&Util.o("Cannot add Layer with the name '"+e+"'; a Layer with the same name is already present in this Diagram.")}addLayer(t){this.LS(t,null),t.Ao(this);const i=this.jt;let e=i.count-1;if(!t.isTemporary)for(;e>=0&&i.elt(e).isTemporary;)e--;return i.insertAt(e+1,t),this.Mi!==null&&this.raiseChangedEvent(3,"layers",this,null,t,null,e+1),this.C(),this.invalidateDocumentBounds(),this}addLayerBefore(t,i){this.LS(t,i),t.Ao(this);const e=this.jt,s=e.indexOf(t);s>=0&&(e.delete(t),this.Mi!==null&&this.raiseChangedEvent(4,"layers",this,t,null,s,null));const n=e.count;let o;for(o=0;o<n;o++)if(e.elt(o)===i){e.insertAt(o,t);break}return this.Mi!==null&&this.raiseChangedEvent(3,"layers",this,null,t,null,o),this.C(),s<0&&this.invalidateDocumentBounds(),this}addLayerAfter(t,i){this.LS(t,i),t.Ao(this);const e=this.jt,s=e.indexOf(t);s>=0&&(e.delete(t),this.Mi!==null&&this.raiseChangedEvent(4,"layers",this,t,null,s,null));const n=e.count;let o;for(o=0;o<n;o++)if(e.elt(o)===i){e.insertAt(o+1,t);break}return this.Mi!==null&&this.raiseChangedEvent(3,"layers",this,null,t,null,o+1),this.C(),s<0&&this.invalidateDocumentBounds(),this}Gr(t,i){t.Ao(this),this.jt.insertAt(i,t)}RL(t){this.jt.removeAt(t)}removeLayer(t){if(t.diagram!==this&&Util.o("Cannot remove a Layer from another Diagram: "+t+" of "+t.diagram),t.name==="")return;const i=this.jt,e=i.indexOf(t);if(i.delete(t)){const n=t.At.copy().iterator;for(;n.next();){const o=n.value,r=o.layerName;r!==t.name?o.layerName=r:o.layerName=""}this.Mi!==null&&this.raiseChangedEvent(4,"layers",this,t,null,e,null),this.C(),this.invalidateDocumentBounds()}}findLayer(t){const i=this.layers;for(;i.next();){const e=i.value;if(e.name===t)return e}return null}findRouter(t){for(const i of this.zc)if(i.name===t)return i;return null}addModelChangedListener(t){return Util.i(t,"function",Diagram,"addModelChangedListener:listener"),this.qn===null&&(this.qn=new List),this.qn.add(t),this.model.addChangedListener(t),this}removeModelChangedListener(t){Util.i(t,"function",Diagram,"removeModelChangedListener:listener"),this.qn!==null&&(this.qn.delete(t),this.qn.count===0&&(this.qn=null)),this.model.removeChangedListener(t)}addChangedListener(t){return Util.i(t,"function",Diagram,"addChangedListener:listener"),this.Ar===null&&(this.Ar=new List),this.Ar.add(t),this}removeChangedListener(t){Util.i(t,"function",Diagram,"removeChangedListener:listener"),this.Ar!==null&&(this.Ar.delete(t),this.Ar.count===0&&(this.Ar=null))}Iw(t){if(!this.skipsUndoManager&&!this.model.skipsUndoManager&&this.model.undoManager.handleChanged(t),t.change!==1&&(this.isModified=!0),this.Ar!==null){const i=this.Ar,e=i.length;for(let s=0;s<e;s++)i.elt(s)(t)}}raiseChangedEvent(t,i,e,s,n,o,r){o===void 0&&(o=null),r===void 0&&(r=null);const l=new ChangedEvent;l.diagram=this,l.change=t,l.propertyName=i,l.object=e,l.oldValue=s,l.oldParam=o,l.newValue=n,l.newParam=r,this.Iw(l)}raiseChanged(t,i,e,s,n){this.raiseChangedEvent(2,t,this,i,e,s,n)}t(t,i,e,s,n){this.raiseChangedEvent(2,t,this,i,e,s,n)}get animationManager(){return this.ds}get undoManager(){return this.Mi.undoManager}get skipsUndoManager(){return this.Fo}set skipsUndoManager(t){Util.i(t,"boolean",Diagram,"skipsUndoManager"),this.Fo=t,this.Mi.skipsUndoManager=t}get delaysLayout(){return this.Ux}set delaysLayout(t){this.Ux=t}MC(t,i){if(t===null||t.diagram!==this)return;const e=this.fe;try{this.fe=!0;const s=t.change;if(s===2){const n=t.object,o=t.propertyName,r=t.getValue(i);if(Model.rt(n,o,r),n instanceof GraphObject){const l=n.part;l!==null&&l.invalidateAdornments()}this.isModified=!0}else if(s===3){const n=t.object,o=t.newParam,r=t.newValue;if(n instanceof Panel)if(typeof o=="number"&&r instanceof GraphObject){i?n.te(o):n.insertAt(o,r);const l=n.part;l!==null&&l.invalidateAdornments()}else typeof o=="number"&&r instanceof RowColumnDefinition&&(r.isRow?n.vL(o,i?void 0:r):n.OL(o,i?void 0:r));else if(n instanceof Layer){const l=t.oldParam===!0;typeof o=="number"&&r instanceof Part&&(i?(r.isSelected=!1,r.isHighlighted=!1,r.invalidateAdornments(),n.te(l?o:-1,r,l)):n.qh(o,r,l))}else n instanceof Diagram?typeof o=="number"&&r instanceof Layer&&(i?this.RL(o):this.Gr(r,o)):Util.o("unknown ChangeType.Insert object: "+t.toString());this.isModified=!0}else if(s===4){const n=t.object,o=t.oldParam,r=t.oldValue;if(n instanceof Panel)typeof o=="number"&&r instanceof GraphObject?i?n.insertAt(o,r):n.te(o):typeof o=="number"&&r instanceof RowColumnDefinition&&(r.isRow?n.vL(o,i?r:void 0):n.OL(o,i?r:void 0));else if(n instanceof Layer){const l=t.newParam===!0;typeof o=="number"&&r instanceof Part&&(i?n.At.indexOf(r)<0&&n.qh(o,r,l):(r.isSelected=!1,r.isHighlighted=!1,r.invalidateAdornments(),n.te(l?o:-1,r,l)))}else n instanceof Diagram?typeof o=="number"&&r instanceof Layer&&(i?this.Gr(r,o):this.RL(o)):Util.o("unknown ChangeType.Remove object: "+t.toString());this.isModified=!0}else s===1||Util.o("unknown ChangedEvent: "+t.toString())}finally{this.fe=e}}startTransaction(t){return this.undoManager.startTransaction(t)}commitTransaction(t){return this.undoManager.commitTransaction(t)}rollbackTransaction(){return this.undoManager.rollbackTransaction()}commit(t,i){let e=i;e===void 0&&(e="");const s=this.skipsUndoManager;e===null&&(this.skipsUndoManager=!0,e=""),this.undoManager.startTransaction(e);let n=!1;try{t(this),n=!0}finally{n?this.undoManager.commitTransaction(e):this.undoManager.rollbackTransaction(),this.skipsUndoManager=s}}updateAllTargetBindings(t){this.partManager.updateAllTargetBindings(t)}updateAllThemeBindings(){if(this.partManager.updateAllThemeBindings(),this.is!==null){const t=this.is.part;t!==null&&t.Oo()}}setDivBackground(t){this.div&&(this.div.style.backgroundColor=t)}updateAllRelationshipsFromData(){this.partManager.updateAllRelationshipsFromData()}pb(){const t=this.D,i=this.et,e=this.at;t.vi(),i!==1&&t.et(i),(e.x!==0||e.y!==0)&&t.Ds(-e.x,-e.y)}IL(t,i){const e=this.animationManager;if(this.qt||this.ps){this.et=i,this.Zl(),this.C(),this.ra(),e.tL(t,this.et),this.pb();return}if(this.dt===null){this.et=i,this.pb();return}this.qt=!0;const n=this.viewportBounds.copy(),o=this.kt,r=this.Pt;let l=this.zoomPoint.x,h=this.zoomPoint.y;const a=this.contentAlignment;isNaN(l)&&(a.isSide()?a.includesSide(Spot.LeftSide)?l=0:a.includesSide(Spot.RightSide)&&(l=o-1):a.isSpot()?l=a.x*(o-1):l=o/2),isNaN(h)&&(a.isSide()?a.includesSide(Spot.TopSide)?h=0:a.includesSide(Spot.BottomSide)&&(h=r-1):a.isSpot()?h=a.y*(r-1):h=r/2),this.scaleComputation!==null&&!this.animationManager.defaultAnimation.isAnimating&&(i=this.scaleComputation(this,i)),i<this.minScale&&(i=this.minScale),i>this.maxScale&&(i=this.maxScale);const c=Point.X(this.at.x+l/t-l/i,this.at.y+h/t-h/i);this.position=c,Point.s(c),this.et=i,this.Zl(),this.qt=!1,this.onViewportBoundsChanged(n,this.viewportBounds,t,!1),this.Us(!1),e.tL(t,this.et),this.C()}sR(){const t=this.jt.r;for(let i=0;i<t.length;i++)t[i].lL()}onViewportBoundsChanged(t,i,e,s){if(t.equals(i))return;s===void 0&&(s=!1),s||this.ra(),this.Ql();const n=this.layout;n!==null&&n.isViewportSized&&this.autoScale===1&&(t.width!==i.width||t.height!==i.height)&&n.invalidateLayout();const o=this.currentTool;this.Uc===!0&&o instanceof ToolManager&&!this.animationManager.isTicking&&(this.lastInput.documentPoint=this.transformViewToDoc(this.lastInput.viewPoint),o.standardMouseActivity(this)),this.qt||this.invalidateViewport(t,i),this._l(),this.Vi.scale=e,this.Vi.position.x=t.x,this.Vi.position.y=t.y,this.Vi.bounds.a(t),this.Vi.canvasSize.width=Math.round(t.width*e),this.Vi.canvasSize.height=Math.round(t.height*e),this.Vi.newCanvasSize.width=this.kt,this.Vi.newCanvasSize.height=this.Pt,this.Vi.isScroll=s,this.v("ViewportBoundsChanged",this.Vi,t),this.isVirtualized&&this.links.each(r=>{r.isAvoiding&&r.actualBounds.intersectsRect(i)&&r.invalidateRoute()})}_l(t){const i=this.is;if(i===null||!i.visible||i.layer===null)return;const e=t!==void 0?t:this._x;if(!e.isReal())return;const s=e.width,n=e.height;if(i.scale=1,i.angle=0,i.layer.isViewportAligned)i.width=s*this.scale,i.height=n*this.scale,i.part.alignment=Spot.TopLeft;else{i.xi===null&&(i.xi=new GridPanelSettings);const o=i.xi.Yc;if(!o.isReal())return;i.width=s+o.width*2,i.height=n+o.height*2;const r=Point.l();Geo.Bg(e.x,e.y,0,0,o.width,o.height,r),r.offset(-o.width,-o.height),i.part.location=r,Point.s(r)}}clearSelection(t){t===void 0&&(t=!1);const i=this.selection;if(i.count===0)return;t||this.v("ChangingSelection",i);const e=i.toArray(),s=e.length;for(let n=0;n<s;n++){const o=e[n];o.isSelected=!1}i.ot(),i.clear(),i.g(),t||this.v("ChangedSelection",i)}select(t){t!==null&&t.diagram===this&&(!t.isSelected||this.selection.count>1)&&(this.v("ChangingSelection",this.selection),this.clearSelection(!0),t.isSelected=!0,this.v("ChangedSelection",this.selection))}selectCollection(t){if(this.v("ChangingSelection",this.selection),this.clearSelection(!0),Array.isArray(t)){const i=t.length;for(let e=0;e<i;e++){const s=t[e];s instanceof Part||Util.o("Diagram.selectCollection given something that is not a Part: "+s),s.isSelected=!0}}else{const i=t.iterator;for(;i.next();){const e=i.value;e instanceof Part||Util.o("Diagram.selectCollection given something that is not a Part: "+e),e.isSelected=!0}}this.v("ChangedSelection",this.selection)}clearHighlighteds(){const t=this.highlighteds;if(t.count>0){const i=t.toArray(),e=i.length;for(let s=0;s<e;s++){const n=i[s];n.isHighlighted=!1}t.ot(),t.clear(),t.g()}}highlight(t){t!==null&&t.diagram===this&&(!t.isHighlighted||this.highlighteds.count>1)&&(this.clearHighlighteds(),t.isHighlighted=!0)}highlightCollection(t){const i=new GSet().addAll(t),s=this.highlighteds.copy().removeAll(i).iterator;for(;s.next();){const o=s.value;o.isHighlighted=!1}const n=i.iterator;for(;n.next();){const o=n.value;o instanceof Part||Util.o("Diagram.highlightCollection given something that is not a Part: "+o),o.isHighlighted=!0}}scroll(t,i,e){e===void 0&&(e=1);const s=i==="up"||i==="down";let n=0;const o=Point.l();if(t==="pixel")n=e;else if(t==="line")n=e*(s?this.scrollVerticalLineChange:this.scrollHorizontalLineChange);else if(t==="page"){let l=s?this.viewportBounds.height:this.viewportBounds.width;if(l*=this.scale,l!==0){const h=Math.max(l-(s?this.scrollVerticalLineChange:this.scrollHorizontalLineChange),0);n=e*h}}else if(t==="document"){const l=this.documentBounds,h=this.viewportBounds;i==="up"?this.position=o.e(h.x,l.y):i==="left"?this.position=o.e(l.x,h.y):i==="down"?this.position=o.e(h.x,l.bottom-h.height):i==="right"&&(this.position=o.e(l.right-h.width,h.y)),Point.s(o);return}else Util.o("scrolling unit must be 'pixel', 'line', 'page', or 'document', not: "+t);n/=this.scale;const r=this.position;i==="up"?this.position=o.e(r.x,r.y-n):i==="down"?this.position=o.e(r.x,r.y+n):i==="left"?this.position=o.e(r.x-n,r.y):i==="right"?this.position=o.e(r.x+n,r.y):Util.o("scrolling direction must be 'up', 'down', 'left', or 'right', not: "+i),Point.s(o)}scrollToRect(t){const i=this.viewportBounds;if(i.containsRect(t))return;const e=t.center;e.x-=i.width/2,e.y-=i.height/2,this.position=e}centerRect(t){const i=this.viewportBounds,e=t.center;e.x-=i.width/2,e.y-=i.height/2,this.position=e}transformDocToView(t){return t.copy().D(this.D)}transformViewToDoc(t){return t.copy().Ie(this.D)}TF(t){return t.Ie(this.D)}static None=1;static Uniform=2;static UniformToFill=3;static CycleAll=1;static CycleNotDirected=2;static CycleNotDirectedFast=3;static CycleNotUndirected=4;static CycleDestinationTree=5;static CycleSourceTree=6;static DocumentScroll=1;static InfiniteScroll=2;static TreeParentCollapsed=1;static AllParentsCollapsed=2;static AnyParentsCollapsed=3;get opacity(){return this.Jt}set opacity(t){const i=this.Jt;i!==t&&(Util.i(t,"number",Diagram,"opacity"),(t<0||t>1)&&Util._(t,"0 <= value <= 1",Diagram,"opacity"),this.Jt=t,this.t("opacity",i,t),this.C())}get validCycle(){return this.Rx}set validCycle(t){const i=this.Rx;i!==t&&(this.Rx=t,this.t("validCycle",i,t))}get layers(){return this.jt.iterator}get isModelReadOnly(){const t=this.Mi;return t===null?!1:t.isReadOnly}set isModelReadOnly(t){const i=this.Mi;i!==null&&(i.isReadOnly=t)}get isReadOnly(){return this.Ro}set isReadOnly(t){const i=this.Ro;i!==t&&(Util.i(t,"boolean",Diagram,"isReadOnly"),this.Ro=t,this.t("isReadOnly",i,t))}get isEnabled(){return this.Ii}set isEnabled(t){const i=this.Ii;i!==t&&(Util.i(t,"boolean",Diagram,"isEnabled"),this.Ii=t,this.t("isEnabled",i,t))}get allowClipboard(){return this.Vx}set allowClipboard(t){const i=this.Vx;i!==t&&(Util.i(t,"boolean",Diagram,"allowClipboard"),this.Vx=t,this.t("allowClipboard",i,t))}get allowCopy(){return this.Fl}set allowCopy(t){const i=this.Fl;i!==t&&(Util.i(t,"boolean",Diagram,"allowCopy"),this.Fl=t,this.t("allowCopy",i,t))}get allowDelete(){return this.Rl}set allowDelete(t){const i=this.Rl;i!==t&&(Util.i(t,"boolean",Diagram,"allowDelete"),this.Rl=t,this.t("allowDelete",i,t))}get allowDragOut(){return this.zx}set allowDragOut(t){const i=this.zx;i!==t&&(Util.i(t,"boolean",Diagram,"allowDragOut"),this.zx=t,this.t("allowDragOut",i,t))}get allowDrop(){return this.Xx}set allowDrop(t){const i=this.Xx;i!==t&&(Util.i(t,"boolean",Diagram,"allowDrop"),this.Xx=t,this.t("allowDrop",i,t))}get allowTextEdit(){return this.vl}set allowTextEdit(t){const i=this.vl;i!==t&&(Util.i(t,"boolean",Diagram,"allowTextEdit"),this.vl=t,this.t("allowTextEdit",i,t))}get allowGroup(){return this.Ol}set allowGroup(t){const i=this.Ol;i!==t&&(Util.i(t,"boolean",Diagram,"allowGroup"),this.Ol=t,this.t("allowGroup",i,t))}get allowUngroup(){return this.Il}set allowUngroup(t){const i=this.Il;i!==t&&(Util.i(t,"boolean",Diagram,"allowUngroup"),this.Il=t,this.t("allowUngroup",i,t))}get allowInsert(){return this.Kx}set allowInsert(t){const i=this.Kx;i!==t&&(Util.i(t,"boolean",Diagram,"allowInsert"),this.Kx=t,this.t("allowInsert",i,t))}get allowLink(){return this.El}set allowLink(t){const i=this.El;i!==t&&(Util.i(t,"boolean",Diagram,"allowLink"),this.El=t,this.t("allowLink",i,t))}get allowRelink(){return this.Bl}set allowRelink(t){const i=this.Bl;i!==t&&(Util.i(t,"boolean",Diagram,"allowRelink"),this.Bl=t,this.t("allowRelink",i,t))}get allowMove(){return this.Ul}set allowMove(t){const i=this.Ul;i!==t&&(Util.i(t,"boolean",Diagram,"allowMove"),this.Ul=t,this.t("allowMove",i,t))}get allowReshape(){return this.Vl}set allowReshape(t){const i=this.Vl;i!==t&&(Util.i(t,"boolean",Diagram,"allowReshape"),this.Vl=t,this.t("allowReshape",i,t))}get allowResize(){return this.zl}set allowResize(t){const i=this.zl;i!==t&&(Util.i(t,"boolean",Diagram,"allowResize"),this.zl=t,this.t("allowResize",i,t))}get allowRotate(){return this.Xl}set allowRotate(t){const i=this.Xl;i!==t&&(Util.i(t,"boolean",Diagram,"allowRotate"),this.Xl=t,this.t("allowRotate",i,t))}get allowSelect(){return this.Kl}set allowSelect(t){const i=this.Kl;i!==t&&(Util.i(t,"boolean",Diagram,"allowSelect"),this.Kl=t,this.t("allowSelect",i,t))}get allowUndo(){return this.Yx}set allowUndo(t){const i=this.Yx;i!==t&&(Util.i(t,"boolean",Diagram,"allowUndo"),this.Yx=t,this.t("allowUndo",i,t))}get allowZoom(){return this.Gx}set allowZoom(t){const i=this.Gx;i!==t&&(Util.i(t,"boolean",Diagram,"allowZoom"),this.Gx=t,this.t("allowZoom",i,t))}get hasVerticalScrollbar(){return this.Iu}set hasVerticalScrollbar(t){const i=this.Iu;i!==t&&(Util.i(t,"boolean",Diagram,"hasVerticalScrollbar"),this.Iu=t,this.ra(),this.C(),this.t("hasVerticalScrollbar",i,t),this.Us(!1))}get hasHorizontalScrollbar(){return this.Ou}set hasHorizontalScrollbar(t){const i=this.Ou;i!==t&&(Util.i(t,"boolean",Diagram,"hasHorizontalScrollbar"),this.Ou=t,this.ra(),this.C(),this.t("hasHorizontalScrollbar",i,t),this.Us(!1))}get allowHorizontalScroll(){return this.jx}set allowHorizontalScroll(t){const i=this.jx;i!==t&&(Util.i(t,"boolean",Diagram,"allowHorizontalScroll"),this.jx=t,this.t("allowHorizontalScroll",i,t),this.Us(!1))}get allowVerticalScroll(){return this.Hx}set allowVerticalScroll(t){const i=this.Hx;i!==t&&(Util.i(t,"boolean",Diagram,"allowVerticalScroll"),this.Hx=t,this.t("allowVerticalScroll",i,t),this.Us(!1))}get scrollHorizontalLineChange(){return this.qx}set scrollHorizontalLineChange(t){const i=this.qx;i!==t&&(Util.i(t,"number",Diagram,"scrollHorizontalLineChange"),t<0&&Util._(t,">= 0",Diagram,"scrollHorizontalLineChange"),this.qx=t,this.t("scrollHorizontalLineChange",i,t))}get scrollVerticalLineChange(){return this.Wx}set scrollVerticalLineChange(t){const i=this.Wx;i!==t&&(Util.i(t,"number",Diagram,"scrollVerticalLineChange"),t<0&&Util._(t,">= 0",Diagram,"scrollVerticalLineChange"),this.Wx=t,this.t("scrollVerticalLineChange",i,t))}get lastInput(){return this.$h}set lastInput(t){this.$h=t}get previousInput(){return this.Xr}set previousInput(t){this.Xr=t}get firstInput(){return this.Jm}set firstInput(t){this.Jm=t}get currentCursor(){return this.vx}set currentCursor(t){if(t===""&&(t=this.Ym),this.vx!==t){Util.i(t,"string",Diagram,"currentCursor");const e=this.dt,s=this.Tt;if(e===null||s===null)return;this.vx=t;const n=e.style.cursor;e.style.cursor=t,s.style.cursor=t,e.style.cursor===n&&(e.style.cursor="-webkit-"+t,s.style.cursor="-webkit-"+t,e.style.cursor===n&&(e.style.cursor="-moz-"+t,s.style.cursor="-moz-"+t,e.style.cursor===n&&(e.style.cursor=t,s.style.cursor=t)))}}get defaultCursor(){return this.Ym}set defaultCursor(t){t===""&&(t="auto");const i=this.Ym;i!==t&&(Util.i(t,"string",Diagram,"defaultCursor"),this.Ym=t,this.t("defaultCursor",i,t))}get click(){return this.Tr}set click(t){const i=this.Tr;i!==t&&(t!==null&&Util.i(t,"function",Diagram,"click"),this.Tr=t,this.t("click",i,t))}get doubleClick(){return this.Dr}set doubleClick(t){const i=this.Dr;i!==t&&(t!==null&&Util.i(t,"function",Diagram,"doubleClick"),this.Dr=t,this.t("doubleClick",i,t))}get contextClick(){return this.Fr}set contextClick(t){const i=this.Fr;i!==t&&(t!==null&&Util.i(t,"function",Diagram,"contextClick"),this.Fr=t,this.t("contextClick",i,t))}get mouseOver(){return this.Rr}set mouseOver(t){const i=this.Rr;i!==t&&(t!==null&&Util.i(t,"function",Diagram,"mouseOver"),this.Rr=t,this.t("mouseOver",i,t))}get mouseHover(){return this.vr}set mouseHover(t){const i=this.vr;i!==t&&(t!==null&&Util.i(t,"function",Diagram,"mouseHover"),this.vr=t,this.t("mouseHover",i,t))}get mouseHold(){return this.Or}set mouseHold(t){const i=this.Or;i!==t&&(t!==null&&Util.i(t,"function",Diagram,"mouseHold"),this.Or=t,this.t("mouseHold",i,t))}get mouseDragOver(){return this.Ox}set mouseDragOver(t){const i=this.Ox;i!==t&&(t!==null&&Util.i(t,"function",Diagram,"mouseDragOver"),this.Ox=t,this.t("mouseDragOver",i,t))}get mouseDrop(){return this.Ir}set mouseDrop(t){const i=this.Ir;i!==t&&(this.Ir=t,this.t("mouseDrop",i,t))}get handlesDragDropForTopLevelParts(){return this.Ix}set handlesDragDropForTopLevelParts(t){const i=this.Ix;i!==t&&(Util.i(t,"boolean",Diagram,"handlesDragDropForTopLevelParts"),this.Ix=t,this.t("handlesDragDropForTopLevelParts",i,t))}get mouseEnter(){return this.Er}set mouseEnter(t){const i=this.Er;i!==t&&(t!==null&&Util.i(t,"function",Diagram,"mouseEnter"),this.Er=t,this.t("mouseEnter",i,t))}get mouseLeave(){return this.Br}set mouseLeave(t){const i=this.Br;i!==t&&(t!==null&&Util.i(t,"function",Diagram,"mouseLeave"),this.Br=t,this.t("mouseLeave",i,t))}get toolTip(){return this.Ur}set toolTip(t){const i=this.Ur;i!==t&&(this.Ur=t,this.t("toolTip",i,t))}get contextMenu(){return this.Vr}set contextMenu(t){const i=this.Vr;i!==t&&(this.Vr=t,this.t("contextMenu",i,t))}get commandHandler(){return this.qM}set commandHandler(t){this.qM!==t&&(this.qM=t,t.Ao(this))}get toolManager(){return this.GM}set toolManager(t){this.GM!==t&&(this.GM=t,t.diagram=this)}get defaultTool(){return this.jM}set defaultTool(t){const i=this.jM;i!==t&&(this.jM=t,t.diagram=this,this.currentTool===i&&(this.currentTool=t))}get currentTool(){return this.HM}set currentTool(t){const i=this.HM;i&&(i.isActive&&i.doDeactivate(),i.cancelWaitAfter(),i.doStop()),t===null&&(t=this.defaultTool),t!==null&&(this.HM=t,t.diagram=this,t.doStart())}get selection(){return this.tS}get maxSelectionCount(){return this.Qx}set maxSelectionCount(t){const i=this.Qx;if(i!==t)if(Util.i(t,"number",Diagram,"maxSelectionCount"),t>=0&&!isNaN(t)){if(this.Qx=t,this.t("maxSelectionCount",i,t),!this.undoManager.isUndoingRedoing){const e=this.selection.count-t;if(e>0){this.v("ChangingSelection",this.selection);const s=this.selection.toArray();for(let n=0;n<e;n++)s[n].isSelected=!1;this.v("ChangedSelection",this.selection)}}}else Util._(t,">= 0",Diagram,"maxSelectionCount")}get nodeSelectionAdornmentTemplate(){return this.qm}set nodeSelectionAdornmentTemplate(t){const i=this.qm;i!==t&&(this.qm=t.Vt(),this.t("nodeSelectionAdornmentTemplate",i,t))}get groupSelectionAdornmentTemplate(){return this.ib}set groupSelectionAdornmentTemplate(t){const i=this.ib;i!==t&&(this.ib=t.Vt(),this.t("groupSelectionAdornmentTemplate",i,t))}get linkSelectionAdornmentTemplate(){return this.eb}set linkSelectionAdornmentTemplate(t){const i=this.eb;i!==t&&(this.eb=t.Vt(),this.t("linkSelectionAdornmentTemplate",i,t))}get highlighteds(){return this.iS}get isModified(){const t=this.undoManager;return t.isEnabled?t.currentTransaction!==null?!0:this.Vu&&this.vs!==t.historyIndex:this.Vu}set isModified(t){if(this.Vu!==t){Util.i(t,"boolean",Diagram,"isModified"),this.Vu=t;const e=this.undoManager;!t&&e.isEnabled&&(this.vs=e.historyIndex),t||this.EL()}}EL(){const t=this.isModified;this.QM!==t&&(this.QM=t,this.v("Modified"))}get model(){return this.Mi}set model(t){const i=this.Mi;if(i!==t){this.currentTool.doCancel(),i&&i.undoManager!==t.undoManager&&i.undoManager.isInTransaction&&Util.o("Do not replace a Diagram.model while a transaction is in progress."),this.animationManager.stopAnimation(!0);const e=this.yL(!0);this.Jn=!1,this.vu=!0,this.vs=-2,this.Pr=!1;const s=this.qt;this.qt=!0,this.animationManager.Dl("Model"),i&&(this.qn!==null&&this.qn.each(n=>i.removeChangedListener(n)),i.removeChangedListener(this.ZM)),this.Mi=t,this.partManager=this.uR(this.Mi.type),this.initializePartManager(this.partManager);for(let n=0;n<e.length;n++)this.add(e[n]);t.addChangedListener(this.$M),this.partManager.AS(),t.removeChangedListener(this.$M),t.addChangedListener(this.ZM),this.qn!==null&&this.qn.each(n=>t.addChangedListener(n)),this.qt=s,this.invalidateDocumentBounds(),this.qt||this.C(),i&&t.undoManager.copyProperties(i.undoManager)}}get themeManager(){return this.gb}set themeManager(t){const i=this.gb;i!==t&&(i!==null&&i.removeDiagram(this),this.gb=t,t!==null&&t.addDiagram(this))}initializePartManager(t){}static mS(t,i){Diagram.fL.set(t,i)}static get licenseKey(){return Diagram.TS.last()}static set licenseKey(t){Diagram.TS.add(t.replace(/\s/g,""))}static get version(){return Diagram.dR}static TS=new List;static dR="3.0.14";uR(t){const i=Diagram.fL.get(t);return i!==null?new i:new PartManager}get Y(){return this.JM}set Y(t){this.JM=t}get mx(){return this.hL}gR(t){if(t.model!==this.model)return;const i=t.change,e=t.propertyName;if(i===1&&e[0]==="S"){if(e==="StartingFirstTransaction"){const s=this,n=this.toolManager;n.mouseDownTools.each(o=>o.diagram=s),n.mouseMoveTools.each(o=>o.diagram=s),n.mouseUpTools.each(o=>o.diagram=s),this.routers.each(o=>o.diagram=s),!this.ps&&!this.Jn&&(this.Oc=!0,this.vu&&(this.Pr=!0))}else if(e==="StartingUndo"||e==="StartingRedo"){const s=this.animationManager;this.skipsUndoManager||(s.defaultAnimation.isAnimating&&s.stopAnimation(),s.getBundleAnimation().isAnimating&&s.getBundleAnimation().stop()),this.v("ChangingSelection",this.selection)}else if(e==="StartedTransaction"){const s=this.animationManager;s.defaultAnimation.isAnimating&&!this.skipsUndoManager&&s.stopAnimation()}return}if(this.Y){this.Y=!1;try{if(t.modelChange===""&&i===1){(e==="FinishedUndo"||e==="FinishedRedo")&&(this.v("ChangedSelection",this.selection),this.Ci());const s=this.animationManager;e==="RolledBackTransaction"&&s.stopAnimation(),this.eL(),this.Oc=!0,this.maybeUpdate(),(this.undoManager.transactionLevel===0||this.undoManager.transactionLevel===1)&&s.SM(),e==="CommittedTransaction"&&this.undoManager.isJustDiscarded&&(this.vs=Math.min(this.vs,this.undoManager.historyIndex-1)),(e==="CommittedTransaction"||e==="RolledBackTransaction")&&this.undoManager.Ow&&setTimeout(()=>{this.isModified=!1},1);const n=t.isTransactionFinished;if(n&&(this.EL(),this.mx.clear(),this.animationManager.dF()),!this.Ex&&n&&this.lastInput.targetDiagram){this.Ex=!0;const o=this;Util.Oh(()=>{o.currentTool.standardMouseOver(),o.Ex=!1},10)}}}finally{this.Y=!0}}}get fe(){return this.WM}set fe(t){this.WM=t}get dc(){return this.Bx}set dc(t){this.Bx=t}CL(t){const i=t.L.r;for(const e of i)e instanceof Picture&&this.DS(e)}DS(t){const i=t.element;if(i===null||!(i instanceof HTMLImageElement)||(i.ss instanceof GSet&&i.ss.add(this),t.mR(),!i.f0))return;const e=i.getAttribute("src")||"",s=this.Wl.get(e);if(s===null){Picture.BL(t,i);const n=[];n.push(t),this.Wl.set(e,n)}else{for(let n=0;n<s.length;n++)if(s[n]===t)return;s.push(t)}}pR(t){const i=t.L.r,e=i.length;for(let s=0;s<e;s++)this.FS(i[s])}FS(t){if(!(t instanceof Picture))return;const i=t.element;if(i===null||!(i instanceof HTMLImageElement)||!i.f0)return;const e=i.getAttribute("src")||"",s=this.Wl.get(e);if(s!==null){for(let n=0;n<s.length;n++)if(s[n]===t){s.splice(n,1),s.length===0&&(this.Wl.delete(e),Picture.yR(i),i.ss instanceof GSet&&i.ss.delete(this),Picture.clearCache(e));return}}}wL(){Picture.clearCache(),this.Wl.clear()}rebuildParts(){this.partManager.rebuildParts()}Lc(t,i){this.ds.Lc(t,i)}Cc(t,i){this.ds.Cc(t,i)}findPartForKey(t){return this.partManager.findPartForKey(t)}findNodeForKey(t){return this.partManager.findNodeForKey(t)}findLinkForKey(t){return this.partManager.findLinkForKey(t)}findPartForData(t){return this.partManager.findPartForData(t)}findNodeForData(t){return this.partManager.findNodeForData(t)}findLinkForData(t){return this.partManager.findLinkForData(t)}findNodesByExample(...t){return this.partManager.findNodesByExample(...t)}findLinksByExample(...t){return this.partManager.findLinksByExample(...t)}get nodeTemplate(){return this.zr.get("")}set nodeTemplate(t){const i=this.zr.get("");i!==t&&(this.zr.set("",t),this.t("nodeTemplate",i,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get nodeTemplateMap(){return this.zr}set nodeTemplateMap(t){const i=this.zr;i!==t&&(this.zr=t,this.t("nodeTemplateMap",i,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get groupTemplate(){return this.Jh.get("")}set groupTemplate(t){const i=this.Jh.get("");i!==t&&(this.Jh.set("",t),this.t("groupTemplate",i,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get groupTemplateMap(){return this.Jh}set groupTemplateMap(t){const i=this.Jh;i!==t&&(this.Jh=t,this.t("groupTemplateMap",i,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get linkTemplate(){return this.Hl.get("")}set linkTemplate(t){const i=this.Hl.get("");i!==t&&(this.Hl.set("",t),this.t("linkTemplate",i,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get linkTemplateMap(){return this.Hl}set linkTemplateMap(t){const i=this.Hl;i!==t&&(this.Hl=t,this.t("linkTemplateMap",i,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get isMouseCaptured(){return this._M}set isMouseCaptured(t){const i=this.dt;if(i===null)return;const e=i.Ft;e instanceof SVGElement||(t?(this.lastInput.bubbles=!1,this.Si(e,"pointermove",this.ia,!1),this.Si(e,"pointerdown",this.$l,!1),this.Si(e,"pointerup",this.ea,!1),this.Si(e,"pointerout",this.sa,!1),this.Si(e,"pointercancel",this.na,!1),this.zt(root,"pointermove",this.ia,!0),this.zt(root,"pointerdown",this.$l,!0),this.zt(root,"pointerup",this.ea,!0),this.zt(root,"pointerout",this.sa,!0),this.zt(root,"pointercancel",this.na,!0),this.Si(e,"wheel",this.ta,!1),this.zt(root,"wheel",this.ta,!0),this.zt(root,"selectstart",this.Yh,!1)):(this.Si(root,"pointermove",this.ia,!0),this.Si(root,"pointerdown",this.$l,!0),this.Si(root,"pointerup",this.ea,!0),this.Si(root,"pointerout",this.sa,!0),this.Si(root,"pointercancel",this.na,!0),this.zt(e,"pointermove",this.ia,!1),this.zt(e,"pointerdown",this.$l,!1),this.zt(e,"pointerup",this.ea,!1),this.zt(e,"pointerout",this.sa,!1),this.zt(e,"pointercancel",this.na,!1),this.Si(root,"wheel",this.ta,!0),this.Si(root,"selectstart",this.Yh,!1),this.zt(e,"wheel",this.ta,!1)),this._M=t)}get position(){return this.at}set position(t){if(this.at.equals(t))return;const i=Point.l().a(this.at),e=this.viewportBounds.copy();if(this.at.a(t),this.animationManager._C(i,this.at),!this.qt&&!(this.dt===null&&!this.Bu.isReal())){this.qt=!0;const s=this.scale,n=this.kt/s,o=this.Pt/s;this.xS(this.Hm,n,o,this.Rc,!1),this.qt=!1}else this.Zl(),this.pb();if(!this.qt){const s=this.viewportBounds;this.onViewportBoundsChanged(e,s,this.et,!1)}Point.s(i)}get initialPosition(){return this.xx}set initialPosition(t){this.xx.equals(t)||(this.xx=t.N())}get initialScale(){return this.bx}set initialScale(t){this.bx!==t&&(Util.i(t,"number",Diagram,"initialScale"),this.bx=t)}get grid(){return this.is===null&&(this.is=this.bL()),this.is}set grid(t){let i=this.is;if(i!==t){i===null&&(this.is=this.bL(),i=this.is),t.type!==Panel.Grid&&Util.o("Diagram.grid must be a Panel of type Panel.Grid");const e=i.panel;e!==null&&e.remove(i),this.is=t,t.name="GRID",e!==null&&e.add(t),this.Uu=!1,this.C(),this.t("grid",i,t)}}get viewportBounds(){return this._x}Zl(){const t=this._x,i=this.at,e=this.et;t.e(i.x,i.y,Math.max(this.kt,0)/e,Math.max(this.Pt,0)/e),this.Ql()}get viewSize(){return this.Bu}set viewSize(t){const i=this.viewSize;if(!i.equals(t)){t=t.N(),this.Bu=t;let e=0,s=0;t.isReal()?(e=t.width,s=t.height):this.Tt!==null&&(e=this.Tt.clientWidth||1,s=this.Tt.clientHeight||1),this.kt=e,this.Pt=s,this.Zl(),this.invalidateDocumentBounds(),this.t("viewSize",i,t),this.C()}}get fixedBounds(){return this.Sx}set fixedBounds(t){const i=this.Sx;i.equals(t)||((t.width===-1/0||t.height===1/0||t.height===-1/0)&&Util.o("fixedBounds width/height must not be Infinity"),t=t.N(),this.Sx=t,this.invalidateDocumentBounds(),this.t("fixedBounds",i,t))}get scrollMargin(){return this.Fc}set scrollMargin(t){typeof t=="number"&&(t=new Margin(t));const i=this.Fc;i.equals(t)||(t=t.N(),this.Fc=t,this.t("scrollMargin",i,t),this.yu())}get scrollMode(){return this.jh}set scrollMode(t){const i=this.jh;i!==t&&(this.jh=t,t===1&&this.Us(!1),this.t("scrollMode",i,t),this.ra(),this.C())}get scrollsPageOnFocus(){return this.Nx}set scrollsPageOnFocus(t){const i=this.Nx;i!==t&&(Util.i(t,"boolean",Diagram,"scrollsPageOnFocus"),this.Nx=t,this.t("scrollsPageOnFocus",i,t))}get positionComputation(){return this.Cx}set positionComputation(t){const i=this.Cx;i!==t&&(t!==null&&Util.i(t,"function",Diagram,"positionComputation"),this.Cx=t,this.Us(!1),this.t("positionComputation",i,t))}get scaleComputation(){return this.Lx}set scaleComputation(t){const i=this.Lx;i!==t&&(t!==null&&Util.i(t,"function",Diagram,"scaleComputation"),this.Lx=t,this.IL(this.scale,this.scale),this.t("scaleComputation",i,t))}get documentBounds(){return this.Hm}UL(t){this.Zh=!1;let i=this.Hm;i.equals(t)||(i=i.copy(),this.Hm.a(t),this.Us(!1),this.v("DocumentBoundsChanged",void 0,i),this.ra(),this.C())}ensureBounds(){if(this.Zh){const t=Rect.l();this.UL(this.computeBounds(t)),Rect.s(t)}}get isVirtualized(){return this.tb}set isVirtualized(t){const i=this.tb;i!==t&&(Util.i(t,"boolean",Diagram,"isVirtualized"),this.tb=t,this.t("isVirtualized",i,t))}get scale(){return this.et}set scale(t){const i=this.et;i!==t&&this.IL(i,t)}get defaultScale(){return this.$m}set defaultScale(t){this.$m=t}get autoScale(){return this.Gl}set autoScale(t){const i=this.Gl;i!==t&&(this.Gl=t,this.t("autoScale",i,t),t!==1&&this.Us(!1))}get initialAutoScale(){return this.Cr}set initialAutoScale(t){const i=this.Cr;i!==t&&(this.Cr=t,this.t("initialAutoScale",i,t))}get initialViewportSpot(){return this.Tx}set initialViewportSpot(t){const i=this.Tx;i!==t&&(t.isSpot()||Util.o("initialViewportSpot must be a specific Spot: "+t),this.Tx=t,this.t("initialViewportSpot",i,t))}get initialDocumentSpot(){return this.Ax}set initialDocumentSpot(t){const i=this.Ax;i!==t&&(t.isSpot()||Util.o("initialViewportSpot must be a specific Spot: "+t),this.Ax=t,this.t("initialDocumentSpot",i,t))}get minScale(){return this.kx}set minScale(t){const i=this.kx;i!==t&&(t>0?(this.kx=t,this.t("minScale",i,t),t>this.scale&&(this.scale=t)):Util._(t,"> 0",Diagram,"minScale"))}get maxScale(){return this.Px}set maxScale(t){const i=this.Px;i!==t&&(t>0?(this.Px=t,this.t("maxScale",i,t),t<this.scale&&(this.scale=t)):Util._(t,"> 0",Diagram,"maxScale"))}get zoomPoint(){return this.Mx}set zoomPoint(t){this.Mx.equals(t)||(t=t.N(),this.Mx=t)}get contentAlignment(){return this.Rc}set contentAlignment(t){const i=this.Rc;i.equals(t)||(t=t.N(),this.Rc=t,this.t("contentAlignment",i,t),this.Us(!1))}get initialContentAlignment(){return this.zm}set initialContentAlignment(t){const i=this.zm;i.equals(t)||(t=t.N(),this.zm=t,this.t("initialContentAlignment",i,t))}get padding(){return this.Zt}set padding(t){typeof t=="number"&&(t=new Margin(t));const i=this.Zt;i.equals(t)||(t=t.N(),this.Zt=t,this.invalidateDocumentBounds(),this.t("padding",i,t))}get partManager(){return this.rS}set partManager(t){const i=this.rS;i!==t&&(t.diagram!==null&&Util.o("Cannot share PartManagers between Diagrams: "+t.toString()),i&&i.Ao(null),this.rS=t,t.Ao(this))}get nodes(){return this.partManager.nodes.iterator}get links(){return this.partManager.links.iterator}get parts(){return this.partManager.parts.iterator}findTopLevelNodesAndLinks(){const t=new GSet,i=this.nodes;for(;i.next();){const s=i.value;s.isTopLevel&&t.add(s)}const e=this.links;for(;e.next();){const s=e.value;s.isTopLevel&&t.add(s)}return t.iterator}findTopLevelGroups(){return this.Yr.iterator}get routers(){return this.zc}doLinkRouting(t){this.Do=!0;const i=this.zc.r;for(let e=0;e<i.length;e++)i[e].canRoute(t)&&i[e].routeLinks(this.Lr,t);this.Do=!1}get layout(){return this.ie}set layout(t){const i=this.ie;i!==t&&(this.ie=t,t.diagram=this,t.group=null,this.Kr=!0,this.t("layout",i,t),this.requestUpdate())}layoutDiagram(t){this.Ci(),t&&this.bb(!0),this.ps?this.PS(!1,this.xl||this.zc.count!==0&&this.Hn.size!==0):(this.Oc=!0,this.pr())}bb(t){const i=this.Yr.iterator;for(;i.next();)this.VL(i.value,t);this.layout&&(t?this.layout.isValidLayout=!1:this.layout.invalidateLayout())}VL(t,i){if(t===null)return;const e=t.la.iterator;for(;e.next();){const s=e.value;this.VL(s,i)}t.layout!==null&&(i?t.layout.isValidLayout=!1:t.layout.invalidateLayout())}PS(t,i){if(this.Ux)return;const e=this.Y;this.Y=!0;const s="Layout",n=this.undoManager.transactionLevel,o=this.layout,r=this.animationManager;try{n===0&&(this.undoManager.wl=!0,this.startTransaction(s)),n<=1&&!r.defaultAnimation.isAnimating&&!r.wi&&(t||r.Dl(s)),this.Kr=!1;let l=this.Yr.iterator;for(;l.next();)this.zL(l.value,t,n,i);let h=!1;if(o.isValidLayout||(!t||o.isRealtime||o.isRealtime===null||n===0?(o.doLayout(this),this.l0(this),h=!0,o.isValidLayout=!0):this.Kr=!0),h||this.l0(this),this.doLinkRouting(this),this.Lr.clear(),this.Wh.size!==0){for(let a=0;a<23&&this.Wh.size!==0;a++){for(l=this.Yr.iterator;l.next();)this.XL(l.value);const c=this.Lr;this.Lr=this.Wh,this.Wh=c,this.l0(this),this.doLinkRouting(this)}this.Lr.clear(),this.Wh.clear()}}finally{const l=this.undoManager.wl;n===0&&(this.commitTransaction(s),this.undoManager.wl=!1),l&&(n===0||n===1)&&r.SM(),this.Kr&&(this.Kr=!o.isValidLayout),this.Y=e}}zL(t,i,e,s){const n=t.la.iterator;for(;n.next();)this.zL(n.value,i,e,s);const o=t.layout;o!==null&&!o.isValidLayout?!i||o.isRealtime||e===0?(t.Wr=!t.location.isReal(),o.doLayout(t),t.invalidateLayout(32),this.yb(t),this.l0(t),this.doLinkRouting(t),o.isValidLayout=!0):(this.doLinkRouting(t),this.Kr=!0):s&&this.doLinkRouting(t)}XL(t){const i=t.la.iterator;for(;i.next();)this.XL(i.value);this.l0(t),this.doLinkRouting(t)}get isTreePathToChildren(){return this.Dx}set isTreePathToChildren(t){const i=this.Dx;if(i!==t&&(Util.i(t,"boolean",Diagram,"isTreePathToChildren"),this.Dx=t,this.t("isTreePathToChildren",i,t),!this.undoManager.isUndoingRedoing)){const e=this.nodes;for(;e.next();)e.value.u0()}}findTreeRoots(){const t=new List,i=this.nodes;for(;i.next();){const e=i.value;e.isTopLevel&&e.findTreeParentLink()===null&&t.add(e)}return t.iterator}get treeCollapsePolicy(){return this.Fx}set treeCollapsePolicy(t){const i=this.Fx;i!==t&&(t!==1&&t!==2&&t!==3&&Util.o("Unknown Diagram.treeCollapsePolicy: "+t),this.Fx=t,this.t("treeCollapsePolicy",i,t))}get isCollapsingExpanding(){return this.YM}set isCollapsingExpanding(t){this.YM=t}VF(){const t=new GMap,i=new GMap;function e(s){const n=s.toLowerCase(),o=new List;t.set(s,o),t.set(n,o),i.set(s,s),i.set(n,s)}e("InitialAnimationStarting"),e("AnimationStarting"),e("AnimationFinished"),e("BackgroundSingleClicked"),e("BackgroundDoubleClicked"),e("BackgroundContextClicked"),e("ClipboardChanged"),e("ClipboardPasted"),e("DocumentBoundsChanged"),e("ExternalObjectsDropped"),e("GainedFocus"),e("InitialLayoutCompleted"),e("LayoutCompleted"),e("LinkDrawn"),e("LinkRelinked"),e("LinkReshaped"),e("LostFocus"),e("Modified"),e("ObjectSingleClicked"),e("ObjectDoubleClicked"),e("ObjectContextClicked"),e("PartCreated"),e("PartResized"),e("PartRotated"),e("SelectionMoved"),e("SelectionCopied"),e("SelectionDeleting"),e("SelectionDeleted"),e("SelectionGrouped"),e("SelectionUngrouped"),e("ChangingSelection"),e("ChangedSelection"),e("SubGraphCollapsed"),e("SubGraphExpanded"),e("TextEdited"),e("ThemeChanged"),e("TreeCollapsed"),e("TreeExpanded"),e("ViewportBoundsChanged"),e("InvalidateDraw"),this.XM=t,this.KM=i}NL(t){const i=this.KM.get(t);return i!==null?i:this.KM.get(t.toLowerCase())}RS(t){let i=this.XM.get(t);if(i!==null)return i;const e=t.toLowerCase();if(i=this.XM.get(e),i!==null)return i;Util.o("Unknown DiagramEvent name: "+t)}addDiagramListener(t,i){Util.i(t,"string",Diagram,"addDiagramListener:name"),Util.i(i,"function",Diagram,"addDiagramListener:listener");const e=this.RS(t);return e!==null&&e.add(i),this}removeDiagramListener(t,i){Util.i(t,"string",Diagram,"removeDiagramListener:name"),Util.i(i,"function",Diagram,"addDiagramListener:listener");const e=this.RS(t);e!==null&&e.delete(i)}raiseDiagramEvent(t,i,e){this.v(t,i,e)}v(t,i,e){const s=this.RS(t),n=new DiagramEvent;n.diagram=this;const o=this.NL(t);o!==null&&(n.name=o),i!==void 0&&(n.subject=i),e!==void 0&&(n.parameter=e);const r=s.length;if(r===1)s.elt(0)(n);else if(r!==0){const l=s.toArray();for(let h=0;h<r;h++){const a=l[h];a(n)}}}isUnoccupied(t,i){return this.getPositions(!1,null,i||null).isUnoccupied(t.x,t.y,t.width,t.height)}computeOccupiedArea(t){return this.isVirtualized?this.viewportBounds.copy():this.Zh?this.PL(t):t.a(this.documentBounds)}getPositions(t,i,e){let s=this.jl;s===null&&(this.jl=s=new PositionArray(this.avoidanceCellSize));let n=i;if(s.Io||s.ha!==n||s.vS!==e){if(s.OS=Math.max(s.Gc+1,Math.floor(this.avoidanceLimit/this.avoidanceCellSize.width)),s.IS=Math.max(s.Gc+1,Math.floor(this.avoidanceLimit/this.avoidanceCellSize.height)),n!==null&&(n=this.KL(n)),n===null){const o=Rect.l();this.computeOccupiedArea(o),o.inflate(100,100),s.kb(o);const r=this.nodes;for(;r.next();){const l=r.value,h=l.layer;h===null||!h.visible||h.isTemporary||this.ES(l,e,o)}Rect.s(o)}else{if(n.memberParts.count>0){const l=this.computePartsBounds(n.memberParts,!1);l.inflate(20,20),s.kb(l)}const o=Rect.l(),r=n.memberParts;for(;r.next();){const l=r.value;l instanceof Node&&this.ES(l,e,o)}Rect.s(o)}s.ha=n,s.vS=e,s.Io=!1}else t&&s.YL();return s}get avoidanceCellSize(){return this.eS}set avoidanceCellSize(t){this.jl=null,this.eS=new Size(Math.max(1,t.width),Math.max(1,t.height))}get avoidanceLimit(){return this.sS}set avoidanceLimit(t){this.sS=Math.max(1,t)}KL(t){return t.canAvoid()?t:t.containingGroup!==null?this.KL(t.containingGroup):null}ES(t,i,e){if(t===i||!t.isVisible())return;const s=t.canAvoid();if(s){const n=t.getAvoidableRect(e);this.jl.wR(n.x,n.y,n.width,n.height)}if(t instanceof Group&&(!s||t.avoidableMembers)){const n=t.memberParts;for(;n.next();){const o=n.value;o instanceof Node&&this.ES(o,i,e)}}}BS(t){this.jl!==null&&!this.jl.Io&&(t===void 0||t.canAvoid())&&(this.jl.Io=!0)}get autoScrollInterval(){return this.Xm}set autoScrollInterval(t){const i=this.Xm;i!==t&&(this.Xm=t,this.t("autoScrollInterval",i,t))}get autoScrollRegion(){return this.Km}set autoScrollRegion(t){typeof t=="number"&&(t=new Margin(t));const i=this.Km;i.equals(t)||(t=t.N(),this.Km=t,this.invalidateDocumentBounds(),this.t("autoScrollRegion",i,t))}doAutoScroll(t){this.Wm.a(t),this.computeAutoScrollPosition(this.Wm).equalsApprox(this.position)?this.stopAutoScroll():this.GL()}GL(){if(this.vc!==-1)return;const t=this.Xm,i=this;this.vc=Util.Oh(()=>{if(i.vc===-1||(i.stopAutoScroll(),i.lastInput.event===null))return;const s=i.computeAutoScrollPosition(i.Wm);if(s.equalsApprox(i.position))return;i.position=s,i.lastInput.documentPoint=i.transformViewToDoc(i.Wm),i.doMouseMove(),i.Zh=!0;const n=Rect.l();i.computeBounds(n),n.unionRect(i.documentBounds),i.UL(n),Rect.s(n),i.Ue=!0,i.maybeUpdate(),i.GL()},t)}stopAutoScroll(){this.vc!==-1&&(Util.Ig(this.vc),this.vc=-1)}computeAutoScrollPosition(t){let i=this.position;const e=this.Km;if(e.top<=0&&e.left<=0&&e.right<=0&&e.bottom<=0)return i;const s=this.viewportBounds,n=this.scale,o=Rect.X(0,0,s.width*n,s.height*n),r=Point.X(0,0);if(t.x>=o.x&&t.x<o.x+e.left&&this.allowHorizontalScroll){let l=Math.max(this.scrollHorizontalLineChange,1);l=l|0,r.x-=l,t.x<o.x+e.left/2&&(r.x-=l),t.x<o.x+e.left/4&&(r.x-=4*l)}else if(t.x<=o.x+o.width&&t.x>o.x+o.width-e.right&&this.allowHorizontalScroll){let l=Math.max(this.scrollHorizontalLineChange,1);l=l|0,r.x+=l,t.x>o.x+o.width-e.right/2&&(r.x+=l),t.x>o.x+o.width-e.right/4&&(r.x+=4*l)}if(t.y>=o.y&&t.y<o.y+e.top&&this.allowVerticalScroll){let l=Math.max(this.scrollVerticalLineChange,1);l=l|0,r.y-=l,t.y<o.y+e.top/2&&(r.y-=l),t.y<o.y+e.top/4&&(r.y-=4*l)}else if(t.y<=o.y+o.height&&t.y>o.y+o.height-e.bottom&&this.allowVerticalScroll){let l=Math.max(this.scrollVerticalLineChange,1);l=l|0,r.y+=l,t.y>o.y+o.height-e.bottom/2&&(r.y+=l),t.y>o.y+o.height-e.bottom/4&&(r.y+=4*l)}return r.equalsApprox(Point.Po)||(i=new Point(i.x+r.x/n,i.y+r.y/n)),Rect.s(o),Point.s(r),i}makeSvg(t){this.ql.has("SVG")||this.addRenderer("SVG",new SVGSurface(this,root.document));const i=new SVGSurface(this,root.document,!0);t===void 0&&(t={});const e=this;function s(n,o){const r=e.jL(n,"SVG",i),l=r!==null?r.svg:null;return typeof o=="function"?(o(l),null):l}return this.HL(s,t)}makeSVG(t){return this.makeSvg(t)}addRenderer(t,i){this.ql.set(t,i)}removeRenderer(t){this.ql.delete(t)}cacheGroupExternalLinks(t){this.gS=t,t||this.nodes.each(i=>{i instanceof Group&&(i.d0=null)})}HL(t,i){const e=i.callback;let s=!0;const o=this.Wl.iterator;for(;o.next();)if(!o.value[0].mn){s=!1;break}if(typeof e!="function"||s)return t(i,e,this);const r=this;function l(){const c=+new Date;for(s=!0,o.reset();o.next();)if(!o.value[0].mn){s=!1;break}if(s||c-a>h){t(i,e,r);return}root.requestAnimationFrame(l)}const h=i.callbackTimeout||300,a=+new Date;return root.requestAnimationFrame(()=>l()),null}makeImage(t){return Diagram.isUsingDOM()?(t===void 0&&(t={}),t.returnType="Image",this.makeImageData(t)):null}makeImageData(t){return t===void 0&&(t={}),this.HL(this.xR,t)}static img="image";xR(t,i,e){const s=e.jL(t,"canvas",null);if(s===null)return null;const n=s.U.canvas;let o=null;if(n!==null){let r=t.returnType;switch(r===void 0?r="string":r=r.toLowerCase(),r){case Diagram.img+"data":o=s.getImageData(0,0,n.width,n.height);break;case Diagram.img:const h=(t.document||document).createElement("img");h.src=n.toDataURL(t.type,t.details),o=h;break;case"blob":{const a=n;return typeof i!="function"&&(o="",Util.o('Error: Diagram.makeImageData called with "returnType: toBlob", but no required "callback" function property defined.')),typeof a.toBlob=="function"?(a.toBlob(i,t.type,t.details),"toBlob"):(i(null),null)}case"string":default:o=n.toDataURL(t.type,t.details)}}return typeof i=="function"?(i(o),null):o}static bR=!1;jL(t,i,e){if(this.animationManager.stopAnimation(),this.maybeUpdate(),this.dt===null)return null;typeof t!="object"&&Util.o("properties argument must be an Object.");let n=!1,o=t.size||null,r=t.scale||null;t.scale!==void 0&&isNaN(t.scale)&&(r="NaN");let l=t.maxSize;t.maxSize===void 0&&(n=!0,i==="SVG"?l=new Size(1/0,1/0):l=new Size(2e3,2e3));const h=t.position||null;let a=t.parts||null;Array.isArray(a)&&(a=new List(a));let c=t.padding===void 0?1:t.padding;const f=t.background||null;let u=t.omitTemporary;u===void 0&&(u=!0);const d=t.document||document,m=t.elementFinished||null;let g=t.showTemporary;g===void 0&&(g=!u);let p=t.showGrid;p===void 0&&(p=g),o!==null&&isNaN(o.width)&&isNaN(o.height)&&(o=null),typeof c=="number"?c=new Margin(c):c instanceof Margin||Util.o("MakeImage padding must be a Margin or a number."),c.left=Math.max(c.left,0),c.right=Math.max(c.right,0),c.top=Math.max(c.top,0),c.bottom=Math.max(c.bottom,0),this.Qt.clearContextCache(!0);const y=new CanvasSurface(null,d,void 0,!0),x=y.ai;if(!(o||r||a||h))return y.width=this.kt+Math.ceil(c.left+c.right),y.height=this.Pt+Math.ceil(c.top+c.bottom),i==="SVG"?e===null?null:(e.resize(y.width,y.height,y.width,y.height),e.aa=d,e.ju=m,this.wb(e.ai,c,new Size(y.width,y.height),this.et,this.at,a,f,g,p),e.ai):(this.zu=!1,this.wb(x,c,new Size(y.width,y.height),this.et,this.at,a,f,g,p),this.zu=!0,y.ai);const k=this.$m,b=this.documentBounds.copy();if(b.subtractMargin(this.Zt),g){const A=this.jt.r,D=A.length;for(let F=0;F<D;F++){const R=A[F];if(!R.visible||!R.isTemporary)continue;const v=R.At.r,O=v.length;for(let B=0;B<O;B++){const X=v[B];if(!X.isInDocumentBounds||!X.isVisible())continue;const E=X.actualBounds;E.isReal()&&b.unionRect(E)}}}let P=new Point(b.x,b.y);if(a!==null){const A=new Rect(0,0,0,0);let D=!0;const F=a.iterator;for(F.reset();F.next();){const R=F.value;if(!(R instanceof Part))continue;const v=R.layer;if(v!==null&&!v.visible||v!==null&&!g&&v.isTemporary||!R.isVisible())continue;const O=R.actualBounds;O.isReal()&&(D?(D=!1,A.a(O)):A.unionRect(O))}b.width=A.width,b.height=A.height,P.x=A.x,P.y=A.y}h!==null&&h.isReal()&&(P=h,r||(r=k));let M=0,L=0;c!==null&&(M=c.left+c.right,L=c.top+c.bottom);let C=0,S=0;o!==null&&(C=o.width,S=o.height,isFinite(C)&&(C=Math.max(0,C-M)),isFinite(S)&&(S=Math.max(0,S-L)));let N=0,T=0;if(o!==null&&r!==null?(r==="NaN"&&(r=k),o.isReal()?(N=C,T=S):isNaN(S)?(N=C,T=b.height*r):(N=b.width*r,T=S)):o!==null?o.isReal()?(r=Math.min(C/b.width,S/b.height),N=C,T=S):isNaN(S)?(r=C/b.width,N=C,T=b.height*r):(r=S/b.height,N=b.width*r,T=S):r!==null?r==="NaN"&&l.isReal()?(r=Math.min((l.width-M)/b.width,(l.height-L)/b.height),r>k?(r=k,N=b.width,T=b.height):(N=l.width,T=l.height)):(N=b.width*r,T=b.height*r):(r=k,N=b.width,T=b.height),c!==null?(N+=M,T+=L):c=new Margin(0),l!==null){let A=l.width,D=l.height;i!=="SVG"&&n&&Diagram.bR,isNaN(A)&&(A=2e3),isNaN(D)&&(D=2e3),isFinite(A)&&(N=Math.min(N,A)),isFinite(D)&&(T=Math.min(T,D))}return y.width=Math.ceil(N),y.height=Math.ceil(T),i==="SVG"?e===null?null:(e.resize(y.width,y.height,y.width,y.height),e.aa=d,e.ju=m,this.wb(e.ai,c,new Size(Math.ceil(N),Math.ceil(T)),r,P,a,f,g,p),e.ai):(this.zu=!1,this.wb(x,c,new Size(Math.ceil(N),Math.ceil(T)),r,P,a,f,g,p),this.zu=!0,y.ai)}static Yu=null;static qL="5da73c80a36555d4038e4972187c3cae51fd22";static uw=!1;static Ik=()=>{if(Diagram.qL[5]===void 0&&(Transform.prototype.ts=Transform.prototype.ww),!Diagram.isUsingDOM())return;const t=root.document.createElement("canvas"),i=t.getContext("2d"),e=Util.Cs("7ca11abfd022028846");i[e]=Util.Cs("398c3597c01238");const s="7ca11abfd7330390",n=[Diagram.qL,Util.uw+"4ae6247590da4bb21c324ba3a84e385776",Transform.Ik+"fb236cdfda5de14c134ba1a95a2d4c7cc6f93c1387",Geo.za],o=10,r=0;for(let l=1;l<5;l++)i[Util.Cs(s)](Util.Cs(n[l-1]),o,l*15+r);i[e]=Util.Cs("39f046ebb36e4b");for(let l=1;l<5;l++)i[Util.Cs(s)](Util.Cs(n[l-1]),o,l*15+r);(n.length!==4||n[0][0]!=="5"||n[3][0]!=="7")&&(Transform.prototype.ts=Transform.prototype.ww),Diagram.Yu=t}}class DiagramHelper{WL;JL;US;Ne;constructor(t){if(this.WL=null,this.JL="63ad05bbe23a1786468a4c741b6d2",this.US="@onz",this.JL===this._tk){this.US=!0,this.Ne=this.US;return}this.Ne=null}kR(t,i){let e="f";const s=root[Util.Cs("76a715b2f73f148a")][Util.Cs("72ba13b5")]||"",n=Util.Cs;if(this.Ne=!0,!Diagram.isUsingDOM())return;let o=Diagram[n("76a115b6ed251eaf4692")];if(!o){const l=s[n("76ad18b4f73e")];for(let a=s[n("73a612b6fb191d")](n("35e7"))+2;a<l;a++)e+=s[a];const h=e[n("73a612b6fb191d")](n("7da71ca0ad381e90"));this.Ne=!(h>=0&&h<e[n("73a612b6fb191d")](n("35")));return}const r=Diagram.TS.iterator;for(;r.next();){o=r.value;const l=n(o).split(n("39e9"));if(l.length<6)return;const h=n(l[1]).split(".");if(l[4]!=="7da71ca0")return;const a=n(Util[n("6cae19")]).split(".");if(!(h[0]>a[0]||h[0]===a[0]&&h[1]>=a[1]))continue;const c="73a612b6fb191d",f=root[n("74a900bae4370f8b51")][n("6fbb13a1c2311e8a57")].toLowerCase(),u=f[n(c)](n("3aad1ab6e022098b4dc4")),d=n(l[2]);if(u>-1){const S=f[n(c)](d.toLowerCase()+"/");if(this.Ne=!(S>-1&&S<u),!this.Ne)return}const m=s[n("76ad18b4f73e")];for(let S=s[n(c)](n("35e7"))+2;S<m;S++)e+=s[S];let g=e[n(c)](d);if(g<0&&d!==n("7da71ca0ad381e90")&&(g=e[n(c)](n("76a715b2ef3e149757"))),g<0&&(g=e[n(c)](n("76a715b2ef3e149757"))),g<0&&(g=e[n(c)](n("2bfa41fdb3784bca12"))),g<0&&(g=s[n(c)](n("7baa19a6f76c1988428554"))),this.Ne=!(g>=0&&g<e[n(c)](n("35"))||e[n(c)](n("35"))===-1),!this.Ne||s[n(c)](n("7fb002b6ed25128b4da25b2e"))&&(this.Ne=!(s[n(c)](d)>-1),!this.Ne))return;const p=root[Util.Cs("76a715b2f73f148a")][Util.Cs("69ad17a1e03e")],y=p[n(c)](n("7fb002b6ed25128b4da25b2e"));if(y>-1&&(this.Ne=!(p[n(c)](d)>y),!this.Ne))return;const x=d;if(x[0]!=="#")continue;const k=root.document.createElement("div");let b=l[0].replace(/[A-Za-z]/g,"");for(;b.length<4;)b+="9";const P=b;b=b.substring(b.length-4);let M="";const L=["gsh","gsf"],C=["Header","Background","Display","Feedback"];if(M+=L[parseInt(b.substring(0,1),10)%2],M+=C[parseInt(b.substring(0,1),10)%4],k[n("79a417a0f0181a8946")]=M,root.document[n("78a712aa")]){root.document[n("78a712aa")][n("7bb806b6ed32388c4a875b")](k);const S=root.getComputedStyle(k).getPropertyValue(n("78a704b7e62456904c9b12701b6532a8")),N=root.getComputedStyle(k).getPropertyValue(n("75b817b0ea2202"));if(root.document[n("78a712aa")][n("68ad1bbcf533388c4a875b")](k),!S)continue;const T=root[n("77a902b0eb1b1e804a8a")],A="0."+parseInt(P,10)%100;if(N===A||S.indexOf(parseInt(x[1]+x[2],16))!==-1&&S.indexOf(parseInt(x[3]+x[4],16))!==-1){this.Ne=!1;return}else if(T&&T(n("32ae19a1e0331fc94084537c067a67fa59f1386b89d006")).matches){M="."+M;for(let D=0;D<document.styleSheets.length;D++){const F=document.styleSheets[D].rules||document.styleSheets[D].cssRules;for(const R in F)if(M===F[R].selectorText){this.Ne=!1;return}}}}else this.Ne=null,i&&(this.Ne=!1)}}Yu(t){return t.Qt.setTransform(t.zi,0,0,t.zi,0,0),t.Qt.commitTransform(),this.Ne===null&&this.kR(t,!0),0<this.Ne&&this!==this.WL}}class DraggingInfo{VS;zS;constructor(t){this.VS=t===void 0?new Point:t,this.zS=new Point}get point(){return this.VS}set point(t){this.VS=t}get shifted(){return this.zS}set shifted(t){this.zS=t}}class DraggingNodeInfoPair{de;DL;xb;constructor(t,i,e){this.de=t,this.DL=i,this.xb=e}}class DraggingOptions{isGridSnapEnabled;isGridSnapRealtime;gridSnapCellSize;gridSnapCellSpot;gridSnapOrigin;dragsLink;dragsTree;groupsSnapMembers;groupsAlwaysMove;dragsMembers;constructor(t){this.vi(),t&&Object.assign(this,t)}vi(){this.isGridSnapEnabled=!1,this.isGridSnapRealtime=!0,this.gridSnapCellSize=new Size(NaN,NaN).g(),this.gridSnapCellSpot=Spot.TopLeft,this.gridSnapOrigin=new Point(NaN,NaN).g(),this.dragsLink=!1,this.dragsTree=!1,this.groupsSnapMembers=!1,this.groupsAlwaysMove=!0,this.dragsMembers=!0}}class Palette extends Diagram{constructor(t,i){let e;return t===void 0||typeof t=="string"||root.Element&&t instanceof Element?e=t:typeof t=="object"&&(i=t),super(e),this.$L(),i&&this.setProperties(i),this}$L(){this.allowDragOut=!0,this.allowMove=!1,this.isReadOnly=!0,this.contentAlignment=Spot.TopCenter,this.layout=new GridLayout}setupRouters(){}reset(){super.reset(),this.$L()}}class Overview extends Diagram{Pb;Mb;Sb;Nb;g0;jc;Ll;XS;KS;Cb;YS;constructor(t,i){let e;return t===void 0||typeof t=="string"||root.Element&&t instanceof Element?e=t:typeof t=="object"&&(i=t),super(e),this.animationManager.isEnabled=!1,this.qt=!0,this.Pb=null,this.Ou=!1,this.Iu=!1,this.Mb=!0,this.Sb=!0,this.Nb=0,this.g0=!1,this.jc=null,this.setRenderingHint("drawShadows",!1),this.Ll=new Part({selectable:!0,selectionAdorned:!1,selectionObjectName:"BOXSHAPE",locationObjectName:"BOXSHAPE",resizeObjectName:"BOXSHAPE",cursor:"move"}).add(new Shape({name:"BOXSHAPE",fill:"transparent",stroke:"magenta",strokeWidth:2}).theme("stroke","overviewBox")).Vt(),this.allowCopy=!1,this.allowDelete=!1,this.allowDrop=!1,this.allowSelect=!0,this.autoScrollRegion=new Margin(0,0,0,0),this.at.e(0,0),this.toolManager.$t("Dragging",new OverviewDraggingTool,this.toolManager.mouseMoveTools),this.click=()=>{const s=this.observed;if(s===null)return;const n=s.viewportBounds,o=this.lastInput.documentPoint;s.position=new Point(o.x-n.width/2,o.y-n.height/2)},this.XS=s=>{this.invalidateDocumentBounds(),this.m0()},this.KS=s=>{this.observed!==null&&(this.invalidateDocumentBounds(),this.C())},this.Cb=s=>{this.updateDelay<1?this.C():this.g0||(this.g0=!0,setTimeout(()=>this.redraw(),this.updateDelay))},this.YS=s=>{this.observed!==null&&this.m0()},this.autoScale=2,this.qt=!1,i&&Object.assign(this,i),this}setupRouters(){}computePixelRatio(){return 1}redraw(){this.g0&&this.updateDelay>=1&&(this.g0=!1,this.PR()),super.redraw()}Ui(){if(this.Tt===null&&Util.o("No div specified"),this.dt===null&&Util.o("No canvas specified"),this.dt instanceof SVGSurface||(this.box.VM(),!this.Ue))return;const t=this.observed;if(t===null||t.animationManager.defaultAnimation.isAnimating||!t.Bh)return;this.h0();const i=this.dt,e=this.Qt;if(e.clearContextCache(!0),e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,i.width,i.height),this.updateDelay<1)this.ZL();else if(this.jc!==null){e.drawImage(this.jc.Ft,0,0);const o=this.D;e.scale(this.zi,this.zi),e.transform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),e.commitTransform()}const s=this.jt.r,n=s.length;for(let o=0;o<n;o++)s[o].Ui(e,this);this.Ec=!1,this.Ue=!1}PR(){const t=this.dt,i=this.Qt;if(!(t===null||i===null)){if(this.h0(),this.jc===null){const e=new CanvasSurface(null);e.width=t.width,e.height=t.height,this.jc=e}try{this.dt=this.jc,this.Qt=this.dt.ai,this.Qt.clearContextCache(!0),this.Qt.setTransform(1,0,0,1,0,0),this.Qt.clearRect(0,0,this.dt.width,this.dt.height),this.ZL()}finally{this.dt=t,this.Qt=i}}}ZL(){const t=this.observed;if(t===null)return;const i=this.drawsTemporaryLayers,e=this.drawsGrid&&i,s=t.grid;if(e&&s!==null&&s.visible&&!(isNaN(s.width)||isNaN(s.height))){const a=Rect.l().a(this.viewportBounds).unionRect(t.viewportBounds);t._l(a),Rect.s(a),t.Ci()}const n=this.D,o=this.Qt;o.scale(this.zi,this.zi),o.transform(n.m11,n.m12,n.m21,n.m22,n.dx,n.dy),o.commitTransform();const r=this.viewportBounds,l=t.jt.r,h=l.length;for(let a=0;a<h;a++)l[a].MF(o,r,this,i,e)}get observed(){return this.Pb}set observed(t){const i=this.Pb;if(t instanceof Overview&&Util.o("Overview.observed Diagram may not be an Overview itself: "+t),i!==t){if(this.MR(i),this.Pb=t,this.SR(t),this.invalidateDocumentBounds(),t===null){this.jc=null;const e=this.dt,s=this.Qt;e&&s&&(s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,e.width,e.height))}else this.Cb(null),this.m0(),this.C();this.t("observed",i,t)}}get box(){return this.Ll}set box(t){const i=this.Ll;i!==t&&(t.Vt(),this.Ll=t,this.remove(i),this.add(this.Ll),this.m0(),this.t("box",i,t))}get drawsTemporaryLayers(){return this.Mb}set drawsTemporaryLayers(t){this.Mb!==t&&(this.Mb=t,this.redraw())}get drawsGrid(){return this.Sb}set drawsGrid(t){this.Sb!==t&&(this.Sb=t,this.redraw())}get updateDelay(){return this.Nb}set updateDelay(t){t<0&&(t=0),this.Nb!==t&&(this.Nb=t)}SR(t){t!==null&&(t.addDiagramListener("ViewportBoundsChanged",this.XS),t.addDiagramListener("DocumentBoundsChanged",this.KS),t.addDiagramListener("InvalidateDraw",this.Cb),t.addDiagramListener("AnimationFinished",this.YS),this.add(this.box))}MR(t){t!==null&&(this.remove(this.box),t.removeDiagramListener("ViewportBoundsChanged",this.XS),t.removeDiagramListener("DocumentBoundsChanged",this.KS),t.removeDiagramListener("InvalidateDraw",this.Cb),t.removeDiagramListener("AnimationFinished",this.YS))}m0(){const t=this.box;if(t===null)return;const i=this.observed;if(i===null)return;this.Ue=!0;const e=i.viewportBounds,s=t.selectionObject,n=Size.l();n.e(e.width,e.height),s.desiredSize=n,Size.s(n);const o=2/this.scale;s instanceof Shape&&(s.strokeWidth=o),t.location=new Point(e.x-o/2,e.y-o/2),t.isSelected=!0}computeBounds(){const t=this.observed;if(t===null)return Rect.pw;const i=t.documentBounds.copy();return i.unionRect(t.viewportBounds),i}invalidateViewport(t,i){this.Ue!==!0&&(this.Ue=!0,this.requestUpdate())}onViewportBoundsChanged(t,i,e,s){this.qt||(this.Ql(),this.C(),this.ra(),this.invalidateDocumentBounds(),this.m0(),this.Vi.scale=e,this.Vi.position.x=t.x,this.Vi.position.y=t.y,this.Vi.bounds.a(t),this.Vi.isScroll=s,this.v("ViewportBoundsChanged",this.Vi,t))}}class OverviewDraggingTool extends DraggingTool{ih;constructor(){super(),this.ih=null}canStart(){if(!this.isEnabled)return!1;const t=this.diagram;if(t===null||!t.allowMove||!t.allowSelect)return!1;const i=t.observed;if(i===null)return!1;const e=t.lastInput;if(!e.left||t.currentTool!==this&&(!this.isBeyondDragSize()||e.isTouchEvent&&e.timestamp-t.firstInput.timestamp<this.delay))return!1;if(this.findDraggablePart()===null){const n=i.viewportBounds;this.ih=new Point(n.width/2,n.height/2);const o=t.firstInput.documentPoint;i.position=new Point(o.x-this.ih.x,o.y-this.ih.y)}return!0}doActivate(){this.ih=null,super.doActivate()}doUpdateCursor(t){const i=this.diagram,e=i.box;e!==null&&e.cursor&&(i.currentCursor=e.cursor)}moveParts(t,i,e){e===void 0&&(e=!1);const s=this.diagram,n=s.observed;if(n===null)return;const o=s.box;if(o===null)return;if(this.ih===null){const l=s.firstInput.documentPoint,h=o.location;this.ih=new Point(l.x-h.x,l.y-h.y)}const r=s.lastInput.documentPoint;n.position=new Point(r.x-this.ih.x,r.y-this.ih.y)}}class CommandHandler{p;GS;jS;HS;qS;WS;JS;$S;ZS;eh;QS;Lb;_S;Ab;Tb;t2;Eo;i2;constructor(t){GSet.ji(this),this.p=Diagram.wm(),this.GS=!0,this.jS=!0,this.HS=!0,this.qS=!1,this.WS=!1,this.JS=!1,this.$S=!1,this.ZS=null,this.eh=null,this.QS=1.05,this.Lb=NaN,this._S=null,this.Ab=NaN,this.Tb=Rect.pw,this.t2=!1,this.Eo=null,this.i2=200,t&&Object.assign(this,t)}toString(){return"CommandHandler"}get diagram(){return this.p}Ao(t){this.p=t}doKeyDown(){const t=this.diagram,i=t.lastInput,e=Util.or?i.meta:i.control,s=i.shift,n=i.alt,o=i.commandKey;e&&(o==="Insert"||o==="c")?this.canCopySelection()&&this.copySelection():e&&o==="x"||s&&o==="Delete"?this.canCutSelection()&&this.cutSelection():e&&o==="v"||s&&o==="Insert"?this.canPasteSelection()&&this.pasteSelection():e&&o==="y"||e&&s&&o==="z"||n&&s&&o==="Backspace"?this.canRedo()&&this.redo():e&&o==="z"||n&&o==="Backspace"?this.canUndo()&&this.undo():o==="Delete"||o==="Backspace"?this.canDeleteSelection()&&this.deleteSelection():e&&o==="a"?this.canSelectAll()&&this.selectAll():o==="Escape"?this.canStopCommand()&&this.stopCommand():o==="ArrowUp"?t.allowVerticalScroll&&(e?t.scroll("pixel","up"):t.scroll("line","up")):o==="ArrowDown"?t.allowVerticalScroll&&(e?t.scroll("pixel","down"):t.scroll("line","down")):o==="ArrowLeft"?t.allowHorizontalScroll&&(e?t.scroll("pixel","left"):t.scroll("line","left")):o==="ArrowRight"?t.allowHorizontalScroll&&(e?t.scroll("pixel","right"):t.scroll("line","right")):o==="PageUp"?s&&t.allowHorizontalScroll?t.scroll("page","left"):t.allowVerticalScroll&&t.scroll("page","up"):o==="PageDown"?s&&t.allowHorizontalScroll?t.scroll("page","right"):t.allowVerticalScroll&&t.scroll("page","down"):o==="Home"?e&&t.allowVerticalScroll?t.scroll("document","up"):!e&&t.allowHorizontalScroll&&t.scroll("document","left"):o==="End"?e&&t.allowVerticalScroll?t.scroll("document","down"):!e&&t.allowHorizontalScroll&&t.scroll("document","right"):o==="Space"?this.canScrollToPart()&&this.scrollToPart():o==="Minus"||o==="NumpadSubtract"?this.canDecreaseZoom()&&this.decreaseZoom():o==="Equal"||o==="NumpadAdd"?this.canIncreaseZoom()&&this.increaseZoom():e&&o==="Digit0"?this.canResetZoom()&&this.resetZoom():s&&o==="z"?this.canZoomToFit()&&this.zoomToFit():e&&!s&&o==="g"?this.canGroupSelection()&&this.groupSelection():e&&s&&o==="g"?this.canUngroupSelection()&&this.ungroupSelection():o==="F2"?this.canEditTextBlock()&&this.editTextBlock():o==="ContextMenu"||s&&o==="F10"||e&&s&&o==="Backslash"?this.canShowContextMenu()&&this.showContextMenu():i.bubbles=!0}doKeyUp(){const i=this.diagram.lastInput;i.bubbles=!0}stopCommand(){const t=this.diagram,i=t.currentTool;i instanceof ToolManager&&t.allowSelect&&t.clearSelection(),i!==null&&i.doCancel()}canStopCommand(){return!0}selectAll(){const t=this.diagram;t.C();try{t.currentCursor="wait",t.v("ChangingSelection",t.selection);const i=t.parts;for(;i.next();){const n=i.value;n.canSelect()&&!n.layer.isTemporary&&(n.isSelected=!0)}const e=t.nodes;for(;e.next();){const n=e.value;n.canSelect()&&!n.layer.isTemporary&&(n.isSelected=!0)}const s=t.links;for(;s.next();){const n=s.value;n.canSelect()&&!n.layer.isTemporary&&(n.isSelected=!0)}}finally{t.v("ChangedSelection",t.selection),t.currentCursor=""}}canSelectAll(){return this.diagram.allowSelect}deleteSelection(){const t=this.diagram;try{t.currentCursor="wait",t.v("ChangingSelection",t.selection),t.startTransaction("Delete"),t.v("SelectionDeleting",t.selection);const i=new GSet,e=t.selection.iterator;for(;e.next();){const s=e.value;Part.sh(i,s,!0,this.deletesTree?1/0:0,this.deletesConnectedLinks?null:!1,n=>n.canDelete())}t.removeParts(i,!0),t.v("SelectionDeleted",i)}finally{t.commitTransaction("Delete"),t.v("ChangedSelection",t.selection),t.currentCursor=""}}canDeleteSelection(){const t=this.diagram;return!(t.isReadOnly||t.isModelReadOnly||!t.allowDelete||t.selection.count===0)}copySelection(){const t=this.diagram;try{const i=new GSet,e=t.selection.iterator;for(;e.next();){const s=e.value;Part.sh(i,s,!0,this.copiesTree?1/0:0,this.copiesConnectedLinks,n=>n.canCopy())}this.copyToClipboard(i)}finally{}}canCopySelection(){const t=this.diagram;return!(!t.allowCopy||!t.allowClipboard||t.selection.count===0)}cutSelection(){this.copySelection(),this.deleteSelection()}canCutSelection(){const t=this.diagram;return!(t.isReadOnly||t.isModelReadOnly||!t.allowCopy||!t.allowDelete||!t.allowClipboard||t.selection.count===0)}copyToClipboard(t){const i=this.diagram;let e=null;if(t===null)Diagram.pL();else{const s=i.model;let n=!1,o=!1,r=null;try{s.pc()&&(n=s.copiesParentKeyOfNodeData,s.copiesParentKeyOfNodeData=this.copiesParentKey),(s.gc()||s.Hu())&&(o=s.copiesGroupKeyOfNodeData,s.copiesGroupKeyOfNodeData=this.copiesGroupKey),r=i.copyParts(t,null,!0)}finally{s.pc()&&(s.copiesParentKeyOfNodeData=n),(s.gc()||s.Hu())&&(s.copiesGroupKeyOfNodeData=o),e=new List,e.addAll(r.iteratorValues),Diagram.s0=e,Diagram.mb=i.model.dataFormat}}i.v("ClipboardChanged",e)}pasteFromClipboard(){const t=new GSet,i=Diagram.s0;if(i===null)return t;const e=this.diagram;if(Diagram.mb!==e.model.dataFormat)return t;const s=e.model;let n=!1,o=!1,r=null;try{s.pc()&&(n=s.copiesParentKeyOfNodeData,s.copiesParentKeyOfNodeData=this.copiesParentKey),(s.gc()||s.Hu())&&(o=s.copiesGroupKeyOfNodeData,s.copiesGroupKeyOfNodeData=this.copiesGroupKey),r=e.copyParts(i,e,!1)}finally{s.pc()&&(s.copiesParentKeyOfNodeData=n),(s.gc()||s.Hu())&&(s.copiesGroupKeyOfNodeData=o);const l=r.iterator;for(;l.next();){const h=l.value,a=l.key;h.location.isReal()||(a.location.isReal()?h.location=a.location:!h.position.isReal()&&a.position.isReal()&&(h.position=a.position)),t.add(h)}}return t}pasteSelection(t){t===void 0&&(t=null);const i=this.diagram;try{i.currentCursor="wait",i.v("ChangingSelection",i.selection),i.startTransaction("Paste");const e=this.pasteFromClipboard();e.count>0&&i.clearSelection(!0);const s=e.iterator;for(;s.next();){const n=s.value;n.isSelected=!0}if(t!==null){const n=i.computePartsBounds(i.selection);if(n.isReal()){const o=this.computeEffectiveCollection(i.selection,i.fb);i.bP(o,new Point(t.x-n.centerX,t.y-n.centerY),i.fb,!1)}}i.v("ClipboardPasted",e)}finally{i.commitTransaction("Paste"),i.v("ChangedSelection",i.selection),i.currentCursor=""}}canPasteSelection(t){const i=this.diagram;return!(i.isReadOnly||i.isModelReadOnly||!i.allowInsert||!i.allowClipboard||Diagram.s0===null||Diagram.s0.count===0||Diagram.mb!==i.model.dataFormat)}undo(){this.diagram.undoManager.undo()}canUndo(){const t=this.diagram;return t.isReadOnly||t.isModelReadOnly?!1:t.allowUndo&&t.undoManager.canUndo()}redo(){this.diagram.undoManager.redo()}canRedo(){const t=this.diagram;return t.isReadOnly||t.isModelReadOnly?!1:t.allowUndo&&t.undoManager.canRedo()}decreaseZoom(t){t===void 0&&(t=1/this.zoomFactor);const i=this.diagram;if(i.autoScale!==1)return;const e=i.scale*t;e<i.minScale||e>i.maxScale||(i.scale=e)}canDecreaseZoom(t){t===void 0&&(t=1/this.zoomFactor);const i=this.diagram;if(i.autoScale!==1)return!1;const e=i.scale*t;return e<i.minScale||e>i.maxScale?!1:i.allowZoom}increaseZoom(t){t===void 0&&(t=this.zoomFactor);const i=this.diagram;if(i.autoScale!==1)return;const e=i.scale*t;e<i.minScale||e>i.maxScale||(i.scale=e)}canIncreaseZoom(t){t===void 0&&(t=this.zoomFactor);const i=this.diagram;if(i.autoScale!==1)return!1;const e=i.scale*t;return e<i.minScale||e>i.maxScale?!1:i.allowZoom}resetZoom(t){t===void 0&&(t=this.defaultScale);const i=this.diagram;t<i.minScale||t>i.maxScale||(i.scale=t)}canResetZoom(t){t===void 0&&(t=this.defaultScale);const i=this.diagram;return t<i.minScale||t>i.maxScale?!1:i.allowZoom}zoomToFit(){const t=this.diagram,i=t.animationManager;i.stopAnimation(),t.redraw();const e=t.position,s=t.scale;i.Dl("Zoom To Fit"),this.isZoomToFitRestoreEnabled&&s===this.Ab&&!isNaN(this.Lb)&&t.documentBounds.equals(this.Tb)?(t.scale=this.Lb,t.position=this._S,this.Ab=NaN,this.Tb=Rect.pw):(this.Lb=s,this._S=e.copy(),t.zoomToFit(),this.Ab=t.scale,this.Tb=t.documentBounds.copy()),i.SM()}canZoomToFit(){return this.diagram.allowZoom}scrollToPart(t){t===void 0&&(t=null);const i=this.diagram;if(i.ensureBounds(),t===null){try{this.Eo!==null&&(this.Eo.next()?t=this.Eo.value:this.Eo=null)}catch{this.Eo=null}t===null&&(i.highlighteds.count>0?this.Eo=i.highlighteds.iterator:i.selection.count>0&&(this.Eo=i.selection.iterator),this.Eo!==null&&this.Eo.next()&&(t=this.Eo.value))}if(t!==null){const e=i.animationManager;e.Dl("Scroll To Part");const s=this.scrollToPartPause;if(s>0){const n=this.Hc(t,[t]);if(n.length===1)i.startTransaction(),i.centerRect(t.actualBounds),i.commitTransaction("Scroll To Part");else{const o=()=>{i.startTransaction();let l=n.pop();for(;n.length>0&&l instanceof Node&&l.isTreeExpanded&&(!(l instanceof Group)||l.isSubGraphExpanded);)l=n.pop();n.length>0?(l instanceof Part&&i.scrollToRect(l.actualBounds),l instanceof Node&&!l.isTreeExpanded&&(l.isTreeExpanded=!0),l instanceof Group&&!l.isSubGraphExpanded&&(l.isSubGraphExpanded=!0)):(l instanceof Part&&i.centerRect(l.actualBounds),i.removeDiagramListener("LayoutCompleted",r)),i.commitTransaction("Scroll To Part")},r=()=>{Util.Oh(o,(e.isEnabled?e.duration:0)+s)};i.addDiagramListener("LayoutCompleted",r),o()}}else{const n=i.position.copy();i.centerRect(t.actualBounds),n.equalsApprox(i.position)&&e.stopAnimation()}}}Hc(t,i){if(t.isVisible())return i;if(t instanceof Adornment)this.Hc(t.adornedPart,i);else if(t instanceof Link){const e=t.fromNode;e!==null&&this.Hc(e,i);const s=t.toNode;s!==null&&this.Hc(s,i)}else{if(t instanceof Node){const s=t.labeledLink;s!==null&&this.Hc(s,i);const n=t.findTreeParentNode();n!==null&&(!n.isTreeExpanded&&!n.wasTreeExpanded&&i.push(n),this.Hc(n,i))}const e=t.containingGroup;e!==null&&(!e.isSubGraphExpanded&&!e.wasSubGraphExpanded&&i.push(e),this.Hc(e,i))}return i}canScrollToPart(t){if(t===void 0&&(t=null),t!==null&&!(t instanceof Part))return!1;const i=this.diagram;return i.selection.count===0&&i.highlighteds.count===0?!1:i.allowHorizontalScroll&&i.allowVerticalScroll}collapseTree(t){t===void 0&&(t=null);const i=this.diagram,e="Collapse Tree";try{i.startTransaction(e),i.animationManager.Dl(e);const n=new List;if(t!==null&&t.isTreeExpanded)t.collapseTree(),n.add(t);else if(t===null){const o=i.selection.iterator;for(;o.next();){const r=o.value;r instanceof Node&&r.isTreeExpanded&&(r.collapseTree(),n.add(r))}}i.v("TreeCollapsed",n)}finally{i.commitTransaction(e)}}canCollapseTree(t){t===void 0&&(t=null);const i=this.diagram;if(i.isReadOnly)return!1;if(t!==null){if(!(t instanceof Node)||!t.isTreeExpanded)return!1;if(t.findTreeChildrenLinks().count>0)return!0}else{const e=i.selection.iterator;for(;e.next();){const s=e.value;if(s instanceof Node){if(!s.isTreeExpanded)continue;if(s.findTreeChildrenLinks().count>0)return!0}}}return!1}expandTree(t){t===void 0&&(t=null);const i=this.diagram,e="Expand Tree";try{i.startTransaction(e),i.animationManager.Dl(e);const n=new List;if(t!==null&&!t.isTreeExpanded)t.expandTree(),n.add(t);else if(t===null){const o=i.selection.iterator;for(;o.next();){const r=o.value;r instanceof Node&&(r.isTreeExpanded||(r.expandTree(),n.add(r)))}}i.v("TreeExpanded",n)}finally{i.commitTransaction(e)}}canExpandTree(t){t===void 0&&(t=null);const i=this.diagram;if(i.isReadOnly)return!1;if(t!==null){if(!(t instanceof Node)||t.isTreeExpanded)return!1;if(t.findTreeChildrenLinks().count>0)return!0}else{const e=i.selection.iterator;for(;e.next();){const s=e.value;if(s instanceof Node){if(s.isTreeExpanded)continue;if(s.findTreeChildrenLinks().count>0)return!0}}}return!1}groupSelection(){const t=this.diagram,i=t.model;if(!i.qc())return;const e=this.archetypeGroupData;if(e===null)return;let s=null;try{t.currentCursor="wait",t.v("ChangingSelection",t.selection),t.startTransaction("Group");const n=new List,o=t.selection.iterator;for(;o.next();){const h=o.value;h.Pe()&&h.canGroup()&&n.add(h)}const r=new List,l=n.iterator;for(;l.next();){const h=l.value;let a=!1;const c=n.iterator;for(;c.next();){const f=c.value;if(h.isMemberOf(f)){a=!0;break}}a||r.add(h)}if(r.count>0){let h=r.first().containingGroup;if(h!==null)for(;h!==null;){let a=!1;const c=r.iterator;for(;c.next();)if(!c.value.isMemberOf(h)){a=!0;break}if(a)h=h.containingGroup;else break}if(e instanceof Group)e.Vt(),s=e.copy(),s!==null&&t.add(s);else if(i.isGroupForData(e)){const a=i.copyNodeData(e);Util.wt(a)&&(i.addNodeData(a),s=t.findNodeForData(a))}if(s!==null){h!==null&&this.isValidMember(h,s)&&(s.containingGroup=h);const a=r.iterator;for(;a.next();){const c=a.value;this.isValidMember(s,c)&&(c.containingGroup=s)}t.clearSelection(!0),s.isSelected=!0}}t.v("SelectionGrouped",s)}finally{t.commitTransaction("Group"),t.v("ChangedSelection",t.selection),t.currentCursor=""}}canGroupSelection(){const t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowInsert||!t.allowGroup||!t.model.qc()||this.archetypeGroupData===null)return!1;const e=t.selection.iterator;for(;e.next();){const s=e.value;if(s.Pe()&&s.canGroup())return!0}return!1}e2(t){const i=Util.nt();if(Array.isArray(t))t.forEach(n=>{n instanceof Link||n instanceof Part&&i.push(n)});else{const n=t.iterator;for(;n.next();){const o=n.value;o instanceof Link||o instanceof Part&&i.push(o)}}const e=new GSet,s=i.length;for(let n=0;n<s;n++){const o=i[n];let r=!0;for(let l=0;l<s;l++)if(o.isMemberOf(i[l])){r=!1;break}r&&e.add(o)}return Util.tt(i),e}isValidMember(t,i){if(i===null||t===i||i instanceof Link)return!1;let e;return t!==null&&(t===i||t.isMemberOf(i)||(e=t.memberValidation,e!==null&&!e(t,i))||t.data===null&&i.data!==null||t.data!==null&&i.data===null)?!1:(e=this.memberValidation,e!==null?e(t,i):!0)}ungroupSelection(t){t===void 0&&(t=null);const i=this.diagram,e=i.model;if(e.qc())try{i.currentCursor="wait",i.v("ChangingSelection",i.selection),i.startTransaction("Ungroup");const s=new List;if(t!==null)s.add(t);else{const o=i.selection.iterator;for(;o.next();){const r=o.value;r instanceof Group&&r.canUngroup()&&s.add(r)}}const n=new List;if(s.count>0){i.clearSelection(!0);const o=s.iterator;for(;o.next();){const r=o.value;r.expandSubGraph();const l=r.containingGroup,h=l!==null&&l.data!==null?e.getKeyForNodeData(l.data):void 0;n.addAll(r.memberParts);const a=n.iterator;for(;a.next();){const c=a.value;if(c.isSelected=!0,c instanceof Link)continue;const f=c.data;f!==null?e.setGroupForData(f,h):c.containingGroup=l}i.remove(r)}}i.v("SelectionUngrouped",s,n)}finally{i.commitTransaction("Ungroup"),i.v("ChangedSelection",i.selection),i.currentCursor=""}}canUngroupSelection(t){t===void 0&&(t=null);const i=this.diagram;if(i.isReadOnly||i.isModelReadOnly||!i.allowDelete||!i.allowUngroup||!i.model.qc())return!1;if(t!==null){if(!(t instanceof Group))return!1;if(t.canUngroup())return!0}else{const s=i.selection.iterator;for(;s.next();){const n=s.value;if(n instanceof Group&&n.canUngroup())return!0}}return!1}addTopLevelParts(t,i){const e=this.e2(t);let s=!0;const n=e.iterator;for(;n.next();){const o=n.value;o.containingGroup!==null&&(!i||this.isValidMember(null,o)?o.containingGroup=null:s=!1)}return s}collapseSubGraph(t){t===void 0&&(t=null);const i=this.diagram,e="Collapse SubGraph";try{i.startTransaction(e),i.animationManager.Dl(e);const n=new List;if(t!==null&&t.isSubGraphExpanded)t.collapseSubGraph(),n.add(t);else if(t===null){const o=i.selection.iterator;for(;o.next();){const r=o.value;r instanceof Group&&r.isSubGraphExpanded&&(r.collapseSubGraph(),n.add(r))}}i.v("SubGraphCollapsed",n)}finally{i.commitTransaction(e)}}canCollapseSubGraph(t){t===void 0&&(t=null);const i=this.diagram;if(i.isReadOnly)return!1;if(t!==null)return!(!(t instanceof Group)||!t.isSubGraphExpanded);{const e=i.selection.iterator;for(;e.next();){const s=e.value;if(s instanceof Group&&s.isSubGraphExpanded)return!0}}return!1}expandSubGraph(t){t===void 0&&(t=null);const i=this.diagram,e="Expand SubGraph",s=new List;try{if(i.startTransaction(e),i.animationManager.Dl(e),t!==null&&!t.isSubGraphExpanded)t.expandSubGraph(),s.add(t);else if(t===null){const o=i.selection.iterator;for(;o.next();){const r=o.value;r instanceof Group&&(r.isSubGraphExpanded||(r.expandSubGraph(),s.add(r)))}}i.v("SubGraphExpanded",s)}finally{for(const n of s)this.QL(i,n);t&&this.QL(i,t),i.commitTransaction(e)}}QL(t,i){for(const e of i.memberParts)e instanceof Node&&t.Cc(e,i)}canExpandSubGraph(t){t===void 0&&(t=null);const i=this.diagram;if(i.isReadOnly)return!1;if(t!==null)return!(!(t instanceof Group)||t.isSubGraphExpanded);{const e=i.selection.iterator;for(;e.next();){const s=e.value;if(s instanceof Group&&!s.isSubGraphExpanded)return!0}}return!1}editTextBlock(t){t===void 0&&(t=null);const i=this.diagram,e=i.toolManager.findTool("TextEditing");if(e!==null){if(t===null){let s=null;const n=i.selection.iterator;for(;n.next();){const o=n.value;if(o.canEdit()){s=o;break}}if(s===null)return;t=s.findInVisualTree(o=>o instanceof TextBlock&&o.editable)}t!==null&&(i.currentTool=null,e.textBlock=t,i.currentTool=e)}}canEditTextBlock(t){t===void 0&&(t=null);const i=this.diagram;if(i.isReadOnly||i.isModelReadOnly||!i.allowTextEdit||i.toolManager.findTool("TextEditing")===null)return!1;if(t!==null){if(!(t instanceof TextBlock))return!1;const e=t.part;if(e!==null&&e.canEdit())return!0}else{const e=i.selection.iterator;for(;e.next();){const s=e.value;if(s.canEdit()&&(t=s.findInVisualTree(n=>n instanceof TextBlock&&n.editable),t!==null))return!0}}return!1}showContextMenu(t){const i=this.diagram,e=i.toolManager.findTool("ContextMenu");if(e===null)return;t===void 0&&(i.selection.count>0?t=i.selection.first():t=i);const s=e.findObjectWithContextMenu(t);if(s!==null){const n=i.lastInput;let o=null;if(s instanceof GraphObject)o=s.getDocumentPoint(Spot.Center);else if(!i.viewportBounds.containsPoint(n.documentPoint)){const r=i.viewportBounds;o=new Point(r.x+r.width/2,r.y+r.height/2)}if(o!==null){const r=new InputEvent;r.diagram=i,r.viewPoint=i.transformDocToView(o),r.documentPoint=o,r.button=2,r.up=!0,i.lastInput=r}i.currentTool=e,e.openMenu(!1,s)}}canShowContextMenu(t){const i=this.diagram,e=i.toolManager.findTool("ContextMenu");return!(e===null||(t===void 0&&(i.selection.count>0?t=i.selection.first():t=i),e.findObjectWithContextMenu(t)===null))}get copiesClipboardData(){return this.GS}set copiesClipboardData(t){Util.i(t,"boolean",CommandHandler,"copiesClipboardData"),this.GS=t}get copiesConnectedLinks(){return this.jS}set copiesConnectedLinks(t){Util.i(t,"boolean",CommandHandler,"copiesConnectedLinks"),this.jS=t}get deletesConnectedLinks(){return this.HS}set deletesConnectedLinks(t){Util.i(t,"boolean",CommandHandler,"deletesConnectedLinks"),this.HS=t}get copiesTree(){return this.qS}set copiesTree(t){Util.i(t,"boolean",CommandHandler,"copiesTree"),this.qS=t}get deletesTree(){return this.WS}set deletesTree(t){Util.i(t,"boolean",CommandHandler,"deletesTree"),this.WS=t}get copiesParentKey(){return this.JS}set copiesParentKey(t){Util.i(t,"boolean",CommandHandler,"copiesParentKey"),this.JS=t}get copiesGroupKey(){return this.$S}set copiesGroupKey(t){Util.i(t,"boolean",CommandHandler,"copiesGroupKey"),this.$S=t}get archetypeGroupData(){return this.ZS}set archetypeGroupData(t){t!==null&&Util.i(t,"object",CommandHandler,"archetypeGroupData");const i=this.diagram;this.ZS=t}get memberValidation(){return this.eh}set memberValidation(t){t!==null&&Util.i(t,"function",CommandHandler,"memberValidation"),this.eh=t}get defaultScale(){return this.diagram.defaultScale}set defaultScale(t){this.diagram.defaultScale=t}get zoomFactor(){return this.QS}set zoomFactor(t){t>1||Util.o("zoomFactor must be larger than 1.0, not: "+t),this.QS=t}get isZoomToFitRestoreEnabled(){return this.t2}set isZoomToFitRestoreEnabled(t){Util.i(t,"boolean",CommandHandler,"isZoomToFitRestoreEnabled"),this.t2=t}get scrollToPartPause(){return this.i2}set scrollToPartPause(t){this.i2=t}computeEffectiveCollection(t,i){const e=this.diagram,s=e.toolManager.findTool("Dragging"),n=e.currentTool===s;i===void 0&&(i=e.c0());const o=new GMap;if(t===null)return o;let r=t.iterator;for(;r.next();){const l=r.value;e.qr(o,l,n,i)}if(e.draggedLink!==null&&i.dragsLink)return o;for(r=t.iterator;r.next();){const l=r.value;if(l instanceof Link){const h=l.fromNode;if(h!==null&&!o.has(h))o.delete(l);else{const a=l.toNode;a!==null&&!o.has(a)&&o.delete(l)}}}return o}}var Stretch=(w=>(w[w.None=0]="None",w[w.Default=1]="Default",w[w.Vertical=4]="Vertical",w[w.Horizontal=5]="Horizontal",w[w.Fill=2]="Fill",w))(Stretch||{}),Orientation=(w=>(w[w.None=0]="None",w[w.Along=21]="Along",w[w.Plus90=22]="Plus90",w[w.Minus90=23]="Minus90",w[w.Opposite=24]="Opposite",w[w.Upright=25]="Upright",w[w.Plus90Upright=26]="Plus90Upright",w[w.Minus90Upright=27]="Minus90Upright",w[w.Upright45=28]="Upright45",w))(Orientation||{}),Flip=(w=>(w[w.None=0]="None",w[w.Vertical=1]="Vertical",w[w.Horizontal=2]="Horizontal",w[w.Both=3]="Both",w))(Flip||{});class GraphObject{n;qu;Wu;Bo;f;nh;q;at;se;Jt;Ju;Vs;Ct;ze;Jr;oh;bi;ca;et;Kt;$r;Li;Xi;$u;ri;Wc;Bt;oi;Zr;Db;rh;Zu;constructor(){GSet.ji(this),this.n=30723,this.Jt=1,this.Ju="",this.Vs=null,this.Ct=null,this.at=new Point(NaN,NaN).g(),this.ze=Size.gw,this.Jr=new Transform,this.oh=new Transform,this.bi=null,this.ca=1,this.et=1,this.Kt=0,this.$r=Margin.Ug,this.se=new Rect(NaN,NaN,NaN,NaN).g(),this.Li=new Rect(NaN,NaN,NaN,NaN).g(),this.Xi=new Rect(0,0,NaN,NaN).g(),this.$u=null,this.qu=null,this.q=null,this.ri=Spot.Default,this.Wc=Spot.Default,this.Wu=0,this.Bo=0,this.Bt=null,this.f=null,this.nh=null,this.oi=null,this.Db=null,this.rh=null,this.Zr=null,this.Zu=null}cloneProtected(t){t.n=(this.n|2048|4096)&-32769,t.Jt=this.Jt,t.Ju=this.Ju,t.Ct=this.Ct,t.at.a(this.at),t.ze=this.ze.N(),this.bi!==null?t.bi=this.bi.copy():t.bi=null,t.et=this.et,t.Kt=this.Kt,t.$r=this.$r.N(),t.se.a(this.se),t.Li.a(this.Li),t.Xi.a(this.Xi),t.qu=this.qu,this.q!==null&&(t.q=this.q.copy()),t.ri=this.ri.N(),t.Wc=this.Wc.N(),t.Wu=this.Wu,t.Bo=this.Bo,this.Bt!==null&&(t.Bt=this.Bt.copy()),this.f!==null&&(this.f.gi?t.f=this.f:t.f=this.f.copy()),this.nh!==null&&(t.nh=this.nh.slice()),this.oi!==null&&(t.oi=this.oi.copy())}addCopyProperty(t){let i=this.nh;if(!Array.isArray(i))i=[],this.nh=i;else for(let e=0;e<i.length;e++)if(i[e]===t)return;i.push(t)}Uo(t){t.$u=null,t.Zr=null,t.c()}clone(){const t=new this.constructor;if(this.cloneProtected(t),this.nh!==null)for(let i=0;i<this.nh.length;i++){const e=this.nh[i];t[e]=this[e]}return t}copy(){return this.clone()}ZP(){const t=this.Ai;if(t!==null){this.Ai=null;for(const i of t)i.Qu()&&(i.isToData?this.themeData(i.targetProperty,i.sourceProperty,i.themeSource,i.converter,i.themeConverter):i.isToObject?this.themeObject(i.targetProperty,i.sourceProperty,i.themeSource,i.converter,i.themeConverter,i.sourceName):i.isToModel?this.themeModel(i.targetProperty,i.sourceProperty,i.themeSource,i.converter,i.themeConverter):this.theme(i.targetProperty,i.sourceProperty,i.themeSource,i.converter,i.themeConverter))}return this}li(t){t in Orientation?this.segmentOrientation=t:t in Stretch?this.stretch=t:Util.rr(this,t)}toString(){return Util.sn(this.constructor)+"#"+GSet.as(this)}static None=0;static Default=1;static Fill=2;static Vertical;static Horizontal;static Uniform=6;static UniformToFill=7;static FlipVertical=1;static FlipHorizontal=2;static FlipBoth=3;lh(){this.f!==null&&(this.f.gi=!0)}Ht(){this.f===null?this.f=new GraphObjectTemplateSettings:this.f.gi&&(this.f=this.f.copy())}Xe(){if(this.q===null){const t=new LinkSettings;t.fa=Spot.None,t.ua=Spot.None,t.da=10,t.ga=10,t.ma=0,t.pa=0,this.q=t}}raiseChangedEvent(t,i,e,s,n,o,r){const l=this.part;if(l!==null){l.Jc(t,i,e,s,n,o,r),e===this&&t===2&&this.$c()&&this.ya(l,i);const h=this.diagram;if(this.ys!==null&&h!==null&&h.Bh&&!h.undoManager.isUndoingRedoing&&!h.animationManager.wu){const a=this.ys.get(i);if(a!==null&&h.animationManager.isEnabled&&!h.animationManager.isTicking){this.Zu===null&&(this.Zu=new GMap);let c=h.undoManager.transactionLevel===0;if(a.startCondition===2?c=!0:a.startCondition===3&&(c=!1),c){const f=new Animation;a.bF(f);const u=this.Zu.get(a);u!==null&&u.stop(),this.Zu.set(a,f),f.cx=this,f.FM=a,f.add(this,i,s,n),f.start()}else h.animationManager.getBundleAnimation().add(this,i,s,n)}}if(this instanceof Panel&&e===l&&l.s2()&&l.data!==null){const a=this.L.r,c=a.length;for(let f=0;f<c;f++){const u=a[f];u instanceof Panel&&u.Hr(d=>{d.data!==null&&d.s2()&&d.updateTargetBindings(i)})}}}}pF(t){this.Zu.delete(t)}Oo(){if(this.diagram===null)return;if(this.findBindingPanel()===null&&this.Ai!==null){const i=this.Ai.iterator;for(;i.next();){const e=i.value;if(!e.isToTheme)continue;let s=null;const n=e.sourceName;e.isToObject&&(s=this._L(n));let o=this;const r=e.targetId;r!==-1&&(o=this.p0(r),o===null)||(n==="/"?s=o.part:n==="."?s=o:n===".."&&(s=o.panel),e.updateTarget(o,s))}}}ya(t,i){const e=this.findBindingPanel();if(e!==null){const s=this.Ai.iterator;for(;s.next();){const n=s.value;let o=null;if(n.isToObject){if(o=n.tA(e,this),o===null)continue;n.updateSource(this,o,i,null)}else if(n.isToModel){const r=t.diagram;r!==null&&!r.fe&&n.updateSource(this,r.model.modelData,i,e)}else if(!n.isToTheme){const r=e.data;if(r===null)continue;const l=t.diagram;l!==null&&!l.fe&&n.updateSource(this,r,i,e)}if(o===this){const r=n.targetId,l=e.p0(r);l!==null&&n.updateTarget(l,o,i)}}}}p0(t){return this.$n===t?this:null}_L(t){let i;return t===""?i=this:t==="/"?i=this:t==="."?i=this:t===".."?i=this:i=this.part.findObject(t),i}get $n(){return this.f!==null?this.f.$n:-1}set $n(t){this.$n!==t&&(this.f===null&&(this.f=new GraphObjectTemplateSettings),this.f.$n=t)}get Ai(){return this.f!==null?this.f.Ai:null}set Ai(t){this.Ai!==t&&(this.f===null&&(this.f=new GraphObjectTemplateSettings),this.f.Ai=t)}get Zn(){return this.f!==null?this.f.Zn:null}set Zn(t){this.Zn!==t&&(this.f===null&&(this.f=new GraphObjectTemplateSettings),this.f.Zn=t)}raiseChanged(t,i,e){this.raiseChangedEvent(2,t,this,i,e)}t(t,i,e){this.raiseChangedEvent(2,t,this,i,e)}Qn(t,i,e,s){const n=this.se;if(n.e(t,i,e,s),this.et!==1||this.Kt!==0){this.bi===null&&(this.bi=new Transform);const o=this.bi;o.vi(),this.y0(o,t,i,e,s),o.Vg(n)}}iA(t,i,e){return this.pickable===!1?!1:(e.ic(this.D),i?this.intersectsRect(t,e):this.containedInRect(t,e))}eA(t,i,e){if(this.pickable===!1)return!1;const s=this.naturalBounds,n=t.distanceSquaredPoint(i);return e?Point.distanceLineSegmentSquared(t.x,t.y,0,0,0,s.height)<=n||Point.distanceLineSegmentSquared(t.x,t.y,0,s.height,s.width,s.height)<=n||Point.distanceLineSegmentSquared(t.x,t.y,s.width,s.height,s.width,0)<=n||Point.distanceLineSegmentSquared(t.x,t.y,s.width,0,0,0)<=n:t.distanceSquared(0,0)<=n&&t.distanceSquared(0,s.height)<=n&&t.distanceSquared(s.width,0)<=n&&t.distanceSquared(s.width,s.height)<=n}pn(){return!0}containsPoint(t){const i=Point.l();i.a(t),this.D.xt(i);const e=this.actualBounds;if(!e.isReal())return Point.s(i),!1;const s=this.diagram;if(s!==null&&s.Qm){const o=s.getInputOption("extraTouchThreshold"),r=s.getInputOption("extraTouchArea"),l=r/2,h=this.naturalBounds,a=this.getDocumentScale()*s.scale,c=1/a;if(h.width*a<o&&h.height*a<o){const f=Rect.contains(e.x-l*c,e.y-l*c,e.width+r*c,e.height+r*c,i.x,i.y);return Point.s(i),f}}let n=!1;return(this instanceof Adornment||this instanceof Shape?Rect.contains(e.x-5,e.y-5,e.width+10,e.height+10,i.x,i.y):e.containsPoint(i))&&(this.oi&&!this.oi.containsPoint(i)?n=!1:this.Ct!==null&&this.Xi.containsPoint(t)?n=!0:n=this.hh(t)),Point.s(i),n}hh(t){const i=this.naturalBounds;return Rect.contains(0,0,i.width,i.height,t.x,t.y)}containsRect(t){if(this.angle===0)return this.actualBounds.containsRect(t);const i=this.naturalBounds,e=Rect.X(0,0,i.width,i.height),s=this.D;let n=!1;const o=Point.X(t.x,t.y);return e.containsPoint(s.ts(o))&&(o.e(t.x,t.bottom),e.containsPoint(s.ts(o))&&(o.e(t.right,t.bottom),e.containsPoint(s.ts(o))&&(o.e(t.right,t.y),e.containsPoint(s.ts(o))&&(n=!0)))),Point.s(o),Rect.s(e),n}containedInRect(t,i){if(i===void 0)return t.containsRect(this.actualBounds);const e=this.naturalBounds,s=i;let n=!1;const o=Point.X(0,0);return t.containsPoint(s.xt(o))&&(o.e(0,e.height),t.containsPoint(s.xt(o))&&(o.e(e.width,e.height),t.containsPoint(s.xt(o))&&(o.e(e.width,0),t.containsPoint(s.xt(o))&&(n=!0)))),Point.s(o),n}intersectsRect(t,i){if(i===void 0&&(i=this.D,this.angle===0))return t.intersectsRect(this.actualBounds);const e=this.naturalBounds,s=i,n=Point.X(0,0),o=Point.X(0,e.height),r=Point.X(e.width,e.height),l=Point.X(e.width,0);let h=!1;if(t.containsPoint(s.xt(n))||t.containsPoint(s.xt(o))||t.containsPoint(s.xt(r))||t.containsPoint(s.xt(l)))h=!0;else{const a=Rect.X(0,0,e.width,e.height),c=Point.X(t.x,t.y);a.containsPoint(s.ts(c))?h=!0:(c.e(t.x,t.bottom),a.containsPoint(s.ts(c))?h=!0:(c.e(t.right,t.bottom),a.containsPoint(s.ts(c))?h=!0:(c.e(t.right,t.y),a.containsPoint(s.ts(c))&&(h=!0)))),Point.s(c),Rect.s(a),h||(Geo.kw(t,n,o)||Geo.kw(t,o,r)||Geo.kw(t,r,l)||Geo.kw(t,l,n))&&(h=!0)}return Point.s(n),Point.s(o),Point.s(r),Point.s(l),h}getDocumentPoint(t,i){if(i===void 0&&(i=new Point),t instanceof Spot){const e=t,s=this.naturalBounds;return i.e(e.x*s.width+e.offsetX,e.y*s.height+e.offsetY),this.Es.xt(i),i}else return i.set(t),this.Es.xt(i),i}getDocumentBounds(t){t===void 0&&(t=new Rect);const i=this.naturalBounds,e=this.Es,s=Point.X(0,0).D(e);return t.e(s.x,s.y,0,0),s.e(i.width,0).D(e),t.unionNoCheck(s.x,s.y,0,0),s.e(i.width,i.height).D(e),t.unionNoCheck(s.x,s.y,0,0),s.e(0,i.height).D(e),t.unionNoCheck(s.x,s.y,0,0),Point.s(s),t}getDocumentAngle(){return this.Es.FD()}getDocumentScale(){if(this.w0()===!1)return this.ca;const t=this.et;return this.panel!==null?t*this.panel.getDocumentScale():t}getLocalPoint(t,i){return i===void 0&&(i=new Point),i.a(t),this.Es.ts(i),i}getNearestIntersectionPoint(t,i,e){return this.Zc(t.x,t.y,i.x,i.y,e)}Zc(t,i,e,s,n){const o=this.D,r=1/(o.m11*o.m22-o.m12*o.m21),l=o.m22*r,h=-o.m12*r,a=-o.m21*r,c=o.m11*r,f=r*(o.m21*o.dy-o.m22*o.dx),u=r*(o.m12*o.dx-o.m11*o.dy),d=t*l+i*a+f,m=t*h+i*c+u,g=e*l+s*a+f,p=e*h+s*c+u;n.e(0,0);const y=this.naturalBounds,x=Geo.ml(0,0,y.width,y.height,d,m,g,p,n);return n.D(o),x}ut(t,i,e,s){if(this.vo()===!1)return;const n=this.$r,o=n.right+n.left,r=n.top+n.bottom;t=Math.max(t-o,0),i=Math.max(i-r,0),e=e||0,s=s||0,e=Math.max(e-o,0),s=Math.max(s-r,0);const l=this.angle;let h=0;const a=this.desiredSize,c=this.x0();l===90||l===270?(t=isFinite(a.height)?a.height+c:t,i=isFinite(a.width)?a.width+c:i):(t=isFinite(a.width)?a.width+c:t,i=isFinite(a.height)?a.height+c:i);let f=e||0,u=s||0;const d=this instanceof Panel;switch(this.zs(!0)){case 0:f=0,u=0,d&&(t=1/0,i=1/0);break;case 2:isFinite(t)&&t>e&&(f=t),isFinite(i)&&i>s&&(u=i);break;case 5:isFinite(t)&&t>e&&(f=t),u=0,d&&(i=1/0);break;case 4:isFinite(i)&&i>s&&(u=i),f=0,d&&(t=1/0);break}const g=this.maxSize,p=this.minSize;f>g.width&&p.width<g.width&&(f=g.width),u>g.height&&p.height<g.height&&(u=g.height),e=Math.max(f,p.width),s=Math.max(u,p.height),g.width<e&&(e=Math.min(p.width,e)),g.height<s&&(s=Math.min(p.height,s)),t=Math.min(g.width,t),i=Math.min(g.height,i),t=Math.max(e,t),i=Math.max(s,i),(l===90||l===270)&&(h=t,t=i,i=h,h=e,e=s,s=h),this.se.ot(),this._u(t,i,e,s),this.se.g(),this.se.isReal()||Util.o("Non-real measuredBounds has been set. Object "+this+", measuredBounds: "+this.se.toString()),this.ue(!1)}_u(t,i,e,s){}Xs(){return!1}Xt(t,i,e,s,n){this.Qc();const o=Rect.l();o.a(this.Li),this.Li.ot(),this.es()===!1?this.Li.e(t,i,e,s):this.ah(t,i,e,s),this.Li.g(),n===void 0?this.oi=null:this.oi=n;let r=!1;if(n!==void 0)r=!0;else{let l=this.panel;if(l!==null&&l.Qr()&&(l=l.panel),l!==null){const h=l.Xi,a=this.measuredBounds,c=i+a.height,f=t+a.width;if(r=!(0<=t+.05&&f<=h.width+.05&&0<=i+.05&&c<=h.height+.05),this instanceof TextBlock){const u=this.naturalBounds;(this.b0>u.height||this.mi>u.width)&&(r=!0)}}}r?this.n|=256:this.n&=-257,this.Li.isReal()||Util.o("Non-real actualBounds has been set. Object "+this+", actualBounds: "+this.Li.toString()),this.td(o,this.Li),this._n(!1),Rect.s(o)}ah(t,i,e,s){}commonArrange(t,i,e,s){if(this.Li.e(t,i,e,s),this.desiredSize.isReal())return;const n=this.se,o=this.$r,r=o.right+o.left,l=o.top+o.bottom,h=n.width+r,a=n.height+l;e+=r,s+=l;let c=this.zs(!0);switch(h===e&&a===s&&(c=0),c){case 0:(h>e||a>s)&&(this.ue(!0),this.ut(h>e?e:h,a>s?s:a,0,0));break;case 2:this.ue(!0),this.ut(e,s,0,0);break;case 5:this.ue(!0),this.ut(e,a,0,0);break;case 4:this.ue(!0),this.ut(h,s,0,0);break}}td(t,i){const e=this.part;e!==null&&e.diagram!==null&&((e.selectionObject===this||e.resizeObject===this||e.rotateObject===this)&&e.o2(!0),this.C(),!t.equalsApproxClose(i)&&(e.ch(),this.k0(e)))}k0(t){this.portId!==null&&(t.o2(!0),t instanceof Node&&t.sA(this))}get shadowVisible(){return this.f!==null?this.f.P0:null}set shadowVisible(t){const i=this.shadowVisible;i!==t&&(this.Ht(),this.f.P0=t,this.Ke(!0),this.C(),this.t("shadowVisible",i,t))}NR(t,i){const e=this.naturalBounds,s=this.oh,n=s.m11,o=s.m21,r=s.dx,l=s.m12,h=s.m22,a=s.dy;let c=0,f=0,u=c,d=f;c=u*n+d*o+r,f=u*l+d*h+a;let m=c,g=f,p=0,y=0;u=e.width+i,d=0,c=u*n+d*o+r,f=u*l+d*h+a;let x=Math.min(m,c),k=Math.min(g,f);p=Math.max(m+p,c)-x,y=Math.max(g+y,f)-k,m=x,g=k,u=e.width+i,d=e.height+i,c=u*n+d*o+r,f=u*l+d*h+a,x=Math.min(m,c),k=Math.min(g,f),p=Math.max(m+p,c)-x,y=Math.max(g+y,f)-k,m=x,g=k,u=0,d=e.height+i,c=u*n+d*o+r,f=u*l+d*h+a,x=Math.min(m,c),k=Math.min(g,f),p=Math.max(m+p,c)-x,y=Math.max(g+y,f)-k,m=x,g=k;const b=t.viewportBounds,P=b.x,M=b.y,L=b.width,C=b.height;return m>L+P||P>p+m||g>C+M||M>y+g}Ui(t,i){if(this.CR(t,i)||!this.visible)return;const e=this.opacity;if(e===0)return;let s=1;e!==1&&(s=t.globalAlpha,t.globalAlpha=s*e);let n="";this.filter!==""&&(n=t.filter,t.filter=this.filter);const o=this.D,r=this.panel;this.w0()===!0&&this.Fb();const l=this.part;let h=!1,a=0;if(l&&i.getRenderingHint("drawShadows")&&(h=l.isShadowed,h)){const g=l.shadowOffset;a=Math.max(g.y,g.x)*i.scale*i.zi}const c=this instanceof Panel&&this.Qr(),f=this.Li;if(c&&(this.nA(h,t,!1,r),this.LR(t,i),this.oA(h,t,!1,r),this.rA(h,t,!1)),c||!c&&(f.width===0||f.height===0||isNaN(f.x)||isNaN(f.y))){e!==1&&(t.globalAlpha=s),this.filter!==""&&(t.filter=n);return}const u=this.Xs();if(!i.Qh&&u&&this.NR(i,a)){e!==1&&(t.globalAlpha=s),this.filter!==""&&(t.filter=n);return}let d=(this.n&256)!==0;if(t.clipInsteadOfFill&&(d=!1),this instanceof TextBlock&&(t.font=this.font),d){const g=r.pn()?r.naturalBounds:r.actualBounds;let p=Math.max(f.x,g.x),y=Math.max(f.y,g.y),x=Math.min(f.right,g.right)-p,k=Math.min(f.bottom,g.bottom)-y;const b=this.oi;if(b!==null&&(p=b.x,y=b.y,x=b.width,k=b.height),p>f.width+f.x||f.x>g.width+g.x){e!==1&&(t.globalAlpha=s),this.filter!==""&&(t.filter=n);return}t.save(),t.beginPath(),t.rect(p,y,x,k),t.clip()}if(u){if(!l.isVisible()){e!==1&&(t.globalAlpha=s),this.filter!==""&&(t.filter=n);return}if(h){const g=l.shadowOffset;t.shadowsSet(g.x*i.scale*this.scale*i.zi,g.y*i.scale*this.scale*i.zi,l.shadowBlur),t.shadowsOn(),t.shadowColor=l.shadowColor}}const m=this.naturalBounds;if(t.transform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.nA(h,t,u,r),this.Ct!==null&&(t.commitTransform(),this.Rb(t,m,f)),this.oA(h,t,u,r),this.fh(t,i),this.rA(h,t,u),d&&(t.restore(),t.clearContextCache(this instanceof Panel)),!o.Ok()){const g=1/(o.m11*o.m22-o.m12*o.m21);t.transform(o.m22*g,-o.m12*g,-o.m21*g,o.m11*g,g*(o.m21*o.dy-o.m22*o.dx),g*(o.m12*o.dx-o.m11*o.dy))}e!==1&&(t.globalAlpha=s),this.filter!==""&&(t.filter=n)}nA(t,i,e,s){t&&this.shadowVisible===!0?i.shadowsOn():t&&this.shadowVisible===!1&&i.shadowsOff(),t&&this.vb(s)&&this.shadowVisible===null&&i.shadowsOff()}oA(t,i,e,s){t&&(this.Ct!==null||this.vb(s))?(this.Ob(!0),this.shadowVisible===null&&i.shadowsOff()):this.Ob(!1)}rA(t,i,e){t&&this.l2()===!0&&i.shadowsOn(),e&&t&&i.shadowsOff()}AR(t,i,e){const s=this.part;let n=!1;s&&t.getRenderingHint("drawShadows")&&(n=s.isShadowed),i.clipInsteadOfFill&&(n=!1),this.Xs()&&n&&i.shadowsOn(),n&&this.shadowVisible===!0?i.shadowsOn():n&&this.shadowVisible===!1&&i.shadowsOff();const o=this.panel;if(n&&this.vb(o)&&this.shadowVisible===null&&i.shadowsOff(),i._r){const r=t.computePixelRatio(),l=`drop-shadow(${i.shadowOffsetX/r}px ${i.shadowOffsetY/r}px ${i.shadowBlur/r/2}px ${i.shadowColor})`;this.background!==null&&e.Ct.setAttributeNS(null,"filter",l)}return n&&(this.Ct!==null||this.vb(o))?(this.Ob(!0),this.shadowVisible===null&&i.shadowsOff()):this.Ob(!1),n}TR(t,i,e,s){if(e._r){const n=i.computePixelRatio(),o=`drop-shadow(${e.shadowOffsetX/n}px ${e.shadowOffsetY/n}px ${e.shadowBlur/n/2}px ${e.shadowColor})`;this.h2(t,o)}s&&this.l2()===!0&&e.shadowsOn(),this.Xs()&&e.shadowsOff()}vb(t){return t===null?!1:(t.Qr()&&(t=t.panel),t.l2()||(t.type===Panel.Auto||t.type===Panel.Spot)&&t.findMainElement()!==this)}h2(t,i){}Rb(t,i,e){const s=this.x0(),n=i.x,o=i.y,r=i.width+s,l=i.height+s;this.dn(t,this.Ct,!0,!1,i,e),this.Ct instanceof Brush&&this.Ct.type===3?(t.beginPath(),t.rect(n-s/2,o-s/2,r,l),t.fillContext(this.Ct,!1,null)):t.fillRect(n-s/2,o-s/2,r,l)}lA(t,i){let e=t.DR(this);const s=t.rh!==null?t.rh:t.svg;if(e!==-1)if(e===0)if(s.Ct)s.Ct.after(i);else if(t.type===Panel.Table){const n=s.getElementsByClassName("gojs-ts"),o=n.length!==0?n[0]:null;o!==null&&o.after(i)}else s.prepend(i);else{for(;e!==0&&!t.elt(e-1).isVisibleObject();)e--;if(e===0)s.prepend(i);else{const n=t.elt(e-1).svg;n!==null?n.after(i):s.appendChild(i)}}}CR(t,i){if(!(t instanceof SVGContext))return!1;if(!this.visible||this.opacity===0)return this.svg!==null&&this.svg.parentNode!==null&&this.svg.remove(),!0;const e=this.Li;if(this.Xs()&&(!this.isVisible()||e.width===0||e.height===0||isNaN(e.x)||isNaN(e.y)))return this.svg!==null&&this.svg.parentNode!==null&&this.svg.remove(),!0;const s=this.panel,n=this.ed(t);if(this._c(t,i,n))return this.hA(this.svg),this.svg.parentElement!==null?(this.Xs()&&(t.lastDrawnPart=this.svg),!0):(this.Xs()?(t.lastDrawnPart!==null?t.lastDrawnPart.after(this.svg):t.diagramGroup.prepend(this.svg),t.lastDrawnPart=this.svg):s&&this.lA(s,this.svg),!0);if(this.Ke(!1),this.Xs()&&this.isShadowed){const m=this.shadowOffset;t.shadowsSet(m.x*i.scale*this.scale*i.zi,m.y*i.scale*this.scale*i.zi,this.shadowBlur),t.shadowsOn(),t.shadowColor=this.shadowColor}this instanceof TextBlock&&(t.font=this.font),t.currentElement=null;const o=this.D,r=this instanceof Panel,l=this instanceof Panel?this.Qr():!1,h=this.svg;if(this.w0()===!0&&this.Fb(),t.setCurrentTransform(1,0,0,1,0,0),t.outerGroup=!1,n)if(t.outerGroup=!0,r&&l)t.newGroup(1,0,0,1,0,0),this.svg=t.lastCreatedElement;else if(r&&this.isClipping){const m=this.findMainElement();let g=0,p=0;m!==null&&(g=m.actualBounds.x,p=m.actualBounds.y),t.newGroup(o.m11,o.m12,o.m21,o.m22,o.dx+g,o.dy+p),this.svg=t.lastCreatedElement,m!==null&&t.createOrUpdateClipGroup(this,m.actualBounds),t.currentElement=t.lastCreatedElement}else r?(t.newGroup(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.svg=t.lastCreatedElement):t.newGroup(1,0,0,1,0,0);const a=this.naturalBounds;r||t.setCurrentTransform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.background!==null&&(r?(l&&t.setCurrentTransform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.Rb(t,a,e),l&&t.setCurrentTransform(1,0,0,1,0,0)):(t.setCurrentTransform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),this.Rb(t,a,e)),t.currentElement.Ct=t.lastCreatedElement,t.currentElement.prepend(t.lastCreatedElement));const c=this.AR(i,t,t.currentElement);this.fh(t,i),r&&t.endGroup(),t.outerGroup&&t.endGroup();const f=t.surface.ju,u=r?this.svg:t.currentElement;if(h!==null&&u!==h&&h.parentNode===this.panel.svg){const m=this.svg.getAttribute("filter");return m!==null&&u.setAttribute("filter",m),h.replaceWith(u),this.svg=u,u!==null&&this.M0(t,s,e,u),!0}if(this.svg=u,f!==null&&u===null&&t.dummyGroup(),u===null)return!0;this.M0(t,s,e,u),this.TR(u,i,t,c);const d=this.Xs()?this.opacity*t.globalAlpha:this.opacity;if(d!==1&&u.setAttributeNS(null,"opacity",d.toString()),this.filter!==""&&u.setAttributeNS(null,"filter",this.filter),this.Xs()){if(h!==null&&u!==h&&h.parentNode===t.diagramGroup){const m=h.getAttribute("filter");m!==null&&u.setAttribute("filter",m),h.replaceWith(u)}else t.lastDrawnPart?t.lastDrawnPart.after(u):t.diagramGroup.prepend(u);t.lastDrawnPart=u}else s!==null&&this.lA(s,u);return f!==null&&f(this,u),this.hA(u),!0}hA(t){const i=this,e=t.dataset;i instanceof GraphObject&&(i.portId!==null&&(e.portId=i.portId),i instanceof Panel&&(isNaN(i.itemIndex)||(e.itemIndex=i.itemIndex.toString()),i instanceof Part&&(e.className=Util.sn(i),i.key!==void 0&&(e.key=i.key.toString()),i.containingGroup!==null&&(e.group=i.containingGroup.key.toString()),i instanceof Link&&(i.fromNode!==null&&i.fromNode.key!==void 0&&(e.fromKey=i.fromNode.key.toString()),i.fromPortId!==""&&(e.fromPortId=i.fromPortId),i.toNode!==null&&i.toNode.key!==void 0&&(e.toKey=i.toNode.key.toString()),i.toPortId!==""&&(e.toPortId=i.toPortId)))))}M0(t,i,e,s){let n=(this.n&256)!==0;if(t.clipInsteadOfFill&&(n=!1),!n){s.removeAttributeNS(null,"clip-path");return}const o=i.pn()?i.naturalBounds:i.actualBounds;let r=Math.max(e.x,o.x),l=Math.max(e.y,o.y),h=Math.min(e.right,o.right)-r,a=Math.min(e.bottom,o.bottom)-l;const c=this.oi;c!==null&&(r=c.x,l=c.y,h=c.width,a=c.height);const f=new Rect(r,l,Math.max(h,0),Math.max(a,0));this instanceof Panel&&this.D.copy().yw().Vg(f),s.setAttributeNS(null,"clip-path",`path('      M ${f.x},${f.y}       L ${f.width+f.x} ${f.y}       L ${f.width+f.x} ${f.height+f.y}       L ${f.x} ${f.height+f.y} z') view-box`)}FR(){if(this.svg===null)return;const t=this.svg.innerHTML.match(/url\(#((CLIP|GRAD).+?)\)/g),i=this.svg.ownerDocument;if(t!==null)for(const e of t){const s=i.getElementById(e.split("#")[1].slice(0,-1));s!==null&&s.remove()}this.svg.remove()}LR(t,i){const e=this.Li,s=this.Xi,n=this.Ct;n!==null&&t.commitTransform(),n!==null&&(this.dn(t,n,!0,!1,s,e),n instanceof Brush&&n.type===3?(t.beginPath(),t.rect(e.x,e.y,e.width,e.height),t.fillContext(n,!1,null)):t.fillRect(e.x,e.y,e.width,e.height)),this.fh(t,i)}fh(t,i){}sd(){this.Ke(!0)}_c(t,i,e){const s=this.svg;if(this.RR()){if(this.sd(),this.Ke(!1),s===null)return!1;const c=s.getAttribute("clip-path");if(c!==null&&c.includes("url")){const u=t.svg.getElementById(c.split("#")[1].slice(0,-1));u!==null&&u.remove()}return s.getAttribute("filter")&&s.removeAttribute("filter"),!1}if(s===null)return!1;if(!this.visible)return s.remove(),!1;if(s.nodeName!=="g"&&e||s.nodeName==="g"&&!e)return!1;const n=this.D,o="matrix("+n.m11+", "+n.m12+", "+n.m21+", "+n.m22+", "+n.dx+", "+n.dy+")",r=this instanceof Panel,l=r?this.Qr():!1;if(!(r&&l))if(this instanceof Picture){const c=this.Ib;t.setCurrentTransform(n.m11,n.m12,n.m21,n.m22,n.dx,n.dy),c!==null&&t.amendImageTransform(c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7]),e?s.lastElementChild.setAttributeNS(null,"transform",t.getCurrentTransform()):s.setAttributeNS(null,"transform",t.getCurrentTransform())}else if(e&&!r)if(this instanceof Shape){const c=s.getElementsByTagName("path");for(let f=0;f<c.length;f++)c[f].setAttributeNS(null,"transform",o)}else if(this instanceof TextBlock){const c=s.getElementsByTagName("text");for(let f=0;f<c.length;f++)c[f].setAttributeNS(null,"transform",o)}else(s.lastElementChild||s).setAttributeNS(null,"transform",o);else if(r&&this.isClipping&&this.rh){const c=this.findMainElement(),f=c!==null?c.actualBounds.x:0,u=c!==null?c.actualBounds.y:0;this.rh.setAttributeNS(null,"transform","matrix(1,0,0,1,"+-f+", "+-u+")"),s.setAttributeNS(null,"transform","matrix("+n.m11+", "+n.m12+", "+n.m21+", "+n.m22+", "+(n.dx+f)+", "+(n.dy+u)+")")}else s.setAttributeNS(null,"transform",o);const h=this.Xs()?this.opacity*t.globalAlpha:this.opacity;h===1?s.removeAttribute("opacity"):s.setAttributeNS(null,"opacity",h.toString()),t.setCurrentTransform(1,0,0,1,0,0);const a=this.rh?this.rh:this.Db;if(this.background!==null||a.Ct!==void 0){const c=a.Ct;if(this.background===null)t.removeOldGradient(this,a.Ct,"fill"),a.Ct.remove(),a.Ct=void 0;else{if((l||e&&!(this instanceof Panel))&&t.setCurrentTransform(n.m11,n.m12,n.m21,n.m22,n.dx,n.dy),this.Rb(t,this.naturalBounds,this.actualBounds),a.Ct){t.removeOldGradient(this,a.Ct,"fill");const f=a.Ct.getAttribute("filter");f!==null&&t.lastCreatedElement.setAttribute("filter",f),a.Ct.replaceWith(t.lastCreatedElement)}else a.prepend(t.lastCreatedElement);a.Ct=t.lastCreatedElement}c&&t.removeOldGradient(this,c,"fill")}return this.M0(t,this.panel,this.actualBounds,s),!0}ed(t){if(this.background!==null)return!0;let i=(this.n&256)!==0;return t.clipInsteadOfFill&&(i=!1),!!i}static fE(t,i,e,s,n,o,r){let l=.001;const h=o.length;t.moveTo(i,e);let a=s-i;const c=n-e;a===0&&(a=.001);const f=c/a;let u=Math.sqrt(a*a+c*c),d=0,m=!0;l=o[d%h];let g=r!==0;for(;u>=.1;){if(g){for(l=o[d++%h],l-=r;l<0;)l+=o[d++%h],m=!m;g=!1}else l=o[d++%h];l>u&&(l=u);let p=Math.sqrt(l*l/(1+f*f));a<0&&(p=-p),i+=p,e+=f*p,m?t.lineTo(i,e):t.moveTo(i,e),u-=l,m=!m}}dn(t,i,e,s,n,o){let r=1,l=1;if(typeof i=="string"){e?t.fillStyle=i:t.strokeStyle=i;return}else if(i.type===1){e?t.fillStyle=i.color:t.strokeStyle=i.color;return}let h;const a=this.x0();r=n.width,l=n.height,s?(r=o.width,l=o.height):e||(r+=a,l+=a);const c=t instanceof CanvasSurfaceContext;if(c&&i.yn&&(i.type===4||i.tf===r&&i.Eb===l))h=i.yn;else{let f=0,u=0,d=0,m=0,g=0,p=0,y=0,x=0;if(s?(y=o.x,x=o.y):e||(y-=a/2,x-=a/2),f=i.start.x*r+i.start.offsetX+y,u=i.start.y*l+i.start.offsetY+x,d=i.end.x*r+i.end.offsetX+y,m=i.end.y*l+i.end.offsetY+x,i.type===2)h=t.createLinearGradient(f,u,d,m);else if(i.type===3)p=isNaN(i.endRadius)?Math.max(r,l)/2:i.endRadius,isNaN(i.startRadius)?(g=0,p=Math.max(r,l)/2):g=i.startRadius,h=t.createRadialGradient(f,u,g,d,m,p);else if(i.type===4)try{h=t.createPattern(i.pattern,"repeat")}catch{h=null}else Util.we(i.type,"Brush type");if(i.type!==4){const k=i.colorStops;if(k!==null){const b=k.iterator;for(;b.next();)h.addColorStop(b.key,b.value)}}if(c&&(i.yn=h,h!==null&&(i.tf=r,i.Eb=l),h===null&&i.type===4&&i.tf!==-1)){i.tf=-1;const k=this.diagram;k!==null&&i.tf===-1&&Util.Oh(()=>{k.redraw()},600)}}e?t.fillStyle=h:t.strokeStyle=h}isContainedBy(t){return t instanceof Panel?this.vR(this,t):!1}vR(t,i){if(t===i||i===null)return!1;let e=t.panel;for(;e!==null;){if(e===i)return!0;e=e.panel}return!1}isVisibleObject(){if(!this.visible)return!1;const t=this.panel;return t!==null?t.isVisibleObject():!0}isEnabledObject(){let t=this instanceof Panel?this:this.panel;for(;t!==null&&t.isEnabled;)t=t.panel;return t===null}get enabledChanged(){return this.f!==null?this.f.S0:null}set enabledChanged(t){const i=this.enabledChanged;i!==t&&(t!==null&&Util.i(t,"function",GraphObject,"enabledChanged"),this.Ht(),this.f.S0=t,this.t("enabledChanged",i,t))}Fb(){if(this.Bb()===!0){const t=this.Jr;if(t.vi(),!this.Li.isReal()||!this.se.isReal()){this.nd(!1);return}if(t.Ds(this.Li.x-this.se.x,this.Li.y-this.se.y),this.scale!==1||this.angle!==0){const i=this.naturalBounds;this.y0(t,i.x,i.y,i.width,i.height)}this.nd(!1),this.wa(!0)}if(this.w0()===!0){const t=this.panel;if(t===null)this.oh.set(this.Jr),this.ca=this.scale;else if(t.Es!==null){const i=this.oh;i.vi(),t.pn()?i.ic(t.oh):t.panel!==null&&i.ic(t.panel.oh),i.ic(this.Jr),this.ca=this.scale*t.ca}this.wa(!1)}}y0(t,i,e,s,n){if(this.et!==1&&t.et(this.et),this.Kt===0)return;const o=Point.l();o.setSpot(i,e,s,n,Spot.Center),t.cs(this.Kt,o.x,o.y),Point.s(o)}c(t){if(this.vo())return;t===void 0&&(t=!1),this.ue(!0),this._n(!0);const i=this.panel;i!==null&&!t&&i.c()}ef(){this.vo()||(this.ue(!0),this._n(!0))}sf(t){if(this.es())return;const i=this.panel;!t&&i!==null&&i.c(),this._n(!0)}Qc(){this.Bb()===!1&&(this.nd(!0),this.wa(!0))}a2(){this.wa(!0)}C(){const t=this.part;t!==null&&t.C()}zs(t){const i=this.stretch,e=this.panel;if(e===null)return this.Vo(i===1?0:i,t);if(e.type===Panel.Table)return this.N0(e.getRowDefinition(this.row),e.getColumnDefinition(this.column),t);if(e.type===Panel.Auto&&e.findMainElement()===this)return this.Vo(2,t);if(i===1){if(e.type===Panel.Spot&&e.findMainElement()===this)return this.Vo(2,t);const s=e.defaultStretch;return s===1?this.Vo(0,t):this.Vo(s,t)}return this.Vo(i,t)}N0(t,i,e){const s=this.stretch;if(s!==1)return this.Vo(s,e);let n=null,o=null;switch(t.stretch){case 1:case 5:break;case 4:o=!0;break;case 2:o=!0;break}switch(i.stretch){case 1:case 4:break;case 5:n=!0;break;case 2:n=!0;break}const r=this.panel.defaultStretch;return n===null&&(n=r===5||r===2),o===null&&(o=r===4||r===2),n===!0&&o===!0?this.Vo(2,e):n===!0?this.Vo(5,e):o===!0?this.Vo(4,e):this.Vo(0,e)}Vo(t,i){if(i)return t;if(t===0)return 0;const e=this.desiredSize;if(e.isReal())return 0;const s=!isNaN(e.width),n=!isNaN(e.height),o=this.angle;if(s)if(o!==90&&o!==270){if(t===5)return 0;if(t===2)return 4}else{if(t===4)return 0;if(t===2)return 5}if(n)if(o!==90&&o!==270){if(t===4)return 0;if(t===2)return 5}else{if(t===5)return 0;if(t===2)return 4}return t}get segmentOrientation(){return this.Bt!==null?this.Bt.C0:0}set segmentOrientation(t){const i=this.segmentOrientation;i!==t&&(this.Bt===null&&(this.Bt=new LinkElementSettings),this.Bt.C0=t,this.c(),this.t("segmentOrientation",i,t),t===0&&(this.angle=0))}OR(){this.segmentOrientation=21}get segmentIndex(){return this.Bt!==null?this.Bt.L0:-1/0}set segmentIndex(t){t=Math.round(t);const i=this.segmentIndex;i!==t&&(this.Bt===null&&(this.Bt=new LinkElementSettings),this.Bt.L0=t,this.c(),this.t("segmentIndex",i,t))}get segmentFraction(){return this.Bt!==null?this.Bt.A0:0}set segmentFraction(t){isNaN(t)||t<0?t=0:t>1&&(t=1);const i=this.segmentFraction;i!==t&&(this.Bt===null&&(this.Bt=new LinkElementSettings),this.Bt.A0=t,this.c(),this.t("segmentFraction",i,t))}get segmentOffset(){return this.Bt!==null?this.Bt.T0:Point.Po}set segmentOffset(t){const i=this.segmentOffset;i.equals(t)||(t=t.N(),this.Bt===null&&(this.Bt=new LinkElementSettings),this.Bt.T0=t,this.c(),this.t("segmentOffset",i,t))}get stretch(){return this.f!==null?this.f.to:1}set stretch(t){const i=this.stretch;i!==t&&(this.Ht(),this.f.to=t,this.c(),this.t("stretch",i,t))}get name(){return this.f!==null?this.f.St:""}set name(t){const i=this.name;i!==t&&(this.Ht(),this.f.St=t,this.part!==null&&this.part.D0(),this.t("name",i,t))}get opacity(){return this.Jt}set opacity(t){const i=this.Jt;if(i!==t){Util.i(t,"number",GraphObject,"opacity"),(t<0||t>1)&&Util._(t,"0 <= value <= 1",GraphObject,"opacity"),this.Jt=t,this.t("opacity",i,t);const e=this.diagram,s=this.part;e!==null&&s!==null&&e.C(s.Hh(s.actualBounds))}}get filter(){return this.Ju}set filter(t){const i=this.Ju;if(i!==t){this.Ju=t,this.Ke(!0),this.t("filter",i,t);const e=this.diagram,s=this.part;e!==null&&s!==null&&e.C(s.Hh(s.actualBounds))}}get visible(){return(this.n&1)!==0}set visible(t){const i=(this.n&1)!==0;if(i!==t){this.n=this.n^1,this.sd(),this.t("visible",i,t);const e=this.panel;e!==null?e.c():this.Xs()&&this.Bi(t),this.C(),this.aA()}}get pickable(){return(this.n&2)!==0}set pickable(t){const i=(this.n&2)!==0;i!==t&&(this.n=this.n^2,this.t("pickable",i,t))}get fromLinkableDuplicates(){return(this.n&4)!==0}set fromLinkableDuplicates(t){const i=(this.n&4)!==0;i!==t&&(this.n=this.n^4,this.t("fromLinkableDuplicates",i,t))}get fromLinkableSelfNode(){return(this.n&8)!==0}set fromLinkableSelfNode(t){const i=(this.n&8)!==0;i!==t&&(this.n=this.n^8,this.t("fromLinkableSelfNode",i,t))}get toLinkableDuplicates(){return(this.n&16)!==0}set toLinkableDuplicates(t){const i=(this.n&16)!==0;i!==t&&(this.n=this.n^16,this.t("toLinkableDuplicates",i,t))}get toLinkableSelfNode(){return(this.n&32)!==0}set toLinkableSelfNode(t){const i=(this.n&32)!==0;i!==t&&(this.n=this.n^32,this.t("toLinkableSelfNode",i,t))}get isPanelMain(){return(this.n&64)!==0}set isPanelMain(t){const i=(this.n&64)!==0;i!==t&&(this.n=this.n^64,this.c(),this.t("isPanelMain",i,t))}get isActionable(){return(this.n&128)!==0}set isActionable(t){const i=(this.n&128)!==0;i!==t&&(this.n=this.n^128,this.t("isActionable",i,t))}get background(){return this.Ct}set background(t){const i=this.Ct;i!==t&&(t!==null&&Brush.od(t,"GraphObject.background"),t instanceof Brush&&t.g(),this.Ct=t,this.C(),this.t("background",i,t))}l2(){return(this.n&512)!==0}Ob(t){t?this.n|=512:this.n&=-513}$c(){return(this.n&1024)!==0}c2(t){t?this.n|=1024:this.n&=-1025}Bb(){return(this.n&2048)!==0}nd(t){t?this.n|=2048:this.n&=-2049}w0(){return(this.n&4096)!==0}wa(t){t?this.n|=4096:this.n&=-4097}vo(){return(this.n&8192)!==0}ue(t){t?this.n|=8192:this.n&=-8193}es(){return(this.n&16384)!==0}_n(t){t?this.n|=16384:this.n&=-16385}RR(){return(this.n&32768)!==0}Ke(t){t?this.n|=32768:this.n&=-32769}get part(){if(this.Xs())return this;if(this.Zr!==null)return this.Zr;let t=this;for(t=t.panel;t;){if(t instanceof Part)return this.Zr=t,t;t=t.panel}return null}get svg(){return this.Db}set svg(t){this.Db=t}Du(){this.svg=null}get panel(){return this.Vs}xa(t){this.Vs=t,this.svg!==null&&this.svg.remove()}get layer(){const t=this.part;return t!==null?t.layer:null}get diagram(){const t=this.part;return t!==null?t.diagram:null}get position(){return this.at}set position(t){const i=t.x,e=t.y,s=this.at,n=s.x,o=s.y;n!==i&&(!isNaN(n)||!isNaN(i))||o!==e&&(!isNaN(o)||!isNaN(e))?(t=t.copy(),this.f2(t,n,o)&&this.t("position",new Point(n,o),t)):this.u2()}u2(){}f2(t,i,e){return this.at=t,this.sf(),!0}bc(t,i,e){this.at.x===t&&this.at.y===i||(this.at.e(t,i),this.Qc())}get actualBounds(){return this.Li}get scale(){return this.et}set scale(t){const i=this.et;i!==t&&(t<=0&&Util.o("GraphObject.scale for "+this+" must be greater than zero, not: "+t),this.et=t,this.c(),this.t("scale",i,t))}get angle(){return this.Kt}set angle(t){const i=this.Kt;if(i!==t){if(t=t%360,t<0&&(t+=360),i===t)return;this.Kt=t,this.aA(),this.c(),this.t("angle",i,t)}}get desiredSize(){return this.ze}set desiredSize(t){const i=t.width,e=t.height,s=this.ze,n=s.width,o=s.height;if((n!==i&&(!isNaN(n)||!isNaN(i))||o!==e&&(!isNaN(o)||!isNaN(e)))&&(t=t.N(),this.ze=t,this.c(),this instanceof Shape&&this.ee(),this.t("desiredSize",s,t),this.$c())){const r=this.part;r!==null&&(this.ya(r,"width"),this.ya(r,"height"))}}get width(){return this.ze.width}set width(t){const i=this.ze.width;if(i!==t&&(!isNaN(i)||!isNaN(t))){const e=this.ze,s=new Size(t,this.ze.height).g();if(this.ze=s,this.c(),this instanceof Shape&&this.ee(),this.t("desiredSize",e,s),this.$c()){const n=this.part;n!==null&&this.ya(n,"width")}}}get height(){return this.ze.height}set height(t){const i=this.ze.height;if(i!==t&&(!isNaN(i)||!isNaN(t))){const e=this.ze,s=new Size(this.ze.width,t).g();if(this.ze=s,this.c(),this instanceof Shape&&this.ee(),this.t("desiredSize",e,s),this.$c()){const n=this.part;n!==null&&this.ya(n,"height")}}}get minSize(){return this.f!==null?this.f.xr:Size.ru}set minSize(t){const i=this.minSize;i.equals(t)||(t=t.copy(),isNaN(t.width)&&(t.width=0),isNaN(t.height)&&(t.height=0),t.g(),this.Ht(),this.f.xr=t,this.c(),this.t("minSize",i,t))}get maxSize(){return this.f!==null?this.f.br:Size.eC}set maxSize(t){const i=this.maxSize;i.equals(t)||(t=t.copy(),isNaN(t.width)&&(t.width=1/0),isNaN(t.height)&&(t.height=1/0),t.g(),this.Ht(),this.f.br=t,this.c(),this.t("maxSize",i,t))}get measuredBounds(){return this.se}get naturalBounds(){return this.Xi}x0(){return 0}get margin(){return this.$r}set margin(t){typeof t=="number"&&(t=new Margin(t));const i=this.$r;i.equals(t)||(t=t.N(),this.$r=t,this.c(),this.t("margin",i,t))}get D(){return this.Bb()===!0&&this.Fb(),this.Jr}get Es(){return this.w0()===!0&&this.Fb(),this.oh}trigger(t,i,e){let s=null;return typeof t=="string"?s=new AnimationTrigger(t,i,e):s=t,s.ke=this,this.ys===null&&(this.ys=new GMap),this.ys.set(s.propertyName,s),this}get ys(){return this.f!==null?this.f.ys:null}set ys(t){this.ys!==t&&(this.Ht(),this.f.ys=t)}get wr(){return this.f!==null?this.f.wr:0}set wr(t){this.wr!==t&&(this.Ht(),this.f.wr=t)}get alignment(){return this.ri}set alignment(t){const i=this.ri;i.equals(t)||(t.isNoSpot()&&!t.isDefault()&&Util.o("GraphObject.alignment for "+this+" must be a real Spot or Spot.Default, not: "+t),t=t.N(),this.ri=t,this.sf(),this.t("alignment",i,t))}get column(){return this.Bo}set column(t){t=Math.round(t);const i=this.Bo;i!==t&&(t<0&&Util._(t,">= 0",GraphObject,"column"),this.Bo=t,this.c(),this.t("column",i,t),this.svg!==null&&this.svg.remove())}get columnSpan(){return this.f!==null?this.f.F0:1}set columnSpan(t){t=Math.round(t);const i=this.columnSpan;i!==t&&(t<1&&Util._(t,">= 1",GraphObject,"columnSpan"),this.Ht(),this.f.F0=t,this.c(),this.t("columnSpan",i,t))}get row(){return this.Wu}set row(t){t=Math.round(t);const i=this.Wu;i!==t&&(t<0&&Util._(t,">= 0",GraphObject,"row"),this.Wu=t,this.c(),this.t("row",i,t),this.svg!==null&&this.svg.remove())}get rowSpan(){return this.f!==null?this.f.R0:1}set rowSpan(t){t=Math.round(t);const i=this.rowSpan;i!==t&&(t<1&&Util._(t,">= 1",GraphObject,"rowSpan"),this.Ht(),this.f.R0=t,this.c(),this.t("rowSpan",i,t))}get spanAllocation(){return this.f!==null?this.f.v0:null}set spanAllocation(t){const i=this.spanAllocation;i!==t&&(t!==null&&Util.i(t,"function",GraphObject,"spanAllocation"),this.Ht(),this.f.v0=t,this.c(),this.t("spanAllocation",i,t))}get alignmentFocus(){return this.Wc}set alignmentFocus(t){const i=this.Wc;i.equals(t)||(t=t.N(),this.Wc=t,this.c(),this.t("alignmentFocus",i,t))}get portId(){return this.qu}set portId(t){const i=this.qu;if(i!==t){const e=this.part;e!==null&&!(e instanceof Node)&&Util.o("Cannot set portID on a Link: "+t);const s=e;i!==null&&s!==null&&s.d2(this),this.qu=t,t!==null&&s!==null&&(s.wn=!0,s.cA(this)),this.t("portId",i,t)}}ba(){const t=this.part;if(t instanceof Node&&(this.portId!==null||this===t.port)){const i=t.diagram;i!==null&&!i.undoManager.isUndoingRedoing&&t.sA(this)}}aA(){const t=this.diagram;t===null||t.undoManager.isUndoingRedoing||(this instanceof Panel?this instanceof Node?this.invalidateConnectedLinks():this.walkVisualTreeFrom(this,i=>{i.ba()}):this.ba())}get toSpot(){return this.q!==null?this.q.ua:Spot.None}set toSpot(t){const i=this.toSpot;i.equals(t)||(t=t.N(),this.Xe(),this.q.ua=t,this.t("toSpot",i,t),this.ba())}get toEndSegmentLength(){return this.q!==null?this.q.ga:10}set toEndSegmentLength(t){const i=this.toEndSegmentLength;i!==t&&(t<0&&Util._(t,">= 0",GraphObject,"toEndSegmentLength"),this.Xe(),this.q.ga=t,this.t("toEndSegmentLength",i,t),this.ba())}get toShortLength(){return this.q!==null?this.q.pa:0}set toShortLength(t){const i=this.toShortLength;i!==t&&(this.Xe(),this.q.pa=t,this.t("toShortLength",i,t),this.ba())}get toLinkable(){return this.q!==null?this.q.O0:null}set toLinkable(t){const i=this.toLinkable;i!==t&&(this.Xe(),this.q.O0=t,this.t("toLinkable",i,t))}get toMaxLinks(){return this.q!==null?this.q.I0:1/0}set toMaxLinks(t){const i=this.toMaxLinks;i!==t&&(t<0&&Util._(t,">= 0",GraphObject,"toMaxLinks"),this.Xe(),this.q.I0=t,this.t("toMaxLinks",i,t))}get fromSpot(){return this.q!==null?this.q.fa:Spot.None}set fromSpot(t){const i=this.fromSpot;i.equals(t)||(t=t.N(),this.Xe(),this.q.fa=t,this.t("fromSpot",i,t),this.ba())}get fromEndSegmentLength(){return this.q!==null?this.q.da:10}set fromEndSegmentLength(t){const i=this.fromEndSegmentLength;i!==t&&(t<0&&Util._(t,">= 0",GraphObject,"fromEndSegmentLength"),this.Xe(),this.q.da=t,this.t("fromEndSegmentLength",i,t),this.ba())}get fromShortLength(){return this.q!==null?this.q.ma:0}set fromShortLength(t){const i=this.fromShortLength;i!==t&&(this.Xe(),this.q.ma=t,this.t("fromShortLength",i,t),this.ba())}get fromLinkable(){return this.q!==null?this.q.E0:null}set fromLinkable(t){const i=this.fromLinkable;i!==t&&(this.Xe(),this.q.E0=t,this.t("fromLinkable",i,t))}get fromMaxLinks(){return this.q!==null?this.q.B0:1/0}set fromMaxLinks(t){const i=this.fromMaxLinks;i!==t&&(t<0&&Util._(t,">= 0",GraphObject,"fromMaxLinks"),this.Xe(),this.q.B0=t,this.t("fromMaxLinks",i,t))}get cursor(){return this.f!==null?this.f.Pl:""}set cursor(t){const i=this.cursor;i!==t&&(Util.i(t,"string",GraphObject,"cursor"),this.Ht(),this.f.Pl=t,this.t("cursor",i,t))}get click(){return this.f!==null?this.f.Tr:null}set click(t){const i=this.click;i!==t&&(t!==null&&Util.i(t,"function",GraphObject,"click"),this.Ht(),this.f.Tr=t,this.t("click",i,t))}get doubleClick(){return this.f!==null?this.f.Dr:null}set doubleClick(t){const i=this.doubleClick;i!==t&&(t!==null&&Util.i(t,"function",GraphObject,"doubleClick"),this.Ht(),this.f.Dr=t,this.t("doubleClick",i,t))}get contextClick(){return this.f!==null?this.f.Fr:null}set contextClick(t){const i=this.contextClick;i!==t&&(t!==null&&Util.i(t,"function",GraphObject,"contextClick"),this.Ht(),this.f.Fr=t,this.t("contextClick",i,t))}get mouseEnter(){return this.f!==null?this.f.Er:null}set mouseEnter(t){const i=this.mouseEnter;i!==t&&(t!==null&&Util.i(t,"function",GraphObject,"mouseEnter"),this.Ht(),this.f.Er=t,this.t("mouseEnter",i,t))}get mouseLeave(){return this.f!==null?this.f.Br:null}set mouseLeave(t){const i=this.mouseLeave;i!==t&&(t!==null&&Util.i(t,"function",GraphObject,"mouseLeave"),this.Ht(),this.f.Br=t,this.t("mouseLeave",i,t))}get mouseOver(){return this.f!==null?this.f.Rr:null}set mouseOver(t){const i=this.mouseOver;i!==t&&(t!==null&&Util.i(t,"function",GraphObject,"mouseOver"),this.Ht(),this.f.Rr=t,this.t("mouseOver",i,t))}get mouseHover(){return this.f!==null?this.f.vr:null}set mouseHover(t){const i=this.mouseHover;i!==t&&(t!==null&&Util.i(t,"function",GraphObject,"mouseHover"),this.Ht(),this.f.vr=t,this.t("mouseHover",i,t))}get mouseHold(){return this.f!==null?this.f.Or:null}set mouseHold(t){const i=this.mouseHold;i!==t&&(t!==null&&Util.i(t,"function",GraphObject,"mouseHold"),this.Ht(),this.f.Or=t,this.t("mouseHold",i,t))}get mouseDragEnter(){return this.f!==null?this.f.U0:null}set mouseDragEnter(t){const i=this.mouseDragEnter;i!==t&&(t!==null&&Util.i(t,"function",GraphObject,"mouseDragEnter"),this.Ht(),this.f.U0=t,this.t("mouseDragEnter",i,t))}get mouseDragLeave(){return this.f!==null?this.f.V0:null}set mouseDragLeave(t){const i=this.mouseDragLeave;i!==t&&(t!==null&&Util.i(t,"function",GraphObject,"mouseDragLeave"),this.Ht(),this.f.V0=t,this.t("mouseDragLeave",i,t))}get mouseDrop(){return this.f!==null?this.f.Ir:null}set mouseDrop(t){const i=this.mouseDrop;i!==t&&(t!==null&&Util.i(t,"function",GraphObject,"mouseDrop"),this.Ht(),this.f.Ir=t,this.t("mouseDrop",i,t))}get actionDown(){return this.f!==null?this.f.z0:null}set actionDown(t){const i=this.actionDown;i!==t&&(t!==null&&Util.i(t,"function",GraphObject,"actionDown"),this.Ht(),this.f.z0=t,this.t("actionDown",i,t))}get actionMove(){return this.f!==null?this.f.X0:null}set actionMove(t){const i=this.actionMove;i!==t&&(t!==null&&Util.i(t,"function",GraphObject,"actionMove"),this.Ht(),this.f.X0=t,this.t("actionMove",i,t))}get actionUp(){return this.f!==null?this.f.K0:null}set actionUp(t){const i=this.actionUp;i!==t&&(t!==null&&Util.i(t,"function",GraphObject,"actionUp"),this.Ht(),this.f.K0=t,this.t("actionUp",i,t))}get actionCancel(){return this.f!==null?this.f.Y0:null}set actionCancel(t){const i=this.actionCancel;i!==t&&(t!==null&&Util.i(t,"function",GraphObject,"actionCancel"),this.Ht(),this.f.Y0=t,this.t("actionCancel",i,t))}get toolTip(){return this.f!==null?this.f.Ur:null}set toolTip(t){const i=this.toolTip;i!==t&&(this.Ht(),this.f.Ur=t,this.t("toolTip",i,t))}get contextMenu(){return this.f!==null?this.f.Vr:null}set contextMenu(t){const i=this.contextMenu;i!==t&&(this.Ht(),this.f.Vr=t,this.t("contextMenu",i,t))}findBindingPanel(){let t=this instanceof Panel?this:this.panel;for(;t!==null;){if(t.g2())return t;t=t.panel}return null}bind(t,i,e,s){return this.nf(t,i,e,s),this}bindTwoWay(t,i,e,s){return this.nf(t,i,e,s).makeTwoWay(),this}bindModel(t,i,e,s){return this.nf(t,i,e,s).ofModel(),this}bindObject(t,i,e,s,n){return this.nf(t,i,e,s).ofObject(n),this}theme(t,i,e,s,n){return this.uh(t,i,e,s,n),this}themeData(t,i,e,s,n){return this.uh(t,i,e,s,n).ofData(),this}themeObject(t,i,e,s,n,o){return this.uh(t,i,e,s,n).ofObject(o),this}themeModel(t,i,e,s,n){return this.uh(t,i,e,s,n).ofModel(),this}nf(t,i,e,s){let n=null;return typeof t=="string"?n=new Binding(t,i,e,s):n=t,this.G0(n),n}uh(t,i,e,s,n){let o=null;return typeof t=="string"?o=new ThemeBinding(t,i,e,s,n):o=t,this.G0(o),o}G0(t){t.ke=this;const i=this.findBindingPanel();i!==null&&i.fA()&&Util.o("Cannot add a Binding to a template that has already been copied: "+t),this.Ai===null&&(this.Ai=new List),this.Ai.add(t)}set(t){return Object.assign(this,t),this}attach(t){return GraphObject.m2(this,t),this}apply(t){return t(this),this}setProperties(t){return Diagram.a0(this,t),this}static build(t,i,...e){const s=GraphObject.j0.get(t);if(typeof s=="function"){const n=s([t].concat(e));if(n instanceof GraphObject)return i&&n.setProperties(i),n}Util.o('GraphObject.build invoked object builder "'+t+'", but it did not return an Object')}static make(t,...i){let e=arguments,s=null,n=null;if(typeof t=="function")n=t;else if(typeof t=="string"){const r=GraphObject.j0.get(t);typeof r=="function"?(e=Array.prototype.slice.call(e),s=r(e),Util.wt(s)||Util.o('GraphObject.make invoked object builder "'+t+'", but it did not return an Object')):n=root.go[t]}s===null&&((n==null||!n.constructor)&&Util.o("GraphObject.make requires a class function or GoJS class name or name of an object builder, not: "+t),s=new n);let o=1;if(s instanceof Diagram&&e.length>1){const r=s,l=e[1];(typeof l=="string"||l instanceof HTMLDivElement)&&(r.pS(l),o++)}for(let r=o;r<e.length;r++){const l=e[r];l===void 0?Util.o("Undefined value at argument "+r+" for object being constructed by GraphObject.make: "+s):GraphObject.m2(s,l)}return s}static m2(t,i){if(typeof i=="number")GraphObject.IR(t,i);else if(typeof i=="string")GraphObject.ER(t,i);else if(i instanceof GraphObject)t instanceof Panel||Util.o("A GraphObject can only be added to a Panel, not to: "+t),t.add(i);else if(i instanceof RowColumnDefinition){let e;i.isRow&&typeof t.getRowDefinition=="function"?e=t.getRowDefinition(i.index):!i.isRow&&typeof t.getColumnDefinition=="function"&&(e=t.getColumnDefinition(i.index)),e instanceof RowColumnDefinition?e.Ub(i):Util.o("A RowColumnDefinition can only be added to an object that implements getRowDefinition/getColumnDefinition, not to: "+t)}else if(i instanceof PanelLayout){const e=t;e.type=i}else if(i instanceof Binding)t instanceof GraphObject||t instanceof RowColumnDefinition?t.bind(i):Util.o("A Binding can only be applied to a GraphObject or RowColumnDefinition, not to: "+t);else if(i instanceof AnimationTrigger)t instanceof GraphObject?t.trigger(i):Util.o("An AnimationTrigger can only be applied to a GraphObject, not to: "+t);else if(i instanceof PathFigure)t instanceof Geometry&&t.type===4?t.figures.add(i):Util.o("A PathFigure can only be added to a Path Geometry, not to: "+t);else if(i instanceof PathSegment)t instanceof PathFigure?t.segments.add(i):Util.o("A PathSegment can only be added to a PathFigure, not to: "+t);else if(i instanceof Layout)t instanceof Diagram||t instanceof Group?t.layout=i:Util.o("A Layout can only be assigned to a Diagram or a Group, not to: "+t);else if(Array.isArray(i))for(let e=0;e<i.length;e++){const s=i[e];GraphObject.m2(t,s)}else typeof i=="object"&&i!==null?GraphObject.BR(t,i):Util.o('Unknown initializer "'+i+'" for object being constructed by GraphObject.make: '+t)}static ER(t,i){if(t instanceof TextBlock)t.text=i;else if(t instanceof Shape)t.figure=i;else if(t instanceof Picture)t.source=i;else if(t instanceof Panel){const e=PanelLayout.Layouts.get(i);e!==null&&(t.type=e)}else if(t instanceof Brush){const e=Util.Ih(BrushType,i);e!==null?t.type=e:Util.o("Unknown Brush type as an argument to GraphObject.make: "+i)}else if(t instanceof Geometry){const e=Util.Ih(GeometryType,i);e!==null&&(t.type=e)}else if(t instanceof PathSegment){const e=Util.Ih(SegmentType,i);e!==null&&(t.type=e)}}static IR(t,i){typeof t.li=="function"?t.li(i):Util.rr(t,i)}static BR(t,i){if(t instanceof Brush){const e=new PropertyCollection;for(const s in i){const n=parseFloat(s);isNaN(n)?e[s]=i[s]:t.addColorStop(n,i[s])}Diagram.a0(t,e)}else if(t instanceof RowColumnDefinition){if(i.row!==void 0){const s=i.row;(s==null||s===1/0||isNaN(s)||s<0)&&Util.o("Must specify non-negative integer row for RowColumnDefinition "+i+", not: "+s),t.isRow=!0,t.index=s}else if(i.column!==void 0){const s=i.column;(s==null||s===1/0||isNaN(s)||s<0)&&Util.o("Must specify non-negative integer column for RowColumnDefinition "+i+", not: "+s),t.isRow=!1,t.index=s}const e=new PropertyCollection;for(const s in i)s==="row"||s==="column"||(e[s]=i[s]);Diagram.a0(t,e)}else Diagram.a0(t,i)}static uE(){const t=new GMap;for(const i in GraphObject.j0){if(i===i.toLowerCase())continue;const e=GraphObject.j0.get(i);typeof e=="function"&&t.set(i,e)}return t.g(),t}static defineBuilder(t,i){Util.i(t,"string",GraphObject,"defineBuilder:name"),Util.i(i,"function",GraphObject,"defineBuilder:func");const e=t.toLowerCase();GraphObject.j0.set(t,i)}static takeBuilderArgument(t,i,e){e===void 0&&(e=null);const s=t[1];if(typeof e=="function"?e(s):typeof s=="string")return t.splice(1,1),s;if(i===void 0)throw new Error("no "+(typeof e=="function"?"satisfactory":"string")+" argument for GraphObject builder "+t[0]);return i}static j0=new GMap;static{GraphObject.Vertical=4,GraphObject.Horizontal=5,GraphObject.defineBuilder("Button",t=>{const i="#f5f5f5",e="#737373",s="#d4d4d4",n="#737373",o="#a3a3a3",r=2.76142374915397,l=2.761423749153969,h=new Panel(Panel.Auto,{isActionable:!0,enabledChanged:(a,c)=>{if(a instanceof Panel){const f=a.findObject("ButtonBorder");if(f!==null)if(a._buttonFillNormal===void 0&&(a._buttonFillNormal=f.fill),c){let u=null;a.layer!==null&&a.diagram!==null&&a.isVisibleObject()&&(u=a.layer.findObjectAt(a.diagram.lastInput.documentPoint)),u===a||u!==null&&u.isContainedBy(a)?f.fill=a._buttonFillOver:f.fill=a._buttonFillNormal}else f.fill=a._buttonFillDisabled}},cursor:"pointer"}).attach({_buttonFillNormal:void 0,_buttonStrokeNormal:void 0,_buttonFillOver:s,_buttonStrokeOver:n,_buttonFillDisabled:o}).add(new Shape("RoundedRectangle",{name:"ButtonBorder",spot1:new Spot(0,0,r,l),spot2:new Spot(1,1,-r,-l),parameter1:2,fill:i,stroke:e}));return h.mouseEnter=(a,c,f)=>{if(!c.isEnabledObject()||!(c instanceof Panel))return;const u=c.findObject("ButtonBorder");u instanceof Shape&&(c._buttonFillNormal===void 0&&(c._buttonFillNormal=u.fill),u.fill=c._buttonFillOver,c._buttonStrokeNormal===void 0&&(c._buttonStrokeNormal=u.stroke),u.stroke=c._buttonStrokeOver)},h.mouseLeave=(a,c,f)=>{if(!c.isEnabledObject()||!(c instanceof Panel))return;const u=c.findObject("ButtonBorder");u instanceof Shape&&(c._buttonFillNormal!==void 0&&(u.fill=c._buttonFillNormal),c._buttonStrokeNormal!==void 0&&(u.stroke=c._buttonStrokeNormal))},h}),GraphObject.defineBuilder("TreeExpanderButton",t=>{const i=GraphObject.build("Button");return i.attach({_treeExpandedFigure:"MinusLine",_treeCollapsedFigure:"PlusLine",visible:!1}),i.add(new Shape("MinusLine",{name:"ButtonIcon",stroke:"#0a0a0a",strokeWidth:2,desiredSize:Size.lu}).bindObject("figure","isTreeExpanded",(e,s)=>{const n=s.panel;return e?n._treeExpandedFigure:n._treeCollapsedFigure})),i.bindObject("visible","isTreeLeaf",e=>!e),i.click=(e,s)=>{let n=s.part;if(n instanceof Adornment&&(n=n.adornedPart),!(n instanceof Node))return;const o=n.diagram;if(o===null)return;const r=o.commandHandler;if(n.isTreeExpanded){if(!r.canCollapseTree(n))return}else if(!r.canExpandTree(n))return;e.handled=!0,n.isTreeExpanded?r.collapseTree(n):r.expandTree(n)},i}),GraphObject.defineBuilder("SubGraphExpanderButton",t=>{const i=GraphObject.build("Button");return i.attach({_subGraphExpandedFigure:"MinusLine",_subGraphCollapsedFigure:"PlusLine"}),i.add(new Shape("MinusLine",{name:"ButtonIcon",stroke:"#0a0a0a",strokeWidth:2,desiredSize:Size.lu}).bindObject("figure","isSubGraphExpanded",(e,s)=>{const n=s.panel;return e?n._subGraphExpandedFigure:n._subGraphCollapsedFigure})),i.click=(e,s)=>{let n=s.part;if(n instanceof Adornment&&(n=n.adornedPart),!(n instanceof Group))return;const o=n.diagram;if(o===null)return;const r=o.commandHandler;if(n.isSubGraphExpanded){if(!r.canCollapseSubGraph(n))return}else if(!r.canExpandSubGraph(n))return;e.handled=!0,n.isSubGraphExpanded?r.collapseSubGraph(n):r.expandSubGraph(n)},i}),GraphObject.defineBuilder("ToolTip",t=>new Adornment(Panel.Auto,{isShadowed:!0,shadowColor:"rgba(0, 0, 0, .4)",shadowOffset:new Point(0,2)}).add(new Shape("RoundedRectangle",{name:"Border",parameter1:1,fill:"#f5f5f5",strokeWidth:0,spot1:new Spot(0,0,4,6),spot2:new Spot(1,1,-4,-4)}))),GraphObject.defineBuilder("ContextMenu",t=>new Adornment(Panel.Vertical,{background:"#f5f5f5",isShadowed:!0,shadowColor:"rgba(0, 0, 0, .4)",shadowOffset:new Point(0,2)}).bindObject("background","",i=>i.adornedPart!==null&&i.hasPlaceholder()?null:"#f5f5f5")),GraphObject.defineBuilder("ContextMenuButton",t=>{const i=GraphObject.build("Button");i.stretch=5;const e=i.findObject("ButtonBorder");return e instanceof Shape&&(e.figure="Rectangle",e.strokeWidth=0,e.spot1=new Spot(0,0,4,6),e.spot2=new Spot(1,1,-4,-4)),i}),GraphObject.defineBuilder("PanelExpanderButton",t=>{const i=GraphObject.takeBuilderArgument(t,"COLLAPSIBLE"),e=GraphObject.build("Button");e.attach({_buttonExpandedFigure:"M0 0 M0 6 L4 2 8 6 M8 8",_buttonCollapsedFigure:"M0 0 M0 2 L4 6 8 2 M8 8","ButtonBorder.fill":"rgba(0, 0, 0, 0)",_buttonFillNormal:"rgba(0, 0, 0, 0)","ButtonBorder.stroke":null,_buttonStrokeNormal:null,_buttonFillOver:"rgba(0, 0, 0, .2)",_buttonStrokeOver:null}),e.add(new Shape({name:"ButtonIcon",strokeWidth:2}).bindObject("geometryString","visible",n=>n?e._buttonExpandedFigure:e._buttonCollapsedFigure,void 0,i));const s=e.findObject("ButtonBorder");return s instanceof Shape&&(s.stroke=null,s.fill="rgba(0, 0, 0, 0)"),e.click=(n,o)=>{if(!(o instanceof Panel))return;const r=o.diagram;if(r===null||r.isReadOnly)return;let l=o.findBindingPanel();if(l===null&&(l=o.part),l!==null){const h=l.findObject(i);h!==null&&(n.handled=!0,r.startTransaction("Collapse/Expand Panel"),h.visible=!h.visible,r.commitTransaction("Collapse/Expand Panel"))}},e}),GraphObject.defineBuilder("CheckBoxButton",t=>{const i=GraphObject.takeBuilderArgument(t),e=GraphObject.build("Button",{desiredSize:new Size(14,14)});e.attach({"ButtonBorder.spot1":new Spot(0,0,1,1),"ButtonBorder.spot2":new Spot(1,1,-1,-1)});const s=new Shape({name:"ButtonIcon",geometryString:"M0 0 M0 8.85 L4.9 13.75 16.2 2.45 M16.2 16.2",strokeWidth:2,stretch:2,geometryStretch:6,visible:!1});return i!==""&&s.bindTwoWay("visible",i),e.add(s),e.click=(n,o)=>{if(!(o instanceof Panel))return;const r=n.diagram;if(r===null||r.isReadOnly||i!==""&&r.model.isReadOnly)return;n.handled=!0;const l=o.findObject("ButtonIcon");r.startTransaction("checkbox"),l!==null&&(l.visible=!l.visible),typeof o._doClick=="function"&&o._doClick(n,o),r.commitTransaction("checkbox")},e}),GraphObject.defineBuilder("CheckBox",t=>{const i=GraphObject.takeBuilderArgument(t),e=GraphObject.build("CheckBoxButton",{name:"Button",isActionable:!1,margin:new Margin(0,1,0,0)},i),s=new Panel("Horizontal",{isActionable:!0,cursor:e.cursor,margin:new Margin(1),mouseEnter:e.mouseEnter,mouseLeave:e.mouseLeave,click:e.click}).attach({_buttonFillNormal:e._buttonFillNormal,_buttonStrokeNormal:e._buttonStrokeNormal,_buttonFillOver:e._buttonFillOver,_buttonStrokeOver:e._buttonStrokeOver,_buttonFillDisabled:e._buttonFillDisabled,_buttonClick:e.click});return s.add(e),e.mouseEnter=null,e.mouseLeave=null,e.click=null,s})}}class GraphObjectTemplateSettings{gi;St;$n;Ai;Zn;Ks;Pl;Tr;Dr;Fr;Er;Br;Rr;vr;Or;U0;V0;Ir;z0;X0;K0;Y0;Ur;Vr;S0;v0;ys;xr;br;to;R0;F0;wr;P0;H0;q0;constructor(){this.gi=!1,this.St="",this.$n=-1,this.Ai=null,this.Zn=null,this.Ks=null,this.Pl="",this.Tr=null,this.Dr=null,this.Fr=null,this.Er=null,this.Br=null,this.Rr=null,this.vr=null,this.Or=null,this.U0=null,this.V0=null,this.Ir=null,this.z0=null,this.X0=null,this.K0=null,this.Y0=null,this.Ur=null,this.Vr=null,this.S0=null,this.v0=null,this.ys=null,this.xr=Size.ru,this.br=Size.eC,this.to=1,this.R0=1,this.F0=1,this.wr=0,this.P0=null,this.H0=null,this.q0="category"}copy(){const t=new GraphObjectTemplateSettings;return t.St=this.St,t.$n=this.$n,t.Ai=this.Ai,t.Ks=this.Ks,t.Pl=this.Pl,t.Tr=this.Tr,t.Dr=this.Dr,t.Fr=this.Fr,t.Er=this.Er,t.Br=this.Br,t.Rr=this.Rr,t.vr=this.vr,t.Or=this.Or,t.U0=this.U0,t.V0=this.V0,t.Ir=this.Ir,t.z0=this.z0,t.X0=this.X0,t.K0=this.K0,t.Y0=this.Y0,t.Ur=this.Ur,t.Vr=this.Vr,t.S0=this.S0,t.v0=this.v0,t.ys=this.ys,t.xr=this.xr.N(),t.br=this.br.N(),t.to=this.to,t.R0=this.R0,t.F0=this.F0,t.wr=this.wr,t.P0=this.P0,t.H0=this.H0,t.q0=this.q0,t}}class STransform{m;constructor(){this.m=[1,0,0,1,0,0]}copy(){const t=new STransform;return t.m[0]=this.m[0],t.m[1]=this.m[1],t.m[2]=this.m[2],t.m[3]=this.m[3],t.m[4]=this.m[4],t.m[5]=this.m[5],t}translate(t,i){this.m[4]+=this.m[0]*t+this.m[2]*i,this.m[5]+=this.m[1]*t+this.m[3]*i}scale(t,i){this.m[0]*=t,this.m[1]*=t,this.m[2]*=i,this.m[3]*=i}rotate(t,i,e){if(t>=360?t-=360:t<0&&(t+=360),t===0)return;this.translate(i,e);let s=0,n=0;if(t===90)s=0,n=1;else if(t===180)s=-1,n=0;else if(t===270)s=0,n=-1;else{const a=t*Math.PI/180;s=Math.cos(a),n=Math.sin(a)}const o=this.m[0]*s+this.m[2]*n,r=this.m[1]*s+this.m[3]*n,l=this.m[0]*-n+this.m[2]*s,h=this.m[1]*-n+this.m[3]*s;this.m[0]=o,this.m[1]=r,this.m[2]=l,this.m[3]=h,this.translate(-i,-e)}}class SGradient{type;x1;y1;r1;x2;y2;r2;colors;pattern;constructor(t){this.type=t,this.x1=0,this.y1=0,this.r1=0,this.x2=0,this.y2=0,this.r2=0,this.colors=[],this.pattern=null}addColorStop(t,i){this.colors.push({offset:t,color:i})}}class SVGSurface{Ft;ai;aa;ju;p2;constructor(t,i,e){const s=i===void 0?root.document:i;this.aa=s,this.p2="http://www.w3.org/2000/svg";const n="http://www.w3.org/2000/xmlns/";s!==void 0&&(this.Ft=this.makeElement("svg",{width:"1px",height:"1px",viewBox:"0 0 1 1"}),this.style.display="block",this.style.letterSpacing="normal",this.style.wordSpacing="normal",e||(this.style.position="absolute"),this.Ft.setAttributeNS(n,"xmlns",this.p2),this.Ft.setAttributeNS(n,"xmlns:xlink","http://www.w3.org/1999/xlink")),this.ju=null,this.ai=new SVGContext(this,e)}resize(t,i,e,s){return this.width!==t||this.height!==i?(this.width=t,this.height=i,this.style.width=e+"px",this.style.height=s+"px",this.Ft.setAttributeNS(null,"width",e+"px"),this.Ft.setAttributeNS(null,"height",s+"px"),this.Ft.setAttributeNS(null,"viewBox","0 0 "+e+" "+s),this.ai.w2.firstElementChild.setAttributeNS(null,"width",e+"px"),this.ai.w2.firstElementChild.setAttributeNS(null,"height",s+"px"),!0):!1}makeElement(t,i,e){const s=this.aa.createElementNS(this.p2,t);if(Util.wt(i))for(const n in i)s.setAttributeNS(n==="href"?"http://www.w3.org/1999/xlink":"",n,i[n]);return e!==void 0&&(s.textContent=e),s}getBoundingClientRect(){return this.Ft.getBoundingClientRect()}focus(){this.Ft.focus()}get width(){return this.Ft.width.baseVal.value}set width(t){this.Ft.setAttribute("width",t+"px")}get height(){return this.Ft.height.baseVal.value}set height(t){this.Ft.setAttribute("height",t+"px")}dispose(){this.aa=null}get style(){return this.Ft.style}}class SVGContext{of;rf;xn;Ti;Ye;fillStyle;font;globalAlpha;lineCap;lineDashOffset;lineJoin;lineWidth;miterLimit;shadowBlur;shadowColor;shadowOffsetX;shadowOffsetY;strokeStyle;textAlign;imageSmoothingEnabled;clipInsteadOfFill;lastCreatedElement;lf;hf;surface;svg;w2;uA;Vb;zo;dh;ka;currentElement;clipPathGroup;diagramGroup;lastDrawnPart;currentPath;outerGroup;pathAttributes;_r;Sr;filter;partClipRect;constructor(t,i){this.surface=t,this.svg=t.Ft,this.lf=[],this.hf=[],this.fillStyle="#000000",this.font="10px sans-serif",this.globalAlpha=1,this.lineCap="butt",this.lineDashOffset=0,this.lineJoin="miter",this.lineWidth=1,this.miterLimit=10,this.shadowBlur=0,this.shadowColor="rgba(0, 0, 0, 0)",this.shadowOffsetX=0,this.shadowOffsetY=0,this._r=!1,this.strokeStyle="#000000",this.textAlign="start",this.clipInsteadOfFill=!1,this.of=0,this.rf=0,this.xn=0,this.lastCreatedElement=null,this.currentElement=null,this.Ti=[],this.pathAttributes={},this.Vb=!1,this.zo=null,this.dh=0,this.Ye=new STransform,this.clipPathGroup=this.newGroup2(),this.diagramGroup=this.newGroup2("gojs-diagram"),this.lastDrawnPart=null,this.currentPath=null;const e=GSet.Eg++,s=this.makeElement("clipPath",{id:"mainClip"+e}),n={x:0,y:0,width:t.width,height:t.height};s.appendChild(this.makeElement("rect",n)),this.w2=s,this.svg.appendChild(this.clipPathGroup),this.clipPathGroup.appendChild(this.diagramGroup),this.svg.appendChild(s),this.clipPathGroup.setAttributeNS(null,"clip-path","url(#mainClip"+e+")"),this.uA={},this.Sr=!!i,this.filter="",this.partClipRect=null}setDiagramPosScale(t,i,e,s,n,o){this.diagramGroup===void 0?this.newGroup(t,i,e,s,n,o):this.diagramGroup.setAttribute("transform","matrix("+t+", "+i+", "+e+", "+s+", "+n+", "+o+")")}resetInnerSVG(){this.diagramGroup!==null&&(this.diagramGroup.innerHTML="")}arc(t,i,e,s,n,o,r,l){const h=2*Math.PI,a=1e-6,c=h-a,f=e*Math.cos(s),u=e*Math.sin(s),d=t+f,m=i+u,g=o?0:1;let p=o?s-n:n-s;(Math.abs(r-d)>a||Math.abs(l-m)>a)&&this.Ti.push(["L",d,+m]),p<0&&(p=p%h+h),p>c?(this.Ti.push(["A",e,e,0,1,g,t-f,i-u]),this.Ti.push(["A",e,e,0,1,g,d,m])):p>a&&this.Ti.push(["A",e,e,0,+(p>=Math.PI),g,t+e*Math.cos(n),i+e*Math.sin(n)])}beginPath(){this.Ti=[],this.pathAttributes={stroke:"none",fill:"none"}}endPath(t){this.UR(this.Ti,this.Ye,t||0)}bezierCurveTo(t,i,e,s,n,o){this.Ti.push(["C",t,i,e,s,n,o])}clearRect(t,i,e,s){}clip(){this.pathAttributes.clipPath=!0}closePath(){this.Ti.push(["z"])}createLinearGradient(t,i,e,s){const n=new SGradient("linear");return n.x1=t,n.y1=i,n.x2=e,n.y2=s,n}createPattern(t,i){let e="";t instanceof HTMLCanvasElement&&(e=t.toDataURL()),t instanceof HTMLImageElement&&(e=t.getAttribute("src"));const s=this.uA;if(s[e])return"url(#"+s[e]+")";const n="PATTERN"+GSet.Eg++,o={width:t.width,height:t.height,id:n,patternUnits:"userSpaceOnUse"},r={x:0,y:0,width:t.width,height:t.height,href:e},l=this.makeElement("pattern",o);return l.appendChild(this.makeElement(Diagram.img,r)),this.svg.appendChild(l),s[e]=n,"url(#"+n+")"}createRadialGradient(t,i,e,s,n,o){const r=new SGradient("radial");return r.x1=t,r.y1=i,r.r1=e,r.x2=s,r.y2=n,r.r2=o,r}amendImageTransform(t,i,e,s,n,o,r,l){const h=r/e,a=l/s;(n!==0||o!==0)&&this.Ye.translate(n,o),(h!==1||a!==1)&&this.Ye.scale(h,a),(t!==0||i!==0)&&this.Ye.translate(-t,-i)}drawImage(t,i,e,s,n,o,r,l,h){let a="";t instanceof HTMLCanvasElement&&(a=t.toDataURL()),t instanceof HTMLImageElement&&(a=t.getAttribute("src"));const c=t instanceof HTMLImageElement?t.naturalWidth:t.width,f=t instanceof HTMLImageElement?t.naturalHeight:t.height;s===void 0&&(o=i,r=e,l=s=c,h=n=f),s=s||0,n=n||0,o=o||0,r=r||0,l=l||0,h=h||0,this.amendImageTransform(i,e,s,n,o,r,l,h);const u={x:0,y:0,width:c||s,height:f||n,href:a};!Geo.K(s,l)||!Geo.K(n,h)?u.preserveAspectRatio="none":a.toLowerCase().indexOf(".svg")===-1&&a.toLowerCase().indexOf("data:image/svg")===-1&&(u.preserveAspectRatio="xMidYMid slice"),(i!==0||e!==0||s!==c||n!==f)&&(s+=i,n+=e,u["clip-path"]=`path('M ${i},${e} L ${s} ${e} L ${s} ${n} L ${i} ${n} z')`),this.processCommon(Diagram.img,u,this.Ye),this.rd(Diagram.img,u)}fill(t,i){t&&(this.pathAttributes["fill-rule"]="evenodd"),this.setFill(this.pathAttributes)}fillContext(t,i,e){this.clipInsteadOfFill?this.clip():this.fill(i,e)}createOrUpdateClipGroup(t,i){const e=this.newGroup(1,0,0,1,-i.x,-i.y);e.setAttributeNS(null,"class","spotClip"),t.rh=e}fillRect(t,i,e,s){this.addRect("fill",[t,i,e,s],this.Ye)}fillBackground(t,i,e,s){const n={x:t,y:i,width:e,height:s};this.processCommon("fill",n,this.Ye),this.setFill(n),this.svg.prepend(this.makeElement("rect",n))}fillText(t,i,e){this.addText("fill",[t,i,e],this.Ye)}lineTo(t,i){this.Ti.push(["L",t,i])}moveTo(t,i){this.Ti.push(["M",t,i])}quadraticCurveTo(t,i,e,s){this.Ti.push(["Q",t,i,e,s])}rect(t,i,e,s){this.Ti.push(["M",t,i],["L",t+e,i],["L",t+e,i+s],["L",t,i+s],["z"])}restore(){this.Ye=this.lf.pop(),this.Ti=this.lf.pop();const t=this.lf.pop();this.fillStyle=t.fillStyle,this.font=t.font,this.globalAlpha=t.globalAlpha,this.lineCap=t.lineCap,this.lineDashOffset=t.lineDashOffset,this.lineJoin=t.lineJoin,this.lineWidth=t.lineWidth,this.miterLimit=t.miterLimit,this.shadowBlur=t.shadowBlur,this.shadowColor=t.shadowColor,this.shadowOffsetX=t.shadowOffsetX,this.shadowOffsetY=t.shadowOffsetY,this.strokeStyle=t.strokeStyle,this.textAlign=t.textAlign,this.partClipRect=t.partClipRect}save(){const t={fillStyle:this.fillStyle,font:this.font,globalAlpha:this.globalAlpha,lineCap:this.lineCap,lineDashOffset:this.lineDashOffset,lineJoin:this.lineJoin,lineWidth:this.lineWidth,miterLimit:this.miterLimit,shadowBlur:this.shadowBlur,shadowColor:this.shadowColor,shadowOffsetX:this.shadowOffsetX,shadowOffsetY:this.shadowOffsetY,strokeStyle:this.strokeStyle,textAlign:this.textAlign,partClipRect:this.partClipRect};this.lf.push(t);const i=[];for(let e=0;e<this.Ti.length;e++)i.push(this.Ti[e]);this.lf.push(i),this.lf.push(this.Ye.copy())}setTransform(t,i,e,s,n,o){t===1&&i===0&&e===0&&s===1&&n===0&&o===0||this.newGroup(t,i,e,s,n,o)}setCurrentTransform(t,i,e,s,n,o){this.Ye.m=[t,i,e,s,n,o]}getCurrentTransform(){const t=this.Ye.m;return"matrix("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}scale(t,i){this.Ye.scale(t,i)}translate(t,i){this.Ye.translate(t,i)}transform(t,i,e,s,n,o){}commitTransform(){}stroke(){this.setStroke(this.pathAttributes)}strokeContext(){this.clipInsteadOfFill||this.stroke()}strokeRect(t,i,e,s){this.addRect("stroke",[t,i,e,s],this.Ye)}makeElement(t,i,e){return this.surface.makeElement(t,i,e)}rd(t,i,e){const s=this.makeElement(t,i,e);return this.currentElement!==null?this.currentElement.appendChild(s):this.currentElement=s,this.lastCreatedElement=s,s}processCommon(t,i,e){if(t==="fill"?this.setFill(i):t==="stroke"&&this.setStroke(i),e!==null){const s=e.m;i.transform="matrix("+s[0]+", "+s[1]+", "+s[2]+", "+s[3]+", "+s[4]+", "+s[5]+")"}}setFill(t){if(this.fillStyle instanceof SGradient){t.fill=this.addGradient(this.fillStyle,!0);return}if(/^rgba\(/.test(this.fillStyle)){const e=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(this.fillStyle);t.fill="rgb("+e[1]+","+e[2]+","+e[3]+")",t["fill-opacity"]=e[4]}else t.fill=this.fillStyle}setFillOrStrokeInPlace(t,i){const e=i?"fill":"stroke";if(this.fillStyle instanceof SGradient){t.setAttributeNS(null,"fill",this.addGradient(this.fillStyle,!0));return}if(/^rgba\(/.test(this.fillStyle)){const n=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(this.fillStyle);t.setAttributeNS(null,e,"rgb("+n[1]+","+n[2]+","+n[3]+")"),t.setAttributeNS(null,e+"-opacity",n[4])}else t.setAttributeNS(null,e,this.fillStyle)}setStroke(t){if(this.strokeStyle instanceof SGradient)t.stroke=this.addGradient(this.strokeStyle,!1);else if(/^rgba\(/.test(this.strokeStyle)){const e=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(this.strokeStyle);t.stroke="rgb("+e[1]+","+e[2]+","+e[3]+")",t["stroke-opacity"]=e[4]}else t.stroke=this.strokeStyle;t["stroke-width"]=this.lineWidth,t["stroke-linecap"]=this.lineCap,t["stroke-linejoin"]=this.lineJoin,t["stroke-miterlimit"]=this.miterLimit,this.Vb&&(t["stroke-dasharray"]=this.zo.toString(),t["stroke-dashoffset"]=this.dh)}addGradient(t,i){let e="";const s=this.currentPath!==null?this.currentPath.getAttribute(i?"fill":"stroke"):null;if(s!==null&&s.indexOf("GRAD")!==-1){e=s.split("#")[1].slice(0,-1);const h=this.svg.getElementById(e);h!==null&&h.remove()}else e="GRAD"+GSet.Eg++;let n;if(t.type==="linear"){const h={x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2,id:e,gradientUnits:"userSpaceOnUse"};n=this.makeElement("linearGradient",h)}else if(t.type==="radial"){const h={x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2,r1:t.r1,r2:t.r2,id:e};n=this.makeElement("radialGradient",h)}else throw new Error("invalid gradient");const o=t.colors,r=o.length,l=[];for(let h=0;h<r;h++){const a=o[h],c=a.color,f={offset:a.offset,"stop-color":c};if(/^rgba\(/.test(c)){const d=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(c);f["stop-color"]="rgb("+d[1]+","+d[2]+","+d[3]+")",f["stop-opacity"]=d[4]}l.push(f)}l.sort((h,a)=>h.offset>a.offset?1:-1);for(let h=0;h<r;h++)n.appendChild(this.makeElement("stop",l[h]));return this.svg.appendChild(n),"url(#"+e+")"}addRect(t,i,e){const s={x:i[0],y:i[1],width:i[2],height:i[3]};this.processCommon(t,s,e),this.rd("rect",s)}addText(t,i,e){let s=this.textAlign;s==="left"?s="start":s==="right"?s="end":s==="center"&&(s="middle");const n={x:i[1],y:i[2],style:"font: "+this.font,"text-anchor":s};this.processCommon(t,n,e),this.rd("text",n,i[0])}UR(t,i,e){const s=this.VR(t),n=this.pathAttributes;if(n.clipPath){this.hf.length>1&&this.hf[this.hf.length-2].setAttributeNS(null,"clip-path",'path("'+s+'") view-box');return}if(n.d=s,this.processCommon("",n,i),this.currentPath!==null){const r=this.currentPath;if(r.nodeName!=="g")for(const l in n)l!=="transform"&&r.setAttributeNS(null,l,n[l]);else{const l=r.getElementsByTagName("path");for(const h in n)h!=="transform"&&l[e].setAttributeNS(null,h,n[h])}}else this.rd("path",n)}VR(t){const i=[];for(let e=0;e<t.length;e++){const s=t[e].slice(),n=[s.shift()];if(n[0]==="A")n.push(s.shift()+","+s.shift(),s.shift(),s.shift()+","+s.shift(),s.shift()+","+s.shift());else for(;s.length;)n.push(s.shift()+","+s.shift());i.push(n.join(" "))}return i.join(" ")}newGroup(t,i,e,s,n,o){const r=new STransform;r.m=[t,i,e,s,n,o];const l={};this.processCommon("g",l,r);const h=this.rd("g",l);return this.hf.push(h),h}newGroup2(t){const i={};t&&(i.class=t);const e=this.rd("g",i);return this.hf.push(e),e}endGroup(){return this.hf.pop()}dummyGroup(){return this.newGroup2(),this.endGroup()}shadowsSet(t,i,e){this.of=t,this.rf=i,this.xn=e}shadowsOff(){this._r=!1,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowBlur=0}shadowsOn(){this._r=!0,this.shadowOffsetX=this.of,this.shadowOffsetY=this.rf,this.shadowBlur=this.xn}enableDash(t,i){this.Vb=!0,this.zo=t,this.dh=i}disableDash(){this.Vb=!1}clearContextCache(t){}setImageSmoothingEnabled(t){}rotate(t){this.Ye.rotate(t*57.2958,0,0)}getImageData(t,i,e,s){return null}measureText(t){return null}removeOldGradient(t,i,e){const s=i.getAttribute(e);if(s===null)return;const n=s.split("#");if(n.length===1)return;const o=this.svg.getElementById(n[1].slice(0,-1));if(o!==null){const r=new RegExp(o.id,"g");this.svg.innerHTML.match(r).length===1&&o.remove()}}removePartFromView(t){t.svg!==null&&t.svg.parentNode===this.diagramGroup&&t.svg.remove()}}class CanvasSurface{Ft;ai;aa;ju;constructor(t,i,e,s){const n=i===void 0?root.document:i;this.aa=n,this.ju=null;const o=n.createElement("canvas");o.tabIndex=0,this.Ft=o,this.ai=new CanvasSurfaceContext(o,e,s),Diagram.Ve.set(o,t)}resize(t,i,e,s){return this.width!==t||this.height!==i?(this.width=t,this.height=i,this.style.width=e+"px",this.style.height=s+"px",!0):!1}toDataURL(t,i){return this.Ft.toDataURL(t,i)}getBoundingClientRect(){return this.Ft.getBoundingClientRect()}focus(){this.Ft.focus()}get width(){return this.Ft.width}set width(t){this.Ft.width=t}get height(){return this.Ft.height}set height(t){this.Ft.height=t}dispose(){Diagram.Ve.delete(this.Ft),this.aa=null}get style(){return this.Ft.style}}class CanvasSurfaceContext{U;zb;Xb;Kb;clipInsteadOfFill;of;rf;xn;ka;_r;Sr;constructor(t,i,e){this.U=t.getContext?t.getContext("2d",i):null,this.U===null&&Util.o("Browser does not support HTML Canvas Element"),this.zb="",this.Xb="",this.Kb="",this.clipInsteadOfFill=!1,this.of=0,this.rf=0,this.xn=0,this._r=!1,this.ka=new Transform,this.Sr=!!e}createOrUpdateClipGroup(t,i){}setImageSmoothingEnabled(t){this.U.imageSmoothingEnabled=t}get fillStyle(){return this.U.fillStyle}set fillStyle(t){this.Kb!==t&&(this.U.fillStyle=t,this.Kb=t)}get font(){return this.U.font}set font(t){this.zb!==t&&(this.U.font=t,this.zb=t)}get globalAlpha(){return this.U.globalAlpha}set globalAlpha(t){this.U.globalAlpha=t}get lineCap(){return this.U.lineCap}set lineCap(t){this.U.lineCap=t}get lineDashOffset(){return this.U.lineDashOffset}set lineDashOffset(t){this.U.lineDashOffset=t}get lineJoin(){return this.U.lineJoin}set lineJoin(t){this.U.lineJoin=t}get lineWidth(){return this.U.lineWidth}set lineWidth(t){this.U.lineWidth=t}get miterLimit(){return this.U.miterLimit}set miterLimit(t){this.U.miterLimit=t}get shadowBlur(){return this.U.shadowBlur}set shadowBlur(t){this.U.shadowBlur=t}get shadowColor(){return this.U.shadowColor}set shadowColor(t){this.U.shadowColor=t}get shadowOffsetX(){return this.U.shadowOffsetX}set shadowOffsetX(t){this.U.shadowOffsetX=t}get shadowOffsetY(){return this.U.shadowOffsetY}set shadowOffsetY(t){this.U.shadowOffsetY=t}get strokeStyle(){return this.U.strokeStyle}set strokeStyle(t){this.Xb!==t&&(this.U.strokeStyle=t,this.Xb=t)}get textAlign(){return this.U.textAlign}set textAlign(t){this.U.textAlign=t}get imageSmoothingEnabled(){return this.U.imageSmoothingEnabled}set imageSmoothingEnabled(t){this.U.imageSmoothingEnabled=t}get filter(){return this.U.filter}set filter(t){t===""?this.U.filter="none":this.U.filter=t}arc(t,i,e,s,n,o,r,l){this.U.arc(t,i,e,s,n,o)}beginPath(){this.U.beginPath()}endPath(){}bezierCurveTo(t,i,e,s,n,o){this.U.bezierCurveTo(t,i,e,s,n,o)}clearRect(t,i,e,s){this.commitTransform(),this.U.clearRect(t,i,e,s)}clip(t){t?this.U.clip(t):this.U.clip()}closePath(){this.U.closePath()}createLinearGradient(t,i,e,s){return this.U.createLinearGradient(t,i,e,s)}createPattern(t,i){return this.U.createPattern(t,i)}createRadialGradient(t,i,e,s,n,o){return this.U.createRadialGradient(t,i,e,s,n,o)}drawImage(t,i,e,s,n,o,r,l,h){s===void 0?this.U.drawImage(t,i,e):this.U.drawImage(t,i,e,s,n,o,r,l,h)}fill(t,i){i?this.U.fill(i,t?"evenodd":"nonzero"):this.U.fill(t?"evenodd":"nonzero")}fillRect(t,i,e,s){this.U.fillRect(t,i,e,s)}fillBackground(t,i,e,s){this.U.fillRect(t,i,e,s)}fillText(t,i,e){this.U.fillText(t,i,e)}getImageData(t,i,e,s){return this.U.getImageData(t,i,e,s)}lineTo(t,i){this.U.lineTo(t,i)}measureText(t){return this.U.measureText(t)}moveTo(t,i){this.U.moveTo(t,i)}quadraticCurveTo(t,i,e,s){this.U.quadraticCurveTo(t,i,e,s)}rect(t,i,e,s){this.U.rect(t,i,e,s)}restore(){this.U.restore()}save(){this.commitTransform(),this.U.save()}rotate(t){this.ka.cs(t*57.2958,0,0)}setTransform(t,i,e,s,n,o){this.ka.setTo(t,i,e,s,n,o)}scale(t,i){this.ka.et(t,i)}translate(t,i){this.ka.Ds(t,i)}stroke(t){t?this.U.stroke(t):this.U.stroke()}transform(t,i,e,s,n,o){if(t===1&&i===0&&e===0&&s===1&&n===0&&o===0)return;const r=this.ka,l=r.m11*t+r.m21*i,h=r.m12*t+r.m22*i,a=r.m11*e+r.m21*s,c=r.m12*e+r.m22*s;r.dx=r.m11*n+r.m21*o+r.dx,r.dy=r.m12*n+r.m22*o+r.dy,r.m11=l,r.m12=h,r.m21=a,r.m22=c}commitTransform(){const t=this.ka;this.U.setTransform(t.m11,t.m12,t.m21,t.m22,t.dx,t.dy)}fillContext(t,i,e){this.radialFill(t,i,e)||this.fillOrClip(i,e)}radialFill(t,i,e){if(!(t instanceof Brush)||t.type!==3)return!1;const s=t.tf,n=t.Eb;return n>s?(this.scale(s/n,1),this.translate((n-s)/2,0)):s>n&&(this.scale(1,n/s),this.translate(0,(s-n)/2)),this.fillOrClip(i,e),n>s?(this.translate(-(n-s)/2,0),this.scale(1/(s/n),1)):s>n&&(this.translate(0,-(s-n)/2),this.scale(1,1/(n/s))),!0}strokeContext(){this.clipInsteadOfFill||this.stroke()}fillOrClip(t,i){this.clipInsteadOfFill?this.clip(i):this.fill(t,i)}shadowsSet(t,i,e){this.of=t,this.rf=i,this.xn=e}shadowsOff(){this._r=!1,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowBlur=0}shadowsOn(){this._r=!0,this.shadowOffsetX=this.of,this.shadowOffsetY=this.rf,this.shadowBlur=this.xn}enableDash(t,i){const e=this.U;e.setLineDash!==void 0&&(e.setLineDash(t),e.lineDashOffset=i)}disableDash(){const t=this.U;t.setLineDash!==void 0&&(t.setLineDash(CanvasSurfaceContext.EmptyArray),t.lineDashOffset=0)}clearContextCache(t){t&&(this.zb=""),this.Xb="",this.Kb=""}removePartFromView(t){}static EmptyArray=Object.freeze([])}var BrushType=(w=>(w[w.Solid=1]="Solid",w[w.Linear=2]="Linear",w[w.Radial=3]="Radial",w[w.Pattern=4]="Pattern",w))(BrushType||{}),ColorSpace=(w=>(w[w.Lab=1]="Lab",w[w.HSL=2]="HSL",w[w.Oklch=3]="Oklch",w))(ColorSpace||{});class ColorNumbers{n0;n1;n2;n3;constructor(){this.n0=0,this.n1=0,this.n2=0,this.n3=0}}class Brush{h;$;Pa;ni;gs;W0;J0;bn;$0;yn;tf;Eb;constructor(t,i){if(GSet.ji(this),this.h=!1,t===void 0)this.$=1,this.Pa="black";else if(typeof t=="string"){const s=Util.Ih(BrushType,t);s!==null?(this.$=s,this.Pa="black"):(this.$=1,this.Pa=t)}else this.$=t,this.Pa="black";const e=this.$;if(e===2?(this.ni=Spot.TopCenter,this.gs=Spot.BottomCenter):e===3?(this.ni=Spot.Center,this.gs=Spot.Center):(this.ni=Spot.None,this.gs=Spot.None),this.W0=0,this.J0=NaN,this.bn=null,this.$0=null,this.yn=null,this.tf=0,this.Eb=0,i){const s={};for(const n in i)isFinite(parseFloat(n))?this.addColorStop(parseFloat(n),i[n]):s[n]=i[n];Object.assign(this,s)}}copy(){const t=new Brush;return t.$=this.$,t.Pa=this.Pa,t.ni=this.ni.N(),t.gs=this.gs.N(),t.W0=this.W0,t.J0=this.J0,this.bn!==null&&(t.bn=this.bn.copy()),t.$0=this.$0,t}g(){return this.h=!0,this.bn!==null&&this.bn.g(),this}ot(){return Object.isFrozen(this)&&Util.o("cannot thaw constant: "+this),this.h=!1,this.bn!==null&&this.bn.ot(),this}li(t){t in BrushType?this.type=t:Util.rr(this,t)}toString(){let t="Brush(";if(this.type===1)t+=this.color;else if(this.type===2?t+="Linear ":this.type===3?t+="Radial ":this.type===4?t+="Pattern ":t+="(unknown) ",t+=this.start+" "+this.end,this.colorStops!==null){const i=this.colorStops.iterator;for(;i.next();){const e=i.key,s=i.value;t+=" "+e+":"+s}}return t+=")",t}addColorStop(t,i){return this.h&&Util.T(this),(typeof t!="number"||!isFinite(t)||t>1||t<0)&&Util._(t,"0 <= loc <= 1",Brush,"addColorStop:loc"),Util.i(i,"string",Brush,"addColorStop:color"),this.bn===null&&(this.bn=new GMap),this.bn.set(t,i),this.$===1&&(this.type=2),this.yn=null,this}get type(){return this.$}set type(t){this.h&&Util.T(this,t),this.$=t,this.start.isNoSpot()&&(t===2?this.start=Spot.TopCenter:t===3&&(this.start=Spot.Center)),this.end.isNoSpot()&&(t===2?this.end=Spot.BottomCenter:t===3&&(this.end=Spot.Center)),this.yn=null}get color(){return this.Pa}set color(t){this.h&&Util.T(this,t),this.Pa=t,this.yn=null}get start(){return this.ni}set start(t){this.h&&Util.T(this,t),this.ni=t.N(),this.yn=null}get end(){return this.gs}set end(t){this.h&&Util.T(this,t),this.gs=t.N(),this.yn=null}get startRadius(){return this.W0}set startRadius(t){this.h&&Util.T(this,t),t<0&&Util._(t,">= zero",Brush,"startRadius"),this.W0=t,this.yn=null}get endRadius(){return this.J0}set endRadius(t){this.h&&Util.T(this,t),t<0&&Util._(t,">= zero",Brush,"endRadius"),this.J0=t,this.yn=null}get colorStops(){return this.bn}set colorStops(t){this.h&&Util.T(this,t),this.bn=t,this.yn=null}get pattern(){return this.$0}set pattern(t){this.h&&Util.T(this,t),this.$0=t,this.yn=null}static randomColor(t,i){t===void 0&&(t=128),i===void 0&&(i=Math.max(t,255));const e=Math.abs(i-t);let s=Math.floor(t+Math.random()*e).toString(16),n=Math.floor(t+Math.random()*e).toString(16),o=Math.floor(t+Math.random()*e).toString(16);return s.length<2&&(s="0"+s),n.length<2&&(n="0"+n),o.length<2&&(o="0"+o),"#"+s+n+o}static isValidColor(t){return root.CSS?root.CSS.supports("color",t):!0}static lighten(t){return Brush.lightenBy(t)}lightenBy(t,i){this.h&&Util.T(this);const e=t===void 0||typeof t!="number"?.2:t,s=i===void 0?3:i;if(this.type===1)Brush.To(this.color),this.color=Brush.ld(e,s);else if((this.type===2||this.type===3)&&this.colorStops!==null){const n=this.colorStops.iterator;for(;n.next();)Brush.To(n.value),this.addColorStop(n.key,Brush.ld(e,s))}return this}static lightenBy(t,i,e){const s=i===void 0||typeof i!="number"?.2:i,n=e===void 0?3:e;return Brush.To(t),Brush.ld(s,n)}static darken(t){return Brush.darkenBy(t)}darkenBy(t,i){this.h&&Util.T(this);const e=t===void 0||typeof t!="number"?.2:t,s=i===void 0?3:i;if(this.type===1)Brush.To(this.color),this.color=Brush.ld(-e,s);else if((this.type===2||this.type===3)&&this.colorStops!==null){const n=this.colorStops.iterator;for(;n.next();)Brush.To(n.value),this.addColorStop(n.key,Brush.ld(-e,s))}return this}static darkenBy(t,i,e){const s=i===void 0||typeof i!="number"?.2:i,n=e===void 0?3:e;return Brush.To(t),Brush.ld(-s,n)}static mix(t,i,e){Brush.To(t);const s=Brush.G.n0,n=Brush.G.n1,o=Brush.G.n2,r=Brush.G.n3;Brush.To(i),e===void 0&&(e=.5);const l=Math.round((Brush.G.n0-s)*e+s),h=Math.round((Brush.G.n1-n)*e+n),a=Math.round((Brush.G.n2-o)*e+o),c=Math.round((Brush.G.n3-r)*e+r);return`rgba(${l}, ${h}, ${a}, ${c})`}isDark(){if(this.type===1)return Brush.isDark(this.color);if((this.type===2||this.type===3)&&this.colorStops!==null){const t=this.colorStops;if(this.type===3)return Brush.isDark(t.first().value);if(t.get(.5)!==null)return Brush.isDark(t.get(.5));if(t.count===2){const l=t.toArray();return Brush.isDark(Brush.mix(l[0].value,l[1].value))}const i=t.iterator;let e=-1,s=-1,n=1,o=1;for(;i.next();){const l=i.key,h=Math.abs(.5-i.key);n>o&&h<n?(e=l,n=h):o>=n&&h<o&&(s=l,o=h)}if(e>s){let l=e;e=s,s=l,l=n,n=o,o=l}const r=s-e;return Brush.isDark(Brush.mix(t.get(e),t.get(s),1-o/r))}return!1}static isDark(t){return t?t instanceof Brush?t.isDark():(Brush.To(t),(299*Brush.G.n0+587*Brush.G.n1+114*Brush.G.n2)/1e3<128):!1}static ld(t,i){switch(i){case 1:return Brush.zR(),Brush.io.n0=Math.min(100,Math.max(0,Brush.io.n0+100*t)),Brush.XR(),"rgba("+Brush.G.n0+", "+Brush.G.n1+", "+Brush.G.n2+", "+Brush.G.n3+")";case 2:return Brush.IM(),Brush.Ei.n2=Math.min(100,Math.max(0,Brush.Ei.n2+100*t)),"hsla("+Brush.Ei.n0+", "+Brush.Ei.n1+"%, "+Brush.Ei.n2+"%, "+Brush.Ei.n3+")";case 3:return Brush.KR(),Brush.eo.n0=Math.min(100,Math.max(0,Brush.eo.n0+100*t)),Brush.YR(),"rgba("+Brush.G.n0+", "+Brush.G.n1+", "+Brush.G.n2+", "+Brush.G.n3+")";default:Util.o("Unknown color space: "+i)}}static To(t){const i=Brush.tl;if(i===null)return;i.clearRect(0,0,1,1),i.fillStyle="#000000";const e=i.fillStyle;if(i.fillStyle=t,i.fillStyle!==e){i.fillRect(0,0,1,1);const s=i.getImageData(0,0,1,1).data;Brush.G.n0=s[0],Brush.G.n1=s[1],Brush.G.n2=s[2],Brush.G.n3=s[3]/255}else{i.fillStyle="#FFFFFF";const s=i.fillStyle;i.fillStyle=t,i.fillStyle,Brush.G.n0=0,Brush.G.n1=0,Brush.G.n2=0,Brush.G.n3=1}}static IM(){const t=Brush.G.n0/255,i=Brush.G.n1/255,e=Brush.G.n2/255,s=Math.max(t,i,e),n=Math.min(t,i,e),o=s-n;let r,l;const h=(s+n)/2;if(o===0)r=l=0;else{switch(s){case t:r=(i-e)/o%6;break;case i:r=(e-t)/o+2;break;case e:r=(t-i)/o+4;break}r*=60,r<0&&(r+=360),l=o/(1-Math.abs(2*h-1))}Brush.Ei.n0=Math.round(r),Brush.Ei.n1=Math.round(l*100),Brush.Ei.n2=Math.round(h*100),Brush.Ei.n3=Brush.G.n3}static dE(){const t=Brush.Ei.n0,i=Brush.Ei.n1/100,e=Brush.Ei.n2/100;let s,n,o;const r=(1-Math.abs(2*e-1))*i,l=t/60,h=r*(1-Math.abs(l%2-1));l>=0&&l<1?(s=r,n=h,o=0):l>=1&&l<2?(s=h,n=r,o=0):l>=2&&l<3?(s=0,n=r,o=h):l>=3&&l<4?(s=0,n=h,o=r):l>=4&&l<5?(s=h,n=0,o=r):l>=5&&l<6&&(s=r,n=0,o=h);const a=e-.5*r;s+=a,n+=a,o+=a,Brush.G.n0=Math.round(s*255),Brush.G.n1=Math.round(n*255),Brush.G.n2=Math.round(o*255),Brush.G.n3=Brush.Ei.n3}static zR(){Brush.dA(),Brush.GR()}static XR(){Brush.jR(),Brush.gA()}static b2(t){return t/=255,t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}static k2(t){return t<=.0031308?t*12.92:1.055*Math.pow(t,1/2.4)-.055}static dA(){const t=Brush.b2(Brush.G.n0),i=Brush.b2(Brush.G.n1),e=Brush.b2(Brush.G.n2);Brush.Rt.n0=.4124564*t+.3575761*i+.1804375*e,Brush.Rt.n1=.2126729*t+.7151522*i+.072175*e,Brush.Rt.n2=.0193339*t+.119192*i+.9503041*e,Brush.Rt.n3=Brush.G.n3}static gA(){const t=3.2404542*Brush.Rt.n0+-1.5371385*Brush.Rt.n1+-.4985314*Brush.Rt.n2,i=-.969266*Brush.Rt.n0+1.8760108*Brush.Rt.n1+.041556*Brush.Rt.n2,e=.0556434*Brush.Rt.n0+-.2040259*Brush.Rt.n1+1.0572252*Brush.Rt.n2;Brush.G.n0=Brush.k2(t)*255,Brush.G.n1=Brush.k2(i)*255,Brush.G.n2=Brush.k2(e)*255,Brush.G.n3=Brush.Rt.n3,Brush.G.n0=Math.round(Brush.G.n0),Brush.G.n0>255?Brush.G.n0=255:Brush.G.n0<0&&(Brush.G.n0=0),Brush.G.n1=Math.round(Brush.G.n1),Brush.G.n1>255?Brush.G.n1=255:Brush.G.n1<0&&(Brush.G.n1=0),Brush.G.n2=Math.round(Brush.G.n2),Brush.G.n2>255?Brush.G.n2=255:Brush.G.n2<0&&(Brush.G.n2=0)}static P2=216/24389;static Yb=24389/27;static hd=[95.047,100,108.883];static M2(t){return t>Brush.P2?Math.pow(t,1/3):(Brush.Yb*t+16)/116}static GR(){const t=Brush.M2(Brush.Rt.n0*100/Brush.hd[0]),i=Brush.M2(Brush.Rt.n1*100/Brush.hd[1]),e=Brush.M2(Brush.Rt.n2*100/Brush.hd[2]);Brush.io.n0=116*i-16,Brush.io.n1=500*(t-i),Brush.io.n2=200*(i-e),Brush.io.n3=Brush.Rt.n3}static mA(t){const i=t*t*t;return i>Brush.P2?i:(116*t-16)/Brush.Yb}static jR(){const t=(Brush.io.n0+16)/116,i=Brush.io.n1/500+t,e=t-Brush.io.n2/200;Brush.Rt.n0=Brush.hd[0]/100*Brush.mA(i),Brush.Rt.n1=Brush.hd[1]/100*(Brush.io.n0>Brush.Yb*Brush.P2?Math.pow(t,3):Brush.io.n0/Brush.Yb),Brush.Rt.n2=Brush.hd[2]/100*Brush.mA(e),Brush.Rt.n3=Brush.io.n3}static HR(){let t=.8190224*Brush.Rt.n0+.3619062*Brush.Rt.n1+-.1288737*Brush.Rt.n2,i=.03298366*Brush.Rt.n0+.9292868*Brush.Rt.n1+.03614466*Brush.Rt.n2,e=.04817719*Brush.Rt.n0+.2642395*Brush.Rt.n1+.6335478*Brush.Rt.n2;t=Math.cbrt(t),i=Math.cbrt(i),e=Math.cbrt(e),Brush.ci.n0=.2104542*t+.7936177*i+-.004072046*e,Brush.ci.n1=1.977998*t+-2.428592*i+.4505937*e,Brush.ci.n2=.02590403*t+.7827717*i+-.8086757*e,Brush.ci.n3=Brush.Rt.n3,Brush.ci.n0*=100}static qR(){Brush.ci.n0/=100;let t=.9999999*Brush.ci.n0+.3963377*Brush.ci.n1+.2158037*Brush.ci.n2,i=1.000000009*Brush.ci.n0+-.1055613*Brush.ci.n1+-.06385417*Brush.ci.n2,e=1.00000005*Brush.ci.n0+-.08948418*Brush.ci.n1+-1.291485*Brush.ci.n2;t=t**3,i=i**3,e=e**3,Brush.Rt.n0=1.2268798*t+-.5578149*i+.281391*e,Brush.Rt.n1=-.04057576*t+1.112286*i+-.07171106*e,Brush.Rt.n2=-.07637294*t+-.4214933*i+1.586924*e,Brush.Rt.n3=Brush.ci.n3}static WR(){const t=Math.atan2(Brush.ci.n2,Brush.ci.n1)*180/Math.PI;Brush.eo.n0=Brush.ci.n0,Brush.eo.n1=Math.sqrt(Brush.ci.n1**2+Brush.ci.n2**2),Brush.eo.n2=t>=0?t:t+360,Brush.eo.n3=Brush.ci.n3}static JR(){Brush.ci.n0=Brush.eo.n0,Brush.ci.n1=Brush.eo.n1*Math.cos(Brush.eo.n2*Math.PI/180),Brush.ci.n2=Brush.eo.n1*Math.sin(Brush.eo.n2*Math.PI/180),Brush.ci.n3=Brush.eo.n3}static KR(){Brush.dA(),Brush.HR(),Brush.WR()}static YR(){Brush.JR(),Brush.qR(),Brush.gA()}static od(t,i){typeof t=="string"||t instanceof Brush||Util.o("Value for "+i+" must be a color string or a Brush, not "+t)}static Solid=1;static Linear=2;static Radial=3;static Pattern=4;static Lab=1;static HSL=2;static tl=Diagram.isUsingDOM()?new CanvasSurface(null,void 0,{willReadFrequently:!0}).ai:null;static G=new ColorNumbers;static Ei=new ColorNumbers;static Rt=new ColorNumbers;static io=new ColorNumbers;static ci=new ColorNumbers;static eo=new ColorNumbers}class PanelLayout{St="Base";static Layouts=new GMap;static definePanelLayout(t,i){i.name=t,PanelLayout.Layouts.set(t,i)}get name(){return this.St}set name(t){this.St=t}constructor(){}get classType(){return Panel}measure(t,i,e,s,n,o,r){}measureElement(t,i,e,s,n){t.ut(i,e,s,n)}arrange(t,i,e){}arrangeElement(t,i,e,s,n,o){t.Xt(i,e,s,n,o)}remeasureObject(t){t.ef()}Ui(t,i,e){}}class PanelLayoutPosition extends PanelLayout{constructor(){super()}measure(t,i,e,s,n,o,r){const l=s.length,h=t.Xo();for(let a=0;a<l;a++){const c=s[a];if(!c.visible&&c!==h)continue;const f=c.margin,u=f.right+f.left,d=f.top+f.bottom;c.ut(i,e,o,r);const m=c.measuredBounds,g=Math.max(m.width+u,0),p=Math.max(m.height+d,0);let y=c.position.x,x=c.position.y;if(isFinite(y)||(y=0),isFinite(x)||(x=0),c instanceof Shape&&c.isGeometryPositioned){const k=c.strokeWidth/2;y-=k,x-=k}n.unionNoCheck(y,x,g,p)}}arrange(t,i,e){const s=i.length,n=t.padding,o=e.x-n.left,r=e.y-n.top;for(let l=0;l<s;l++){const h=i[l],a=h.measuredBounds,c=h.margin,f=h.position.x,u=h.position.y;let d=isNaN(f)?-o:f-o,m=isNaN(u)?-r:u-r;if(h instanceof Shape&&h.isGeometryPositioned){const g=h.strokeWidth/2;d-=g,m-=g}h.visible&&h.Xt(d+c.left,m+c.top,a.width,a.height)}}}PanelLayout.definePanelLayout("Position",new PanelLayoutPosition);class PanelLayoutHorizontal extends PanelLayout{constructor(){super()}measure(t,i,e,s,n,o,r){const l=s.length,h=Util.nt(),a=t.Xo();for(let f=0;f<l;f++){const u=s[f];if(!u.visible&&u!==a)continue;const d=u.zs(!1);if(d!==0&&d!==5){h.push(u);continue}u.ut(1/0,e,0,r);const m=u.margin,g=u.measuredBounds,p=Math.max(g.width+m.right+m.left,0),y=Math.max(g.height+m.top+m.bottom,0);n.En(n.width+p,Math.max(n.height,y))}const c=h.length;t.desiredSize.height?e=Math.min(t.desiredSize.height,t.maxSize.height):n.height!==0&&(e=Math.min(n.height,t.maxSize.height));for(let f=0;f<c;f++){const u=h[f];if(!u.visible&&u!==a)continue;const d=u.margin,m=d.right+d.left,g=d.top+d.bottom;u.ut(1/0,e,0,r);const p=u.measuredBounds,y=Math.max(p.width+m,0),x=Math.max(p.height+g,0);n.width+=y,n.height=Math.max(n.height,x)}Util.tt(h)}arrange(t,i,e){const s=i.length,n=t.padding,o=n.top,r=t.isOpposite;let l=r?e.width:n.left;for(let h=0;h<s;h++){const a=o,c=i[h];if(!c.visible)continue;const f=c.measuredBounds,u=c.margin,d=u.top+u.bottom,m=o+n.bottom;let g=f.height;const p=c.zs(!1);(isNaN(c.desiredSize.height)&&p===2||p===4)&&(g=Math.max(e.height-d-m,0));const y=g+d+m;let x=c.alignment;x.isDefault()&&(x=t.defaultAlignment),x.isSpot()||(x=Spot.Center),r&&(l-=f.width+u.left+u.right),c.Xt(l+x.offsetX+u.left,a+x.offsetY+u.top+(e.height*x.y-y*x.y),f.width,g),r||(l+=f.width+u.left+u.right)}}}PanelLayout.definePanelLayout("Horizontal",new PanelLayoutHorizontal);class PanelLayoutVertical extends PanelLayout{constructor(){super()}measure(t,i,e,s,n,o,r){const l=s.length,h=Util.nt(),a=t.Xo();for(let f=0;f<l;f++){const u=s[f];if(!u.visible&&u!==a)continue;const d=u.zs(!1);if(d!==0&&d!==4){h.push(u);continue}u.ut(i,1/0,o,0);const m=u.margin,g=u.measuredBounds,p=Math.max(g.width+m.right+m.left,0),y=Math.max(g.height+m.top+m.bottom,0);n.En(Math.max(n.width,p),n.height+y)}const c=h.length;t.desiredSize.width?i=Math.min(t.desiredSize.width,t.maxSize.width):n.width!==0&&(i=Math.min(n.width,t.maxSize.width));for(let f=0;f<c;f++){const u=h[f];if(!u.visible&&u!==a)continue;const d=u.margin,m=d.right+d.left,g=d.top+d.bottom;u.ut(i,1/0,o,0);const p=u.measuredBounds,y=Math.max(p.width+m,0),x=Math.max(p.height+g,0);n.width=Math.max(n.width,y),n.height+=x}Util.tt(h)}arrange(t,i,e){const s=i.length,n=t.padding,o=n.left,r=t.isOpposite;let l=r?e.height:n.top;for(let h=0;h<s;h++){const a=o,c=i[h];if(!c.visible)continue;const f=c.measuredBounds,u=c.margin,d=u.left+u.right,m=o+n.right;let g=f.width;const p=c.zs(!1);(isNaN(c.desiredSize.width)&&p===2||p===5)&&(g=Math.max(e.width-d-m,0));const y=g+d+m;let x=c.alignment;x.isDefault()&&(x=t.defaultAlignment),x.isSpot()||(x=Spot.Center),r&&(l-=f.height+u.bottom+u.top),c.Xt(a+x.offsetX+u.left+(e.width*x.x-y*x.x),l+x.offsetY+u.top,g,f.height),r||(l+=f.height+u.bottom+u.top)}}}PanelLayout.definePanelLayout("Vertical",new PanelLayoutVertical);class PanelLayoutSpot extends PanelLayout{constructor(){super()}static pA=!1;measure(t,i,e,s,n,o,r){const l=s.length;if(l===0)return;const h=t.findMainElement();let a=h.margin,c=0,f=0;const u=a.right+a.left,d=a.top+a.bottom;h.ut(i,e,o,r);let m=h.measuredBounds,g=m.width,p=m.height,y=Math.max(g+u,0),x=Math.max(p+d,0);const k=t.isClipping;k&&h.x0()!==0&&!PanelLayoutSpot.pA&&(PanelLayoutSpot.pA=!0,Util.ei("Main Shape for Spot Panel with isClipping = true must have a zero strokeWidth: "+t.toString()));const b=Rect.X(-a.left,-a.top,y,x);let P=Rect.X(0,0,g,p);this.S2(h,P,!0),g=P.width,p=P.height;let M=!0;const L=t.Xo();let C;for(let S=0;S<l;S++){const N=s[S];let T=i,A=e;if(N===h||!N.visible&&N!==L)continue;a=N.margin;let D=a.left,F=a.top;switch(c=a.right+a.left,f=a.top+a.bottom,C=N.zs(!1),C){case 2:T=g,A=p,c=0,f=0,D=0,F=0;break;case 5:T=g,c=0,D=0;break;case 4:A=p,f=0,F=0;break}N.ut(T,A,0,0),m=N.measuredBounds,y=Math.max(m.width+c,0),x=Math.max(m.height+f,0);let R=N.alignment;R.isDefault()&&(R=t.defaultAlignment),R.isSpot()||(R=Spot.Center);let v=N.alignmentFocus;v.isDefault()&&(v=Spot.Center);let O=null;N instanceof Panel&&N.so!==""&&(O=N.findObject(N.so),O===N&&(O=null));let B=P.x-D,X=P.y-F;if(O!==null){N.Xt(0,0,m.width,m.height);const E=O.actualBounds,V=Point.X(E.x+(v.x*E.width-v.offsetX),E.y+(v.y*E.height-v.offsetY));for(O=O.panel;O!==N;)O.D.xt(V),O=O.panel;B+=R.x*g+R.offsetX-V.x,X+=R.y*p+R.offsetY-V.y,Point.s(V)}else B+=R.x*g+R.offsetX-(v.x*m.width+v.offsetX),X+=R.y*p+R.offsetY-(v.y*m.height+v.offsetY);M?(M=!1,n.e(B,X,y,x)):n.unionNoCheck(B,X,y,x)}switch(M?n.a(b):k?n.intersect(P.x,P.y,P.width,P.height):n.unionNoCheck(b.x,b.y,b.width,b.height),Rect.s(b),Rect.s(P),C=h.stretch,C===1&&(C=h.zs(!1)),C){case 0:return;case 2:if(!isFinite(i)&&!isFinite(e))return;break;case 5:if(!isFinite(i))return;break;case 4:if(!isFinite(e))return;break}m=h.measuredBounds,g=m.width,p=m.height,y=Math.max(g+u,0),x=Math.max(p+d,0),a=h.margin,P=Rect.X(-a.left,-a.top,y,x),this.S2(h,P,!0),g=P.width,p=P.height;for(let S=0;S<l;S++){const N=s[S];if(N===h||!N.visible&&N!==L)continue;a=N.margin,c=a.right+a.left,f=a.top+a.bottom,m=N.measuredBounds,y=Math.max(m.width+c,0),x=Math.max(m.height+f,0);let T=N.alignment;T.isDefault()&&(T=t.defaultAlignment),T.isSpot()||(T=Spot.Center);let A=N.alignmentFocus;A.isDefault()&&(A=Spot.Center),M?(M=!1,n.e(T.x*g+T.offsetX-(A.x*m.width+A.offsetX)-a.left,T.y*p+T.offsetY-(A.y*m.height+A.offsetY)-a.top,y,x)):n.unionNoCheck(T.x*g+T.offsetX-(A.x*m.width+A.offsetX)-a.left,T.y*p+T.offsetY-(A.y*m.height+A.offsetY)-a.top,y,x)}M?n.a(b):k?n.intersect(P.x,P.y,P.width,P.height):n.unionNoCheck(b.x,b.y,b.width,b.height),Rect.s(P)}arrange(t,i,e){const s=i.length;if(s===0)return;const n=t.findMainElement(),o=n.measuredBounds,r=o.width,l=o.height,h=t.padding,a=h.left,c=h.top;let f=a-e.x,u=c-e.y;n.Xt(f,u,r,l);const d=Rect.X(0,0,r,l);this.S2(n,d,!1);for(let m=0;m<s;m++){const g=i[m];if(g===n)continue;const p=g.measuredBounds,y=p.width,x=p.height;let k=g.alignment;k.isDefault()&&(k=t.defaultAlignment),k.isSpot()||(k=Spot.Center);let b=g.alignmentFocus;b.isDefault()&&(b=Spot.Center);let P=null;if(g instanceof Panel&&g.so!==""&&(P=g.findObject(g.so),P===g&&(P=null)),P!==null){const M=P.actualBounds,L=Point.X(M.x+(b.x*M.width-b.offsetX),M.y+(b.y*M.height-b.offsetY));for(P=P.panel;P!==g;)P.D.xt(L),P=P.panel;f=k.x*d.width+k.offsetX-L.x,u=k.y*d.height+k.offsetY-L.y,Point.s(L)}else f=k.x*d.width+k.offsetX-(b.x*y+b.offsetX),u=k.y*d.height+k.offsetY-(b.y*x+b.offsetY);f+=d.x-e.x,u+=d.y-e.y,g.visible&&g.Xt(a+f,c+u,y,x)}Rect.s(d)}S2(t,i,e){let s=null;if(t instanceof Panel&&t.so!==""&&(s=t.findObject(t.so),s===t&&(s=null)),s!==null)for(e&&t.Xt(0,0,i.width,i.height),i.a(s.actualBounds),s=s.panel;s!==t;)s.D.Vg(i),s=s.panel}}PanelLayout.definePanelLayout("Spot",new PanelLayoutSpot);class PanelLayoutAuto extends PanelLayout{constructor(){super()}measure(t,i,e,s,n,o,r){const l=s.length;if(l===0)return;const h=t.findMainElement();let a=h.margin,c=i,f=e;const u=a.right+a.left,d=a.top+a.bottom;h.ut(i,e,o,r);let m=h.measuredBounds,g=0,p=null;h instanceof Shape&&(p=h,g=p.strokeWidth*p.scale);let y=Math.max(m.width+u,0),x=Math.max(m.height+d,0),k=t.N2(h);const b=k.x*y+k.offsetX,P=k.y*x+k.offsetY;let M=t.C2(h);const L=M.x*y+M.offsetX,C=M.y*x+M.offsetY;isFinite(i)&&(c=Math.max(Math.abs(b-L)-g,0)),isFinite(e)&&(f=Math.max(Math.abs(P-C)-g,0));let S=0,N=0;o>0&&(S=Math.max(Math.abs(k.x*o+k.offsetX-(M.x*o+M.offsetX))-g,0)),r>0&&(N=Math.max(Math.abs(k.y*r+k.offsetY-(M.y*r+M.offsetY))-g,0));const T=Size.l();T.e(0,0);const A=t.Xo();for(let v=0;v<l;v++){const O=s[v];if(O===h||!O.visible&&O!==A)continue;a=O.margin;const B=a.right+a.left,X=a.top+a.bottom;O.ut(c,f,S,N),m=O.measuredBounds,y=Math.max(m.width+B,0),x=Math.max(m.height+X,0),T.e(Math.max(y,T.width),Math.max(x,T.height))}if(l===1){m=h.measuredBounds,n.width=y,n.height=x,Size.s(T);return}k=t.N2(h),M=t.C2(h);let D=0,F=0;M.x!==k.x&&M.y!==k.y&&(D=T.width/Math.abs(M.x-k.x),F=T.height/Math.abs(M.y-k.y)),Size.s(T),g=0,p!==null&&(g=p.strokeWidth*p.scale,p.tM()===6&&(D=F=Math.max(D,F))),D+=Math.abs(k.offsetX)+Math.abs(M.offsetX)+g,F+=Math.abs(k.offsetY)+Math.abs(M.offsetY)+g;let R=h.stretch;switch(R===1&&(R=h.zs(!1)),R){case 0:o=0,r=0;break;case 2:isFinite(i)&&(D=i),isFinite(e)&&(F=e);break;case 5:isFinite(i)&&(D=i),r=0;break;case 4:o=0,isFinite(e)&&(F=e);break}h.ef(),h.ut(D,F,o,r),n.width=h.measuredBounds.width+u,n.height=h.measuredBounds.height+d}arrange(t,i,e){const s=i.length;if(s===0)return;const n=t.findMainElement(),o=n.measuredBounds,r=Rect.l();r.e(0,0,1,1);let l=n.margin;const h=l.left,a=l.top,c=t.padding,f=c.left,u=c.top;let d=h,m=a,g=o.width,p=o.height;n.Xt(f+d,u+m,g,p);const y=t.N2(n),x=t.C2(n),k=0+y.x*o.width+y.offsetX,b=0+y.y*o.height+y.offsetY,P=0+x.x*o.width+x.offsetX,M=0+x.y*o.height+x.offsetY;r.x=k,r.y=b,r.unionNoCheck(P,M,0,0),r.x+=h+f,r.y+=a+u;for(let L=0;L<s;L++){const C=i[L];if(C===n)continue;const S=C.measuredBounds;l=C.margin;const N=Math.max(S.width+l.right+l.left,0),T=Math.max(S.height+l.top+l.bottom,0);let A=C.alignment;A.isDefault()&&(A=t.defaultAlignment),A.isSpot()||(A=Spot.Center),d=r.width*A.x+A.offsetX-N*A.x+l.left+r.x,m=r.height*A.y+A.offsetY-T*A.y+l.top+r.y,g=r.width,p=r.height,C.visible&&(Rect.contains(r.x,r.y,r.width,r.height,d,m,S.width,S.height)?C.Xt(d,m,S.width,S.height):C.Xt(d,m,S.width,S.height,new Rect(r.x,r.y,r.width,r.height)))}Rect.s(r)}}PanelLayout.definePanelLayout("Auto",new PanelLayoutAuto);class PanelLayoutTable extends PanelLayout{constructor(){super(),this.name="Table"}measure(t,i,e,s,n,o,r){let l=s.length;const h=Util.nt(),a=Util.nt();for(let K=0;K<l;K++){const I=s[K],j=I instanceof Panel?I:null;if(j!==null&&j.Qr()&&I.visible){a.push(j);const $=j.L.r,et=$.length;for(let _=0;_<et;_++){const tt=$[_];j.type===Panel.TableRow?tt.row=I.row:j.type===Panel.TableColumn&&(tt.column=I.column),h.push(tt)}}else h.push(I)}l=h.length,l===0&&(t.getRowDefinition(0),t.getColumnDefinition(0));const c=[];for(let K=0;K<l;K++){const I=h[K];I.visible&&(I.ue(!0),I._n(!0),c[I.row]||(c[I.row]=[]),c[I.row][I.column]||(c[I.row][I.column]=[]),c[I.row][I.column].push(I))}Util.tt(h);const f=Util.nt(),u=Util.nt(),d=Util.nt(),m={count:0},g={count:0};let p=i,y=e;const x=t.Ge,k=t.je;let b=null;l=x.length;for(let K=0;K<l;K++)b=x[K],b!==void 0&&(b.actual=0,b.Di=0);l=k.length;for(let K=0;K<l;K++)b=k[K],b!==void 0&&(b.actual=0,b.Di=0);let P=c.length,M=0;for(let K=0;K<P;K++)c[K]&&(M=Math.max(M,c[K].length));const L=Math.min(t.topIndex,P-1),C=Math.min(t.leftIndex,M-1);let S=0,N;P=c.length;const T=t.Xo();for(let K=0;K<P;K++){if(!c[K])continue;M=c[K].length;const I=t.getRowDefinition(K);I.actual=0,I.Di=0;for(let j=0;j<M;j++){if(!c[K][j])continue;const $=t.getColumnDefinition(j);f[j]===void 0&&($.actual=0,$.Di=0,f[j]=!0);const et=c[K][j],_=et.length;for(let tt=0;tt<_;tt++){const it=et[tt];if(!it.visible&&it!==T)continue;const ct=it.rowSpan>1,ot=it.columnSpan>1;(ct||ot)&&!(K<L)&&!(j<C)&&u.push(it);const lt=it.margin,st=lt.right+lt.left,nt=lt.top+lt.bottom;N=it.N0(I,$,!1);const ht=it.desiredSize,Z=!isNaN(ht.width),ft=!isNaN(ht.height);if(N!==0&&!(Z&&ft)&&!(K<L)&&!(j<C)&&(!ot&&m[j]===void 0&&(N===2||N===5)&&(m[j]=-1,m.count++),!ct&&g[K]===void 0&&(N===2||N===4)&&(g[K]=-1,g.count++),!ct&&!ot&&d.push(it)),it.ut(1/0,1/0,0,0),K<L||j<C)continue;const at=it.measuredBounds,ut=Math.max(at.width+st,0),gt=Math.max(at.height+nt,0);if(it.rowSpan===1&&(N===0||N===5)){b=t.getRowDefinition(K);const dt=b.computeEffectiveSpacing(),mt=b.st===0;S=Math.max(gt-b.actual,0),S+(mt?dt:0)>y&&(S=Math.max(y-dt,0)),b.Di=b.Di+S,b.actual=b.st+S,y=Math.max(y-(S+(mt?dt:0)),0)}if(it.columnSpan===1&&(N===0||N===4)){b=t.getColumnDefinition(j);const dt=b.computeEffectiveSpacing(),mt=b.st===0;S=Math.max(ut-b.actual,0),S+(mt?dt:0)>p&&(S=Math.max(p-dt,0)),b.Di=b.Di+S,b.actual=b.st+S,p=Math.max(p-(S+(mt?dt:0)),0)}(ct||ot)&&it.ef()}}}Util.tt(f);let A=0,D=0;l=t.columnCount;for(let K=0;K<l;K++){const I=k[K];I!==void 0&&(A+=isNaN(I.ge)?I.Di:I.ge,I.Di!==0&&(A+=I.computeEffectiveSpacing()))}l=t.rowCount;for(let K=0;K<l;K++){const I=x[K];I!==void 0&&(D+=isNaN(I.ge)?I.Di:I.ge,I.Di!==0&&(D+=I.computeEffectiveSpacing()))}p=Math.max(i-A,0),y=Math.max(e-D,0);let F=y,R=p;l=d.length;for(let K=0;K<l;K++){const I=d[K],j=t.getRowDefinition(I.row),$=t.getColumnDefinition(I.column),et=I.measuredBounds,_=I.margin,tt=_.right+_.left,it=_.top+_.bottom;$.Di===0&&m[I.column]!==void 0?m[I.column]=Math.max(et.width+tt,m[I.column]):m[I.column]=null,j.Di===0&&g[I.row]!==void 0?g[I.row]=Math.max(et.height+it,g[I.row]):g[I.row]=null}let v=0,O=0,B;for(B in g)B!=="count"&&(v+=g[B]);for(B in m)B!=="count"&&(O+=m[B]);const X=Size.l();for(let K=0;K<l;K++){const I=d[K];if(!I.visible&&I!==T)continue;const j=t.getRowDefinition(I.row),$=t.getColumnDefinition(I.column);let et=0;isFinite($.width)?et=$.width:(isFinite(p)&&m[I.column]!==null?O===0?et=$.actual+p:et=m[I.column]/O*R:m[I.column]!==null?et=p:et=$.actual||p,et=Math.max(0,et-$.computeEffectiveSpacing()));let _=0;switch(isFinite(j.height)?_=j.height:(isFinite(y)&&g[I.row]!==null?v===0?_=j.actual+y:_=g[I.row]/v*F:g[I.row]!==null?_=y:_=j.actual||y,_=Math.max(0,_-j.computeEffectiveSpacing())),X.e(Math.max($.minimum,Math.min(et,$.maximum)),Math.max(j.minimum,Math.min(_,j.maximum))),N=I.N0(j,$,!1),N){case 5:X.height=Math.max(X.height,j.actual+y);break;case 4:X.width=Math.max(X.width,$.actual+p);break}const tt=I.margin,it=tt.right+tt.left,ct=tt.top+tt.bottom;I.ef();let ot=$.minimum,lt=j.minimum;const st=I.measuredBounds;st.width===0&&m[I.column]!==null&&(ot=Math.max(ot,m[I.column])),st.height===0&&g[I.row]!==null&&(lt=Math.max(ot,g[I.row])),I.ut(X.width,X.height,ot,lt);const nt=I.measuredBounds;let ht=Math.max(nt.width+it,0),Z=Math.max(nt.height+ct,0);isFinite(p)&&(ht=Math.min(ht,X.width)),isFinite(y)&&(Z=Math.min(Z,X.height));let ft=0;ft=j.actual,j.actual=Math.max(j.actual,Z),j.Di=Math.max(j.Di,Z),S=j.actual-ft,y=Math.max(y-S,0),g[I.row]===null&&(F=Math.max(F-S,0)),ft=$.actual,$.actual=Math.max($.actual,ht),$.Di=Math.max($.Di,ht),S=$.actual-ft,p=Math.max(p-S,0),m[I.column]===null&&(R=Math.max(R-S,0))}Util.tt(d);const E=Size.l(),V=Util.nt(),U=Util.nt();if(l=u.length,l!==0)for(let K=0;K<P;K++){if(!c[K])continue;M=c[K].length;const I=t.getRowDefinition(K);V[K]=I.actual;for(let j=0;j<M;j++){if(!c[K][j])continue;const $=t.getColumnDefinition(j);U[j]=$.actual}}for(let K=0;K<l;K++){const I=u[K];if(!I.visible&&I!==T)continue;const j=t.getRowDefinition(I.row),$=t.getColumnDefinition(I.column);switch(X.e(Math.max($.minimum,Math.min(i,$.maximum)),Math.max(j.minimum,Math.min(e,j.maximum))),N=I.N0(j,$,!1),N){case 2:U[$.index]!==0&&(X.width=Math.min(X.width,U[$.index])),V[j.index]!==0&&(X.height=Math.min(X.height,V[j.index]));break;case 5:U[$.index]!==0&&(X.width=Math.min(X.width,U[$.index]));break;case 4:V[j.index]!==0&&(X.height=Math.min(X.height,V[j.index]));break}isFinite($.width)&&(X.width=$.width),isFinite(j.height)&&(X.height=j.height),E.e(0,0);let et=$.minimum,_=j.minimum;for(let Z=1;Z<I.rowSpan&&!(I.row+Z>=t.rowCount);Z++)b=t.getRowDefinition(I.row+Z),S=0,N===2||N===4?S=Math.max(b.minimum,V[I.row+Z]===0?b.maximum:Math.min(V[I.row+Z],b.maximum)):S=Math.max(b.minimum,isNaN(b.ge)?b.maximum:Math.min(b.ge,b.maximum)),E.height+=S,_+=b.minimum;for(let Z=1;Z<I.columnSpan&&!(I.column+Z>=t.columnCount);Z++)b=t.getColumnDefinition(I.column+Z),S=0,N===2||N===5?S=Math.max(b.minimum,U[I.column+Z]===0?b.maximum:Math.min(U[I.column+Z],b.maximum)):S=Math.max(b.minimum,isNaN(b.ge)?b.maximum:Math.min(b.ge,b.maximum)),E.width+=S,et+=b.minimum;X.width+=E.width,X.height+=E.height;const tt=I.margin,it=tt.right+tt.left,ct=tt.top+tt.bottom;I.ut(X.width,X.height,et,_);const ot=I.measuredBounds,lt=Math.max(ot.width+it,0),st=Math.max(ot.height+ct,0);let nt=0;for(let Z=0;Z<I.rowSpan&&!(I.row+Z>=t.rowCount);Z++)b=t.getRowDefinition(I.row+Z),nt+=b.total||0;if(nt<st){let Z=st-nt;const ft=st-nt;if(I.spanAllocation!==null){const rt=I.spanAllocation;for(let at=0;at<I.rowSpan&&!(Z<=0||I.row+at>=t.rowCount);at++){b=t.getRowDefinition(I.row+at);const ut=b.st||0,gt=rt(I,b,ft);b.actual=Math.min(b.maximum,ut+gt),b.st!==ut&&(Z-=b.st-ut)}}for(;Z>0;){const rt=b.st||0;if(isNaN(b.height)&&b.maximum>rt&&(b.actual=Math.min(b.maximum,rt+Z),b.st!==rt&&(Z-=b.st-rt)),b.index===0)break;b=t.getRowDefinition(b.index-1)}}let ht=0;for(let Z=0;Z<I.columnSpan&&!(I.column+Z>=t.columnCount);Z++)b=t.getColumnDefinition(I.column+Z),ht+=b.total||0;if(ht<lt){let Z=lt-ht;const ft=lt-ht;if(I.spanAllocation!==null){const rt=I.spanAllocation;for(let at=0;at<I.columnSpan&&!(Z<=0||I.column+at>=t.columnCount);at++){b=t.getColumnDefinition(I.column+at);const ut=b.st||0,gt=rt(I,b,ft);b.actual=Math.min(b.maximum,ut+gt),b.st!==ut&&(Z-=b.st-ut)}}for(;Z>0;){const rt=b.st||0;if(isNaN(b.width)&&b.maximum>rt&&(b.actual=Math.min(b.maximum,rt+Z),b.st!==rt&&(Z-=b.st-rt)),b.index===0)break;b=t.getColumnDefinition(b.index-1)}}}Util.tt(u),Size.s(E),Size.s(X),V!==void 0&&Util.tt(V),U!==void 0&&Util.tt(U);let Y=0,G=0;const H=t.desiredSize,J=t.maxSize;N=t.zs(!0),A=0,D=0;let z=0,W=0;l=t.columnCount;for(let K=0;K<l;K++)if(k[K]!==void 0){if(b=t.getColumnDefinition(K),isFinite(b.width)){z+=b.width,z+=b.computeEffectiveSpacing();continue}else if(b.Gb()===2){z+=b.st,z+=b.computeEffectiveSpacing();continue}b.st!==0&&(A+=b.st,A+=b.computeEffectiveSpacing())}isFinite(H.width)?Y=Math.min(H.width,J.width):N!==0&&isFinite(i)?Y=i:Y=A,Y=Math.max(Y,isFinite(i)?Math.min(o,i):o),Y=Math.max(Y-z,0);const q=A===0?1:Math.max(Y/A,1);for(let K=0;K<l;K++)k[K]!==void 0&&(b=t.getColumnDefinition(K),!isFinite(b.width)&&b.Gb()!==2&&(b.actual=b.st*q),b.position=n.width,b.st!==0&&(n.width+=b.st,n.width+=b.computeEffectiveSpacing()));l=t.rowCount;for(let K=0;K<l;K++)if(x[K]!==void 0){if(b=t.getRowDefinition(K),isFinite(b.height)){W+=b.height,W+=b.computeEffectiveSpacing();continue}else if(b.Gb()===2){W+=b.st,W+=b.computeEffectiveSpacing();continue}b.st!==0&&(D+=b.st,D+=b.computeEffectiveSpacing())}isFinite(H.height)?G=Math.min(H.height,J.height):N!==0&&isFinite(e)?G=e:G=D,G=Math.max(G,isFinite(e)?Math.min(r,e):r),G=Math.max(G-W,0);const Q=D===0?1:Math.max(G/D,1);for(let K=0;K<l;K++)x[K]!==void 0&&(b=t.getRowDefinition(K),!isFinite(b.height)&&b.Gb()!==2&&(b.actual=b.st*Q),b.position=n.height,b.st!==0&&(n.height+=b.st,n.height+=b.computeEffectiveSpacing()));l=a.length;for(let K=0;K<l;K++){const I=a[K];let j=0,$=0;I.type===Panel.TableRow?(j=n.width,b=t.getRowDefinition(I.row),$=b.actual):(b=t.getColumnDefinition(I.column),j=b.actual,$=n.height),I.measuredBounds.e(0,0,j,$),I.ue(!1)}Util.tt(a),t.gh=c}arrange(t,i,e){const s=i.length,n=t.padding,o=n.left,r=n.top,l=t.gh;if(l===null)return;let h=0,a=0;const c=l.length;let f=0;for(let C=0;C<c;C++)l[C]&&(f=Math.max(f,l[C].length));const u=t.Ge,d=t.je;let m=0,g=0,p=Math.min(t.topIndex,c-1);if(u.length>0){for(;p!==c&&(u[p]===void 0||u[p].st===0);)p++;p=Math.max(Math.min(p,c-1),0),m=-u[p].position}let y=Math.min(t.leftIndex,f-1);if(d.length>0){for(;y!==f&&(d[y]===void 0||d[y].st===0);)y++;y=Math.max(Math.min(y,f-1),0),g=-d[y].position}let x=0,k=0;for(;x!==c&&u[x]===void 0;)x++;for(;k!==c&&d[k]===void 0;)k++;const b=t.part;let P=t.getRowDefinition(x),M=t.getColumnDefinition(k);for(let C=0;C<i.length;C++){const S=i[C];if(!(S instanceof Panel&&S.visible&&S.Qr()))continue;S.type===Panel.TableRow?(P=t.getRowDefinition(S.row),M=t.getColumnDefinition(k)):(P=t.getRowDefinition(x),M=t.getColumnDefinition(S.column)),a=P.position+m+r,P.st!==0&&(a+=P.computeEffectiveSpacingTop(Math.max(x,p))),h=M.position+g+o,M.st!==0&&(h+=M.computeEffectiveSpacingTop(Math.max(k,y)));const N=S.measuredBounds;S.Qc(),S.actualBounds.ot();const T=S.actualBounds,A=Rect.X(T.x,T.y,T.width,T.height);if(T.x=S.type===Panel.TableRow?o:h,T.y=S.type===Panel.TableColumn?r:a,T.width=N.width,T.height=N.height,S.actualBounds.g(),S._n(!1),A.equalsApproxClose(T)){Rect.s(A);continue}b!==null&&(b.ch(),S.k0(b)),Rect.s(A)}const L=Size.l();for(let C=0;C<c;C++){if(!l[C])continue;f=l[C].length;const S=t.getRowDefinition(C);a=S.position+m+r,S.st!==0&&(a+=S.computeEffectiveSpacingTop(Math.max(x,p)));for(let N=0;N<f;N++){if(!l[C][N])continue;const T=t.getColumnDefinition(N);h=T.position+g+o,T.st!==0&&(h+=T.computeEffectiveSpacingTop(Math.max(k,y)));const A=l[C][N],D=A.length;for(let F=0;F<D;F++){const R=A[F],v=R.measuredBounds;L.e(0,0);for(let st=1;st<R.rowSpan&&!(C+st>=t.rowCount);st++){const nt=t.getRowDefinition(C+st);nt.st!==0&&(L.height+=nt.total)}for(let st=1;st<R.columnSpan&&!(N+st>=t.columnCount);st++){const nt=t.getColumnDefinition(N+st);nt.st!==0&&(L.width+=nt.total)}const O=T.st+L.width,B=S.st+L.height;let X=h,E=a;const V=O,U=B,Y=h,G=a;let H=O,J=B;h+O>e.width&&(H=Math.max(e.width-h,0)),a+B>e.height&&(J=Math.max(e.height-a,0));let z=R.alignment,W=0,q=0,Q=0,K=0;if(z.isDefault()){z=t.defaultAlignment,z.isSpot()||(z=Spot.Center),W=z.x,q=z.y,Q=z.offsetX,K=z.offsetY;const st=T.alignment,nt=S.alignment;st.isSpot()&&(W=st.x,Q=st.offsetX),nt.isSpot()&&(q=nt.y,K=nt.offsetY)}else W=z.x,q=z.y,Q=z.offsetX,K=z.offsetY;(isNaN(W)||isNaN(q))&&(W=.5,q=.5,Q=0,K=0);let I=v.width,j=v.height;const $=R.margin,et=$.left+$.right,_=$.top+$.bottom,tt=R.N0(S,T,!1);isNaN(R.desiredSize.width)&&(tt===2||tt===5)&&(I=Math.max(O-et,0)),isNaN(R.desiredSize.height)&&(tt===2||tt===4)&&(j=Math.max(B-_,0));const it=R.maxSize,ct=R.minSize;I=Math.min(it.width,I),j=Math.min(it.height,j),I=Math.max(ct.width,I),j=Math.max(ct.height,j);const ot=I+et,lt=j+_;X+=V*W-ot*W+Q+$.left,E+=U*q-lt*q+K+$.top,R.visible&&(Rect.contains(Y,G,H,J,X,E,v.width,v.height)?R.Xt(X,E,I,j):R.Xt(X,E,I,j,new Rect(Y,G,H,J)))}}}Size.s(L);for(let C=0;C<s;C++){const S=i[C],N=S instanceof Panel?S:null;if(N!==null&&N.Qr()){const T=S.actualBounds;S.naturalBounds.ot(),S.naturalBounds.e(0,0,T.width,T.height),S.naturalBounds.g()}}}}PanelLayout.definePanelLayout("Table",new PanelLayoutTable);class PanelLayoutTableRow extends PanelLayout{constructor(){super()}measure(t,i,e,s,n,o,r){}arrange(t,i,e){}}PanelLayout.definePanelLayout("TableRow",new PanelLayoutTableRow);class PanelLayoutTableColumn extends PanelLayout{constructor(){super()}measure(t,i,e,s,n,o,r){}arrange(t,i,e){}}PanelLayout.definePanelLayout("TableColumn",new PanelLayoutTableColumn);class PanelLayoutViewbox extends PanelLayout{constructor(){super()}measure(t,i,e,s,n,o,r){s.length!==1&&Util.o("Viewbox Panel must contain exactly one GraphObject.");const h=s[0];h.et=1,h.ef(),h.ut(1/0,1/0,o,r);let a=h.measuredBounds;const c=h.margin,f=c.right+c.left,u=c.top+c.bottom;if(isFinite(i)||isFinite(e)){const d=h.scale,m=a.width,g=a.height,p=Math.max(i-f,0),y=Math.max(e-u,0);let x=1;t.viewboxStretch===6?(m!==0&&g!==0&&(x=Math.min(p/m,y/g)),x===0&&(x=1e-4),h.et*=x):(m!==0&&g!==0&&(x=Math.max(p/m,y/g)),x===0&&(x=1e-4),h.et*=x),d!==h.scale&&(h.ue(!0),h.ut(1/0,1/0,o,r))}a=h.measuredBounds,n.width=isFinite(i)?i:Math.max(a.width+f,0),n.height=isFinite(e)?e:Math.max(a.height+u,0)}arrange(t,i,e){const s=i[0],n=s.measuredBounds,o=s.margin,r=o.right+o.left,l=o.top+o.bottom,h=Math.max(n.width+r,0),a=Math.max(n.height+l,0);let c=s.alignment;c.isDefault()&&(c=t.defaultAlignment),c.isSpot()||(c=Spot.Center),s.Xt(e.width*c.x-h*c.x+c.offsetX,e.height*c.y-a*c.y+c.offsetY,n.width,n.height)}}PanelLayout.definePanelLayout("Viewbox",new PanelLayoutViewbox);class PanelLayoutGrid extends PanelLayout{constructor(){super()}measure(t,i,e,s,n,o,r){t.xi===null&&(t.xi=new GridPanelSettings),this.$R(t),this.ZR(t)}arrange(t,i,e){}Ui(t,i,e){const s=t.naturalBounds,n=s.width,o=s.height;i.save(),i.beginPath(),i.rect(0,0,n,o),i.clip(),i.endPath(),this.QR(t,i,e),i.restore(),i.clearContextCache(!1)}QR(t,i,e){let s=t.getDocumentScale()*e.scale;s<=0&&(s=1);const n=t.gridCellSize,o=n.width,r=n.height,l=t.naturalBounds,h=t.actualBounds,a=l.width,c=l.height,f=Math.ceil(a/o),u=Math.ceil(c/r),d=t.gridOrigin,m=d.x,g=d.y,p=t.xi.Z0,y=t.L.r,x=y.length;for(let k=0;k<x;k++){const b=y[k];if(!b.visible)continue;const P=b.interval||1,M=Math.abs(P);if(o*M*s<2)continue;let L=b.segmentIndex;(!isFinite(L)||isNaN(L))&&(L=0),L<0&&(L=M-Math.min(-L,M)),L=Math.round(L%M);const C=b.opacity;let S=1;if(C!==1){if(C===0)continue;S=i.globalAlpha,i.globalAlpha=S*C}const N=p[k];let T=!1;const A=b.strokeDashArray;if(A!==null&&(T=!0,i.enableDash(A,b.strokeDashOffset)),b.stroke!==null&&b.strokeWidth>0&&(b.figure==="LineV"||b.figure==="LineH")){if(i.lineWidth=b.strokeWidth,t.dn(i,b.stroke,!1,!1,l,h),i.beginPath(),b.figure==="LineV"){const D=Math.floor((m-o)/o);for(let F=D;F<=D+f;F++){const R=F*o+m;0<=R&&R<=a&&this.jb(F,P,L,N)&&(i.moveTo(R,0),i.lineTo(R,c))}}else if(b.figure==="LineH"){const D=Math.floor((g-r)/r);for(let F=D;F<=D+u;F++){const R=F*r+g;0<=R&&R<=c&&this.jb(F,P,L,N)&&(i.moveTo(0,R),i.lineTo(a,R))}}i.stroke(),i.endPath()}else if(b.fill!==null){if(t.dn(i,b.fill,!0,!1,l,h),b.figure==="BarV"){let D=b.width;isNaN(D)&&(D=o);const F=Math.floor((m-o)/o);for(let R=F;R<=F+f;R++){const v=R*o+m;0<=v+D&&v<=a&&this.jb(R,P,L,N)&&i.fillRect(v,0,D,c)}}else if(b.figure==="BarH"){let D=b.height;isNaN(D)&&(D=r);const F=Math.floor((g-r)/r);for(let R=F;R<=F+u;R++){const v=R*r+g;0<=v+D&&v<=c&&this.jb(R,P,L,N)&&i.fillRect(0,v,a,D)}}}T&&i.disableDash(),C!==1&&(i.globalAlpha=S)}}jb(t,i,e,s){if(i<0)return t%i===e;if(t%i!==e)return!1;const n=s.length;for(let o=0;o<n;o++){const r=s[o];if(t%r===e)return!1}return!0}ZR(t){const i=[],e=t.L.r,s=e.length;for(let n=0;n<s;n++){const o=e[n],r=[];if(i.push(r),!o.visible)continue;const l=o.interval;if(l<0)continue;const h=o.figure,a=this.L2(h);for(let c=0;c<s;c++){if(c===n)continue;const f=e[c];if(!f.visible)continue;const u=f.figure;if(this.L2(u)!==a)continue;const d=f.interval;d>l&&r.push(d)}}t.xi.Z0=i}L2(t){return t==="LineV"||t==="BarV"}$R(t){let i=1,e=1;const s=t.L.r,n=s.length;for(let l=0;l<n;l++){const h=s[l],a=Math.abs(h.interval);a<2||(this.L2(h.figure)?e=e*a/Geo.gC(e,a):i=i*a/Geo.gC(i,a))}const o=t.gridCellSize,r=t.xi;r.Yc.isReal()?r.Yc.e(e*o.width,i*o.height):r.Yc=new Size(e*o.width,i*o.height)}}PanelLayout.definePanelLayout("Grid",new PanelLayoutGrid);class PanelLayoutLink extends PanelLayout{constructor(){super()}measure(t,i,e,s,n,o,r){const l=s.length;if(!(t instanceof Adornment||t instanceof Link))return;let h=null,a=null;if(t instanceof Link&&(h=t),t instanceof Adornment&&(a=t,h=a.adornedPart,t.af===null&&(t.af=[])),!(h instanceof Link))return;const c=h;if(l===0){t.naturalBounds.En(0,0),t.measuredBounds.e(0,0,0,0);return}const f=t instanceof Adornment?null:h.path,u=h.routeBounds,d=t.Ko;d.e(0,0,u.width,u.height);const m=c.points,g=h.pointsCount;a!==null?a.ad(!1):h!==null&&h.ad(!1);const p=u.width,y=u.height,x=t.af;if(x.length=0,f!==null){this.measureLinkPath(t,p,y,f);const M=f.measuredBounds;d.unionRect(M),x.push(M)}const k=Transform.l(),b=Point.l(),P=Point.l();for(let M=0;M<l;M++){const L=s[M];if(L===f)continue;let C=L.measuredBounds;if(L.isPanelMain&&L instanceof Shape){this.measureLinkPath(t,p,y,L),C=L.measuredBounds,d.unionRect(C),x.push(C);continue}if(g<2){L.ut(1/0,1/0,0,0),C=L.measuredBounds,d.unionRect(C),x.push(C);continue}const S=L.segmentIndex,N=L.segmentFraction;let T=L.alignmentFocus;T.isNoSpot()&&(T=Spot.Center);const A=L.segmentOrientation,D=L.segmentOffset;let F=0,R=0,v=0,O=0;if(isNaN(S)){const z=c.ct,W=Util.nt();z.getPointAndAngleAlongPath(N,W);const q=Point.X(W[0],W[1]);O=W[2],A!==0&&(v=c.computeAngle(L,A,O),L.Kt=v,L.ue(!0),L._n(!0)),F=q.x,R=q.y,Point.s(q),Util.tt(W)}else if(S<-g||S>=g){const z=Point.l();c.yA(z),O=c.midAngle,A!==0&&(v=c.computeAngle(L,A,O),L.Kt=v,L.ue(!0),L._n(!0)),F=z.x-u.x,R=z.y-u.y,Point.s(z)}else{let z,W,q=0;if(S>=0?(z=m.elt(S),W=S<g-1?m.elt(S+1):z):(q=g+S,z=m.elt(q),W=q>0?m.elt(q-1):z),O=0,z.equalsApprox(W)){let Q,K;S>=0?(Q=S>0?m.elt(S-1):z,K=S<g-2?m.elt(S+2):W):(Q=q<g-1?m.elt(q+1):z,K=q>1?m.elt(q-2):W);const I=Q.distanceSquaredPoint(z),j=W.distanceSquaredPoint(K);I>j+10?O=S>=0?Q.directionPoint(z):z.directionPoint(Q):j>I+10?O=S>=0?W.directionPoint(K):K.directionPoint(W):O=S>=0?Q.directionPoint(K):K.directionPoint(Q)}else O=S>=0?z.directionPoint(W):W.directionPoint(z);A!==0&&(v=c.computeAngle(L,A,O),L.Kt=v,L.ue(!0),L._n(!0)),F=z.x+(W.x-z.x)*N-u.x,R=z.y+(W.y-z.y)*N-u.y}L.ut(1/0,1/0,0,0),C=L.measuredBounds;const B=L.naturalBounds;let X=0;L instanceof Shape&&(X=L.strokeWidth);const E=B.width+X,V=B.height+X;k.vi(),k.Ds(-C.x,-C.y),k.et(L.scale,L.scale),k.cs(A===0?L.angle:O,E/2,V/2),(A===22||A===26)&&k.cs(90,E/2,V/2),(A===23||A===27)&&k.cs(-90,E/2,V/2),A===28&&(O>45&&O<135||O>225&&O<315)&&k.cs(-O,E/2,V/2);const U=new Rect(0,0,E,V);b.setRectSpot(U,T),k.xt(b);const Y=-b.x+X/2*L.scale,G=-b.y+X/2*L.scale;P.a(D);const H=isNaN(D.x),J=isNaN(D.y);if(H||J){const z=E/2+3,W=V/2+3,q=O>=45&&O<=135,Q=O>=225&&O<=315;A===0&&(q||Q)?(P.x=J?z:D.y,P.y=H?W:D.x,q?S>=0||isNaN(S)&&N<.5||H&&(P.y=-W):Q&&((S>=0||isNaN(S)&&N<.5)&&H&&(P.y=-W),J&&(P.x=-z))):(H&&(S>=0||isNaN(S)&&N<.5?P.x=z:P.x=-z),J&&(P.y=-W),P.rotate(O))}else P.rotate(O);F+=P.x,R+=P.y,U.e(F+Y,R+G,C.width,C.height),x.push(U),d.unionRect(U)}if(h!==null){const M=h.labelNodes;for(;M.next();)M.value.ut(1/0,1/0)}t.Ko=d,t.position.e(u.x+d.x,u.y+d.y),n.En(d.width||0,d.height||0),Transform.s(k),Point.s(b),Point.s(P)}arrange(t,i,e){const s=i.length;if(!(t instanceof Adornment||t instanceof Link))return;let n=t,o=null;t instanceof Adornment&&(o=t,n=o.adornedPart);const r=t,l=t instanceof Adornment?null:n.path,h=t.af;if(h.length!==0){let u=0;if(l!==null&&u<h.length){const d=h[u];u++,l.Xt(d.x-r.Ko.x,d.y-r.Ko.y,d.width,d.height)}for(let d=0;d<s;d++){const m=i[d];if(m!==l&&u<h.length){const g=h[u];u++,m.Xt(g.x-r.Ko.x,g.y-r.Ko.y,g.width,g.height)}}}const a=n.points,c=a.count;if(c>=2&&r instanceof Link){const u=r.labelNodes;for(;u.next();){const d=u.value;r._R(d,c,a)}}o!==null?o.ad(!1):n.ad(!1);const f=t.wA(Point.l());t.location.e(t.position.x+f.x,t.position.y+f.y),Point.s(f)}measureLinkPath(t,i,e,s){if(s.vo()===!1)return;let n=s.strokeWidth;if(n===0&&t instanceof Adornment&&t.type===Panel.Link&&t.adornedObject instanceof Shape&&(n=t.adornedObject.strokeWidth),n=n*s.et,t instanceof Link&&t.ct!==null){const o=t.geometry.bounds;s.Qn(o.x-n/2,o.y-n/2,o.width+n,o.height+n)}else if(t instanceof Adornment&&t.adornedPart.ct!==null){const o=t.adornedPart.ct.bounds;s.Qn(o.x-n/2,o.y-n/2,o.width+n,o.height+n)}else s.Qn(-(n/2),-(n/2),i+n,e+n);s.tv(),s.ue(!1)}}PanelLayout.definePanelLayout("Link",new PanelLayoutLink);class PanelLayoutGraduated extends PanelLayout{constructor(){super()}measure(t,i,e,s,n,o,r){const l=t.findMainElement();t.He=[];const h=l.margin,a=h.right+h.left,c=h.top+h.bottom;l.ut(i,e,o,r);const f=l.measuredBounds,u=f.width,d=f.height,m=Math.max(u+a,0),g=Math.max(d+c,0),p=new Rect(-h.left,-h.top,m,g);t.He.push(p),n.a(p),this.determineGraduatedMarks(t,l);const y=t.ws;if(y===null)return;const x=s.length;for(let k=0;k<x;k++){const b=s[k],P=y[k];!b.visible||b===l||P.length===0||(b instanceof Shape?this.measureGraduatedTicks(t,b,P,n):b instanceof TextBlock&&this.measureGraduatedLabels(t,b,P,n),b.ue(!1))}}arrange(t,i,e){if(t.He===null)return;const s=t.findMainElement(),n=t.ws;if(n===null)return;const o=t.He;let r=0,l=o[r];r++,s!==null&&s.Xt(l.x-e.x,l.y-e.y,l.width,l.height);const h=i.length;for(let a=0;a<h;a++){const c=i[a],f=n[a];!c.visible||c===s||f.length===0||(l=o[r],r++,c.Xt(l.x-e.x,l.y-e.y,l.width,l.height))}t.He=null}measureGraduatedTicks(t,i,e,s){let n=i.alignmentFocus;n.isNoSpot()&&(n=Spot.TopCenter);const o=i.angle;i.Kt=0,i.ut(1/0,1/0,0,0),i.Kt=o;const r=i.measuredBounds,l=r.width,h=r.height,a=Rect.X(0,0,l,h),c=Point.l();c.setRectSpot(a,n),Rect.s(a);const f=-c.x,u=-c.y,d=new Rect,m=e.length;for(let g=0;g<m;g++){const p=e[g],y=p.pt.x,x=p.pt.y,k=p.angle;for(let b=0;b<4;b++){switch(b){case 0:c.e(f,u);break;case 1:c.e(f+l,u);break;case 2:c.e(f,u+h);break;case 3:c.e(f+l,u+h);break}c.rotate(k+i.angle),c.offset(y,x),g===0&&b===0?d.e(c.x,c.y,0,0):d.unionPoint(c),c.offset(-y,-x),c.rotate(-k-i.angle)}}Point.s(c),t.He!==null&&t.He.push(d),s.unionNoCheck(d.x,d.y,d.width,d.height)}measureGraduatedLabels(t,i,e,s){t.Me===null&&(t.Me=new TextBlock);const n=t.Me;this.xA(i,n);let o=i.alignmentFocus;o.isNoSpot()&&(o=Spot.TopCenter);const r=i.segmentOrientation,l=i.segmentOffset,h=new Rect;let a=0,c=0,f=0,u=0,d=0;const m=e.length;for(let g=0;g<m;g++){const p=e[g];a=p.pt.x,c=p.pt.y,f=p.angle,u=i.angle,d=i.angle,r!==0&&(r===21||r===25?d=f+i.angle:d=f,u=Link.computeAngle(r,d)),n.Kt=u,n.text=p.text||"",n.ut(1/0,1/0,0,0);const y=n.measuredBounds,x=n.naturalBounds,k=x.width,b=x.height,P=Transform.l();P.vi(),P.Ds(-y.x,-y.y),P.et(n.scale,n.scale),P.cs(d,k/2,b/2),(r===22||r===26)&&P.cs(90,k/2,b/2),(r===23||r===27)&&P.cs(-90,k/2,b/2),r===28&&(f>45&&f<135||f>225&&f<315)&&P.cs(-f,k/2,b/2);const M=Rect.X(0,0,k,b),L=Point.l();L.setRectSpot(M,o),P.xt(L);const C=-L.x,S=-L.y,N=Point.l();N.a(l),isNaN(N.x)&&(N.x=k/2+3),isNaN(N.y)&&(N.y=-(b/2+3)),N.rotate(f),a+=N.x+C,c+=N.y+S;const T=new Rect(a,c,y.width,y.height),A=new Rect(y.x,y.y,y.width,y.height),D=new Rect(x.x,x.y,x.width,x.height);p.labelAngle=u,p.lineCount=n.lineCount,p.lines=n.getMetrics(),p.actualBounds=T,p.measuredBounds=A,p.naturalBounds=D,g===0?h.a(T):h.unionRect(T),Point.s(N),Point.s(L),Rect.s(M),Transform.s(P)}t.He!==null&&t.He.push(h),s.unionNoCheck(h.x,h.y,h.width,h.height)}determineGraduatedMarks(t,i){const e=i.geometry,s=i.strokeWidth,n=e.flattenedSegments,o=e.flattenedLengths,r=e.flattenedTotalLength,l=n.length;let h=0,a=0;const c=Util.nt();for(let x=0;x<l;x++){const k=n[x],b=[];h=0,a=0;const P=k.length;for(let M=0;M<P;M+=2){const L=k[M],C=k[M+1];if(M===0){h=L,a=C;continue}let S=Math.atan2(C-a,L-h)*180/Math.PI;S<0&&(S+=360),b.push(S),h=L,a=C}c.push(b)}const f=this.iv(t),u=t.L.r,d=u.length;let m=0,g=0,p=r;t.ws=[];let y;for(let x=0;x<d;x++){const k=u[x];if(y=[],!k.visible||k===i){t.ws.push(y);continue}const b=Math.abs(k.interval),P=t.graduatedTickUnit;if(P*b*r/t.graduatedRange<2&&k.graduatedSkip===null){t.ws.push(y);continue}let M=o[0][0],L=0,C=0;g=r*k.graduatedStart-1e-4,p=r*k.graduatedEnd+1e-4;const S=P*b;let N=t.graduatedTickBase;if(N<t.graduatedMin){let F=(t.graduatedMin-N)/S;F=F%1===0?F:Math.floor(F+1),N+=F*S}else if(N>t.graduatedMin+S){const F=Math.floor((N-t.graduatedMin)/S);N-=F*S}const T=f[x],A=N,D=t.graduatedMax*1e-6;for(let F=1;N<=t.graduatedMax+D;F++){if(this.ev(t,N-t.graduatedTickBase,T)&&(N>t.graduatedMax&&(N=t.graduatedMax),(k.graduatedSkip===null||k instanceof TextBlock&&!k.graduatedSkip(N,k)||k instanceof Shape&&!k.graduatedSkip(N,k))&&(m=(N-t.graduatedMin)*r/t.graduatedRange,m>r&&(m=r),g<=m&&m<=p))){let R=c[L][C],v=o[L][C];for(;L<o.length;){for(;m>M&&C<o[L].length-1;)C++,R=c[L][C],v=o[L][C],M+=v;if(m<=M)break;L++,C=0,R=c[L][C],v=o[L][C],M+=v}const O=n[L],B=O[C*2],X=O[C*2+1],E=O[C*2+2],V=O[C*2+3],U=(m-(M-v))/v,Y=new Point(B+(E-B)*U+s/2-e.bounds.x,X+(V-X)*U+s/2-e.bounds.y);if(Y.scale(i.scale,i.scale),R=this.sv(R,U,O,c[L],C),k instanceof TextBlock){let G="";k.graduatedFunction!==null?(G=k.graduatedFunction(N,k),G=G!=null?G.toString():""):G=(+N.toFixed(2)).toString(),G!==""&&y.push({pt:Y,angle:R,text:G})}else y.push({pt:Y,angle:R})}N=A+F*S}t.ws.push(y)}Util.tt(c)}sv(t,i,e,s,n){if(i<.5005&&i>.4995)return t;let o=t;if(i<.5?n>0?o=s[n-1]:Geo.K(e[0],e[e.length-2])&&Geo.K(e[1],e[e.length-1])&&(o=s[s.length-1]):i>.5&&(n+1<s.length?o=s[n+1]:Geo.K(e[0],e[e.length-2])&&Geo.K(e[1],e[e.length-1])&&(o=s[0])),t!==o){let r=Math.abs(t-o);if(r>180&&(t<o?t+=360:o+=360,r=Math.abs(t-o)),i<5e-4||i>.9995)return(t+o)/2%360;if(r<10){const l=1-Math.abs(.5-i);return(t*l+o*(1-l))%360}}return t}iv(t){if(t.ns===null){const i=[],e=t.L.r,s=e.length;for(let n=0;n<s;n++){const o=e[n],r=[];if(i.push(r),!o.visible)continue;const l=o.interval;if(!(l<0))for(let h=0;h<s;h++){if(h===n)continue;const a=e[h];if(!a.visible||o.constructor!==a.constructor)continue;const c=a.interval;c>l&&r.push(c)}}t.ns=i}return t.ns}ev(t,i,e){const s=e.length;for(let n=0;n<s;n++){const o=e[n]*t.graduatedTickUnit,r=i%o,l=t.graduatedTickUnit*1e-6;if(r<l&&r>-l)return!1}return!0}Ui(t,i,e){const s=e.Qh;e.Qh=!0;const n=t.naturalBounds,o=n.width,r=n.height,l=i instanceof SVGContext;i.save(),i.beginPath(),i.rect(-1,-1,o+1,r+1),i.clip(),i.endPath();const h=t.findMainElement();h.Ui(i,e);let a=t.getDocumentScale()*e.scale;a<=0&&(a=1);const c=h.actualBounds,f=t.L.r,u=t.ws,d=f.length;for(let m=0;m<d;m++){const g=f[m],p=u[m],y=p.length;if(!(!g.visible||g===h||p.length===0)){if(g instanceof Shape){if(t.graduatedTickUnit*g.interval*h.geometry.flattenedTotalLength/t.graduatedRange*a<2&&g.graduatedSkip===null)continue;const x=g.measuredBounds,k=g.strokeWidth*g.scale;let b=g.alignmentFocus;b.isNoSpot()&&(b=Spot.TopCenter);for(let P=0;P<y;P++){const M=p[P].pt,L=p[P].angle;this.nv(g,M,c,L,x,k,b),g.Ui(i,e),l&&(t.svg.appendChild(g.svg),g.svg=null),g.Jr.vi()}}else if(g instanceof TextBlock){t.Me===null&&(t.Me=new TextBlock);const x=t.Me;this.xA(g,x),x.A2=!0;for(let k=0;k<y;k++){const b=p[k];if(b.actualBounds&&b.measuredBounds&&b.naturalBounds){x.ov(b);const P=b.actualBounds;x.Xt(P.x,P.y,P.width,P.height),this.rv(x,c,P,b.measuredBounds,b.naturalBounds),x.Zr=g.part,x.Vs=g.panel,x.Ui(i,e),x.Vs=null,x.Zr=null,l&&(t.svg.appendChild(x.svg),x.svg=null)}}}}}e.Qh=s,i.restore(),i.clearContextCache(!0)}nv(t,i,e,s,n,o,r){const l=t.Jr;l.vi(),l.Ds(i.x+e.x,i.y+e.y),l.cs(s+t.angle,0,0),l.Ds(-n.width*r.x+r.offsetX+o/2,-n.height*r.y+r.offsetY+o/2),l.et(t.scale,t.scale),t.nd(!1),t.oh.set(t.Jr),t.ca=t.scale,t.wa(!1)}rv(t,i,e,s,n){const o=t.Jr;o.vi(),o.Ds(e.x+i.x,e.y+i.y),o.Ds(-s.x,-s.y),t.y0(o,n.x,n.y,n.width,n.height),t.nd(!1),t.oh.set(t.Jr),t.ca=t.scale,t.wa(!1)}xA(t,i){i.lv(t)}}PanelLayout.definePanelLayout("Graduated",new PanelLayoutGraduated);var ViewboxStretch=(w=>(w[w.Uniform=6]="Uniform",w[w.UniformToFill=7]="UniformToFill",w))(ViewboxStretch||{});class Panel extends GraphObject{$;L;Zt;cd;Kn;il;so;Ko;T2;O;fd;lt;xi;_t;ud;mh;Ys;constructor(t,i){if(super(),this.$=null,t===void 0)this.$=Panel.Position;else if(typeof t=="string"){const e=PanelLayout.Layouts.get(t);e!==null&&(this.$=e)}else t instanceof PanelLayout?this.$=t:t&&(this.$=Panel.Position,i=t);this.$===null&&Util.o("Panel type not specified or PanelLayout not loaded: "+t),this.n|=4194304|(this.$===Panel.Grid?1048576:0),this.L=new List,this.Zt=Margin.Ug,this.cd=Spot.Default,this.Kn=1,this.il=null,this.so="",this.Ko=new Rect(NaN,NaN,NaN,NaN),this.T2=null,this.O=null,this.fd=6,this.xi=null,this.lt=null,this._t=null,this.ud=NaN,this.mh=null,this.Ys=null,i&&Object.assign(this,i)}cloneProtected(t){super.cloneProtected(t),t.$=this.$,t.Zt=this.Zt.N(),t.cd=this.cd.N(),t.Kn=this.Kn,t.so=this.so,t.Ko.a(this.Ko),this.O!==null&&(t.O=this.O.copy(t)),t.fd=this.fd,this.lt!==null&&(t.lt=this.lt.copy()),this.xi!==null&&(t.xi=this.xi.copy()),t._t=this._t,t.ud=this.ud,t.mh=this.mh}Uo(t){super.Uo(t),t.L=this.L;const i=t.L.r,e=i.length;for(let s=0;s<e;s++){const n=i[s];n.Vs=t}t.il=null}copy(){const t=super.copy();if(t!==null){const i=this.L.r,e=i.length;for(let s=0;s<e;s++){const o=i[s].copy();t.hv(o)}return t}else return null}toString(){return"Panel("+this.type.name+")#"+GSet.as(this)}get type(){return this.$}set type(t){const i=this.$;i!==t&&(this.$=t,this.cf=this.$===Panel.Grid,this.c(),this.t("type",i,t))}get elements(){return this.L.iterator}get naturalBounds(){return this.Xi}get padding(){return this.Zt}set padding(t){typeof t=="number"?(t<0&&Util._(t,">= 0",Panel,"padding"),t=new Margin(t)):(t.left<0&&Util._(t.left,">= 0",Panel,"padding:value.left"),t.right<0&&Util._(t.right,">= 0",Panel,"padding:value.right"),t.top<0&&Util._(t.top,">= 0",Panel,"padding:value.top"),t.bottom<0&&Util._(t.bottom,">= 0",Panel,"padding:value.bottom"));const i=this.Zt;i.equals(t)||(t=t.N(),this.Zt=t,this.c(),this.t("padding",i,t))}get defaultAlignment(){return this.cd}set defaultAlignment(t){const i=this.cd;i.equals(t)||(t=t.N(),this.cd=t,this.c(),this.t("defaultAlignment",i,t))}get defaultStretch(){return this.Kn}set defaultStretch(t){const i=this.Kn;i!==t&&(this.Kn=t,this.c(),this.t("defaultStretch",i,t))}get defaultSeparatorPadding(){return this.O!==null?this.O.Q0:Margin.Ug}set defaultSeparatorPadding(t){typeof t=="number"&&(t=new Margin(t));const i=this.defaultSeparatorPadding;i.equals(t)||(t=t.N(),this.O===null&&(this.O=new TablePanelSettings),this.O.Q0=t,this.c(),this.t("defaultSeparatorPadding",i,t))}get defaultRowSeparatorStroke(){return this.O!==null?this.O._0:null}set defaultRowSeparatorStroke(t){const i=this.defaultRowSeparatorStroke;i!==t&&(t===null||typeof t=="string"||t instanceof Brush)&&(t instanceof Brush&&t.g(),this.O===null&&(this.O=new TablePanelSettings),this.O._0=t,this.C(),this.t("defaultRowSeparatorStroke",i,t))}get defaultRowSeparatorStrokeWidth(){return this.O!==null?this.O.tp:1}set defaultRowSeparatorStrokeWidth(t){const i=this.defaultRowSeparatorStrokeWidth;i!==t&&isFinite(t)&&t>=0&&(this.O===null&&(this.O=new TablePanelSettings),this.O.tp=t,this.c(),this.t("defaultRowSeparatorStrokeWidth",i,t))}get defaultRowSeparatorDashArray(){return this.O!==null?this.O.ip:null}set defaultRowSeparatorDashArray(t){const i=this.defaultRowSeparatorDashArray;if(i!==t){if(t!==null&&!Array.isArray(t)&&Util.we(t,"Array",Panel,"defaultRowSeparatorDashArray:value"),t!==null){const e=t.length;let s=0;for(let n=0;n<e;n++){const o=t[n];(typeof o!="number"||!(o>=0)||!isFinite(o))&&Util.o("defaultRowSeparatorDashArray value "+o+" at index "+n+" must be a positive number or zero."),s+=o}if(s===0){if(i===null)return;t=null}}this.O===null&&(this.O=new TablePanelSettings),this.O.ip=t,this.C(),this.t("defaultRowSeparatorDashArray",i,t)}}get defaultColumnSeparatorStroke(){return this.O!==null?this.O.ep:null}set defaultColumnSeparatorStroke(t){const i=this.defaultColumnSeparatorStroke;i!==t&&(t===null||typeof t=="string"||t instanceof Brush)&&(t instanceof Brush&&t.g(),this.O===null&&(this.O=new TablePanelSettings),this.O.ep=t,this.C(),this.t("defaultColumnSeparatorStroke",i,t))}get defaultColumnSeparatorStrokeWidth(){return this.O!==null?this.O.sp:1}set defaultColumnSeparatorStrokeWidth(t){const i=this.defaultColumnSeparatorStrokeWidth;i!==t&&isFinite(t)&&t>=0&&(this.O===null&&(this.O=new TablePanelSettings),this.O.sp=t,this.c(),this.t("defaultColumnSeparatorStrokeWidth",i,t))}get defaultColumnSeparatorDashArray(){return this.O!==null?this.O.np:null}set defaultColumnSeparatorDashArray(t){const i=this.defaultColumnSeparatorDashArray;if(i!==t){if(t!==null&&!Array.isArray(t)&&Util.we(t,"Array",Panel,"defaultColumnSeparatorDashArray:value"),t!==null){const e=t.length;let s=0;for(let n=0;n<e;n++){const o=t[n];(typeof o!="number"||!(o>=0)||!isFinite(o))&&Util.o("defaultColumnSeparatorDashArray value "+o+" at index "+n+" must be a positive number or zero."),s+=o}if(s===0){if(i===null)return;t=null}}this.O===null&&(this.O=new TablePanelSettings),this.O.np=t,this.C(),this.t("defaultColumnSeparatorDashArray",i,t)}}get gh(){return this.O!==null?this.O.gh:null}set gh(t){this.O===null&&(this.O=new TablePanelSettings),this.O.gh=t}get viewboxStretch(){return this.fd}set viewboxStretch(t){const i=this.fd;i!==t&&(this.fd=t,this.c(),this.t("viewboxStretch",i,t))}get gridCellSize(){return this.xi!==null?this.xi.dd:Size.iC}set gridCellSize(t){this.xi===null&&(this.xi=new GridPanelSettings);const i=this.xi.dd;if(!i.equals(t)){(!t.isReal()||t.width===0||t.height===0)&&Util.o("Invalid Panel.gridCellSize: "+t),this.xi.dd=t.N();const e=this.diagram;e!==null&&this===e.grid&&e._l(),this.C(),this.t("gridCellSize",i,t)}}get gridOrigin(){return this.xi!==null?this.xi.gd:Point.Po}set gridOrigin(t){this.xi===null&&(this.xi=new GridPanelSettings);const i=this.xi.gd;if(!i.equals(t)){t.isReal()||Util.o("Invalid Panel.gridOrigin: "+t),this.xi.gd=t.N();const e=this.diagram;e!==null&&this===e.grid&&e._l(),this.C(),this.t("gridOrigin",i,t)}}get graduatedMin(){return this.lt!==null?this.lt.op:0}set graduatedMin(t){const i=this.graduatedMin;if(i!==t&&(this.lt===null&&(this.lt=new GradPanelSettings),this.lt.op=t,this.c(),this.t("graduatedMin",i,t),this.$c())){const e=this.part;e!==null&&this.ya(e,"graduatedRange")}}get graduatedMax(){return this.lt!==null?this.lt.rp:100}set graduatedMax(t){const i=this.graduatedMax;if(i!==t&&(this.lt===null&&(this.lt=new GradPanelSettings),this.lt.rp=t,this.c(),this.t("graduatedMax",i,t),this.$c())){const e=this.part;e!==null&&this.ya(e,"graduatedRange")}}get graduatedRange(){return this.graduatedMax-this.graduatedMin}get graduatedTickUnit(){return this.lt!==null?this.lt.lp:10}set graduatedTickUnit(t){const i=this.graduatedTickUnit;i!==t&&t>0&&(this.lt===null&&(this.lt=new GradPanelSettings),this.lt.lp=t,this.c(),this.t("graduatedTickUnit",i,t))}get graduatedTickBase(){return this.lt!==null?this.lt.hp:0}set graduatedTickBase(t){const i=this.graduatedTickBase;i!==t&&(this.lt===null&&(this.lt=new GradPanelSettings),this.lt.hp=t,this.c(),this.t("graduatedTickBase",i,t))}get ws(){return this.lt!==null?this.lt.ws:null}set ws(t){this.lt!==null?this.lt.ws=t:t!==null&&(this.lt=new GradPanelSettings,this.lt.ws=t)}get He(){return this.lt!==null?this.lt.He:null}set He(t){this.lt!==null?this.lt.He=t:t!==null&&(this.lt=new GradPanelSettings,this.lt.He=t)}get ns(){return this.lt!==null?this.lt.ns:null}set ns(t){this.lt!==null?this.lt.ns=t:t!==null&&(this.lt=new GradPanelSettings,this.lt.ns=t)}get Me(){return this.lt!==null?this.lt.Me:null}set Me(t){this.lt!==null?this.lt.Me=t:t!==null&&(this.lt=new GradPanelSettings,this.lt.Me=t)}k0(t){super.k0(t);const i=this.L.r,e=i.length;for(let s=0;s<e;s++)i[s].k0(t)}fh(t,i){if(this.$===Panel.Grid){t.commitTransform(),this.$.Ui(this,t,i);return}if(this.$===Panel.Graduated){t.commitTransform(),this.$.Ui(this,t,i);return}if(this.$===Panel.Table)if(t.commitTransform(),t instanceof SVGContext){const r=t.currentElement;t.currentElement=t.newGroup2("gojs-ts"),this.D2(t,i),t.endGroup(),t.currentElement=r}else this.D2(t,i);const e=this.isClipping&&this.$===Panel.Spot;e&&t.save();const s=this.findMainElement(),n=this.L.r,o=n.length;for(let r=0;r<o;r++){const l=n[r];e&&l===s&&(t.clipInsteadOfFill=!0),l.Ui(t,i),e&&l===s&&(t.clipInsteadOfFill=!1)}e&&(t.restore(),t.clearContextCache(!0))}D2(t,i){t.lineCap="butt";const e=this.rowCount>0?this.Ge:null,s=this.columnCount>0?this.je:null;e!==null&&this.Hb(t,i,!0,e,!0),s!==null&&this.Hb(t,i,!1,s,!0),e!==null&&this.bA(t,!0,e),s!==null&&this.bA(t,!1,s),e!==null&&this.Hb(t,i,!0,e,!1),s!==null&&this.Hb(t,i,!1,s,!1)}bA(t,i,e){const s=e.length,n=this.actualBounds,o=this.naturalBounds;let r=!0;for(let l=0;l<s;l++){const h=e[l];if(h===void 0||h.actual===0)continue;if(r){r=!1;continue}if(i){if(h.position>o.height)continue}else if(h.position>o.width)continue;let a=h.separatorStrokeWidth;isNaN(a)&&(a=i?this.defaultRowSeparatorStrokeWidth:this.defaultColumnSeparatorStrokeWidth);let c=h.separatorStroke;if(c===null&&(c=i?this.defaultRowSeparatorStroke:this.defaultColumnSeparatorStroke),a===0||c===null)continue;this.dn(t,c,!1,!1,o,n);let f=!1,u=h.separatorDashArray;u===null&&(u=i?this.defaultRowSeparatorDashArray:this.defaultColumnSeparatorDashArray),u!==null&&(f=!0,t.enableDash(u,0)),t.beginPath();const d=h.position+a;i?d>o.height&&(a-=d-o.height):d>o.width&&(a-=d-o.width);let m=h.position+a/2;t.lineWidth=a;const g=this.Zt;if(i){m+=g.top;const p=g.left,y=o.width-g.right;t.moveTo(p,m),t.lineTo(y,m)}else{m+=g.left;const p=g.top,y=o.height-g.bottom;t.moveTo(m,p),t.lineTo(m,y)}t.stroke(),t.endPath(),f&&t.disableDash()}}Hb(t,i,e,s,n){const o=s.length,r=this.actualBounds,l=this.naturalBounds,h=this.kA(!0),a=this.kA(!1);for(let c=0;c<o;c++){const f=s[c];if(f===void 0||f.background===null||f.coversSeparators===n||f.actual===0)continue;const u=e?r.height:r.width;if(f.position>u)continue;let d=f.computeEffectiveSpacing(),m=f.separatorStrokeWidth;isNaN(m)&&(m=e?this.defaultRowSeparatorStrokeWidth:this.defaultColumnSeparatorStrokeWidth);let g=f.separatorStroke;g===null&&(g=e?this.defaultRowSeparatorStroke:this.defaultColumnSeparatorStroke),(g===null||f.index===(e?h:a))&&(m=0),d-=m;const p=f.position+m;let y=d+f.actual;if(p+y>u&&(y=u-p),y<=0)continue;const x=this.Zt;this.dn(t,f.background,!0,!1,l,r),e?t.fillRect(x.left,p+x.top,r.width-(x.left+x.right),y):t.fillRect(p+x.left,x.top,y,r.height-(x.top+x.bottom))}}kA(t){const i=t?this.rowCount:this.columnCount;for(let e=0;e<i;e++){const s=t?this.Ge[e]:this.je[e];if(s!==void 0)return s.index}return 0}sd(){const t=this.L.r,i=t.length;for(let e=0;e<i;e++)t[e].sd();this.Ke(!0)}_c(t,i,e){const s=this.svg;if(s===null)return!1;if(this.type===Panel.Table){const r=s.getElementsByClassName("gojs-ts"),l=r.length!==0?r[0]:null;l!==null&&(l.innerHTML=""),t.currentElement=l,this.D2(t,i),t.currentElement=null}else{if(this.$===Panel.Grid)return s.innerHTML="",s.remove(),!1;if(this.$===Panel.Graduated)return s.innerHTML="",s.remove(),!1;if(this.$===Panel.Spot&&this.isClipping)return s.innerHTML="",s.remove(),this.rh=null,this.sd(),!1}if(!super._c(t,i,e))return!1;const n=this.L.r,o=n.length;for(let r=0;r<o;r++)n[r].Ui(t,i);return!0}ed(t){return!0}M0(t,i,e,s){if(!this.isClipping){if(this.Xs()&&t.partClipRect!==null){const n=t.partClipRect,o=this.L.r;let r=0,l=0;for(let h=0;h<o.length;h++){if(!o[h].isVisibleObject())continue;const a=o[h].actualBounds;r=h===0?a.x:Math.min(a.x,r),l=h===0?a.y:Math.min(a.y,l)}s.setAttributeNS(null,"clip-path",`path('M ${n.x-e.x-r},${n.y-e.y-l} l ${n.width} 0 l 0 ${n.height} l -${n.width} 0 z')`);return}super.M0(t,i,e,s)}}Zc(t,i,e,s,n){const o=this.pn(),r=this.D,l=1/(r.m11*r.m22-r.m12*r.m21);let h=r.m22*l,a=-r.m12*l,c=-r.m21*l,f=r.m11*l,u=l*(r.m21*r.dy-r.m22*r.dx),d=l*(r.m12*r.dx-r.m11*r.dy);if(this.background!==null){const m=t*h+i*c+u,g=t*a+i*f+d,p=e*h+s*c+u,y=e*a+s*f+d;n.e(0,0);const x=this.naturalBounds,k=Geo.ml(0,0,x.width,x.height,m,g,p,y,n);return n.D(r),k}else{o||(h=1,a=0,c=0,f=1,u=0,d=0);const m=t*h+i*c+u,g=t*a+i*f+d,p=e*h+s*c+u,y=e*a+s*f+d;n.e(p,y);let x=(p-m)*(p-m)+(y-g)*(y-g),k=!1;const b=this.L.r,P=b.length,M=Point.l();let L=null,C=1/0,S=null;const N=this.isClipping&&this.$===Panel.Spot;N&&(S=Point.l(),L=this.findMainElement(),k=L.Zc(m,g,p,y,S),k&&(C=(m-S.x)*(m-S.x)+(g-S.y)*(g-S.y)));for(let T=0;T<P;T++){const A=b[T];if(!A.visible||A===L||!A.Zc(m,g,p,y,M))continue;k=!0;const D=(m-M.x)*(m-M.x)+(g-M.y)*(g-M.y);D<x&&(x=D,n.set(M))}return N&&(C>x&&n.set(S),Point.s(S)),Point.s(M),o&&n.D(r),k}}Du(){const t=this.L.r,i=t.length;for(let e=0;e<i;e++)t[e].Du();super.Du()}c(t){if(this.vo())return;super.c(t);let i=null;(this.$===Panel.Auto||this.$===Panel.Link)&&(i=this.findMainElement());const e=this.L.r,s=e.length;for(let n=0;n<s;n++){const o=e[n];if((o===i||o.isPanelMain)&&o.c(!0),o.desiredSize.isReal())continue;const r=o.zs(!1);!(o instanceof Placeholder)&&!(o instanceof Panel)&&!(o instanceof TextBlock)&&r===0||o.c(!0)}}ef(){if(this.vo())return;this.ue(!0),this._n(!0);const t=this.L.r,i=t.length;for(let e=0;e<i;e++)t[e].ef()}Qc(){if(this.Bb()===!1){this.nd(!0),this.wa(!0);const t=this.L.r,i=t.length;for(let e=0;e<i;e++)t[e].a2()}}a2(){this.wa(!0);const t=this.L.r,i=t.length;for(let e=0;e<i;e++)t[e].a2()}_u(t,i,e,s){const n=this.Ko;n.e(0,0,0,0);const o=this.desiredSize,r=this.minSize;e===void 0&&(e=r.width,s=r.height),e=Math.max(e,r.width),s=Math.max(s,r.height);const l=this.maxSize;isNaN(o.width)||(t=Math.min(o.width,l.width)),isNaN(o.height)||(i=Math.min(o.height,l.height)),t=Math.max(e,t),i=Math.max(s,i);const h=this.Zt;t=Math.max(t-h.left-h.right,0),i=Math.max(i-h.top-h.bottom,0);const a=this.L.r;this.$.measure(this,t,i,a,n,e,s);let c=n.width+h.left+h.right,f=n.height+h.top+h.bottom;isFinite(o.width)&&(c=o.width),isFinite(o.height)&&(f=o.height),c=Math.min(l.width,c),f=Math.min(l.height,f),c=Math.max(r.width,c),f=Math.max(r.height,f),c=Math.max(e,c),f=Math.max(s,f),n.En(c,f),this.naturalBounds.En(c,f),this.Qn(0,0,c,f)}findMainElement(){if(this.il===null){const t=this.L.r,i=t.length;if(i===0)return null;for(let e=0;e<i;e++){const s=t[e];if(s.isPanelMain===!0)return this.il=s,s}this.il=t[0]}return this.il}Xo(){return this.part!==null?this.part.locationObject:null}get panelLayoutState(){return this.T2}set panelLayoutState(t){this.T2=t}ah(t,i,e,s){const n=this.L.r;if(this.actualBounds.e(t,i,e,s),!this.desiredSize.isReal()){let o=this.zs(!0);const r=this.measuredBounds,l=r.width,h=r.height,a=this.$r,c=a.left+a.right,f=a.top+a.bottom;switch(l===e&&h===s&&(o=0),o){case 0:(l>e||h>s)&&(this.c(),this.ut(l>e?e:l,h>s?s:h,0,0));break;case 2:this.c(!0),this.ut(e+c,s+f,0,0);break;case 5:this.c(!0),this.ut(e+c,h+f,0,0);break;case 4:this.c(!0),this.ut(l+c,s+f,0,0);break}}this.$.arrange(this,n,this.Ko)}hh(t){const i=this.naturalBounds,e=this.Xo();if(Rect.contains(0,0,i.width,i.height,t.x,t.y)){const s=this.L.r,n=s.length,o=Point.X(0,0);for(let r=n;r--;){const l=s[r];if(!(!l.visible&&l!==e)&&(o.set(t).Ie(l.D),l.containsPoint(o)))return Point.s(o),!0}return Point.s(o),this.Ct!==null}return!1}p0(t){if(this.$n===t)return this;const i=this.L.r,e=i.length;for(let s=0;s<e;s++){const o=i[s].p0(t);if(o!==null)return o}return null}walkVisualTreeFrom(t,i){if(i(this,t),t instanceof Panel){const e=t.L.r,s=e.length;for(let n=0;n<s;n++)this.walkVisualTreeFrom(e[n],i)}}Hr(t){this.PA(this,t)}PA(t,i){i(t);const e=t.L.r,s=e.length;for(let n=0;n<s;n++){const o=e[n];o instanceof Panel&&this.PA(o,i)}}av(t){this.MA(this,t)}MA(t,i){if(i(t),t instanceof Panel){const e=t.L.r,s=e.length;for(let n=0;n<s;n++)this.MA(e[n],i)}}findInVisualTree(t){return this.SA(this,t)}SA(t,i){if(i(t))return t;if(t instanceof Panel){const e=t.L.r,s=e.length;for(let n=0;n<s;n++){const o=this.SA(e[n],i);if(o!==null)return o}}return null}findObject(t){if(this.name===t)return this;const i=this.L.r;let e=i.length;this.cv()&&(e=this.ap());for(let s=0;s<e;s++){const n=i[s];if(n instanceof Panel){const o=n.findObject(t);if(o!==null)return o}if(n.name===t)return n}return null}NA(){const t=this.L.r,i=t.length;let e=0;for(let s=0;s<i;s++){const n=t[s];n instanceof Panel?e=Math.max(e,n.NA()):n instanceof Shape&&(e=Math.max(e,n.fv()))}return e}pn(){return!(this.type===Panel.TableRow||this.type===Panel.TableColumn)}Qr(){return this.type===Panel.TableRow||this.type===Panel.TableColumn}sL(t,i,e){if(this.pickable===!1||(i===void 0&&(i=null),e===void 0&&(e=null),this.es()))return null;const s=this.naturalBounds,n=1/this.getDocumentScale(),o=this.pn(),r=o?t:Point.X(t.x,t.y).Ie(this.D),l=this.diagram;let h=10,a=5;if(l!==null&&(h=l.getInputOption("extraTouchArea"),a=h/2),Rect.contains(-(a*n),-(a*n),s.width+h*n,s.height+h*n,r.x,r.y)){if(!this.cf){const f=this.L.r,u=f.length,d=Point.l(),m=this.isClipping&&this.$===Panel.Spot,g=m?this.findMainElement():null;if(m&&(g.pn()?d.set(t).Ie(g.D):d.set(t),!g.containsPoint(d)))return Point.s(d),o||Point.s(r),null;const p=this.Xo();for(let y=u;y--;){const x=f[y];if(!x.visible&&x!==p||(x.pn()?d.set(t).Ie(x.D):d.set(t),m&&x===g))continue;let k=null;if(x instanceof Panel?k=x.sL(d,i,e):x.pickable===!0&&x.containsPoint(d)&&(k=x),k!==null&&(i!==null&&(k=i(k)),k!==null&&(e===null||e(k))))return Point.s(d),o||Point.s(r),k}Point.s(d)}if(this.background===null)return o||Point.s(r),null;const c=Rect.contains(0,0,s.width,s.height,r.x,r.y)?this:null;return o||Point.s(r),c}return o||Point.s(r),null}nL(t,i,e,s){if(this.pickable===!1)return!1;i===void 0&&(i=null),e===void 0&&(e=null);const n=this.naturalBounds,o=this.pn(),r=o?t:Point.X(t.x,t.y).Ie(this.D),l=this.Qr(),h=Rect.contains(0,0,n.width,n.height,r.x,r.y);if(l||h){if(!this.cf){const a=this.L.r,c=a.length,f=Point.l(),u=this.Xo();for(let d=c;d--;){const m=a[d];if(!m.visible&&m!==u)continue;m.pn()?f.set(t).Ie(m.D):f.set(t);let g=m;const p=m instanceof Panel?m:null;if(p!==null?p.nL(f,i,e,s):g.containsPoint(f)){if(g.pickable===!1)continue;i!==null&&(g=i(g)),g!==null&&(e===null||e(g))&&s.add(g)}}Point.s(f)}return o||Point.s(r),h&&this.background!==null}return o||Point.s(r),!1}Im(t,i,e,s,n,o){if(this.pickable===!1)return!1;i===void 0&&(i=null),e===void 0&&(e=null);let r=o;if(o===void 0&&(r=Transform.l(),r.vi()),r.ic(this.D),this.containedInRect(t,r))return this.F2(i,e,n),o===void 0&&Transform.s(r),!0;if(this.intersectsRect(t,r)){if(!this.cf){const l=this.Xo(),h=this.L.r,a=h.length;for(let c=a;c--;){const f=h[c];if(!f.visible&&f!==l)continue;const u=f.actualBounds,d=this.naturalBounds;if(u.x>d.width||u.y>d.height||u.x+u.width<0||u.y+u.height<0)continue;let m=f;const g=f instanceof Panel?f:null,p=Transform.l();p.set(r),(g!==null?g.Im(t,i,e,s,n,p):m.iA(t,s,p))&&(i!==null&&(m=i(m)),m!==null&&(e===null||e(m))&&n.add(m)),Transform.s(p)}}return o===void 0&&Transform.s(r),s}return o===void 0&&Transform.s(r),!1}F2(t,i,e){const s=this.L.r,n=s.length;for(let o=n;o--;){const r=s[o];if(!r.visible)continue;const l=r.actualBounds,h=this.naturalBounds;if(l.x>h.width||l.y>h.height||l.x+l.width<0||l.y+l.height<0)continue;r instanceof Panel&&r.F2(t,i,e);let a=r;t!==null&&(a=t(a)),a!==null&&(i===null||i(a))&&e.add(a)}}oL(t,i,e,s,n,o){if(this.pickable===!1)return!1;e===void 0&&(e=null),s===void 0&&(s=null);const r=this.naturalBounds,l=this.pn(),h=l?t:Point.X(t.x,t.y).Ie(this.D),a=l?i:Point.X(i.x,i.y).Ie(this.D),c=h.distanceSquaredPoint(a),f=h.x>0&&h.x<r.width&&h.y>0&&h.y<r.height||Point.distanceLineSegmentSquared(h.x,h.y,0,0,0,r.height)<=c||Point.distanceLineSegmentSquared(h.x,h.y,0,r.height,r.width,r.height)<=c||Point.distanceLineSegmentSquared(h.x,h.y,r.width,r.height,r.width,0)<=c||Point.distanceLineSegmentSquared(h.x,h.y,r.width,0,0,0)<=c,u=h.distanceSquared(0,0)<=c&&h.distanceSquared(0,r.height)<=c&&h.distanceSquared(r.width,0)<=c&&h.distanceSquared(r.width,r.height)<=c;if(l||(Point.s(h),Point.s(a)),f){if(!this.cf){const d=Point.l(),m=Point.l(),g=this.Xo(),p=this.L.r,y=p.length;for(let x=y;x--;){const k=p[x];if(!k.visible&&k!==g)continue;const b=k.actualBounds,P=this.naturalBounds;if(l&&(b.x>P.width||b.y>P.height||b.x+b.width<0||b.y+b.height<0))continue;if(k.pn()){const C=k.D;d.set(t).Ie(C),m.set(i).Ie(C)}else d.set(t),m.set(i);let M=k;const L=k instanceof Panel?k:null;(L!==null?L.oL(d,m,e,s,n,o):M.eA(d,m,n))&&(e!==null&&(M=e(M)),M!==null&&(s===null||s(M))&&o.add(M))}Point.s(d),Point.s(m)}return n?f:u}return!1}N2(t){let i=null;if(t instanceof Shape){i=t.spot1,i===Spot.Default&&(i=null);const e=t.geometry;e!==null&&i===null&&(i=e.spot1)}return i===null&&(i=Spot.TopLeft),i}C2(t){let i=null;if(t instanceof Shape){i=t.spot2,i===Spot.Default&&(i=null);const e=t.geometry;e!==null&&i===null&&(i=e.spot2)}return i===null&&(i=Spot.BottomRight),i}add(...t){for(let i=0;i<t.length;i++)this.insertAt(this.L.count,t[i]);return this}elt(t){return this.L.elt(t)}insertAt(t,i){i instanceof Part&&Util.o("Cannot add a Part to a Panel: "+i+"; use a Panel instead"),(this===i||this.isContainedBy(i))&&(this===i&&Util.o("Cannot make a Panel contain itself: "+this.toString()),Util.o("Cannot make a Panel indirectly contain itself: "+this.toString()+" already contains "+i.toString()));const e=i.panel;if(e!==null&&e!==this&&Util.o("Cannot add a GraphObject that already belongs to another Panel to this Panel: "+i.toString()+", already contained by "+e.toString()+", cannot be shared by this Panel: "+this.toString()),this.$===Panel.Grid&&!(i instanceof Shape)&&Util.o("Can only add Shapes to a Grid Panel, not: "+i),this.$===Panel.Graduated&&!(i instanceof Shape||i instanceof TextBlock)&&Util.o("Can only add Shapes or TextBlocks to a Graduated Panel, not: "+i),i.xa(this),i.Zr=null,this.itemArray!==null){const r=i.data;r!==null&&typeof r=="object"&&(this.Ys===null&&(this.Ys=new GMap),this.Ys.set(r,i))}const s=this.L;let n=-1;if(e===this){let r=-1;const l=this.L.r,h=l.length;for(let a=0;a<h;a++)if(l[a]===i){r=a;break}if(r!==-1){if(r===t||r+1>=s.count&&t>=s.count)return;s.removeAt(r),n=r}else Util.o("element "+i.toString()+" has panel "+e.toString()+" but is not contained by it.")}(t<0||t>s.count)&&(t=s.count),s.insertAt(t,i),(t===0||i.isPanelMain)&&(this.il=null),this.vo()||this.c(),i.c(!1),i.portId!==null?this.wn=!0:i instanceof Panel&&i.wn===!0&&(this.wn=!0),this.ns=null,this.isEnabledObject()||this.qb(i,!1);const o=this.part;if(o!==null){o.D0(),o.ff(),this.wn&&o instanceof Node&&(o.wn=!0),o.wn&&o instanceof Node&&(o.ne=null);const r=this.diagram;if(r!==null&&r.undoManager.isUndoingRedoing)return;n!==-1&&o.raiseChangedEvent(4,"elements",this,i,null,n,null),o.raiseChangedEvent(3,"elements",this,null,i,null,t)}}get wn(){return(this.n&8388608)!==0}set wn(t){(this.n&8388608)!==0!==t&&(this.n=this.n^8388608)}s2(){return(this.n&16777216)!==0}R2(t){t?this.n|=16777216:this.n&=-16777217}hv(t){t.xa(this),t.Zr=null;const i=this.L,e=i.count;i.insertAt(e,t);const s=this.part;if(s!==null){s.D0(),t.portId!==null&&s instanceof Node&&(s.wn=!0);const n=this.diagram;if(n!==null&&n.undoManager.isUndoingRedoing)return;s.raiseChangedEvent(3,"elements",this,null,t,null,e)}}DR(t){const i=this.L.r,e=i.length;let s=-1;for(let n=0;n<e;n++)if(i[n]===t){s=n;break}return s}remove(t){const i=this.L.r,e=i.length;let s=-1;for(let n=0;n<e;n++)if(i[n]===t){s=n;break}s!==-1&&this.te(s,!0)}removeAt(t){t>=0&&this.te(t,!0)}te(t,i){const e=this.L,s=e.elt(t);if(s.Zr=null,s.xa(null),this.Ys!==null){const o=s.data;typeof o=="object"&&this.Ys.delete(o)}e.removeAt(t),this.ue(!1),this.c(),this.il===s&&(this.il=null),this.ns=null;const n=this.part;if(n!==null){n.D0(),n.ff(),n.invalidateAdornments(),n instanceof Node&&(s instanceof Panel?s.walkVisualTreeFrom(s,(r,l)=>n.d2(l,i)):n.d2(s,i));const o=this.diagram;if(o!==null&&o.undoManager.isUndoingRedoing)return;n.raiseChangedEvent(4,"elements",this,s,null,t,null)}}get Ge(){return this.O===null&&(this.O=new TablePanelSettings),this.O.Ge}get rowCount(){return this.O===null?0:this.Ge.length}getRowDefinition(t){t<0&&Util._(t,">= 0",Panel,"getRowDefinition:idx"),t=Math.round(t);const i=this.Ge;if(i[t]===void 0){const e=new RowColumnDefinition;e.xa(this),e.isRow=!0,e.index=t,i[t]=e,this.raiseChangedEvent(3,"rowdefs",this,null,e,null,t)}return i[t]}removeRowDefinition(t){if(t<0&&Util._(t,">= 0",Panel,"removeRowDefinition:idx"),this.rowCount===0)return;t=Math.round(t);const i=this.Ge,e=i[t];if(e){i[t]=void 0;let s=i.length-1;for(;s>=0&&i[s--]===void 0;)i.length--;this.raiseChangedEvent(4,"rowdefs",this,e,null,t,null),this.c()}}vL(t,i){const e=this.Ge;if(!(t<0)){if(e[t]=i instanceof RowColumnDefinition?i:void 0,!i){let s=e.length-1;for(;s>=0&&e[s--]===void 0;)e.length--}this.c()}}get je(){return this.O===null&&(this.O=new TablePanelSettings),this.O.je}get columnCount(){return this.O===null?0:this.je.length}getColumnDefinition(t){t<0&&Util._(t,">= 0",Panel,"getColumnDefinition:idx"),t=Math.round(t);const i=this.je;if(i[t]===void 0){const e=new RowColumnDefinition;e.xa(this),e.isRow=!1,e.index=t,i[t]=e,this.raiseChangedEvent(3,"coldefs",this,null,e,null,t)}return i[t]}removeColumnDefinition(t){if(t<0&&Util._(t,">= 0",Panel,"removeColumnDefinition:idx"),this.columnCount===0)return;t=Math.round(t);const i=this.je,e=i[t];if(e){i[t]=void 0;let s=i.length-1;for(;s>=0&&i[s--]===void 0;)i.length--;this.raiseChangedEvent(4,"coldefs",this,e,null,t,null),this.c()}}OL(t,i){const e=this.je;if(!(t<0)){if(e[t]=i instanceof RowColumnDefinition?i:void 0,!i){let s=e.length-1;for(;s>=0&&e[s--]===void 0;)e.length--}this.c()}}addRowColumnDefinition(t){let i=null;return t.isRow?i=this.getRowDefinition(t.index):t.isRow||(i=this.getColumnDefinition(t.index)),i&&i.Ub(t),this}addRowDefinition(t,i){const e=this.getRowDefinition(t);return e&&e.Ub(new RowColumnDefinition(i)),this}addColumnDefinition(t,i){const e=this.getColumnDefinition(t);return e&&e.Ub(new RowColumnDefinition(i)),this}get rowSizing(){return this.O!==null?this.O.cp:3}set rowSizing(t){const i=this.rowSizing;i!==t&&(this.O===null&&(this.O=new TablePanelSettings),this.O.cp=t,this.c(),this.t("rowSizing",i,t))}get columnSizing(){return this.O!==null?this.O.fp:3}set columnSizing(t){const i=this.columnSizing;i!==t&&(this.O===null&&(this.O=new TablePanelSettings),this.O.fp=t,this.c(),this.t("columnSizing",i,t))}get topIndex(){return this.O!==null?this.O.dp:0}set topIndex(t){const i=this.topIndex;i!==t&&((!isFinite(t)||t<0)&&Util.o("Panel.topIndex must be greater than zero and a real number, not: "+t),this.O===null&&(this.O=new TablePanelSettings),this.O.dp=t,this.c(),this.t("topIndex",i,t))}get leftIndex(){return this.O!==null?this.O.gp:0}set leftIndex(t){const i=this.leftIndex;i!==t&&((!isFinite(t)||t<0)&&Util.o("Panel.leftIndex must be greater than zero and a real number, not: "+t),this.O===null&&(this.O=new TablePanelSettings),this.O.gp=t,this.c(),this.t("leftIndex",i,t))}findRowForLocalY(t){if(t<0||this.type!==Panel.Table||this.rowCount===0)return-1;let i=0;const e=this.Ge,s=e.length;let n=this.topIndex;for(;n<s;n++){const o=e[n];if(o!==void 0&&(i+=o.total,t<i))return n}return n}findColumnForLocalX(t){if(t<0||this.type!==Panel.Table||this.columnCount===0)return-1;let i=0;const e=this.je,s=e.length;let n=this.leftIndex;for(;n<s;n++){const o=e[n];if(o!==void 0&&(i+=o.total,t<i))return n}return n}graduatedPointForValue(t,i){if(i===void 0&&(i=new Point(NaN,NaN)),this.type!==Panel.Graduated)return i.e(NaN,NaN),i;t=Math.min(Math.max(t,this.graduatedMin),this.graduatedMax);const e=this.findMainElement();return e.geometry.getPointAlongPath((t-this.graduatedMin)/this.graduatedRange,i),e.D.xt(i)}graduatedValueForPoint(t){if(this.type!==Panel.Graduated)return NaN;const i=this.findMainElement();return i.D.ts(t),i.geometry.getFractionForPoint(t)*this.graduatedRange+this.graduatedMin}get data(){return this._t}set data(t){const i=this._t;if(i!==t){const e=this instanceof Part&&!(this instanceof Adornment);e&&Util.i(t,"object",Panel,"data"),this.Vt(),this._t=t;const s=this.diagram;if(s!==null)if(e)s.partManager.uv(this,i,t);else{const n=this.panel;n!==null&&n.Ys!==null&&(i!==null&&n.Ys.delete(i),t!==null&&n.Ys.set(t,this))}if(this.t("data",i,t),s!==null&&s.undoManager.isUndoingRedoing)return;t!==null&&this.updateTargetBindings()}}get itemIndex(){return this.ud}set itemIndex(t){const i=this.ud;i!==t&&(this.ud=t,this.t("itemIndex",i,t))}get Ks(){return this.f!==null?this.f.Ks:null}set Ks(t){this.Ai!==t&&(this.f===null&&(this.f=new GraphObjectTemplateSettings),this.f.Ks=t)}g2(){return this.Ks!==null}fA(){const t=this.Ks;return t!==null&&t.h}freezeBindings(){return this.Vt()}Vt(){let t=this.Ks;if(t===null)this.data!==null&&Util.o("Template cannot have .data be non-null: "+this),this.Ks=t=new List;else if(t.h)return this;const i=new List;this.R2(!1),this.walkVisualTreeFrom(this,(n,o)=>{o.lh();const r=o.Ai;if(r!==null){o.c2(!1);const l=r.iterator;for(;l.next();){const h=l.value;h.mode===2&&o.c2(!0);const a=h.sourceName;if(h.isToObject){a==="/"&&n.R2(!0);const c=h.tA(n,o);c!==null&&(i.add(c),c.Zn===null&&(c.Zn=new List),c.Zn.add(h))}t.add(h)}}if(o instanceof Panel&&o.type===Panel.Table){if(o.rowCount>0){const l=o.Ge,h=l.length;for(let a=0;a<h;a++){const c=l[a];if(c!==void 0&&c.Gs!==null){const f=c.Gs.iterator;for(;f.next();){const u=f.value;u.ke=c,u.md=2,u.uf=c.index,t.add(u)}}}}if(o.columnCount>0){const l=o.je,h=l.length;for(let a=0;a<h;a++){const c=l[a];if(c!==void 0&&c.Gs!==null){const f=c.Gs.iterator;for(;f.next();){const u=f.value;u.ke=c,u.md=1,u.uf=c.index,t.add(u)}}}}}});const e=i.iterator;for(;e.next();){const n=e.value;if(n.Zn!==null){n.c2(!0);const o=n.Zn.iterator;for(;o.next();){const r=o.value;n.Ai===null&&(n.Ai=new List),n.Ai.add(r)}}n.Zn=null}let s=t.iterator;for(;s.next();){const n=s.value;let o=n.ke;if(o!==null){n.ke=null;const r=n.targetProperty,l=r.indexOf(".");if(l>0&&o instanceof Panel){const h=r.substring(0,l),a=r.substring(l+1),c=o.findObject(h);c!==null?(o=c,n.targetProperty=a):(Util.ei('Warning: unable to find GraphObject named "'+h+'" for Binding: '+n.toString()),o=null)}if(o instanceof RowColumnDefinition){const h=GSet.as(o.panel);n.targetId=h===void 0?-1:h,o.panel.$n=n.targetId}else if(o instanceof GraphObject){const h=GSet.as(o);n.targetId=h===void 0?-1:h,o.$n=n.targetId}else Util.o("Unknown type of binding target: "+o);n.check(o)}}return t.g(),this instanceof Part&&this.Pe()&&this.ensureBounds(),this}static gE=!1;copyTemplate(t){t===void 0&&(t=!1);const i=this.copy();return i.av(e=>{e instanceof Panel&&(e.Ks=null,e._t=null);const s=e.Ai;s!==null&&(e.Ai=null,s.each(o=>e.bind(o.copy())));const n=e.ys;n!==null&&(e.ys=null,n.each(o=>e.trigger(o.value.copy())))}),t&&i.Vt(),i}updateTargetBindings(t){const i=this.Ks;if(i===null)return;t===void 0&&(t="");const e=i.iterator;for(;e.next();){const s=e.value,n=this.CA(s,t);if(n===null)continue;const{data:o,elt:r}=n;s.isToTheme&&this.diagram===null||r!==void 0&&s.updateTarget(r,o)}}Oo(){if(this.diagram!==null)if(this.g2()){const t=this.Ks.iterator;for(;t.next();){const i=t.value;if(!i.isToTheme)continue;const e=this.CA(i);if(e===null)continue;const{data:s,elt:n}=e;n!==void 0&&i.updateTarget(n,s)}}else{const t=this.L.r,i=t.length;for(let e=0;e<i;e++)t[e].Oo()}}CA(t,i=""){const e=t.sourceProperty;if(i!==""&&e!==""&&e!==i)return null;const s=t.targetProperty;if(t.converter===null&&s==="")return null;let o=this.data;const r=t.sourceName;if(t.isToObject){if(o=this._L(r),o===null)return null}else if(t.isToModel){const c=this.diagram;if(c===null)return null;o=c.model.modelData}let l=this;const h=t.targetId;if(h!==-1){if(l=this.p0(h),l===null)return null}else t.ke!==null&&(l=t.ke);r==="/"?o=l.part:r==="."?o=l:r===".."&&(o=l.panel);const a=t.md;if(a!==0){if(!(l instanceof Panel))return null;a===1?l=l.getColumnDefinition(t.uf):a===2&&(l=l.getRowDefinition(t.uf))}return{data:o,elt:l}}get itemArray(){return this.mh}set itemArray(t){const i=this.mh;if(i!==t||t!==null&&this.dv(t)){const e=this.diagram;if(i!==t&&(e!==null&&i!==null&&e.partManager.NS(this,e),this.mh=t,e!==null&&t!==null&&e.partManager.SS(this,e)),this.t("itemArray",i,t),e!==null&&e.undoManager.isUndoingRedoing)return;this.LA(i,t)}}findItemPanelForData(t){return t==null||this.Ys===null?null:(Util.i(t,"object",Panel,"findItemPanelForData"),this.Ys.get(t))}dv(t){const i=this.L.r,e=i.length,s=t.length;let n=0,o=null;for(;n<e&&(o=i[n],!(o instanceof Panel)||o.data===null);)n++,o=i[n];if(e-n!==s)return!0;if(o===null)return s>0;let r=0;for(;n<e&&r<s;){if(o=i[n],!(o instanceof Panel)||o.data!==t[r])return!0;n++,r++}return!1}ap(){if(this.type===Panel.Spot||this.type===Panel.Auto)return Math.min(this.L.length,1);if(this.type===Panel.Link){const t=this.L,i=t.length;let e=0;for(;e<i;e++){const s=t.elt(e);if(!(s instanceof Shape)||!s.isPanelMain)return e}return e}if(this.type===Panel.Table&&this.L.length>0){const i=this.L.elt(0);if(i.isPanelMain&&i instanceof Panel&&i.Qr())return 1}return 0}rebuildItemElements(){const t=this.ap();for(;this.L.length>t;)this.te(this.L.length-1,!1);this.LA(null,this.itemArray)}LA(t,i){const e=this.ap(),s=i;if(s===null||s.length===0){for(;this.L.length>e;)this.te(this.L.length-1,!1);return}if(this.L.length<=e){const n=s.length;for(let o=0;o<n;o++)this.Wb(s[o],o,!0)}else{let n=e;for(let r=0;r<s.length;r++,n++){const l=s[r],h=n<this.L.length?this.L.elt(n):null;if(h instanceof Panel){if(h.data!==l){const a=this.v2(h.data,r),c=this.v2(l,r);let f=c!==a;if(!f){const u=this.O2(h.data,r,a);f=this.O2(l,r,c)!==u}f?(this.te(n,!1),this.Wb(l,r,!1)):h.data=l}}else this.Wb(l,r,!1)}for(;n<this.L.length;)this.te(n,!1);this.il=null,this.I2(e,0),this.vo()||this.c(),this.ns=null,this.isEnabledObject()||this.qb(this,!1);const o=this.part;o!==null&&(o.D0(),o.ff(),this.wn&&o instanceof Node&&(o.wn=!0),o.wn&&o instanceof Node&&(o.ne=null))}}Wb(t,i,e){if(t==null||i<0)return null;const s=this.v2(t,i),n=this.O2(t,i,s);if(n!==null){n.Vt();const o=n.copy();if(o.s2()){const l=this.findBindingPanel();l!==null&&l.R2(!0)}typeof t=="object"&&(this.Ys===null&&(this.Ys=new GMap),this.Ys.set(t,o));const r=i+this.ap();return this.insertAt(r,o),e&&(o._t=t,this.I2(r,i),o._t=null),o.data=t,o}return null}gv(t){if(t<0)return;const i=t+this.ap();this.te(i,!0),this.I2(i,t)}I2(t,i){const e=this.L;let s=t,n=i;for(;s<e.length;){const o=e.elt(s);o instanceof Panel&&o.mv(s,n),s++,n++}}mv(t,i){this.type===Panel.TableRow?this.row=t:this.type===Panel.TableColumn&&(this.column=t),this.itemIndex=i}cv(){return this.mh!==null||this.itemTemplateMap!==null}get itemTemplate(){return this.itemTemplateMap===null?null:this.itemTemplateMap.get("")}set itemTemplate(t){if(this.itemTemplateMap===null){if(t===null)return;this.itemTemplateMap=new GMap}const i=this.itemTemplateMap.get("");if(i!==t){(t instanceof Part||t.isPanelMain)&&Util.o("Panel.itemTemplate must not be a Part or be Panel.isPanelMain: "+t),this.itemTemplateMap.set("",t),this.t("itemTemplate",i,t);const e=this.diagram;if(e!==null&&e.undoManager.isUndoingRedoing)return;this.rebuildItemElements()}}get itemTemplateMap(){return this.f!==null?this.f.H0:null}set itemTemplateMap(t){const i=this.itemTemplateMap;if(i!==t){const e=t.iterator;for(;e.next();){const n=e.value}this.Ht(),this.f.H0=t,this.t("itemTemplateMap",i,t);const s=this.diagram;if(s!==null&&s.undoManager.isUndoingRedoing)return;this.rebuildItemElements()}}get itemCategoryProperty(){return this.f!==null?this.f.q0:"category"}set itemCategoryProperty(t){const i=this.itemCategoryProperty;i!==t&&(typeof t!="string"&&typeof t!="function"&&Util.we(t,"string or function",Panel,"itemCategoryProperty"),this.Ht(),this.f.q0=t,this.t("itemCategoryProperty",i,t))}v2(t,i){if(t===null)return"";const e=this.itemCategoryProperty;let s="";if(typeof e=="function")s=e(t);else if(typeof e=="string"&&typeof t=="object"){if(e==="")return"";s=Model.vt(t,e)}else return"";if(s===void 0)return"";if(typeof s=="string")return s;Util.o("Panel.getCategoryForItemData found a non-string category for "+t+": "+s)}static AA=!1;static TA=null;O2(t,i,e){const s=this.itemTemplateMap;let n=null;return s!==null&&(n=s.get(e)),n===null&&(s!==null&&(n=s.get("")),n===null&&(Panel.AA||(Panel.AA=!0,Util.ei('No item template Panel found for category "'+e+'" on '+this),Util.ei("  Using default item template."),Panel.TA=new Panel().add(new TextBlock().bind("text","",Util.toString).theme("stroke","text"))),n=Panel.TA)),n}get cf(){return(this.n&1048576)!==0}set cf(t){const i=(this.n&1048576)!==0;i!==t&&(Util.i(t,"boolean",Panel,"isAtomic"),this.n=this.n^1048576,this.t("isAtomic",i,t))}get isClipping(){return(this.n&2097152)!==0}set isClipping(t){const i=(this.n&2097152)!==0;i!==t&&(this.sd(),this.n=this.n^2097152,this instanceof Group&&(this.oi=null),this.c(),this.t("isClipping",i,t))}get isOpposite(){return(this.n&33554432)!==0}set isOpposite(t){const i=(this.n&33554432)!==0;i!==t&&(Util.i(t,"boolean",Panel,"isOpposite"),this.n=this.n^33554432,this.c(),this.t("isOpposite",i,t))}get isEnabled(){return(this.n&4194304)!==0}set isEnabled(t){const i=(this.n&4194304)!==0;if(i!==t){Util.i(t,"boolean",Panel,"isEnabled");const e=this.panel===null||this.panel.isEnabledObject();this.n=this.n^4194304,this.t("isEnabled",i,t);const s=this.diagram;if(s!==null&&s.undoManager.isUndoingRedoing)return;e&&this.qb(this,t)}}qb(t,i){const e=t.enabledChanged;if(e!==null&&e(t,i),t instanceof Panel){const s=t.L.r,n=s.length;for(let o=0;o<n;o++){const r=s[o];i&&r instanceof Panel&&!r.isEnabled||this.qb(r,i)}}}get alignmentFocusName(){return this.so}set alignmentFocusName(t){const i=this.so;i!==t&&(this.so=t,this.c(),this.t("alignmentFocusName",i,t))}static definePanelLayout(t,i){PanelLayout.definePanelLayout(t,i)}static Position=PanelLayout.Layouts.get("Position");static Horizontal=PanelLayout.Layouts.get("Horizontal");static Vertical=PanelLayout.Layouts.get("Vertical");static Spot=PanelLayout.Layouts.get("Spot");static Auto=PanelLayout.Layouts.get("Auto");static Table=PanelLayout.Layouts.get("Table");static Viewbox=PanelLayout.Layouts.get("Viewbox");static TableRow=PanelLayout.Layouts.get("TableRow");static TableColumn=PanelLayout.Layouts.get("TableColumn");static Link=PanelLayout.Layouts.get("Link");static Grid=PanelLayout.Layouts.get("Grid");static Graduated=PanelLayout.Layouts.get("Graduated")}Panel.definePanelLayout=Panel.definePanelLayout;class GradPanelSettings{op;rp;lp;hp;ws;He;ns;Me;constructor(){this.op=0,this.rp=100,this.lp=10,this.hp=0,this.ws=null,this.He=null,this.ns=null,this.Me=null}copy(){const t=new GradPanelSettings;return t.op=this.op,t.rp=this.rp,t.lp=this.lp,t.hp=this.hp,t.ws=this.ws,t.He=this.He,t.ns=this.ns,t.Me=this.Me,t}}class GridPanelSettings{dd;gd;Yc;Z0;constructor(){this.dd=Size.iC,this.gd=Point.Po,this.Yc=Size.gw,this.Z0=[]}copy(){const t=new GridPanelSettings;return t.dd=this.dd.copy(),t.gd=this.gd.copy(),t.Yc=this.Yc.copy(),t.Z0=this.Z0,t}}class TablePanelSettings{Ge;je;cp;fp;dp;gp;Q0;tp;_0;ip;sp;ep;np;gh;constructor(){this.Ge=[],this.je=[],this.cp=3,this.fp=3,this.dp=0,this.gp=0,this.Q0=Margin.Ug,this.tp=1,this._0=null,this.ip=null,this.sp=1,this.ep=null,this.np=null,this.gh=null}copy(t){const i=new TablePanelSettings,e=this.Ge,s=e.length,n=i.Ge;for(let h=0;h<s;h++){if(e[h]===void 0)continue;const a=e[h].copy();a.xa(t),n[h]=a}const o=this.je,r=o.length,l=i.je;for(let h=0;h<r;h++){if(o[h]===void 0)continue;const a=o[h].copy();a.xa(t),l[h]=a}return i.cp=this.cp,i.fp=this.fp,i.dp=this.dp,i.gp=this.gp,i.Q0=this.Q0.N(),i.tp=this.tp,i._0=this._0,i.ip=this.ip,i.sp=this.sp,i.ep=this.ep,i.np=this.np,i.gh=this.gh,i}}var Sizing=(w=>(w[w.Default=1]="Default",w[w.None=2]="None",w[w.ProportionalExtra=3]="ProportionalExtra",w))(Sizing||{});class RowColumnDefinition{Vs;mp;Dt;Ma;Sa;ri;at;pd;to;Yo;yd;wd;Na;Ct;xd;Gs;st;Di;ge;constructor(t){GSet.ji(this),this.Vs=null,this.mp=!0,this.Dt=0,this.ge=NaN,this.Ma=0,this.Sa=1/0,this.ri=Spot.Default,this.st=0,this.Di=0,this.at=0,this.Gs=null,this.pd=1,this.to=1,this.Yo=null,this.yd=null,this.wd=NaN,this.Na=null,this.Ct=null,this.xd=!1,t&&(Object.assign(this,t),t.column!==void 0?(this.isRow=!1,this.index=t.column):t.row!==void 0&&(this.isRow=!0,this.index=t.row))}copy(){const t=new RowColumnDefinition;return t.mp=this.mp,t.Dt=this.Dt,t.ge=this.ge,t.Ma=this.Ma,t.Sa=this.Sa,t.ri=this.ri,t.st=this.st,t.Di=this.Di,t.at=this.at,t.to=this.to,t.pd=this.pd,this.Yo===null?t.Yo=null:t.Yo=this.Yo.N(),t.yd=this.yd,t.wd=this.wd,t.Na=null,this.Na!==null&&(t.separatorDashArray=this.separatorDashArray.slice()),t.Ct=this.Ct,t.xd=this.xd,t.Gs=this.Gs,t}Ub(t){t.isRow?this.height=t.height:this.width=t.width,this.minimum=t.minimum,this.maximum=t.maximum,this.alignment=t.alignment,this.stretch=t.stretch,this.sizing=t.sizing,this.Yo=t.separatorPadding===null?null:t.separatorPadding.N(),this.separatorStroke=t.separatorStroke,this.separatorStrokeWidth=t.separatorStrokeWidth,this.Na=null,t.separatorDashArray&&(this.Na=t.separatorDashArray.slice()),this.background=t.background,this.coversSeparators=t.coversSeparators,this.Gs=t.Gs}li(t){t in Sizing?this.sizing=t:Util.rr(this,t)}toString(){return"RowColumnDefinition "+(this.isRow?"(Row ":"(Column ")+this.index+") #"+GSet.as(this)}static Default=1;static None=2;static ProportionalExtra=3;xa(t){this.Vs=t}computeEffectiveSpacingTop(t){let i=0;const e=this.Vs;if(this.index!==t){let n=this.separatorStroke;n===null&&e!==null&&(n=this.isRow?e.defaultRowSeparatorStroke:e.defaultColumnSeparatorStroke),n!==null&&(i=this.separatorStrokeWidth,isNaN(i)&&(e!==null?i=this.isRow?e.defaultRowSeparatorStrokeWidth:e.defaultColumnSeparatorStrokeWidth:i=0))}let s=this.Yo;if(s===null)if(e!==null)s=e.defaultSeparatorPadding;else return i;return i+(this.isRow?s.top:s.left)}computeEffectiveSpacing(){let t=0;const i=this.Vs;let e=0;const s=this.isRow;if(i!==null&&i.type===Panel.Table){const o=s?i.Ge.length:i.je.length;for(let r=0;r<o;r++){const l=s?i.Ge[r]:i.je[r];if(l!==void 0&&l.st!==0){e=l.index;break}}}if(this.index!==e){let o=this.separatorStroke;o===null&&i!==null&&(o=s?i.defaultRowSeparatorStroke:i.defaultColumnSeparatorStroke),o!==null&&(t=this.separatorStrokeWidth,isNaN(t)&&(i!==null?t=s?i.defaultRowSeparatorStrokeWidth:i.defaultColumnSeparatorStrokeWidth:t=0))}let n=this.Yo;if(n===null)if(i!==null)n=i.defaultSeparatorPadding;else return t;return t+(this.isRow?n.top+n.bottom:n.left+n.right)}t(t,i,e,s,n){const o=this.Vs;if(o!==null&&(o.raiseChangedEvent(2,t,this,i,e,s,n),this.Gs!==null)){const r=o.diagram;if(r!==null&&!r.fe){const l=o.findBindingPanel();if(l!==null){const h=l.data;if(h!==null){const a=this.Gs.iterator;for(;a.next();)a.value.updateSource(this,h,t,l)}}}}}get panel(){return this.Vs}get isRow(){return this.mp}set isRow(t){this.mp=t}get index(){return this.Dt}set index(t){this.Dt=t}get height(){return this.ge}set height(t){const i=this.ge;i!==t&&(t<0&&Util._(t,">= 0",RowColumnDefinition,"height"),this.ge=t,this.actual=this.st,this.panel!==null&&this.panel.c(),this.t("height",i,t))}get width(){return this.ge}set width(t){const i=this.ge;i!==t&&(t<0&&Util._(t,">= 0",RowColumnDefinition,"width"),this.ge=t,this.actual=this.st,this.panel!==null&&this.panel.c(),this.t("width",i,t))}get minimum(){return this.Ma}set minimum(t){const i=this.Ma;i!==t&&((t<0||!isFinite(t))&&Util._(t,">= 0",RowColumnDefinition,"minimum"),this.Ma=t,this.actual=this.st,this.panel!==null&&this.panel.c(),this.t("minimum",i,t))}get maximum(){return this.Sa}set maximum(t){const i=this.Sa;i!==t&&(t<0&&Util._(t,">= 0",RowColumnDefinition,"maximum"),this.Sa=t,this.actual=this.st,this.panel!==null&&this.panel.c(),this.t("maximum",i,t))}get alignment(){return this.ri}set alignment(t){const i=this.ri;i.equals(t)||(this.ri=t.N(),this.panel!==null&&this.panel.c(),this.t("alignment",i,t))}get stretch(){return this.to}set stretch(t){const i=this.to;i!==t&&(this.to=t,this.panel!==null&&this.panel.c(),this.t("stretch",i,t))}get separatorPadding(){return this.Yo}set separatorPadding(t){typeof t=="number"&&(t=new Margin(t));const i=this.Yo;(t===null||i===null||!i.equals(t))&&(t!==null&&(t=t.N()),this.Yo=t,this.panel!==null&&this.panel.c(),this.t("separatorPadding",i,t))}get separatorStroke(){return this.yd}set separatorStroke(t){const i=this.yd;i!==t&&(t!==null&&Brush.od(t,"RowColumnDefinition.separatorStroke"),t instanceof Brush&&t.g(),this.yd=t,this.panel!==null&&this.panel.c(),this.t("separatorStroke",i,t))}get separatorStrokeWidth(){return this.wd}set separatorStrokeWidth(t){const i=this.wd;i!==t&&(this.wd=t,this.panel!==null&&this.panel.c(),this.t("separatorStrokeWidth",i,t))}get separatorDashArray(){return this.Na}set separatorDashArray(t){const i=this.Na;if(i!==t){if(t!==null&&!Array.isArray(t)&&Util.we(t,"Array",RowColumnDefinition,"separatorDashArray:value"),t!==null){const e=t.length;let s=0;for(let n=0;n<e;n++){const o=t[n];(typeof o!="number"||!(o>=0)||!isFinite(o))&&Util.o("separatorDashArray value "+o+" at index "+n+" must be a positive number or zero."),s+=o}if(s===0){if(i===null)return;t=null}}this.Na=t,this.panel!==null&&this.panel.C(),this.t("separatorDashArray",i,t)}}get background(){return this.Ct}set background(t){const i=this.Ct;i!==t&&(t!==null&&Brush.od(t,"RowColumnDefinition.background"),t instanceof Brush&&t.g(),this.Ct=t,this.panel!==null&&this.panel.C(),this.t("background",i,t))}get coversSeparators(){return this.xd}set coversSeparators(t){const i=this.xd;i!==t&&(Util.i(t,"boolean",RowColumnDefinition,"coversSeparators"),this.xd=t,this.panel!==null&&this.panel.C(),this.t("coversSeparators",i,t))}get sizing(){return this.pd}set sizing(t){const i=this.pd;i!==t&&(this.pd=t,this.panel!==null&&this.panel.c(),this.t("sizing",i,t))}Gb(){if(this.sizing===1){const t=this.Vs;return this.isRow?t.rowSizing:t.columnSizing}return this.sizing}get actual(){return this.st}set actual(t){isNaN(this.ge)?this.st=Math.max(Math.min(this.Sa,t),this.Ma):this.st=Math.max(Math.min(this.Sa,this.ge),this.Ma)}get measured(){return this.Di}set measured(t){this.Di=t}get total(){return this.st+this.computeEffectiveSpacing()}get position(){return this.at}set position(t){this.at=t}bind(t,i,e,s){return this.nf(t,i,e,s),this}bindTwoWay(t,i,e,s){const n=this.nf(t,i,e,s);return s===void 0&&n.makeTwoWay(),this}theme(t,i,e,s,n){return this.uh(t,i,e,s,n),this}themeData(t,i,e,s,n){return this.uh(t,i,e,s,n).ofData(),this}themeObject(t,i,e,s,n,o){return this.uh(t,i,e,s,n).ofObject(o),this}themeModel(t,i,e,s,n){return this.uh(t,i,e,s,n).ofModel(),this}nf(t,i,e,s){let n=null;return typeof t=="string"?n=new Binding(t,i,e,s):n=t,this.G0(n),n}uh(t,i,e,s,n){let o=null;return typeof t=="string"?o=new ThemeBinding(t,i,e,s,n):o=t,this.G0(o),o}G0(t){t.ke=this;const i=this.panel;if(i!==null){const e=i.findBindingPanel();e!==null&&e.fA()&&Util.o("Cannot add a Binding to a RowColumnDefinition that is already frozen: "+t+" on "+i)}this.Gs===null&&(this.Gs=new List),this.Gs.add(t)}}class Shape extends GraphObject{ct;xs;bd;Ca;Hi;Go;zo;Lt;kd;Pd;J;constructor(t,i){super(),this.ct=null,this.xs=null,this.bd="None",this.Ca="black",this.Hi="black",this.Go=1,this.zo=null,this.Lt=null,this.kd=NaN,this.Pd=NaN,this.J=null,typeof t=="string"?this.figure=t:t&&Object.assign(this,t),i&&Object.assign(this,i)}cloneProtected(t){super.cloneProtected(t),t.ct=this.ct,t.xs=this.xs,t.bd=this.bd,t.Ca=this.Ca,t.Hi=this.Hi,t.Go=this.Go,this.zo!==null&&(t.zo=this.zo.slice()),this.Lt!==null&&(this.Lt.gi?t.Lt=this.Lt:t.Lt=this.Lt.copy()),t.kd=this.kd,t.Pd=this.Pd,this.J!==null&&(t.J=this.J.copy())}La(){this.Lt===null?this.Lt=new ShapeTemplateSettings:this.Lt.gi&&(this.Lt=this.Lt.copy())}lh(){super.lh(),this.Lt!==null&&(this.Lt.gi=!0)}li(t){t in GeometryStretch?this.geometryStretch=t:super.li(t)}toString(){return"Shape("+(this.figure!=="None"?this.figure:this.toArrow!=="None"?this.toArrow:this.fromArrow)+")#"+GSet.as(this)}pv(t,i){const e=this.pathPattern;e.ut(1/0,1/0);const s=e.measuredBounds;e.Xt(0,0,s.width,s.height);const n=this.geometry;t.save(),t.beginPath();const o=Util.nt();if(n.type===1)o.push(n.startX),o.push(n.startY),o.push(n.endX),o.push(n.endY),this.Md(t,i,o,e);else if(n.type===4){const r=n.figures.iterator;for(;r.next();){const l=r.value;o.length=0,o.push(l.startX),o.push(l.startY);let h=l.startX,a=l.startY,c=h,f=a;const u=l.segments.r,d=u.length;for(let m=0;m<d;m++){const g=u[m];switch(g.type){case 1:this.Md(t,i,o,e),o.length=0,o.push(g.endX),o.push(g.endY),h=g.endX,a=g.endY,c=h,f=a;break;case 2:o.push(g.endX),o.push(g.endY),h=g.endX,a=g.endY;break;case 3:Geo.Un(h,a,g.point1X,g.point1Y,g.point2X,g.point2Y,g.endX,g.endY,.5,o),h=g.endX,a=g.endY;break;case 4:Geo.zg(h,a,g.point1X,g.point1Y,g.endX,g.endY,.5,o),h=g.endX,a=g.endY;break;case 5:{const p=g.So(l),y=p.length;if(y===0){o.push(g.centerX),o.push(g.centerY),h=g.centerX,a=g.centerY;break}for(let x=0;x<y;x++){const k=p[x];Geo.Un(h,a,k[2],k[3],k[4],k[5],k[6],k[7],.5,o),h=k[6],a=k[7]}break}case 6:{const p=g.Eh(l,h,a),y=p.length;if(y===0){o.push(g.endX),o.push(g.endY),h=g.endX,a=g.endY;break}for(let x=0;x<y;x++){const k=p[x];Geo.Un(h,a,k[2],k[3],k[4],k[5],k[6],k[7],.5,o),h=k[6],a=k[7]}break}default:Util.o("Segment not of valid type: "+g.type)}g.isClosed&&(o.push(c),o.push(f),this.Md(t,i,o,e))}this.Md(t,i,o,e)}}else if(n.type===2)o.push(n.startX),o.push(n.startY),o.push(n.endX),o.push(n.startY),o.push(n.endX),o.push(n.endY),o.push(n.startX),o.push(n.endY),o.push(n.startX),o.push(n.startY),this.Md(t,i,o,e);else if(n.type===3){const r=new PathFigure;r.startX=n.endX,r.startY=(n.startY+n.endY)/2;const l=new PathSegment(5);l.startAngle=0,l.sweepAngle=360,l.centerX=(n.startX+n.endX)/2,l.centerY=(n.startY+n.endY)/2,l.radiusX=Math.abs(n.startX-n.endX)/2,l.radiusY=Math.abs(n.startY-n.endY)/2,r.add(l);const h=l.So(r),a=h.length;if(a===0)o.push(l.centerX),o.push(l.centerY);else{let c=r.startX,f=r.startY;for(let u=0;u<a;u++){const d=h[u];Geo.Un(c,f,d[2],d[3],d[4],d[5],d[6],d[7],.5,o),c=d[6],f=d[7]}}this.Md(t,i,o,e)}Util.tt(o),t.restore(),t.clearContextCache(!1)}yv(t){let i=t.measuredBounds.width;return t instanceof Shape&&(i-=t.strokeWidth),i<1&&(i=1),i}Md(t,i,e,s){const n=e.length;if(n<4)return;const o=s.measuredBounds,r=Math.max(1,o.width),l=o.height;let h=e[0],a=e[1],c=0,f=0,u=0,d=0,m=0,g=0,p=0,y=0;const x=Util.nt();for(let N=2;N<n;N+=2)c=e[N],f=e[N+1],u=c-h,d=f-a,u===0&&(u=.001),m=d/u,g=Math.atan2(d,u),p=Math.sqrt(u*u+d*d),x.push([u,g,m,p]),y+=p,h=c,a=f;h=e[0],a=e[1];const k=this.yv(s);let b=k;const P=r/2;let M=P!==0,L=0,C=x[L];u=C[0],g=C[1],m=C[2],p=C[3];let S=0;for(;y>=.1;){if(S===0&&(M?(b=k,b-=P,y-=P,M=!1):b=k,b===0&&(b=1)),b>y){b=y,Util.tt(x);return}b>p?(S=b-p,b=p):S=0;let N=Math.sqrt(b*b/(1+m*m));if(u<0&&(N=-N),h+=N,a+=m*N,t.translate(h,a),t.rotate(g),t.translate(-(r/2),-(l/2)),S===0&&s.fh(t,i),t.translate(r/2,l/2),t.rotate(-g),t.translate(-h,-a),y-=b,p-=b,S!==0){if(L++,L===x.length){Util.tt(x);return}C=x[L],u=C[0],g=C[1],m=C[2],p=C[3],b=S}}Util.tt(x)}fh(t,i){const e=t instanceof SVGContext;let s=this.Hi;const n=this.Ca;if(s===null&&n===null)return;const o=this.ct;if(o===null)return;t.commitTransform();const r=this.actualBounds,l=this.naturalBounds;n!==null&&this.dn(t,n,!0,!1,l,r);const h=this.part;let a=this.Go;s!==null&&a===0&&h!==null&&(this.isPanelMain||h.findMainElement()===this)&&(a=h.wv()),a===0&&(s=null),s!==null&&a!==0&&(this.dn(t,s,!1,!1,l,r),t.lineWidth=a,t.lineJoin=this.strokeJoin,t.lineCap=this.strokeCap,t.miterLimit=this.strokeMiterLimit);let c=!1;h&&i.getRenderingHint("drawShadows")&&(c=h.isShadowed),t._r===!1&&(c=!1);let f=!0;s!==null&&(n===null||n==="transparent")&&(f=!1);let u=!1;const d=this.strokeDashArray;if(d!==null&&(u=!0,t.enableDash(d,this.strokeDashOffset)),o.type===1)t.beginPath(),t.moveTo(o.startX,o.startY),t.lineTo(o.endX,o.endY),s!==null&&t.strokeContext(),t.endPath();else if(o.type===2){const m=o.startX,g=o.startY,p=o.endX,y=o.endY,x=Math.min(m,p),k=Math.min(g,y),b=Math.abs(p-m),P=Math.abs(y-g);t.beginPath(),t.rect(x,k,b,P),n!==null&&t.fillContext(n,!1,null),s!==null&&(f&&c&&t.shadowsOff(),t.strokeContext(),f&&c&&t.shadowsOn()),t.endPath()}else if(o.type===3){const m=o.startX,g=o.startY,p=o.endX,y=o.endY,x=Math.abs(p-m)/2,k=Math.abs(y-g)/2,b=Math.min(m,p)+x,P=Math.min(g,y)+k;t.beginPath(),t.moveTo(b,P-k),t.bezierCurveTo(b+Geo.Bn*x,P-k,b+x,P-Geo.Bn*k,b+x,P),t.bezierCurveTo(b+x,P+Geo.Bn*k,b+Geo.Bn*x,P+k,b,P+k),t.bezierCurveTo(b-Geo.Bn*x,P+k,b-x,P+Geo.Bn*k,b-x,P),t.bezierCurveTo(b-x,P-Geo.Bn*k,b-Geo.Bn*x,P-k,b,P-k),t.closePath(),n!==null&&t.fillContext(n,!1,null),s!==null&&(f&&c&&t.shadowsOff(),t.strokeContext(),f&&c&&t.shadowsOn()),t.endPath()}else if(o.type===4){const m=o.figures,g=m.length;for(let p=0;p<g;p++){const y=m.r[p];e?this.buildPath(t,y):y.Be===null&&(y.Be=new Path2D,this.buildPath(y.Be,y));const x=y.isFilled;c?y.isShadowed?(x===!0&&n!=="transparent"&&n!==null&&t.fillContext(n,y.isEvenOdd,y.Be),s!==null&&(x&&f&&t.shadowsOff(),t.stroke(y.Be),x&&f&&t.shadowsOn())):(t.shadowsOff(),x&&n!=="transparent"&&n!==null&&t.fillContext(n,y.isEvenOdd,y.Be),s!==null&&t.stroke(y.Be),t.shadowsOn()):(x&&n!==null&&t.fillContext(n,y.isEvenOdd,y.Be),s!==null&&t.stroke(y.Be)),t.endPath(p)}}u&&t.disableDash(),this.pathPattern!==null&&this.pv(t,i)}buildPath(t,i){t instanceof Path2D||t.beginPath(),t.moveTo(i.startX,i.startY);const s=i.segments.r,n=s.length;let o=null;for(let r=0;r<n;r++){const l=s[r];switch(l.type){case 1:t.moveTo(l.endX,l.endY);break;case 2:t.lineTo(l.endX,l.endY);break;case 3:t.bezierCurveTo(l.point1X,l.point1Y,l.point2X,l.point2Y,l.endX,l.endY);break;case 4:t.quadraticCurveTo(l.point1X,l.point1Y,l.endX,l.endY);break;case 5:if(l.radiusX===l.radiusY){const h=o!==null?o.endX:i.startX,a=o!==null?o.endY:i.startY,c=Math.PI/180;t.arc(l.point1X,l.point1Y,l.radiusX,l.startAngle*c,(l.startAngle+l.sweepAngle)*c,l.sweepAngle<0,h,a)}else{const h=l.So(i),a=h.length;if(a===0){t.lineTo(l.centerX,l.centerY);break}for(let c=0;c<a;c++){const f=h[c];c===0&&t.lineTo(f[0],f[1]),t.bezierCurveTo(f[2],f[3],f[4],f[5],f[6],f[7])}}break;case 6:{let h=0,a=0,c;if(o!==null&&o.type===5){c=o.So(i);const u=c.length;if(u===0){t.lineTo(l.endX,l.endY);break}const d=c[u-1]||null;d!==null&&(h=d[6],a=d[7])}else h=o!==null?o.endX:i.startX,a=o!==null?o.endY:i.startY;c=l.Eh(i,h,a);const f=c.length;if(f===0){t.lineTo(l.endX,l.endY);break}for(let u=0;u<f;u++){const d=c[u];t.bezierCurveTo(d[2],d[3],d[4],d[5],d[6],d[7])}break}}l.isClosed&&t.closePath(),o=l}}_c(t,i,e){if(!super._c(t,i,e)||this.Hi===null&&this.Ca===null||this.ct===null||this.pathPattern!==null)return!1;const s=this.svg.getElementsByTagName("path");return this.geometry.figures.length!==s.length?!1:(t.currentPath=this.svg,this.fh(t,i),t.currentPath=null,!0)}ed(t){return this.geometry!==null&&this.geometry.figures.length>1||this.pathPattern!==null?!0:super.ed(t)}h2(t,i){if(t.nodeName!=="g")t.setAttributeNS(null,"filter",i);else{const e=t.getElementsByTagName("path");for(let s=0;s<e.length;s++)e[s].setAttributeNS(null,"filter",i)}}getDocumentPoint(t,i){if(i===void 0&&(i=new Point),t instanceof Spot){const e=t;e.isNoSpot()&&Util.o("getDocumentPoint Spot must be a real, specific Spot, not: "+e.toString());const s=this.naturalBounds,n=this.strokeWidth;return i.e(e.x*(s.width+n)-n/2+s.x+e.offsetX,e.y*(s.height+n)-n/2+s.y+e.offsetY),this.Es.xt(i),i}else return i.set(t),this.Es.xt(i),i}getDocumentBounds(t){t===void 0&&(t=new Rect);const i=this.naturalBounds,e=this.Es,s=Rect.X(i.x,i.y,i.width,i.height),n=this.strokeWidth;s.inflate(n/2,n/2);const o=Point.X(s.x,s.y).D(e);return t.e(o.x,o.y,0,0),o.e(s.right,s.y).D(e),t.unionNoCheck(o.x,o.y,0,0),o.e(s.right,s.bottom).D(e),t.unionNoCheck(o.x,o.y,0,0),o.e(s.x,s.bottom).D(e),t.unionNoCheck(o.x,o.y,0,0),Rect.s(s),Point.s(o),t}hh(t,i){const e=this.geometry;if(e===null||this.fill===null&&this.stroke===null)return!1;const s=e.bounds;let n=this.strokeWidth/2;e.type===1&&!i&&(n+=2);const o=Rect.l();if(o.a(s),o.inflate(n+2,n+2),!o.containsPoint(t))return Rect.s(o),!1;const r=n+1e-4;if(e.type===1){if(this.stroke===null)return!1;const l=(e.startX-e.endX)*(t.x-e.endX)+(e.startY-e.endY)*(t.y-e.endY),h=(e.endX-e.startX)*(t.x-e.startX)+(e.endY-e.startY)*(t.y-e.startY);return l<0||h<0?!1:(Rect.s(o),Geo.Oi(e.startX,e.startY,e.endX,e.endY,n,t.x,t.y))}else if(e.type===2){const l=e.startX,h=e.startY,a=e.endX,c=e.endY;if(o.x=Math.min(l,a),o.y=Math.min(h,c),o.width=Math.abs(a-l),o.height=Math.abs(c-h),this.fill===null){if(o.inflate(-r,-r),o.containsPoint(t))return Rect.s(o),!1;o.inflate(r,r)}this.stroke!==null&&o.inflate(n,n);const f=o.containsPoint(t);return Rect.s(o),f}else if(e.type===3){const l=e.startX,h=e.startY,a=e.endX,c=e.endY;let f=Math.min(l,a),u=Math.min(h,c);const d=Math.abs(a-l),m=Math.abs(c-h);let g=d/2,p=m/2;if(f=t.x-(f+g),u=t.y-(u+p),this.fill===null){if(g-=r,p-=r,g<=0||p<=0)return Rect.s(o),!1;if(f*f/(g*g)+u*u/(p*p)<=1)return Rect.s(o),!1;g+=r,p+=r}return this.stroke!==null&&(g+=r,p+=r),Rect.s(o),g<=0||p<=0?!1:f*f/(g*g)+u*u/(p*p)<=1}else{if(e.type===4)return Rect.s(o),this.fill===null?e.bC(t.x,t.y,n):e.Vk(t,n,this.strokeWidth>1,i);Util.o("Unknown Geometry type: "+e.type)}}_u(t,i,e,s){const n=this.desiredSize,o=this.Go;t=Math.max(t,0),i=Math.max(i,0);let r;if(this.xs!==null)r=this.geometry.bounds;else{const g=this.figure;let p=Shape.E2[g];if(p===void 0){let y=Geo.Mo[g];typeof y=="string"&&(y=Geo.Mo[y]),typeof y=="function"?(p=y(null,100,100),Shape.E2[g]=p):Util.o("Unsupported Figure: "+g)}r=p.bounds}let l=r.width,h=r.height,a=r.width,c=r.height;switch(this.zs(!0)){case 0:e=0,s=0;break;case 2:a=Math.max(t-o,0),c=Math.max(i-o,0);break;case 5:a=Math.max(t-o,0),s=0;break;case 4:e=0,c=Math.max(i-o,0);break}isFinite(n.width)&&(a=n.width),isFinite(n.height)&&(c=n.height);const u=this.maxSize,d=this.minSize;e=Math.max(e-o,d.width),s=Math.max(s-o,d.height),a=Math.min(u.width,a),c=Math.min(u.height,c),a=isFinite(a)?Math.max(e,a):Math.max(l,e),c=isFinite(c)?Math.max(s,c):Math.max(h,s);const m=this.tM();switch(m){case 0:break;case 2:l=a,h=c;break;case 6:{let g=Math.min(a/l,c/h);isFinite(g)||(g=1),l=l*g,h=h*g;break}default:Util.o(m+" is not a valid geometryStretch.")}if(this.xs!==null){l===0&&(l=.001),h===0&&(h=.001);const p=(this.xs!==null?this.xs:this.ct).GD(l,h);this.ct=p}else(this.ct===null||!Geo.K(this.ct.sc,t-o)||!Geo.K(this.ct.nc,i-o))&&(this.ct=Shape.xv(this,l,h));r=this.ct.bounds,t===1/0||i===1/0?this.Qn(r.x-o/2,r.y-o/2,t===0&&l===0?0:r.width+o,i===0&&h===0?0:r.height+o):this.Qn(-(o/2),-(o/2),a+o,c+o),n.isReal()?(a=n.width,c=n.height,a=Math.min(u.width,a),c=Math.min(u.height,c),a=Math.max(d.width,a),c=Math.max(d.height,c),this.Xi.e(0,0,a,c)):this.Xi.a(r)}tM(){const t=this.geometryStretch;return this.xs!==null?t===1?2:t:t===1?Shape.E2[this.figure].defaultStretch:t}ah(t,i,e,s){this.commonArrange(t,i,e,s)}getNearestIntersectionPoint(t,i,e){return this.Zc(t.x,t.y,i.x,i.y,e)}Zc(t,i,e,s,n){const o=this.D,r=1/(o.m11*o.m22-o.m12*o.m21),l=o.m22*r,h=-o.m12*r,a=-o.m21*r,c=o.m11*r,f=r*(o.m21*o.dy-o.m22*o.dx),u=r*(o.m12*o.dx-o.m11*o.dy),d=t*l+i*a+f,m=t*h+i*c+u,g=e*l+s*a+f,p=e*h+s*c+u,y=this.Go/2;let x=this.ct;x===null&&(this.ut(1/0,1/0),x=this.ct);const k=x.bounds;let b=!1;if(x.type===1)if(this.strokeWidth<=1.5)b=Geo.Vn(x.startX,x.startY,x.endX,x.endY,d,m,g,p,n);else{let P=0,M=0;if(x.startX===x.endX)P=y,M=0;else{const T=(x.endY-x.startY)/(x.endX-x.startX);M=y/Math.sqrt(1+T*T),P=M*T}const L=Util.nt();let C=new Point;Geo.Vn(x.startX+P,x.startY+M,x.endX+P,x.endY+M,d,m,g,p,C)&&L.push(C),C=new Point,Geo.Vn(x.startX-P,x.startY-M,x.endX-P,x.endY-M,d,m,g,p,C)&&L.push(C),C=new Point,Geo.Vn(x.startX+P,x.startY+M,x.startX-P,x.startY-M,d,m,g,p,C)&&L.push(C),C=new Point,Geo.Vn(x.endX+P,x.endY+M,x.endX-P,x.endY-M,d,m,g,p,C)&&L.push(C);const S=L.length;if(S===0)return Util.tt(L),!1;b=!0;let N=1/0;for(let T=0;T<S;T++){const A=L[T],D=(A.x-d)*(A.x-d)+(A.y-m)*(A.y-m);D<N&&(N=D,n.x=A.x,n.y=A.y)}Util.tt(L)}else if(x.type===2)b=Geo.ml(k.x-y,k.y-y,k.x+k.width+y,k.y+k.height+y,d,m,g,p,n);else if(x.type===3){const P=Rect.X(k.x,k.y,k.width,k.height).inflate(y,y);b=this.bv(P,d,m,g,p,n),Rect.s(P)}else if(x.type===4){let P=0,M=0,L=0,C=0;const S=Point.l();let N=g-d,T=p-m,A=N*N+T*T,D=d,F=m;if(A>0&&k.contains(D,F)&&(S.x=D,S.y=F,this.containsPoint(S)))for(N!==0&&Math.abs(N)<.5?(T*=.5/N,N=.5):T!==0&&Math.abs(T)<.5&&(N*=.5/T,T=.5),D-=N,F-=T;k.contains(D,F);)D-=N,F-=T;const R=.6;n.x=g,n.y=p;for(let X=0;X<x.figures.count;X++){const E=x.figures.r[X],V=E.isFilled?D:d,U=E.isFilled?F:m,Y=E.segments;P=E.startX,M=E.startY;let G=P,H=M;for(let J=0;J<Y.count;J++){const z=Y.r[J],W=z.type;L=z.endX,C=z.endY;let q=!1;switch(W){case 1:G=L,H=C;break;case 2:q=this.Jb(P,M,L,C,V,U,g,p,S);break;case 3:{q=Geo.Xg(P,M,z.point1X,z.point1Y,z.point2X,z.point2Y,L,C,V,U,g,p,R,S);break}case 4:{q=Geo.Xg(P,M,P+2/3*(z.point1X-P),M+2/3*(z.point1Y-M),L+2/3*(z.point1X-L),C+2/3*(z.point1Y-C),L,C,V,U,g,p,R,S);break}case 5:case 6:{const Q=z.type===5?z.So(E):z.Eh(E,P,M),K=Q.length;if(K===0){q=this.Jb(P,M,z.type===5?z.centerX:z.endX,z.type===5?z.centerY:z.endY,V,U,g,p,S);break}let I=null;for(let j=0;j<K;j++){if(I=Q[j],j===0&&this.Jb(P,M,I[0],I[1],V,U,g,p,S)){const $=this.$b(V,U,S,A,n);$<A&&(A=$,b=!0)}if(Geo.Xg(I[0],I[1],I[2],I[3],I[4],I[5],I[6],I[7],V,U,g,p,R,S)){const $=this.$b(V,U,S,A,n);$<A&&(A=$,b=!0)}}L=I[6],C=I[7];break}default:Util.o("Unknown Segment type: "+W)}if(P=L,M=C,q){const Q=this.$b(V,U,S,A,n);Q<A&&(A=Q,b=!0)}if(z.isClosed&&(L=G,C=H,this.Jb(P,M,L,C,V,U,g,p,S))){const Q=this.$b(V,U,S,A,n);Q<A&&(A=Q,b=!0)}}}let v=e-t,O=s-i;const B=Math.sqrt(v*v+O*O);B!==0&&(v/=B,O/=B),n.x-=v*y,n.y-=O*y,Point.s(S)}else Util.o("Unknown Geometry type: "+x.type);return b?(this.D.xt(n),!0):!1}$b(t,i,e,s,n){const o=e.x-t,r=e.y-i,l=o*o+r*r;return l<s?(n.x=e.x,n.y=e.y,l):s}Jb(t,i,e,s,n,o,r,l,h){if(Geo.K(t,e)&&Geo.K(i,s)||Geo.K(n,r)&&Geo.K(o,l))return!1;let a=!1;const c=(n-r)*(i-s)-(o-l)*(t-e);if(c===0)return!1;if(h.x=((n*l-o*r)*(t-e)-(n-r)*(t*s-i*e))/c,h.y=((n*l-o*r)*(i-s)-(o-l)*(t*s-i*e))/c,(t>e?t-e:e-t)<(i>s?i-s:s-i)){const f=i<s?i:s,u=i<s?s:i;(h.y>f||Geo.K(h.y,f))&&(h.y<u||Geo.K(h.y,u))&&(a=!0)}else{const f=t<e?t:e,u=t<e?e:t;(h.x>f||Geo.K(h.x,f))&&(h.x<u||Geo.K(h.x,u))&&(a=!0)}return a}kv(t,i,e){return this.pickable===!1?!1:(e.ic(this.D),i?this.Pv(t,e):this.containedInRect(t,e))}containedInRect(t,i){if(i===void 0)return t.containsRect(this.actualBounds);let e=this.ct;e===null&&(this.ut(1/0,1/0),e=this.ct);const s=e.bounds,n=this.strokeWidth/2;let o=!1;const r=Point.l();return r.e(s.x-n,s.y-n),t.containsPoint(i.xt(r))&&(r.e(s.x-n,s.bottom+n),t.containsPoint(i.xt(r))&&(r.e(s.right+n,s.bottom+n),t.containsPoint(i.xt(r))&&(r.e(s.right+n,s.y-n),t.containsPoint(i.xt(r))&&(o=!0)))),Point.s(r),o}intersectsRect(t,i){if(this.containedInRect(t,i)||i===void 0&&(i=this.D,t.containsRect(this.actualBounds)))return!0;const e=Transform.l();e.set(i),e.yw();const s=t.left,n=t.right,o=t.top,r=t.bottom,l=Point.l();if(l.e(s,o),e.xt(l),this.hh(l,!0))return Point.s(l),!0;if(l.e(n,o),e.xt(l),this.hh(l,!0))return Point.s(l),!0;if(l.e(s,r),e.xt(l),this.hh(l,!0))return Point.s(l),!0;if(l.e(n,r),e.xt(l),this.hh(l,!0))return Point.s(l),!0;const h=Point.l(),a=Point.l();e.set(i),e.aC(this.D),e.yw(),h.x=n,h.y=o,h.D(e),l.x=s,l.y=o,l.D(e);let c=!1;return this.Aa(l,h,a)?c=!0:(l.x=n,l.y=r,l.D(e),this.Aa(l,h,a)?c=!0:(h.x=s,h.y=r,h.D(e),this.Aa(l,h,a)?c=!0:(l.x=s,l.y=o,l.D(e),this.Aa(l,h,a)&&(c=!0)))),Point.s(l),Transform.s(e),Point.s(h),Point.s(a),c}Aa(t,i,e){if(!this.getNearestIntersectionPoint(t,i,e))return!1;const s=t.x,n=t.y,o=i.x,r=i.y,l=e.x,h=e.y;if(s===o){let a=0,c=0;return n<r?(a=n,c=r):(a=r,c=n),h>=a&&h<=c}else{let a=0,c=0;return s<o?(a=s,c=o):(a=o,c=s),l>=a&&l<=c}}Pv(t,i){if(this.containedInRect(t,i)||i===void 0&&(i=this.D,t.containsRect(this.actualBounds)))return!0;const e=t.left,s=t.right,n=t.top,o=t.bottom,r=Point.l(),l=Point.l(),h=Point.l(),a=Transform.l();a.set(i),a.aC(this.D),a.yw(),l.x=s,l.y=n,l.D(a),r.x=e,r.y=n,r.D(a);let c=!1;return this.Aa(r,l,h)?c=!0:(r.x=s,r.y=o,r.D(a),this.Aa(r,l,h)?c=!0:(l.x=e,l.y=o,l.D(a),this.Aa(r,l,h)?c=!0:(r.x=e,r.y=n,r.D(a),this.Aa(r,l,h)&&(c=!0)))),Transform.s(a),Point.s(r),Point.s(l),Point.s(h),c}eA(t,i,e){if(e&&this.fill!==null&&this.hh(t,!0))return!0;let s=t.distanceSquaredPoint(i);const n=s;this.strokeWidth>1.5&&(s=this.strokeWidth/2+Math.sqrt(s),s*=s);let o=this.ct;if(o===null&&(this.ut(1/0,1/0),o=this.ct,o===null))return!1;if(!e){const f=o.bounds,u=f.x,d=f.y,m=f.x+f.width,g=f.y+f.height;if(Point.distanceSquared(t.x,t.y,u,d)<=s&&Point.distanceSquared(t.x,t.y,m,d)<=s&&Point.distanceSquared(t.x,t.y,u,g)<=s&&Point.distanceSquared(t.x,t.y,m,g)<=s)return!0}function r(f,u){const d=f.length;for(let m=0;m<d;m+=2)if(u.distanceSquared(f[m],f[m+1])>s)return!0;return!1}const l=o.startX,h=o.startY,a=o.endX,c=o.endY;if(o.type===1){const f=Point.distanceLineSegmentSquared(t.x,t.y,l,h,a,c),u=(a-l)*(t.x-l)+(c-h)*(t.y-h),d=(l-a)*(t.x-a)+(h-c)*(t.y-c),m=u>=0&&d>=0?s:n;return f<=m}else if(o.type===2){let f=!1;return e&&(f=Point.distanceLineSegmentSquared(t.x,t.y,l,h,l,c)<=s||Point.distanceLineSegmentSquared(t.x,t.y,l,h,a,h)<=s||Point.distanceLineSegmentSquared(t.x,t.y,a,h,a,c)<=s||Point.distanceLineSegmentSquared(t.x,t.y,l,c,a,c)<=s),f}else if(o.type===3){const f=(l+a)/2,u=(h+c)/2,d=t.x-f,m=t.y-u,g=Math.abs(a-l)/2,p=Math.abs(c-h)/2;if(g===0||p===0)return Point.distanceLineSegmentSquared(t.x,t.y,l,h,a,c)<=s;if(e){const y=Geo.ID(g,p,d,m);return y*y<=s}else return!(Point.distanceSquared(d,m,-g,0)>=s||Point.distanceSquared(d,m,0,-p)>=s||Point.distanceSquared(d,m,0,p)>=s||Point.distanceSquared(d,m,g,0)>=s)}else if(o.type===4){const f=o.bounds,u=f.x,d=f.y,m=f.x+f.width,g=f.y+f.height;if(t.x>m&&t.x<u&&t.y>g&&t.y<d&&Point.distanceLineSegmentSquared(t.x,t.y,u,d,u,g)>s&&Point.distanceLineSegmentSquared(t.x,t.y,u,d,m,d)>s&&Point.distanceLineSegmentSquared(t.x,t.y,m,g,u,g)>s&&Point.distanceLineSegmentSquared(t.x,t.y,m,g,m,d)>s)return!1;const p=Math.sqrt(s);if(e){if(this.fill===null?o.bC(t.x,t.y,p):o.Vk(t,p,!0,!1))return!0}else{const y=o.figures;for(let x=0;x<y.count;x++){const k=y.r[x];let b=k.startX,P=k.startY;if(t.distanceSquared(b,P)>s)return!1;const M=k.segments.r,L=M.length;for(let C=0;C<L;C++){const S=M[C];switch(S.type){case 1:case 2:if(b=S.endX,P=S.endY,t.distanceSquared(b,P)>s)return!1;break;case 3:{const N=Util.nt();Geo.Un(b,P,S.point1X,S.point1Y,S.point2X,S.point2Y,S.endX,S.endY,.8,N);const T=r(N,t);if(Util.tt(N),T||(b=S.endX,P=S.endY,t.distanceSquared(b,P)>s))return!1;break}case 4:{const N=Util.nt();Geo.zg(b,P,S.point1X,S.point1Y,S.endX,S.endY,.8,N);const T=r(N,t);if(Util.tt(N),T||(b=S.endX,P=S.endY,t.distanceSquared(b,P)>s))return!1;break}case 5:case 6:{const N=S.type===5?S.So(k):S.Eh(k,b,P),T=N.length;if(T===0){if(b=S.type===5?S.centerX:S.endX,P=S.type===5?S.centerY:S.endY,t.distanceSquared(b,P)>s)return!1;break}let A=null;const D=Util.nt();for(let F=0;F<T;F++)if(A=N[F],D.length=0,Geo.Un(A[0],A[1],A[2],A[3],A[4],A[5],A[6],A[7],.8,D),r(D,t))return Util.tt(D),!1;Util.tt(D),A!==null&&(b=A[6],P=A[7]);break}default:Util.o("Unknown Segment type: "+S.type)}}}return!0}}return!1}bv(t,i,e,s,n,o){if(t.width===0)return Geo.Vn(t.x,t.y,t.x,t.y+t.height,i,e,s,n,o);if(t.height===0)return Geo.Vn(t.x,t.y,t.x+t.width,t.y,i,e,s,n,o);{const r=t.width/2,l=t.height/2,h=t.x+r,a=t.y+l;let c=9999;if(i!==s&&(c=(e-n)/(i-s)),Math.abs(c)<9999){const f=e-a-c*(i-h);if(r*r*(c*c)+l*l-f*f<0)return o.x=NaN,o.y=NaN,!1;const u=Math.sqrt(r*r*(c*c)+l*l-f*f),d=(-(r*r*c*f)+r*l*u)/(l*l+r*r*(c*c))+h,m=(-(r*r*c*f)-r*l*u)/(l*l+r*r*(c*c))+h,g=c*(d-h)+f+a,p=c*(m-h)+f+a,y=Math.abs((i-d)*(i-d))+Math.abs((e-g)*(e-g)),x=Math.abs((i-m)*(i-m))+Math.abs((e-p)*(e-p));y<x?(o.x=d,o.y=g):(o.x=m,o.y=p)}else{const f=l*l,u=r*r,d=i-h,m=f-f/u*(d*d);if(m<0)return o.x=NaN,o.y=NaN,!1;const g=Math.sqrt(m),p=a+g,y=a-g,x=Math.abs(p-e),k=Math.abs(y-e);x<k?(o.x=i,o.y=p):(o.x=i,o.y=y)}return!0}}fv(){return this.Go/2*this.strokeMiterLimit*this.getDocumentScale()}get geometry(){return this.ct!==null?this.ct:this.xs}set geometry(t){const i=this.ct,e=this.xs;if(i===t)return;t!==null?(this.ct=t.g(),this.xs=this.ct):(this.ct=null,this.xs=null);const s=this.part;if(s!==null&&s.ff(),this.c(),this.t("geometry",i||e,t),this.$c()){const n=this.part;n!==null&&this.ya(n,"geometryString")}}get geometryString(){return this.geometry===null?"":this.geometry.toString()}set geometryString(t){const i=Geometry.parse(t),e=i.normalize();this.geometry=i;const s=Point.X(-e.x,-e.y);this.position=s,Point.s(s)}get isGeometryPositioned(){return(this.n&1048576)!==0}set isGeometryPositioned(t){const i=(this.n&1048576)!==0;i!==t&&(this.n=this.n^1048576,this.c(),this.t("isGeometryPositioned",i,t))}ee(){this.ct=null}get fill(){return this.Ca}set fill(t){const i=this.Ca;i!==t&&(t!==null&&Brush.od(t,"Shape.fill"),t instanceof Brush&&t.g(),this.Ca=t,this.C(),this.t("fill",i,t))}get stroke(){return this.Hi}set stroke(t){const i=this.Hi;i!==t&&(t!==null&&Brush.od(t,"Shape.stroke"),t instanceof Brush&&t.g(),this.Hi=t,this.C(),this.t("stroke",i,t))}get strokeWidth(){return this.Go}set strokeWidth(t){const i=this.Go;if(i!==t)if(t>=0){this.Go=t,this.c();const e=this.part;e!==null&&e.ff(),this.t("strokeWidth",i,t)}else Util._(t,"value >= 0",Shape,"strokeWidth:value")}x0(){return this.Go}get strokeCap(){return this.Lt!==null?this.Lt.pp:"butt"}set strokeCap(t){const i=this.strokeCap;i!==t&&(typeof t=="string"&&(t==="butt"||t==="round"||t==="square")?(this.La(),this.Lt.pp=t,this.C(),this.t("strokeCap",i,t)):Util._(t,'"butt", "round", or "square"',Shape,"strokeCap"))}get strokeJoin(){return this.Lt!==null?this.Lt.yp:"miter"}set strokeJoin(t){const i=this.strokeJoin;i!==t&&(typeof t=="string"&&(t==="miter"||t==="bevel"||t==="round")?(this.La(),this.Lt.yp=t,this.C(),this.t("strokeJoin",i,t)):Util._(t,'"miter", "bevel", or "round"',Shape,"strokeJoin"))}get strokeMiterLimit(){return this.Lt!==null?this.Lt.wp:10}set strokeMiterLimit(t){const i=this.strokeMiterLimit;if(i!==t&&t>=1){this.La(),this.Lt.wp=t,this.C();const e=this.part;e!==null&&e.ff(),this.t("strokeMiterLimit",i,t)}}get strokeDashArray(){return this.zo}set strokeDashArray(t){const i=this.zo;if(i!==t){if(t!==null&&!Array.isArray(t)&&Util.we(t,"Array",Shape,"strokeDashArray:value"),t!==null){const e=t.length;let s=0;for(let n=0;n<e;n++){const o=t[n];(!(o>=0)||!isFinite(o))&&Util.o("strokeDashArray:value "+o+" at index "+n+" must be a positive number or zero."),s+=o}if(s===0){if(i===null)return;t=null}}this.zo=t,this.C(),this.t("strokeDashArray",i,t)}}get strokeDashOffset(){return this.Lt!==null?this.Lt.dh:0}set strokeDashOffset(t){const i=this.strokeDashOffset;i!==t&&t>=0&&(this.La(),this.Lt.dh=t,this.C(),this.t("strokeDashOffset",i,t))}get figure(){return this.bd}set figure(t){const i=this.bd;if(i!==t){let e=Geo.Mo[t];if(typeof e=="function"?e=t:(e=Geo.Mo[t.toLowerCase()],e||Util.o("Unknown Shape.figure: "+t)),i!==e){const s=this.part;s!==null&&s.ff(),this.bd=e,this.xs=null,this.ee(),this.c(),this.t("figure",i,e)}}}get toArrow(){return this.Bt!==null?this.Bt.xp:"None"}set toArrow(t){const i=this.toArrow;if(t===!0?t="Standard":t===!1&&(t=""),i!==t){const e=Shape.DA(t);e===null?Util.o("Unknown Shape.toArrow: "+t):i!==e&&(this.Bt===null&&(this.Bt=new LinkElementSettings),this.Bt.xp=e,this.xs=null,this.ee(),this.c(),this.FA(e),this.t("toArrow",i,e))}}get fromArrow(){return this.Bt!==null?this.Bt.bp:"None"}set fromArrow(t){const i=this.fromArrow;if(t===!0?t="Standard":t===!1&&(t=""),i!==t){const e=Shape.DA(t);e===null?Util.o("Unknown Shape.fromArrow: "+t):i!==e&&(this.Bt===null&&(this.Bt=new LinkElementSettings),this.Bt.bp=e,this.xs=null,this.ee(),this.c(),this.FA(e),this.t("fromArrow",i,e))}}FA(t){const i=this.diagram;if(i!==null&&i.undoManager.isUndoingRedoing)return;this.OR();const e=Spot.MiddleRight;this.toArrow!=="None"?(this.segmentIndex=-1,this.alignmentFocus=e):this.fromArrow!=="None"&&(this.segmentIndex=0,this.alignmentFocus=new Spot(1-e.x,e.y))}get spot1(){return this.Lt!==null?this.Lt.zn:Spot.Default}set spot1(t){const i=this.spot1;i.equals(t)||(t=t.N(),this.La(),this.Lt.zn=t,this.c(),this.t("spot1",i,t))}get spot2(){return this.Lt!==null?this.Lt.Xn:Spot.Default}set spot2(t){const i=this.spot2;i.equals(t)||(t=t.N(),this.La(),this.Lt.Xn=t,this.c(),this.t("spot2",i,t))}get parameter1(){return this.kd}set parameter1(t){const i=this.kd;i!==t&&(this.kd=t,this.ee(),this.c(),this.t("parameter1",i,t))}get parameter2(){return this.Pd}set parameter2(t){const i=this.Pd;i!==t&&(this.Pd=t,this.ee(),this.c(),this.t("parameter2",i,t))}get naturalBounds(){return this.Xi}tv(){const t=this.desiredSize;if(!t.isReal()&&this.ct!==null){const i=this.ct.bounds;this.Xi.a(i)}else this.Xi.e(0,0,t.width,t.height)}get pathPattern(){return this.Lt!==null?this.Lt.kp:null}set pathPattern(t){const i=this.pathPattern;i!==t&&(this.La(),this.Lt.kp=t,this.C(),this.t("pathPattern",i,t))}get geometryStretch(){return this.Lt!==null?this.Lt.Pp:1}set geometryStretch(t){const i=this.geometryStretch;i!==t&&(this.La(),this.Lt.Pp=t,this.c(),this.t("geometryStretch",i,t))}get interval(){return this.J!==null?this.J.df:1}set interval(t){const i=this.interval;if(t=Math.round(t),i!==t&&t!==0&&isFinite(t)){this.J===null&&(this.J=new GradElementSettings),this.J.df=t;const e=this.diagram;e!==null&&this.panel===e.grid&&e._l(),this.c();const s=this.panel;s!==null&&(s.ns=null),this.t("interval",i,t)}}get graduatedStart(){return this.J!==null?this.J.gf:0}set graduatedStart(t){const i=this.graduatedStart;i!==t&&(t<0?t=0:t>1&&(t=1),this.J===null&&(this.J=new GradElementSettings),this.J.gf=t,this.c(),this.t("graduatedStart",i,t))}get graduatedEnd(){return this.J!==null?this.J.mf:1}set graduatedEnd(t){const i=this.graduatedEnd;i!==t&&(t<0?t=0:t>1&&(t=1),this.J===null&&(this.J=new GradElementSettings),this.J.mf=t,this.c(),this.t("graduatedEnd",i,t))}get graduatedSkip(){return this.J!==null?this.J.pf:null}set graduatedSkip(t){const i=this.graduatedSkip;i!==t&&(t!==null&&Util.i(t,"function",Shape,"graduatedSkip"),this.J===null&&(this.J=new GradElementSettings),this.J.pf=t,this.c(),this.t("graduatedSkip",i,t))}static xv(t,i,e){let n=null;if(t.toArrow!=="None")n=Shape.no[t.toArrow];else if(t.fromArrow!=="None")n=Shape.no[t.fromArrow];else{let o=Geo.Mo[t.figure];typeof o=="string"&&(o=Geo.Mo[o]),o===void 0&&Util.o("Unknown Shape.figure: "+t.figure),n=o(t,i,e),n.sc=i,n.nc=e}if(n===null){const o=Geo.Mo.Rectangle;typeof o=="function"&&(n=o(t,i,e))}return n}static getFigureGenerators(){const t=new GMap;for(const i in Geo.Mo){if(i===i.toLowerCase())continue;const e=Geo.Mo[i];t.set(i,e)}return t.g(),t}static defineFigureGenerator(t,i){Util.i(t,"string",Shape,"defineFigureGenerator:name"),typeof i=="string"||Util.i(i,"function",Shape,"defineFigureGenerator:func");const e=t.toLowerCase(),s=Geo.Mo;s[t]=i,s[e]=t}static getArrowheadGeometries(){const t=new GMap;for(const i in Geo.Gg)if(Shape.no[i]===void 0){const e=Geometry.parse(Geo.Gg[i],!1);Shape.no[i]=e;const s=i.toLowerCase();s!==i&&(Shape.no[s]=i)}for(const i in Shape.no){if(i===i.toLowerCase())continue;const e=Shape.no[i];e instanceof Geometry&&t.set(i,e)}return t.g(),t}static defineArrowheadGeometry(t,i){Util.i(t,"string",Shape,"defineArrowheadGeometry:name");let e=null;typeof i=="string"?(Util.i(i,"string",Shape,"defineArrowheadGeometry:pathstr"),e=Geometry.parse(i,!1)):e=i;const s=t.toLowerCase();(s==="none"||t===s)&&Util.o("Shape.defineArrowheadGeometry name must not be empty or None or all-lower-case: "+t);const n=Shape.no;n[t]=e,n[s]=t}static no=new PropertyCollection;static E2=new PropertyCollection;static DA(t){let i=Shape.no[t];if(i===void 0){const e=t.toLowerCase();if(e==="none")return"None";if(i=Shape.no[e],i===void 0){let s=null;for(const n in Geo.Gg)if(n.toLowerCase()===e){s=n;break}if(s!==null){const n=Geometry.parse(Geo.Gg[s],!1);return Shape.no[s]=n,e!==s&&(Shape.no[e]=s),s}}}return typeof i=="string"?i:i instanceof Geometry?t:null}}class ShapeTemplateSettings{gi;pp;yp;wp;dh;kp;Pp;zn;Xn;constructor(){this.gi=!1,this.pp="butt",this.yp="miter",this.wp=10,this.dh=0,this.kp=null,this.Pp=1,this.zn=Spot.Default,this.Xn=Spot.Default}copy(){const t=new ShapeTemplateSettings;return t.pp=this.pp,t.yp=this.yp,t.wp=this.wp,t.dh=this.dh,t.kp=this.kp,t.Pp=this.Pp,t.zn=this.zn.N(),t.Xn=this.Xn.N(),t}}var Wrap=(w=>(w[w.None=0]="None",w[w.Fit=1]="Fit",w[w.DesiredSize=2]="DesiredSize",w[w.BreakAll=3]="BreakAll",w))(Wrap||{}),TextOverflow=(w=>(w[w.Clip=0]="Clip",w[w.Ellipsis=1]="Ellipsis",w))(TextOverflow||{}),TextFormat=(w=>(w[w.Trim=0]="Trim",w[w.None=1]="None",w))(TextFormat||{});class TextBlock extends GraphObject{hi;Hi;kn;Ce;mi;b0;Sd;J;W;Tl;oo;Pn;Le;Fi;Mn;constructor(t,i){return super(),this.n|=2097152,this.hi="",this.Hi="black",this.kn="13px sans-serif",this.Ce=0,this.mi=0,this.b0=0,this.Sd=null,this.J=null,this.W=null,this.Tl=0,this.oo=null,this.Pn=0,this.Le=null,this.Fi=null,this.Mn=null,typeof t=="string"?this.text=t:t&&Object.assign(this,t),i&&Object.assign(this,i),this}cloneProtected(t){super.cloneProtected(t),t.hi=this.hi,t.Hi=this.Hi,t.kn=this.kn,t.Ce=this.Ce,t.mi=this.mi,t.b0=this.b0,t.Sd=this.Sd,this.J!==null&&(t.J=this.J.copy()),this.W!==null&&(this.W.gi?t.W=this.W:t.W=this.W.copy()),t.Tl=this.Tl,t.oo=this.oo,t.Pn=this.Pn,t.Le=this.Le,t.Fi=this.Fi,t.Mn=this.Mn}Sn(){this.W===null?this.W=new TextBlockTemplateSettings:this.W.gi&&(this.W=this.W.copy())}lh(){super.lh(),this.W!==null&&(this.W.gi=!0)}lv(t){this.n=t.n|2048|4096,this.Jt=t.opacity,this.Ct=t.background,this.ze=t.desiredSize.N(),this.minSize=t.minSize.N(),this.maxSize=t.maxSize.N(),t.bi!==null?this.bi=t.bi.copy():this.bi=null,this.et=t.scale,this.Kt=t.angle,this.stretch=t.stretch,this.$r=t.margin.N(),this.ri=t.alignment.N(),this.Wc=t.alignmentFocus.N(),this.segmentFraction=t.segmentFraction,this.segmentOffset=t.segmentOffset.N(),this.segmentOrientation=t.segmentOrientation,t.oi!==null&&(this.oi=t.oi.copy()),this.shadowVisible=t.shadowVisible,this.hi=t.hi,this.Hi=t.Hi,this.kn=t.kn,this.J!==null&&(this.J=t.J.copy()),t.W!==null&&(t.W.gi?this.W=t.W:this.W=t.W.copy()),this.Tl=t.Tl}ov(t){if(this.hi=t.text||"",this.Kt=t.labelAngle||0,this.Ce=t.lineCount||0,this.Mv(t.lines),t.naturalBounds&&(this.Xi=t.naturalBounds),t.actualBounds){const i=t.actualBounds;this.Xt(i.x,i.y,i.width,i.height)}}li(t){t in Wrap?this.wrap=t:super.li(t)}toString(){return this.hi.length>22?'TextBlock("'+this.hi.substring(0,20)+'"...)':'TextBlock("'+this.hi+'")'}static getEllipsis(){return TextBlock.Mp}static setEllipsis(t){TextBlock.Mp=t,TextBlock.Zb=new PropertyCollection,TextBlock.B2=0}static getBaseline(){return TextBlock.Qb}static setBaseline(t){TextBlock.Qb=t}static Qb=null;static getUnderline(){return TextBlock._b}static setUnderline(t){TextBlock._b=t}static _b=null;static None=0;static WrapFit=1;static WrapDesiredSize=2;static WrapBreakAll=3;static OverflowClip=0;static OverflowEllipsis=1;static FormatTrim=0;static FormatNone=1;c(){super.c()}get font(){return this.kn}set font(t){const i=this.kn;i!==t&&(this.kn=t,this.oo=null,this.c(),this.t("font",i,t))}static isValidFont(t){return root.CSS?root.CSS.supports("font",t):!0}get text(){return this.hi}set text(t){const i=this.hi;t!=null?t=t.toString():t="",i!==t&&(this.hi=t,this.c(),this.t("text",i,t),this.Ke(!0))}get textAlign(){return this.W!==null?this.W.Sp:"start"}set textAlign(t){const i=this.textAlign;i!==t&&(t==="start"||t==="end"||t==="left"||t==="right"||t==="center")&&(this.Sn(),this.W.Sp=t,this.C(),this.t("textAlign",i,t))}get flip(){return this.W!==null?this.W.ro:0}set flip(t){const i=this.flip;i!==t&&(this.Sn(),this.W.ro=t,this.C(),this.t("flip",i,t))}get verticalAlignment(){return this.W!==null?this.W.el:Spot.Top}set verticalAlignment(t){const i=this.verticalAlignment;i.equals(t)||(t=t.N(),this.Sn(),this.W.el=t,this.sf(),this.t("verticalAlignment",i,t))}get naturalBounds(){if(!this.Xi.isReal()){const t=Size.l();this.U2(this.hi,999999,t);let i=t.width;Size.s(t);let e=this.RA(i);const s=this.desiredSize;isNaN(s.width)||(i=s.width),isNaN(s.height)||(e=s.height),this.Xi.En(i,e)}return this.Xi}get isMultiline(){return(this.n&2097152)!==0}set isMultiline(t){const i=(this.n&2097152)!==0;i!==t&&(this.n=this.n^2097152,this.c(),this.t("isMultiline",i,t))}get isUnderline(){return(this.n&4194304)!==0}set isUnderline(t){const i=(this.n&4194304)!==0;i!==t&&(this.n=this.n^4194304,this.Ke(!0),this.C(),this.t("isUnderline",i,t))}get isStrikethrough(){return(this.n&8388608)!==0}set isStrikethrough(t){const i=(this.n&8388608)!==0;i!==t&&(this.n=this.n^8388608,this.Ke(!0),this.C(),this.t("isStrikethrough",i,t))}get wrap(){return this.W!==null?this.W.Np:2}set wrap(t){const i=this.wrap;i!==t&&(this.Sn(),this.W.Np=t,this.c(),this.t("wrap",i,t))}get overflow(){return this.W!==null?this.W.Cp:0}set overflow(t){const i=this.overflow;i!==t&&(this.Sn(),this.W.Cp=t,this.c(),this.t("overflow",i,t))}get isOverflowed(){return(this.n&16777216)!==0}V2(t){t?this.n|=16777216:this.n&=-16777217}get stroke(){return this.Hi}set stroke(t){const i=this.Hi;i!==t&&(t!==null&&Brush.od(t,"TextBlock.stroke"),t instanceof Brush&&t.g(),this.Hi=t,this.C(),this.t("stroke",i,t))}get lineCount(){return this.Ce}get lineHeight(){return this.Lp()}get editable(){return(this.n&1048576)!==0}set editable(t){const i=(this.n&1048576)!==0;i!==t&&(this.n=this.n^1048576,this.t("editable",i,t))}get A2(){return(this.n&33554432)!==0}set A2(t){this.n=this.n^33554432}get textEditor(){return this.W!==null?this.W.Ap:null}set textEditor(t){const i=this.textEditor;i!==t&&(this.Sn(),this.W.Ap=t,this.t("textEditor",i,t))}get errorFunction(){return this.W!==null?this.W.os:null}set errorFunction(t){const i=this.errorFunction;i!==t&&(t!==null&&Util.i(t,"function",TextBlock,"errorFunction"),this.Sn(),this.W.os=t,this.t("errorFunction",i,t))}get interval(){return this.J!==null?this.J.df:1}set interval(t){const i=this.interval;if(t=Math.round(t),i!==t&&t!==0&&isFinite(t)){this.J===null&&(this.J=new GradElementSettings),this.J.df=t,this.c();const e=this.panel;e!==null&&(e.ns=null),this.t("interval",i,t)}}get graduatedStart(){return this.J!==null?this.J.gf:0}set graduatedStart(t){const i=this.graduatedStart;i!==t&&(t<0?t=0:t>1&&(t=1),this.J===null&&(this.J=new GradElementSettings),this.J.gf=t,this.c(),this.t("graduatedStart",i,t))}get graduatedEnd(){return this.J!==null?this.J.mf:1}set graduatedEnd(t){const i=this.graduatedEnd;i!==t&&(t<0?t=0:t>1&&(t=1),this.J===null&&(this.J=new GradElementSettings),this.J.mf=t,this.c(),this.t("graduatedEnd",i,t))}get graduatedFunction(){return this.J!==null?this.J.Tp:null}set graduatedFunction(t){const i=this.graduatedFunction;i!==t&&(t!==null&&Util.i(t,"function",TextBlock,"graduatedFunction"),this.J===null&&(this.J=new GradElementSettings),this.J.Tp=t,this.c(),this.t("graduatedFunction",i,t))}get graduatedSkip(){return this.J!==null?this.J.pf:null}set graduatedSkip(t){const i=this.graduatedSkip;i!==t&&(t!==null&&Util.i(t,"function",TextBlock,"graduatedSkip"),this.J===null&&(this.J=new GradElementSettings),this.J.pf=t,this.c(),this.t("graduatedSkip",i,t))}fh(t,i){if(this.Hi===null||this.hi.length===0||this.kn===null)return;const e=this.naturalBounds,s=this.actualBounds,n=e.width,o=e.height,r=this.Lp();let l=t.textAlign=this.textAlign;const h=i.Ku;l==="start"?l=h?"right":"left":l==="end"&&(l=h?"left":"right");const a=this.isUnderline,c=this.isStrikethrough;this.dn(t,this.Hi,!0,!1,e,s),(a||c)&&this.dn(t,this.Hi,!1,!1,e,s);const f=0;let u=0;const d=n;let m=!1;i.Qt===t&&!(i.Qt instanceof SVGContext)&&!this.A2&&i.getRenderingHint("textGreeking")===!0&&r*this.ca*i.scale<3&&(m=!0);const g=this.spacingAbove,p=this.spacingBelow;switch(this.flip){case 0:break;case 2:t.translate(n,0),t.scale(-1,1);break;case 1:t.translate(0,o),t.scale(1,-1);break;case 3:t.translate(n,o),t.scale(-1,-1);break}t.commitTransform();const y=this.Ce,k=(g+r+p)*y;if(o>k){const b=this.verticalAlignment;u=b.y*o-b.y*k+b.offsetY}if(y===1&&this.Mn!==null){let b=this.mi;b>d&&(b=d),u+=g,this.vA(this.Mn,t,f,u,d,r,b,m,l,a,c)}else if(this.Le!==null&&this.Fi!==null)for(let b=0;b<y;b++){let P=this.Le[b];P>d&&(P=d),u+=g,this.vA(this.Fi[b],t,f,u,d,r,P,m,l,a,c),u+=r+p}switch(this.flip){case 0:break;case 2:t.scale(-1,1),t.translate(-n,0);break;case 1:t.scale(1,-1),t.translate(0,-o);break;case 3:t.scale(-1,-1),t.translate(-n,-o);break}}vA(t,i,e,s,n,o,r,l,h,a,c){let f=0;if(l){h==="left"?f=0:h==="right"?f=n-r:h==="center"&&(f=(n-r)/2);const m=i.globalAlpha;i.globalAlpha=m/2,i.fillRect(e+f,s+o/4,r,o/2),i.globalAlpha=m;return}h==="left"?f=0:h==="right"?f=n:h==="center"&&(f=n/2);const u=TextBlock.Qb!==null?TextBlock.Qb(this,o):o*.75;i.fillText(t,e+f,s+u);let d=o/20|0;if(d===0&&(d=1),h==="right"?f-=r:h==="center"&&(f-=r/2),a){const m=TextBlock._b!==null?TextBlock._b(this,o):o*.8;this.OA(e+f,s+m,e+f+r,s+m,d,i),i instanceof SVGContext&&i.lastCreatedElement.classList.add("gojs-td")}if(c){let m=s+o-o/2.2|0;d%2!==0&&(m+=.5),this.OA(e+f,m,e+f+r,m,d,i),i instanceof SVGContext&&i.lastCreatedElement.classList.add("gojs-td")}}OA(t,i,e,s,n,o){o.beginPath(),o.lineWidth=n,o.moveTo(t,i),o.lineTo(e,s),o.stroke(),o.endPath()}_c(t,i,e){if(!super._c(t,i,e))return!1;if(this.dn(t,this.Hi,!0,!1,this.naturalBounds,this.actualBounds),e){if(this.svg.getElementsByTagName("text").length===0)return!0;const n=this.svg.getElementsByClassName("gojs-td");for(let o=0;o<n.length;o++)t.setFillOrStrokeInPlace(n[o],!1)}else this.Sv(this.svg,this.text,t);return!0}Sv(t,i,e){t.innerHTML=i,e.setFillOrStrokeInPlace(t,!0)}ed(t){return this.lineCount>1||this.isUnderline||this.isStrikethrough?!0:super.ed(t)}h2(t,i){if(t.nodeName!=="g")t.setAttributeNS(null,"filter",i);else{const e=t.getElementsByTagName("text");for(let s=0;s<e.length;s++)e[s].setAttributeNS(null,"filter",i)}}Nv(){this.Pn=0,this.mi=0,this.oo=null,this.Le=null,this.Fi=null,this.Mn=null}_u(t,i,e,s){const n=this.Ce;this.Tl=t,this.V2(!1);const o=this.kn;TextBlock.tl!==null&&TextBlock.IA!==o&&(TextBlock.tl.font=o,TextBlock.IA=o),this.Nv();let r=0,l=0;isNaN(this.desiredSize.width)?(r=this.Cv(),r=Math.min(r,t/this.scale)):r=this.desiredSize.width,this.panel!==null&&(r=Math.min(r,this.panel.maxSize.width)),l=this.RA(r),isNaN(this.desiredSize.height)?l=Math.min(l,i/this.scale):l=this.desiredSize.height,this.Lv(t,l),(this.wrap===1||isNaN(this.desiredSize.width))&&(r=isNaN(t)?this.mi:Math.min(t,this.mi)),r=Math.max(e,r),l=Math.max(s,l),this.Xi.En(r,l),this.Qn(0,0,r,l),this.svg!==null&&n!==this.Ce&&this.Ke(!0)}ah(t,i,e,s){this.commonArrange(t,i,e,s)}Nn(t,i){this.Mn===null?(this.Mn=t,this.mi=i):((this.Fi===null||this.Le===null)&&(this.Fi=[],this.Le=[],this.Fi.push(this.Mn),this.Le.push(this.mi)),this.Fi.push(t),this.Le.push(i),this.Fi.length>this.maxLines&&(this.n|=16777216))}U2(t,i,e){const s=this.formatting===0;s&&(t=t.trim());let n=0,o=0,r=0;const l=this.kn,h=this.spacingAbove+this.spacingBelow,a=Math.max(0,this.Lp()+h),c=this.overflow===1?this.EA(l):0;if(this.Ce>=this.maxLines){e!==null&&e.e(0,a);return}let f=t;if(this.wrap===0){if(this.Pn=1,o=this.getStringWidth(t),c===0||o<=i){this.mi=Math.max(this.mi,o),this.Nn(t,this.mi),e!==null&&e.e(o,a);return}let d=this.Nd(f);f=f.substring(d.length);let m=this.Nd(f);for(o=this.getStringWidth(d+m),r=0;m.length>0&&o<=i;){d+=m,f=f.substring(m.length),m=this.Nd(f),r=o;let g=d+m;s&&(g=g.trim()),o=this.getStringWidth(g)}for(s&&(m=m.trim()),d+=m,i=Math.max(1,i-c);this.getStringWidth(d)>i&&d.length>1;)d=d.substring(0,d.length-1);this.V2(!0),d+=TextBlock.Mp,r=this.getStringWidth(d),this.mi=r,this.Nn(d,r),e!==null&&e.e(r,a);return}let u=0;for(f.length===0&&(u=1,this.Nn(f,0));f.length>0;){let d=this.Nd(f);for(f=f.substring(d.length);this.getStringWidth(d)>i;){let p=1;for(o=this.getStringWidth(d.substring(0,p)),r=0;o<=i;)p++,r=o,o=this.getStringWidth(d.substring(0,p));let y=0;p===1?(y=o,n=Math.max(n,o)):(y=r,n=Math.max(n,r)),p--,p<1&&(p=1);const x=d.substring(0,p);if(this.Nn(x,y),u++,d=d.substring(p),this.Ce+u>this.maxLines)break}let m=this.Nd(f);for(o=this.getStringWidth(d+m),r=0;m.length>0&&o<=i;){d+=m,f=f.substring(m.length),m=this.Nd(f),r=o;let p=d+m;s&&(p=p.trim()),o=this.getStringWidth(p)}if(s&&(d=d.trim()),d==="")continue;d[d.length-1]==="\xAD"&&(d=d.substring(0,d.length-1)+"\u2010");let g=0;if(m.length===0?(g=o,n=Math.max(n,o)):(r=this.getStringWidth(d),g=r,n=Math.max(n,r)),this.Nn(d,g),u++,this.Ce+u>this.maxLines)break}this.Pn=Math.min(this.maxLines,u),this.mi=Math.max(this.mi,n),e!==null&&e.e(this.mi,a*this.Pn)}Lv(t,i){if(this.mi===0||this.Le===null||this.Fi===null||this.overflow!==1)return;const e=this.kn,s=this.overflow===1?this.EA(e):0,n=this.spacingAbove+this.spacingBelow,o=Math.max(0,this.Lp()+n),r=Math.min(this.maxLines-1,Math.max(Math.floor(i/o+.01)-1,0));if(r+1>=this.Fi.length)return;this.V2(!0);let l=this.Fi[r];const h=Math.max(1,t-s);for(;this.getStringWidth(l)>h&&l.length>1;)l=l.substring(0,l.length-1);l+=TextBlock.Mp;const a=this.getStringWidth(l);this.Fi[r]=l,this.Fi=this.Fi.slice(0,r+1),this.Le[r]=a,this.Le=this.Le.slice(0,r+1),this.Pn=this.Fi.length,this.mi=Math.max(this.mi,a),this.Ce=this.Pn,this.Ce===1&&(this.Mn=this.Fi[0])}Nd(t){if(this.wrap===3)return t.substring(0,1);let i=t.length,e=0;const s=TextBlock.Av;for(;e<i&&!s.test(t.charAt(e));)e++;for(this.formatting===1&&(i=Math.min(i,e+1));e<i&&s.test(t.charAt(e));)e++;return e>=t.length?t:t.substring(0,e)}getStringWidth(t){return TextBlock.tl===null?t.length*8:TextBlock.tl.measureText(t).width}Lp(){if(this.oo!==null)return this.oo;const t=this.kn;let i=0;return TextBlock.tl===null?(i=16,this.oo=i,i):(TextBlock.z2[t]!==void 0&&TextBlock.BA<5e3?i=TextBlock.z2[t]:(i=TextBlock.tl.measureText("M").width*1.3,TextBlock.z2[t]=i,TextBlock.BA++),this.oo=i,i)}EA(t){if(TextBlock.tl===null)return 6;let i=0;return TextBlock.Zb[t]!==void 0&&TextBlock.B2<5e3?i=TextBlock.Zb[t]:(i=TextBlock.tl.measureText(TextBlock.Mp).width,TextBlock.Zb[t]=i,TextBlock.B2++),i}t1(t,i){return t.indexOf(`
`,i)}RA(t){let i=this.hi.replace(/\r\n/g,`
`).replace(/\r/g,`
`);const e=this.spacingAbove+this.spacingBelow,s=Math.max(0,this.Lp()+e);if(i.length===0)return this.mi=0,this.Ce=1,s;if(!this.isMultiline){const h=this.t1(i,0);h>=0&&(i=i.substring(0,h))}let n=0;this.Ce=0;let o=0,r=-1,l=!1;for(;!l;){if(r=this.t1(i,o),r===-1&&(r=i.length,l=!0),o<=r){const h=i.substring(o,r);if(this.wrap!==0){this.Pn=0;const a=Size.l();this.U2(h,t,a),n+=a.height,Size.s(a),this.Ce+=this.Pn}else this.U2(h,t,null),n+=s,this.Ce++;this.Ce===this.maxLines&&(l=!0)}o=r+1}return this.b0=n,n}Cv(){let t=this.hi.replace(/\r\n/g,`
`).replace(/\r/g,`
`);if(t.length===0)return 8;if(this.isMultiline){let i=0,e=0,s=!1;for(;!s;){let n=this.t1(t,e);n===-1&&(n=t.length,s=!0);let o=t.substring(e,n);this.formatting===0&&(o=o.trim()),i=Math.max(i,this.getStringWidth(o)),e=n+1}return i}else{const i=this.t1(t,0);return i>=0&&(t=t.substring(0,i)),this.getStringWidth(t)}}get textValidation(){return this.W!==null?this.W.Al:null}set textValidation(t){const i=this.textValidation;i!==t&&(t!==null&&Util.i(t,"function",TextBlock,"textValidation"),this.Sn(),this.W.Al=t,this.t("textValidation",i,t))}get textEdited(){return this.W!==null?this.W.Dp:null}set textEdited(t){const i=this.textEdited;i!==t&&(t!==null&&Util.i(t,"function",TextBlock,"textEdited"),this.Sn(),this.W.Dp=t,this.t("textEdited",i,t))}get spacingAbove(){return this.W!==null?this.W.Fp:0}set spacingAbove(t){const i=this.spacingAbove;i!==t&&(this.Sn(),this.W.Fp=t,this.c(),this.t("spacingAbove",i,t))}get spacingBelow(){return this.W!==null?this.W.Rp:0}set spacingBelow(t){const i=this.spacingBelow;i!==t&&(this.Sn(),this.W.Rp=t,this.c(),this.t("spacingBelow",i,t))}get formatting(){return this.W!==null?this.W.vp:0}set formatting(t){const i=this.formatting;i!==t&&(this.Sn(),this.W.vp=t,this.c(),this.t("formatting",i,t))}get maxLines(){return this.W!==null?this.W.Op:1/0}set maxLines(t){const i=this.maxLines;i!==t&&(t=Math.floor(t),t<=0&&Util._(t,"> 0",TextBlock,"maxLines"),this.Sn(),this.W.Op=t,this.c(),this.t("maxLines",i,t))}getMetrics(){return[this.mi,this.Tl,this.oo,this.Pn,this.Le,this.Fi,this.Mn]}Mv(t){t!==void 0&&(this.mi=t[0],this.Tl=t[1],this.oo=t[2],this.Pn=t[3],this.Le=t[4],this.Fi=t[5],this.Mn=t[6])}get metrics(){return{arrSize:this.Le!==null?this.Le:[this.mi],arrText:this.Fi!==null?this.Fi:[this.Mn],maxLineWidth:this.mi,fontHeight:this.oo}}get choices(){return this.Sd}set choices(t){const i=this.Sd;i!==t&&(this.Sd=t,this.t("choices",i,t))}static Av=new RegExp("[ \u200B\xAD]");static z2=new PropertyCollection;static BA=0;static Zb=new PropertyCollection;static B2=0;static Mp="...";static IA="";static tl=Diagram.isUsingDOM()?new CanvasSurface(null).ai:null}class TextBlockTemplateSettings{gi;os;ro;vp;Op;Cp;Fp;Rp;Sp;Dp;Ap;Al;el;Np;constructor(){this.gi=!1,this.os=null,this.ro=0,this.vp=0,this.Op=1/0,this.Cp=0,this.Fp=0,this.Rp=0,this.Sp="start",this.Dp=null,this.Ap=null,this.Al=null,this.el=Spot.Top,this.Np=2}copy(){const t=new TextBlockTemplateSettings;return t.os=this.os,t.ro=this.ro,t.vp=this.vp,t.Op=this.Op,t.Cp=this.Cp,t.Fp=this.Fp,t.Rp=this.Rp,t.Sp=this.Sp,t.Dp=this.Dp,t.Ap=this.Ap,t.Al=this.Al,t.el=this.el,t.Np=this.Np,t}}class GradElementSettings{df;gf;mf;Tp;pf;constructor(){this.df=1,this.gf=0,this.mf=1,this.Tp=null,this.pf=null}copy(){const t=new GradElementSettings;return t.df=this.df,t.gf=this.gf,t.mf=this.mf,t.Tp=this.Tp,t.pf=this.pf,t}}var ImageStretch=(w=>(w[w.None=0]="None",w[w.Fill=2]="Fill",w[w.Uniform=6]="Uniform",w[w.UniformToFill=7]="UniformToFill",w))(ImageStretch||{});class Picture extends GraphObject{sl;yt;nl;yf;os;ol;wf;ro;xf;bf;Ib;constructor(t,i){super(),this.n|=2097152,this.sl=null,this.yt="",this.nl=Rect.DD,this.yf=2,this.os=null,this.ol=null,this.wf=Spot.Center,this.ro=0,this.xf=null,this.bf=null,this.Ib=null,typeof t=="string"?this.source=t:t&&Object.assign(this,t),i&&Object.assign(this,i)}cloneProtected(t){super.cloneProtected(t),t.yt=this.yt,t.element=this.sl,t.nl=this.nl.N(),t.yf=this.yf,t.ro=this.ro,t.os=this.os,t.ol=this.ol,t.wf=this.wf.N(),t.bf=this.bf}li(t){t in ImageStretch?this.imageStretch=t:super.li(t)}toString(){return"Picture("+this.source+")#"+GSet.as(this)}get kf(){return(this.n&1048576)!==0}set kf(t){this.kf!==t&&(this.n=this.n^1048576)}get Ip(){return(this.n&2097152)!==0}set Ip(t){this.Ip!==t&&(this.n=this.n^2097152)}get mn(){return(this.n&4194304)!==0}set mn(t){this.mn!==t&&(this.n=this.n^4194304)}static clearCache(t){t===void 0&&(t=""),Util.i(t,"string",Picture,"clearCache:url"),t!==""?Picture.Ep[t]&&(delete Picture.Ep[t],Picture.i1--):(Picture.Ep=new PropertyCollection,Picture.i1=0)}static BL(t,i){i.UA||(i.e1=e=>{Picture.Tv(i,e),t.desiredSize.isReal()||(t.ue(!1),t.c())},i.s1=e=>Picture.Dv(i,e),i.addEventListener("load",i.e1),i.addEventListener("error",i.s1),i.UA=!0)}static yR(t){t.e1&&t.removeEventListener("load",t.e1),t.s1&&t.removeEventListener("error",t.s1),delete t.e1,delete t.s1,delete t.UA}get element(){return this.sl}set element(t){const i=this.sl;if(this.Ke(!0),i!==t){this.kf=t instanceof HTMLCanvasElement;const e=t instanceof HTMLImageElement;t!==null&&!(e||t instanceof HTMLVideoElement||this.kf)&&Util.o("Picture.element must be an instance of Image, Canvas, or Video, not: "+t);const s=this.diagram;s!==null&&s.FS(this),this.sl=t,t!==null&&e&&t.ss===void 0&&(t.ss=new GSet),s!==null&&e&&s.DS(this),this.t("element",i,t),this.C()}}mR(){const t=this.sl;if(t===null)return;const i=this.desiredSize.isReal();(this.kf||t.complete===!0)&&(t.f0&&(t.Bp instanceof Event&&this.os!==null?this.os(this,t.Bp):t.mn===!0&&!t.Bp&&this.ol!==null&&t.X2&&this.ol(this,t.X2)),t.mn=!0),t.mn&&i&&this.diagram!==null&&this.diagram.Xu.add(this)}Fv(){if(this.sl===null){this.xf=!1;return}const t=new CanvasSurface(null).ai;try{t.drawImage(this.sl,0,0)}catch{this.Ip=!1}try{t.getImageData(0,0,1,1).data[3]&&(this.xf=!1),this.xf=!1}catch{this.xf=!0}}get source(){return this.yt}set source(t){const i=this.yt;if(i!==t){this.Ke(!0),Util.i(t,"string",Picture,"source"),this.yt=t;let e=Picture.Ep;if(!Diagram.isUsingDOM()){this.t("source",i,t);return}let s=null;if(e[t]!==void 0)s=e[t];else if(t!==""){Picture.i1>30&&(Picture.clearCache(),e=Picture.Ep),s=Util.en("img"),s.f0=!0,Picture.BL(this,s);const n=this.bf;n!==null&&(s.crossOrigin=n(this)),s.src=t,e[t]=s,Picture.i1++}this.element=s,s!==null&&s.__goCache===void 0&&(s.__goCache=new PictureCacheArray),this.c(),this.C(),this.t("source",i,t)}}static Tv(t,i){t.mn=!0,t.Bp=!1;let e;const s=t.ss.copy();if(s==null)return;const n=s.iterator;for(;n.next();){const o=n.value;o.C();const r=t.getAttribute("src")||"",l=o.Wl.get(r);if(l===null)continue;const h=l.length;for(let a=0;a<h;a++)e=l[a],e.desiredSize.isReal()||o.Xu.add(e),e.Ke(!0),o.requestUpdate(),t.f0&&(t.X2===void 0&&(t.X2=i),e.ol!==null&&e.ol(e,i))}t.ss.clear()}static Dv(t,i){t.Bp=i;let e;const s=t.ss.copy();if(s==null)return;const n=s.iterator;for(;n.next();){const o=n.value,r=t.getAttribute("src")||"",l=o.Wl.get(r);if(l===null)continue;const h=l.length,a=Util.nt();for(let c=0;c<h;c++)a.push(l[c]);if(t.f0)for(let c=0;c<h;c++)e=a[c],e.os!==null&&e.os(e,i);Util.tt(a)}t.ss.clear()}reloadSource(){if(this.source==="")return;Picture.clearCache(this.source);const t=this.source;this.source="",this.source=t}redraw(){this.C(),this.Ke(!0)}get sourceCrossOrigin(){return this.bf}set sourceCrossOrigin(t){if(this.bf!==t&&(t!==null&&Util.i(t,"function",Picture,"sourceCrossOrigin"),this.bf=t,this.element!==null)){const e=this.element.getAttribute("src");t===null&&typeof e=="string"?this.element.crossOrigin=null:t!==null&&(this.element.crossOrigin=t(this)),this.element.src=e}}get sourceRect(){return this.nl}set sourceRect(t){const i=this.nl;i.equals(t)||(t=t.N(),this.nl=t,this.C(),this.t("sourceRect",i,t))}get imageStretch(){return this.yf}set imageStretch(t){const i=this.yf;i!==t&&(this.yf=t,this.C(),this.t("imageStretch",i,t))}get flip(){return this.ro}set flip(t){const i=this.ro;i!==t&&(this.ro=t,this.C(),this.t("flip",i,t))}get imageAlignment(){return this.wf}set imageAlignment(t){const i=this.wf;i.equals(t)||(t=t.N(),this.wf=t,this.C(),this.t("imageAlignment",i,t))}get errorFunction(){return this.os}set errorFunction(t){const i=this.os;i!==t&&(t!==null&&Util.i(t,"function",Picture,"errorFunction"),this.os=t,this.t("errorFunction",i,t))}get successFunction(){return this.ol}set successFunction(t){const i=this.ol;i!==t&&(t!==null&&Util.i(t,"function",Picture,"successFunction"),this.ol=t,this.t("successFunction",i,t))}fh(t,i){const e=this.sl;if(e===null)return;const s=e.getAttribute("src");if(e instanceof HTMLImageElement&&(s===null||s==="")||e.Bp instanceof Event&&t instanceof CanvasSurfaceContext)return;const n=t instanceof SVGContext,o=this.naturalBounds;let r=0,l=0;const h=this.kf;let a=h?+e.width:e.naturalWidth,c=h?+e.height:e.naturalHeight;if(a===void 0&&e.videoWidth&&(a=e.videoWidth),c===void 0&&e.videoHeight&&(c=e.videoHeight),a===0||c===0)return;const f=a,u=c;this.sourceRect.isReal()&&(r=this.nl.x,l=this.nl.y,a=this.nl.width,c=this.nl.height);let d=a,m=c;const g=this.yf,p=this.wf;switch(g){case 0:if(this.sourceRect.isReal())break;d>=o.width&&(r=r+p.offsetX+(d*p.x-o.width*p.x)),m>=o.height&&(l=l+p.offsetY+(m*p.y-o.height*p.y)),a=Math.min(o.width,d),c=Math.min(o.height,m);break;case 2:d=o.width,m=o.height;break;case 6:case 7:let A=0;g===6?(A=Math.min(o.height/m,o.width/d),d*=A,m*=A):g===7&&(A=Math.max(o.height/m,o.width/d),d*=A,m*=A,d>=o.width&&(r=(r+p.offsetX+(d*p.x-o.width*p.x)/d)*a),m>=o.height&&(l=(l+p.offsetY+(m*p.y-o.height*p.y)/m)*c),a*=1/(d/o.width),c*=1/(m/o.height),d=o.width,m=o.height);break}const y=a*c,x=this.getDocumentScale()*i.scale,k=d*x,b=m*x,P=k*b,M=y/P,L=e.__goCache;let C=null;const S=Picture.Rv;if(!n){if(e.mn&&L!==void 0&&P>4&&M>S*S){L.Ot===null&&(L.VA(4,f,u,e),L.VA(16,f,u,e));const A=L.Ot,D=A.length;for(let F=0;F<D&&A[F].Cd*A[F].Cd<M;F++)C=A[F]}if(!i.zu&&(this.xf===null&&this.Fv(),this.xf))return}const N=d<o.width?p.offsetX+(o.width*p.x-d*p.x):0,T=m<o.height?p.offsetY+(o.height*p.y-m*p.y):0;switch(this.flip){case 0:break;case 2:t.translate(Math.min(o.width,d),0),t.scale(-1,1);break;case 1:t.translate(0,Math.min(o.height,m)),t.scale(1,-1);break;case 3:t.translate(Math.min(o.width,d),Math.min(o.height,m)),t.scale(-1,-1);break}if(t.commitTransform(),i.getRenderingHint("pictureRatioOptimization")&&!i.Qh&&L!==void 0&&C!==null&&C.Cd!==1){t.save();const A=C.Cd;try{t.drawImage(C.yt,r/A,l/A,Math.min(C.yt.width,a/A),Math.min(C.yt.height,c/A),N,T,Math.min(o.width,d),Math.min(o.height,m)),t instanceof SVGContext&&(this.Ib=[r/A,l/A,Math.min(C.yt.width,a/A),Math.min(C.yt.height,c/A),N,T,Math.min(o.width,d),Math.min(o.height,m)])}catch{this.Ip=!1}t.restore()}else try{t.drawImage(e,r,l,a,c,N,T,Math.min(o.width,d),Math.min(o.height,m)),t instanceof SVGContext&&(this.Ib=[r,l,a,c,N,T,Math.min(o.width,d),Math.min(o.height,m)])}catch{this.Ip=!1}switch(this.flip){case 0:break;case 2:t.scale(-1,1),t.translate(-Math.min(o.width,d),0);break;case 1:t.scale(1,-1),t.translate(0,-Math.min(o.height,m));break;case 3:t.scale(-1,-1),t.translate(-Math.min(o.width,d),-Math.min(o.height,m));break}}get naturalBounds(){return this.Xi}_u(t,i,e,s){const n=this.desiredSize,o=this.zs(!0),r=this.sl,l=this.kf;let h=0,a=0;(l||!this.mn&&r&&r.complete)&&(this.mn=!0),r===null?(isFinite(n.width)||(t=e),isFinite(n.height)||(i=s)):(h=l?+r.width:r.naturalWidth,a=l?+r.height:r.naturalHeight),!isFinite(n.width)&&o!==2&&o!==5?r!==null&&this.mn!==!1&&(this.sourceRect.isReal()?t=this.sourceRect.width:t=h):(isFinite(t)||(this.sourceRect.isReal()?t=this.sourceRect.width:r!==null&&(t=h)),e=0),!isFinite(n.height)&&o!==2&&o!==4?r!==null&&this.mn!==!1&&(this.sourceRect.isReal()?i=this.sourceRect.height:i=a):(isFinite(i)||(this.sourceRect.isReal()?i=this.sourceRect.height:r!==null&&(i=a)),s=0),isFinite(n.width)&&(t=n.width),isFinite(n.height)&&(i=n.height);const c=this.maxSize,f=this.minSize;e=Math.max(e||0,f.width),s=Math.max(s||0,f.height),t=Math.min(c.width,t),i=Math.min(c.height,i),t=Math.max(e,t),i=Math.max(s,i),r!==null&&!r.complete&&(isFinite(t)||(t=0),isFinite(i)||(i=0)),this.Xi.En(t,i),this.Qn(0,0,t,i)}ah(t,i,e,s){this.commonArrange(t,i,e,s)}static Ep=new PropertyCollection;static i1=0;static Rv=4}class PictureCacheArray{Ot;constructor(){this.Ot=null}VA(t,i,e,s){this.Ot===null&&(this.Ot=[]);const n=new CanvasSurface(null),o=n.ai,r=1/t;if(n.width=i/t,n.height=e/t,n.width===0||n.height===0)return;const l=new PictureCacheInstance(n.Ft,t);let h=s,a=1;if(this.Ot.length>0){const c=this.Ot[this.Ot.length-1];h=c.yt,a=c.Cd}o.setTransform(r*a,0,0,r*a,0,0),o.commitTransform(),o.drawImage(h,0,0),this.Ot.push(l)}}class PictureCacheInstance{yt;Cd;constructor(t,i){this.yt=t,this.Cd=i}}class GeoStream{Pi;Jg;constructor(){this.Jg=new Geometry,this.Pi=null}vi(t){t!==null?(t.ot(),this.Jg=t,t.figures.clear()):this.Jg=new Geometry,this.Pi=null}fu(t,i,e,s,n,o){if(s!==void 0&&s===!0){const r=new PathSegment(1);r.endX=t,r.endY=i,this.Pi.segments.add(r)}else this.Pi=new PathFigure,this.Pi.startX=t,this.Pi.startY=i,this.Pi.isFilled=e,this.Pi.isEvenOdd=o||!1,this.Jg.figures.add(this.Pi);n!==void 0&&(this.Pi.isShadowed=n)}zD(){const t=this.Pi.segments.length;t>0&&this.Pi.segments.elt(t-1).close()}XD(){this.Pi.segments.length>0&&(this.Pi.isFilled=!0)}KD(t){this.Pi.isShadowed=t}mE(t){this.Pi.isEvenOdd=t}BD(t,i,e){e===void 0&&(e=!1);const s=new PathSegment(1);s.endX=t,s.endY=i,e&&s.close(),this.Pi.segments.add(s)}fr(t,i,e){e===void 0&&(e=!1);const s=new PathSegment(2);s.endX=t,s.endY=i,e&&s.close(),this.Pi.segments.add(s)}ur(t,i,e,s,n,o,r){r===void 0&&(r=!1);const l=new PathSegment(3);l.point1X=t,l.point1Y=i,l.point2X=e,l.point2Y=s,l.endX=n,l.endY=o,r&&l.close(),this.Pi.segments.add(l)}Mw(t,i,e,s,n){n===void 0&&(n=!1);const o=new PathSegment(4);o.point1X=t,o.point1Y=i,o.endX=e,o.endY=s,n&&o.close(),this.Pi.segments.add(o)}UD(t,i,e,s,n,o,r){o===void 0&&(o=0),r===void 0&&(r=!1);const l=new PathSegment(5);l.startAngle=t,l.sweepAngle=i,l.centerX=e,l.centerY=s,l.radiusX=n,o!==0?l.radiusY=o:l.radiusY=n,r&&l.close(),this.Pi.segments.add(l)}VD(t,i,e,s,n,o,r,l){l===void 0&&(l=!1);const h=new PathSegment(6,o,r,t,i,e,s,n);l&&h.close(),this.Pi.segments.add(h)}static K2=null;static pC(t){const i=GeoStream.K2;if(i!==null)return GeoStream.K2=null,i.vi(t),i;{const e=new GeoStream;return e.vi(t),e}}static yC(t){GeoStream.K2=t}}{const w=function(n,o){const r=n.toLowerCase(),l=Geo.Mo;l[n]=o,l[r]=n};w("Rectangle",(n,o,r)=>{const l="r"+o+","+r;let h=Geo.ar[l];return h!==void 0||(h=new Geometry(2),h.endX=o,h.endY=r,Geo.cr<Geo.jg&&(Geo.ar[l]=h,Geo.cr++)),h}),w("Square",(n,o,r)=>{const l="s"+o+","+r;let h=Geo.ar[l];return h!==void 0||(h=new Geometry(2),h.endX=o,h.endY=r,h.defaultStretch=6,Geo.cr<Geo.jg&&(Geo.ar[l]=h,Geo.cr++)),h});const t=(n,o,r,l,h)=>{(isNaN(l)||l<0)&&(l=5),isNaN(h)&&(h=15);const a="rr"+o+","+r+","+l+","+h;let c=Geo.ar[a];if(c!==void 0)return c;let f=l;(h&1)===1?(f=Math.min(f,(h&2)===2?o/3:o),f=Math.min(f,(h&8)===8?r/3:r)):f=0;const u=new PathFigure(f,0,!0);c=new Geometry().add(u);const d=Spot.TopLeft.copy(),m=Spot.BottomRight.copy();if((h&2)===2){let g=l;g=Math.min(g,(h&1)===1?o/3:o),g=Math.min(g,(h&4)===4?r/3:r);const p=g*Geo.Bn;u.add(new PathSegment(2,o-g,0)).add(new PathSegment(3,o,g,o-p,0,o,p)),d.offsetY=p,m.offsetX=-p}else u.add(new PathSegment(2,o,0));if((h&4)===4){let g=l;g=Math.min(g,(h&8)===8?o/3:o),g=Math.min(g,(h&2)===2?r/3:r);const p=g*Geo.Bn;u.add(new PathSegment(2,o,r-g)).add(new PathSegment(3,o-g,r,o,r-p,o-p,r)),m.offsetX=-p,m.offsetY=-p}else u.add(new PathSegment(2,o,r));if((h&8)===8){let g=l;g=Math.min(g,(h&4)===4?o/3:o),g=Math.min(g,(h&1)===1?r/3:r);const p=g*Geo.Bn;u.add(new PathSegment(2,g,r)).add(new PathSegment(3,0,r-g,p,r,0,r-p)),d.offsetX=p,m.offsetY=-p}else u.add(new PathSegment(2,0,r));if((h&1)===1){const g=f*Geo.Bn;u.add(new PathSegment(2,0,f)).add(new PathSegment(3,f,0,0,g,g,0).close()),d.offsetX=g,d.offsetY=g}else u.add(new PathSegment(2,0,0).close());return c.spot1=d,c.spot2=m,Geo.cr<Geo.jg&&(Geo.ar[a]=c,Geo.cr++),c};w("RoundedRectangle",(n,o,r)=>{const l=n?n.parameter1:NaN,h=n?n.parameter2:NaN;return t(n,o,r,l,h)}),w("Border","RoundedRectangle"),w("RoundedTopRectangle",(n,o,r)=>{const l=n?n.parameter1:NaN;return t(n,o,r,l,3)}),w("RoundedBottomRectangle",(n,o,r)=>{const l=n?n.parameter1:NaN;return t(n,o,r,l,12)}),w("RoundedLeftRectangle",(n,o,r)=>{const l=n?n.parameter1:NaN;return t(n,o,r,l,9)}),w("RoundedRightRectangle",(n,o,r)=>{const l=n?n.parameter1:NaN;return t(n,o,r,l,6)}),w("Ellipse",(n,o,r)=>{const l="e"+o+","+r;let h=Geo.ar[l];return h!==void 0||(h=new Geometry(3),h.endX=o,h.endY=r,h.spot1=Spot.Rk,h.spot2=Spot.vk,Geo.cr<Geo.jg&&(Geo.ar[l]=h,Geo.cr++)),h}),w("Circle",(n,o,r)=>{const l="c"+o+","+r;let h=Geo.ar[l];return h!==void 0||(h=new Geometry(3),h.endX=o,h.endY=r,h.spot1=Spot.Rk,h.spot2=Spot.vk,h.defaultStretch=6,Geo.cr<Geo.jg&&(Geo.ar[l]=h,Geo.cr++)),h}),w("TriangleRight",(n,o,r)=>new Geometry().add(new PathFigure(0,0).add(new PathSegment(2,o,.5*r)).add(new PathSegment(2,0,r).close())).setSpots(0,.25,.5,.75)),w("TriangleDown",(n,o,r)=>new Geometry().add(new PathFigure(0,0).add(new PathSegment(2,o,0)).add(new PathSegment(2,.5*o,r).close())).setSpots(.25,0,.75,.5)),w("TriangleLeft",(n,o,r)=>new Geometry().add(new PathFigure(o,r).add(new PathSegment(2,0,.5*r)).add(new PathSegment(2,o,0).close())).setSpots(.5,.25,1,.75)),w("TriangleUp",(n,o,r)=>new Geometry().add(new PathFigure(o,r).add(new PathSegment(2,0,r)).add(new PathSegment(2,.5*o,0).close())).setSpots(.25,.5,.75,1)),w("Triangle","TriangleUp"),w("Diamond",(n,o,r)=>new Geometry().add(new PathFigure(.5*o,0).add(new PathSegment(2,0,.5*r)).add(new PathSegment(2,.5*o,r)).add(new PathSegment(2,o,.5*r).close())).setSpots(.25,.25,.75,.75)),w("LineH",(n,o,r)=>{const l=new Geometry(1);return l.startX=0,l.startY=r/2,l.endX=o,l.endY=r/2,l}),w("LineV",(n,o,r)=>{const l=new Geometry(1);return l.startX=o/2,l.startY=0,l.endX=o/2,l.endY=r,l}),w("None","Rectangle"),w("BarH","Rectangle"),w("BarV","Rectangle"),w("MinusLine","LineH"),w("PlusLine",(n,o,r)=>new Geometry().add(new PathFigure(0,r/2,!1).add(new PathSegment(2,o,r/2)).add(new PathSegment(1,o/2,0)).add(new PathSegment(2,o/2,r)))),w("XLine",(n,o,r)=>new Geometry().add(new PathFigure(0,r,!1).add(new PathSegment(2,o,0)).add(new PathSegment(1,0,0)).add(new PathSegment(2,o,r)))),w("LineRight",(n,o,r)=>new Geometry().add(new PathFigure(.25*o,0,!1).add(new PathSegment(2,.75*o,.5*r)).add(new PathSegment(2,.25*o,r)))),w("LineDown",(n,o,r)=>new Geometry().add(new PathFigure(0,.25*r,!1).add(new PathSegment(2,.5*o,.75*r)).add(new PathSegment(2,o,.25*r)))),w("LineLeft",(n,o,r)=>new Geometry().add(new PathFigure(.75*o,0,!1).add(new PathSegment(2,.25*o,.5*r)).add(new PathSegment(2,.75*o,r)))),w("LineUp",(n,o,r)=>new Geometry().add(new PathFigure(0,.75*r,!1).add(new PathSegment(2,.5*o,.25*r)).add(new PathSegment(2,o,.75*r)))),w("Capsule",(n,o,r)=>{const l=new Geometry;if(o<r){const h=o/2,a=new PathFigure(0,h,!0);l.add(a),a.add(new PathSegment(5,180,180,h,h,h,h)),a.add(new PathSegment(2,o,r-h)),a.add(new PathSegment(5,0,180,h,r-h,h,h)),a.add(new PathSegment(2,0,h));const c=isFinite(n.parameter1)?n.parameter1:o*.156;return l.spot1=new Spot(0,0,0,c),l.spot2=new Spot(1,1,0,-c),l}else if(o>r){const h=r/2,a=new PathFigure(h,0,!0);l.add(a),a.add(new PathSegment(2,o-h,0)),a.add(new PathSegment(5,270,180,o-h,h,h,h)),a.add(new PathSegment(2,h,r)),a.add(new PathSegment(5,90,180,h,h,h,h));const c=isFinite(n.parameter1)?n.parameter1:r*.156;return l.spot1=new Spot(0,0,c,0),l.spot2=new Spot(1,1,-c,0),l}else return l.type=3,l.endX=o,l.endY=r,l.spot1=Spot.Rk,l.spot2=Spot.vk,l});const i=(n,o)=>new PathFigure(n,o,!1,!1),e=(n,o,r)=>n.add(new PathSegment(2,o,r)),s=(n,o,r)=>n.add(new PathSegment(1,o,r));w("Borders",(n,o,r)=>{let l=n?n.parameter1:NaN;isNaN(l)?l=10:l=l&15;const h=new Geometry;let a;return l===10?(a=i(o,0),e(a,o,r),s(a,0,r),e(a,0,0)):l===5?(a=i(0,0),e(a,o,0),s(a,o,r),e(a,0,r)):l===1?(a=i(0,0),e(a,o,0),s(a,o,r)):l===2?(a=i(o,0),e(a,o,r)):l===4?(a=i(o,r),e(a,0,r)):l===8?(a=i(0,r),e(a,0,0),s(a,o,r)):l===3?(a=i(0,0),e(a,o,0),e(a,o,r)):l===6?(a=i(o,0),e(a,o,r),e(a,0,r)):l===12?(a=i(o,r),e(a,0,r),e(a,0,0)):l===9?(a=i(0,r),e(a,0,0),e(a,o,0)):l===7?(a=i(0,0),e(a,o,0),e(a,o,r),e(a,0,r)):l===14?(a=i(o,0),e(a,o,r),e(a,0,r),e(a,0,0)):l===13?(a=i(o,r),e(a,0,r),e(a,0,0),e(a,o,0)):l===11?(a=i(0,r),e(a,0,0),e(a,o,0),e(a,o,r)):l===15?(a=i(0,0),e(a,o,0),e(a,o,r),e(a,0,r),a.add(new PathSegment(2,0,0).close())):(a=i(0,0),s(a,o,r)),h.add(a),h})}Geo.Gg={"":"",Standard:"F1 m 0,0 l 8,4 -8,4 2,-4 z",Backward:"F1 m 8,0 l -2,4 2,4 -8,-4 z",Triangle:"F1 m 0,0 l 8,4.62 -8,4.62 z",BackwardTriangle:"F1 m 8,4 l 0,4 -8,-4 8,-4 0,4 z",Boomerang:"F1 m 0,0 l 8,4 -8,4 4,-4 -4,-4 z",BackwardBoomerang:"F1 m 8,0 l -8,4 8,4 -4,-4 4,-4 z",SidewaysV:"m 0,0 l 8,4 -8,4 0,-1 6,-3 -6,-3 0,-1 z",BackwardV:"m 8,0 l -8,4 8,4 0,-1 -6,-3 6,-3 0,-1 z",OpenTriangle:"m 0,0 l 8,4 -8,4",BackwardOpenTriangle:"m 8,0 l -8,4 8,4",OpenTriangleLine:"m 0,0 l 8,4 -8,4 m 8.5,0 l 0,-8",BackwardOpenTriangleLine:"m 8,0 l  -8,4 8,4 m -8.5,0 l 0,-8",OpenTriangleTop:"m 0,0 l 8,4 m 0,4",BackwardOpenTriangleTop:"m 8,0 l -8,4 m 0,4",OpenTriangleBottom:"m 0,8 l 8,-4",BackwardOpenTriangleBottom:"m 0,4 l 8,4",HalfTriangleTop:"F1 m 0,0 l 0,4 8,0 z m 0,8",BackwardHalfTriangleTop:"F1 m 8,0 l 0,4 -8,0 z m 0,8",HalfTriangleBottom:"F1 m 0,4 l 0,4 8,-4 z",BackwardHalfTriangleBottom:"F1 m 8,4 l 0,4 -8,-4 z",ForwardSemiCircle:"m 4,0 b 270 180 0 4 4",BackwardSemiCircle:"m 4,8 b 90 180 0 -4 4",Feather:"m 0,0 l 3,4 -3,4",BackwardFeather:"m 3,0 l -3,4 3,4",DoubleFeathers:"m 0,0 l 3,4 -3,4 m 3,-8 l 3,4 -3,4",BackwardDoubleFeathers:"m 3,0 l -3,4 3,4 m 3,-8 l -3,4 3,4",TripleFeathers:"m 0,0 l 3,4 -3,4 m 3,-8 l 3,4 -3,4 m 3,-8 l 3,4 -3,4",BackwardTripleFeathers:"m 3,0 l -3,4 3,4 m 3,-8 l -3,4 3,4 m 3,-8 l -3,4 3,4",ForwardSlash:"m 0,8 l 5,-8",BackSlash:"m 0,0 l 5,8",DoubleForwardSlash:"m 0,8 l 4,-8 m -2,8 l 4,-8",DoubleBackSlash:"m 0,0 l 4,8 m -2,-8 l 4,8",TripleForwardSlash:"m 0,8 l 4,-8 m -2,8 l 4,-8 m -2,8 l 4,-8",TripleBackSlash:"m 0,0 l 4,8 m -2,-8 l 4,8 m -2,-8 l 4,8",Fork:"m 0,4 l 8,0 m -8,0 l 8,-4 m -8,4 l 8,4",BackwardFork:"m 8,4 l -8,0 m 8,0 l -8,-4 m 8,4 l -8,4",LineFork:"m 0,0 l 0,8 m 0,-4 l 8,0 m -8,0 l 8,-4 m -8,4 l 8,4",BackwardLineFork:"m 8,4 l -8,0 m 8,0 l -8,-4 m 8,4 l -8,4 m 8,-8 l 0,8",CircleFork:"F1 m 6,4 b 0 360 -3 0 3 z m 0,0 l 6,0 m -6,0 l 6,-4 m -6,4 l 6,4",BackwardCircleFork:"F1 m 0,4 l 6,0 m -6,-4 l 6,4 m -6,4 l 6,-4 m 6,0 b 0 360 -3 0 3",CircleLineFork:"F1 m 6,4 b 0 360 -3 0 3 z m 1,-4 l 0,8 m 0,-4 l 6,0 m -6,0 l 6,-4 m -6,4 l 6,4",BackwardCircleLineFork:"F1 m 0,4 l 6,0 m -6,-4 l 6,4 m -6,4 l 6,-4 m 0,-4 l 0,8 m 7,-4 b 0 360 -3 0 3",Circle:"F1 m 8,4 b 0 360 -4 0 4 z",Block:"F1 m 0,0 l 0,8 8,0 0,-8 z",StretchedDiamond:"F1 m 0,3 l 5,-3 5,3 -5,3 -5,-3 z",Diamond:"F1 m 0,4 l 4,-4 4,4 -4,4 -4,-4 z",Chevron:"F1 m 0,0 l 5,0 3,4 -3,4 -5,0 3,-4 -3,-4 z",StretchedChevron:"F1 m 0,0 l 8,0 3,4 -3,4 -8,0 3,-4 -3,-4 z",NormalArrow:"F1 m 0,2 l 4,0 0,-2 4,4 -4,4 0,-2 -4,0 z",X:"m 0,0 l 8,8 m 0,-8 l -8,8",TailedNormalArrow:"F1 m 0,0 l 2,0 1,2 3,0 0,-2 2,4 -2,4 0,-2 -3,0 -1,2 -2,0 1,-4 -1,-4 z",DoubleTriangle:"F1 m 0,0 l 4,4 -4,4 0,-8 z  m 4,0 l 4,4 -4,4 0,-8 z",BigEndArrow:"F1 m 0,0 l 5,2 0,-2 3,4 -3,4 0,-2 -5,2 0,-8 z",ConcaveTailArrow:"F1 m 0,2 h 4 v -2 l 4,4 -4,4 v -2 h -4 l 2,-2 -2,-2 z",RoundedTriangle:"F1 m 0,1 a 1,1 0 0 1 1,-1 l 7,3 a 0.5,1 0 0 1 0,2 l -7,3 a 1,1 0 0 1 -1,-1 l 0,-6 z",SimpleArrow:"F1 m 1,2 l -1,-2 2,0 1,2 -1,2 -2,0 1,-2 5,0 0,-2 2,2 -2,2 0,-2 z",AccelerationArrow:"F1 m 0,0 l 0,8 0.2,0 0,-8 -0.2,0 z m 2,0 l 0,8 1,0 0,-8 -1,0 z m 3,0 l 2,0 2,4 -2,4 -2,0 0,-8 z",BoxArrow:"F1 m 0,0 l 4,0 0,2 2,0 0,-2 2,4 -2,4 0,-2 -2,0 0,2 -4,0 0,-8 z",TriangleLine:"F1 m 8,4 l -8,-4 0,8 8,-4 z m 0.5,4 l 0,-8",CircleEndedArrow:"F1 m 10,4 l -2,-3 0,2 -2,0 0,2 2,0 0,2 2,-3 z m -4,0 b 0 360 -3 0 3 z",DynamicWidthArrow:"F1 m 0,3 l 2,0 2,-1 2,-2 2,4 -2,4 -2,-2 -2,-1 -2,0 0,-2 z",EquilibriumArrow:"m 0,3 l 8,0 -3,-3 m 3,5 l -8,0 3,3",FastForward:"F1 m 0,0 l 3.5,4 0,-4 3.5,4 0,-4 1,0 0,8 -1,0 0,-4 -3.5,4 0,-4 -3.5,4 0,-8 z",Kite:"F1 m 0,4 l 2,-4 6,4 -6,4 -2,-4 z",HalfArrowTop:"F1 m 0,0 l 4,4 4,0 -8,-4 z m 0,8",HalfArrowBottom:"F1 m 0,8 l 4,-4 4,0 -8,4 z",OpposingDirectionDoubleArrow:"F1 m 0,4 l 2,-4 0,2 4,0 0,-2 2,4 -2,4 0,-2 -4,0 0,2 -2,-4 z",PartialDoubleTriangle:"F1 m 0,0 4,3 0,-3 4,4 -4,4 0,-3 -4,3 0,-8 z",LineCircle:"F1 m 0,0 l 0,8 m 7 -4 b 0 360 -3 0 3 z",DoubleLineCircle:"F1 m 0,0 l 0,8 m 2,-8 l 0,8 m 7 -4 b 0 360 -3 0 3 z",TripleLineCircle:"F1 m 0,0 l 0,8 m 2,-8 l 0,8 m 2,-8 l 0,8 m 7 -4 b 0 360 -3 0 3 z",CircleLine:"F1 m 6 4 b 0 360 -3 0 3 z m 1,-4 l 0,8",DiamondCircle:"F1 m 8,4 l -4,4 -4,-4 4,-4 4,4 m 8,0 b 0 360 -4 0 4 z",PlusCircle:"F1 m 8,4 b 0 360 -4 0 4 l -8 0 z m -4 -4 l 0 8",OpenRightTriangleTop:"m 8,0 l 0,4 -8,0 m 0,4",OpenRightTriangleBottom:"m 8,8 l 0,-4 -8,0",Line:"m 0,0 l 0,8",DoubleLine:"m 0,0 l 0,8 m 2,0 l 0,-8",TripleLine:"m 0,0 l 0,8 m 2,0 l 0,-8 m 2,0 l 0,8",PentagonArrow:"F1 m 8,4 l -4,-4 -4,0 0,8 4,0 4,-4 z"};var LayoutConditions=(w=>(w[w.None=0]="None",w[w.Added=1]="Added",w[w.Removed=2]="Removed",w[w.Shown=4]="Shown",w[w.Hidden=8]="Hidden",w[w.NodeSized=16]="NodeSized",w[w.GroupLayout=32]="GroupLayout",w[w.NodeReplaced=64]="NodeReplaced",w[w.Standard=127]="Standard",w[w.All=16777215]="All",w))(LayoutConditions||{});class Part extends Panel{P;jo;F;rl;ll;Ho;hi;qo;ph;js;Wo;Ld;UM;zA;Up;Vp;constructor(t,i){let e;t===void 0||t instanceof PanelLayout||typeof t=="string"?e=t:t&&(i=t),super(e),this.P=2408959,this.jo="",this.F=null,this.rl="",this.ll=null,this.Ho=null,this.hi="",this.qo=null,this.ph=null,this.js=new Point(NaN,NaN).g(),this.Wo=null,this.Ld=NaN,this.UM=-1,this.zA=new Rect,this.Up=null,this.Vp=NaN,i&&Object.assign(this,i)}cloneProtected(t){super.cloneProtected(t),t.P=this.P&-4097|16384|32768,t.jo=this.jo,this.F!==null&&(this.F.gi?t.F=this.F:t.F=this.F.copy()),t.rl=this.rl,t.Ho=null,t.hi=this.hi,t.js.a(this.js),t.Ld=this.Ld}Uo(t){super.Uo(t),t.ch(),t.ll=null,t.Wo=null,t.Up=null}toString(){let t=Util.sn(this.constructor)+"#"+GSet.as(this);return this.data!==null&&(t+="("+Util.toString(this.data)+")"),t}static LayoutNone=0;static LayoutAdded=1;static LayoutRemoved=2;static LayoutShown=4;static LayoutHidden=8;static LayoutNodeSized=16;static LayoutGroupLayout=32;static LayoutNodeReplaced=64;static LayoutStandard=127;static LayoutAll=16777215;qi(){this.F===null?this.F=new PartTemplateSettings:this.F.gi&&(this.F=this.F.copy())}lh(){super.lh(),this.F!==null&&(this.F.gi=!0)}Jc(t,i,e,s,n,o,r){const l=this.diagram;l!==null&&(t===3&&i==="elements"?n instanceof Panel?n.Hr(h=>{l.partManager.SS(h,l)}):n instanceof Picture&&l.DS(n):t===4&&i==="elements"&&(n instanceof Panel?n.Hr(h=>l.partManager.NS(h,l)):n instanceof Picture&&l.FS(n)),l.raiseChangedEvent(t,i,e,s,n,o,r))}updateTargetBindings(t){if(super.updateTargetBindings(t),this.data===null)return;const i=this.L.r,e=i.length;for(let n=0;n<e;n++){const o=i[n];o instanceof Panel&&o.Hr(r=>{r.data!==null&&r.updateTargetBindings()})}const s=this.adornments;for(;s.next();)s.value.updateTargetBindings(t)}Oo(){if(super.Oo(),this.g2()){const i=this.L.r,e=i.length;for(let s=0;s<e;s++){const n=i[s];n instanceof Panel&&n.Hr(o=>o.Oo())}}const t=this.adornments;for(;t.next();)t.value.Oo()}updateRelationshipsFromData(){this.data!==null&&this.diagram?.partManager.updateRelationshipsFromData(this)}get key(){const t=this.diagram;if(t!==null)return t.model.getKeyForNodeData(this.data)}get adornments(){return this.Ho===null?EmptyIterator.instance:this.Ho.iteratorValues}findAdornment(t){const i=this.Ho;return i===null?null:i.get(t)}addAdornment(t,i){if(i===null)return;let e=null,s=this.Ho;if(s!==null&&(e=s.get(t)),e!==i){if(e!==null){const o=e.diagram;o!==null&&o.remove(e)}s===null&&(s=new GMap,this.Ho=s),i.jo!==t&&(i.category=t),s.set(t,i);const n=this.diagram;if(n!==null){n.add(i);const o=i.adornedObject;if(o!==null){const r=o.findBindingPanel();r!==null&&(i.data=r.data)}}}}removeAdornment(t){const i=this.Ho;if(i===null)return;const e=i.get(t);if(e!==null){const s=e.diagram;s!==null&&(s.remove(e),e.data=null)}i.delete(t),i.count===0&&(this.Ho=null)}clearAdornments(){const t=this.Ho;if(t===null)return;const i=Util.nt(),e=t.iterator;for(;e.next();){const n=e.key;i.push(n)}const s=i.length;for(let n=0;n<s;n++)this.removeAdornment(i[n]);Util.tt(i)}updateAdornments(){const t=this.diagram;if(t===null)return;this.vv(t),this.Ov(t);let i=this.adornments;for(;i.next();){const e=i.value;e.c(),e.hasPlaceholder()&&e.placeholder.c()}for(i=this.adornments;i.next();)i.value.updateTargetBindings()}invalidateAdornments(){const t=this.diagram;t!==null&&(t.Ql(),this.XA()!==!0&&this.KA(!0))}VM(){this.XA()!==!1&&(this.updateAdornments(),this.KA(!1))}vv(t){const i="Selection";if(this.isSelected&&this.selectionAdorned){const e=this.selectionObject;if(e!==null&&this.actualBounds.isReal()&&this.isVisible()&&e.isVisibleObject()&&e.actualBounds.isReal()){let s=this.findAdornment(i);if(s===null){let n=this.selectionAdornmentTemplate;n===null&&(this.Nl()?n=t.linkSelectionAdornmentTemplate:this instanceof Group?n=t.groupSelectionAdornmentTemplate:n=t.nodeSelectionAdornmentTemplate),s=n.copy(),s!==null&&(this.Nl()&&this.selectionObject===this.path&&(s.type=Panel.Link),s.adornedObject=e)}if(s!==null){s.type===Panel.Link&&s.c(),this.addAdornment(i,s);return}}}this.removeAdornment(i)}Ov(t){const i=this;t.toolManager.mouseDownTools.each(e=>{e.isEnabled&&e.updateAdornments(i)}),t.toolManager.updateAdornments(i)}EM(t){this.qo=t,t===null&&this.FR()}get layer(){return this.qo}get diagram(){const t=this.qo;return t==null?null:t.diagram}get layerName(){return this.rl}set layerName(t){const i=this.rl;if(i===t)return;Util.i(t,"string",Part,"layerName");let e=this.diagram;if(e!==null&&(e.findLayer(t)===null||e.partManager.addsToTemporaryLayer))return;this.rl=t,e!==null&&e.invalidateDocumentBounds(),this.t("layerName",i,t);const s=this.layer;if(s===null||s.name===t||(e=s.diagram,e===null))return;const n=e.findLayer(t);if(n===null||n===s)return;let o=s.te(-1,this,!0);o>=0&&e.raiseChangedEvent(4,"parts",s,this,null,o,!0),o=n.qh(99999999,this,!0),s.visible!==n.visible&&this.Bi(n.visible),o>=0&&e.raiseChangedEvent(3,"parts",n,null,this,!0,o);const r=this.layerChanged;if(r===null)return;const l=e.Y;e.Y=!0,r(this,s,n),e.Y=l}get layerChanged(){return this.F!==null?this.F.zp:null}set layerChanged(t){const i=this.layerChanged;i!==t&&(t!==null&&Util.i(t,"function",Part,"layerChanged"),this.qi(),this.F.zp=t,this.t("layerChanged",i,t))}get zOrder(){return this.Ld}set zOrder(t){const i=this.Ld;if(i===t)return;Util.i(t,"number",Part,"zOrder"),this.Ld=t;const e=this.layer;e!==null&&e.yx(-1,this),this.t("zOrder",i,t);const s=this.diagram;s!==null&&s.C()}Iv(){const t=this.layer;t!==null&&t.yx(-1,this)}o1(){if(this.th()!==!1)return;this.Y2(!0),this.Qc();const t=this.diagram;t!==null&&(t.r0(this),t.requestUpdate())}YA(){if(this.P|=2097152,this.th()===!1)return;const t=this.position,i=this.location;(!i.isReal()||!t.isReal())&&this.GA(t,i);const e=this.Li,s=Rect.l().a(e);e.ot(),e.x=t.x,e.y=t.y,e.g(),this.td(s,e),Rect.s(s),this.Y2(!1),this.Qc()}Qn(t,i,e,s){const n=this.se;n.e(t,i,e,s),this.bi===null&&(this.bi=new Transform);const o=this.bi;o.vi(),this.y0(o,t,i,e,s),this.bi=o,o.Ok()||o.Vg(n)}y0(t,i,e,s,n){if(this.et!==1&&t.et(this.et),this.Kt===0)return;let o=Spot.Center;this.locationSpot.isSpot()&&(o=this.locationSpot);const r=Point.l();if(this.locationObject!==this){const l=this.locationObject,h=l.naturalBounds;r.setSpot(h.x,h.y,h.width,h.height,o),l.bi!==null&&l.bi.xt(r),r.offset(-l.measuredBounds.x,-l.measuredBounds.y);let a=l.panel;for(;a!==null&&a!==this;)a.bi!==null&&a.bi.xt(r),r.offset(-a.measuredBounds.x,-a.measuredBounds.y),a=a.panel}else r.setSpot(i,e,s,n,o);t.cs(this.Kt,r.x,r.y),Point.s(r)}get locationObject(){if(this.Wo===null)if(this instanceof Adornment&&this.type!==Panel.Link&&this.hasPlaceholder())this.Wo=this.placeholder;else{const t=this.locationObjectName;if(t!==""){const i=this.findObject(t);i!==null?this.Wo=i:this.Wo=this}else this.Wo=this}return this.Wo.visible?this.Wo:this}get minLocation(){return this.F!==null?this.F.Xp:Point.ZN}set minLocation(t){const i=this.minLocation;i.equals(t)||(t=t.N(),this.qi(),this.F.Xp=t,this.t("minLocation",i,t))}get maxLocation(){return this.F!==null?this.F.Kp:Point.QN}set maxLocation(t){const i=this.maxLocation;i.equals(t)||(t=t.N(),this.qi(),this.F.Kp=t,this.t("maxLocation",i,t))}get locationObjectName(){return this.F!==null?this.F.Yp:""}set locationObjectName(t){const i=this.locationObjectName;i!==t&&(this.qi(),this.F.Yp=t,this.Wo=null,this.c(),this.t("locationObjectName",i,t))}get locationSpot(){return this.F!==null?this.F.Gp:Spot.TopLeft}set locationSpot(t){const i=this.locationSpot;i.equals(t)||(t=t.N(),this.qi(),this.F.Gp=t,this.c(),this.t("locationSpot",i,t))}move(t,i){i===!0?this.location=t:this.position=t}moveTo(t,i,e){const s=Point.X(t,i);this.move(s,e),Point.s(s)}isVisible(){if(!this.visible)return!1;const t=this.layer;if(t!==null){if(!t.visible)return!1;const e=t.diagram;if(e!==null&&e.animationManager.nx(this))return!0}const i=this.containingGroup;return!(i!==null&&(!i.isSubGraphExpanded||!i.isVisible()))}Bi(t){const i=this.diagram;t?(this.invalidateLayout(4),this.invalidateAdornments(),i!==null&&i.r0(this)):(this.invalidateLayout(8),this.clearAdornments()),this.ch(),i!==null&&(i.invalidateDocumentBounds(),i.C())}findObject(t){if(this.name===t)return this;let i=this.Up;if(i===null&&(this.Up=i=new GMap),i.get(t)!==null)return i.get(t);const e=super.findObject(t);return e!==null?(i.set(t,e),e):(i.set(t,null),null)}D0(){this.Up=null}getRelativePoint(t,i,e){e===void 0&&(e=new Point);const s=i.isNoSpot()?Spot.Center:i,n=t.naturalBounds;if(e.e(n.width*s.x+s.offsetX,n.height*s.y+s.offsetY),t===null||t===this)return e;t.D.xt(e);let o=t.panel;for(;o!==null&&o!==this;)o.D.xt(e),o=o.panel;return this.bi!==null&&this.bi.xt(e),e.offset(-this.se.x,-this.se.y),e}getDocumentBounds(t){return t===void 0&&(t=new Rect),t.a(this.actualBounds)}ensureBounds(){this.ut(1/0,1/0),this.Xt()}wA(t){const i=this.locationSpot,e=this.locationObject;let s=e.naturalBounds;s.isReal()||(s=Rect.pw);const n=e instanceof Shape?e.strokeWidth:0;if(t.setSpot(0,0,s.width+n,s.height+n,i),e!==this){t.offset(-n/2,-n/2),e.D.xt(t);let o=e.panel;for(;o!==null&&o!==this;)o.D.xt(t),o=o.panel}return this.bi!==null&&this.bi.xt(t),t.offset(-this.se.x,-this.se.y),t}Hh(t,i){const e=i===void 0?this.zA:i,s=this.Ev(),n=s*2;if(!this.isShadowed)return e.e(t.x-1-s,t.y-1-s,t.width+2+n,t.height+2+n),e;let o=t.x,r=t.y,l=t.width,h=t.height;const a=this.shadowBlur,c=this.shadowOffset;return l+=a,h+=a,o-=a/2,r-=a/2,c.x>0?l+=c.x:(o+=c.x,l-=c.x),c.y>0?h+=c.y:(r+=c.y,h-=c.y),e.e(o-1,r-1,l+2,h+2),e}wv(){return this.type===Panel.Link&&this instanceof Adornment&&this.category==="Selection"&&this.adornedObject instanceof Shape&&this.adornedPart.findMainElement()===this.adornedObject?this.adornedObject.strokeWidth:0}Ev(){return isNaN(this.Vp)&&(this.Vp=this.NA()),this.Vp}ff(){this.Vp=NaN}Xt(){if(this.es()===!1){this.YA();return}this._n(!1);const t=this.Li,i=Rect.l();i.a(t);const e=this.Sl();this.ah(0,0,this.se.width,this.se.height);const s=this.position;this.GA(s,this.location),t.ot(),t.x=s.x,t.y=s.y,t.g(),this.td(i,t),i.equals(t)?this.Bs(e):this.Pe()&&(!Geo.u(i.width,t.width)||!Geo.u(i.height,t.height))&&this.UM>=0&&this.invalidateLayout(16),Rect.s(i),this.Y2(!1)}td(t,i){const e=this.diagram;if(e===null)return;let s=!1;if(e.Zh===!1&&t.isReal()){const n=Rect.l();n.a(e.documentBounds),n.subtractMargin(e.padding),t.x>n.x&&t.y>n.y&&t.right<n.right&&t.bottom<n.bottom&&i.x>n.x&&i.y>n.y&&i.right<n.right&&i.bottom<n.bottom&&(s=!0),Rect.s(n)}(this.Bv()===!0||!t.equals(i))&&this.LL(s,e),e.C(),!(!t.isReal()&&!i.isReal()||t.equalsApproxClose(i))&&(this instanceof Node&&!e.undoManager.isUndoingRedoing&&this.invalidateConnectedLinks(),this.ch())}get location(){return this.js}set location(t){const i=t.x,e=t.y,s=this.js;(s.x!==i&&(!isNaN(s.x)||!isNaN(i))||s.y!==e&&(!isNaN(s.y)||!isNaN(e)))&&(t=t.copy(),this.Uv(t,s)&&this.t("location",s,t.copy()))}Uv(t,i){if(this.Nl())return!1;if(this.js=t,this.P|=2097152,this.es()===!1){this.o1();const e=this.at;if(e.isReal()){const s=this.diagram;if(s===null||s.animationManager.isTicking||!s.undoManager.isUndoingRedoing){const n=e.copy();e.e(e.x+(t.x-i.x),e.y+(t.y-i.y)),this.jA(s,e,n.x,n.y),this.t("position",n,e.copy())}}}return!0}f2(t,i,e){if(this.Nl()||!t.isReal())return!1;const s=this.diagram;if(s!==null&&this.jA(s,t,i,e),this.at=t,this.P&=-2097153,this.js.isReal()&&(s===null||s.animationManager.isTicking||!s.undoManager.isUndoingRedoing)){const n=this.js;this.js=new Point(n.x+(t.x-i),n.y+(t.y-e)),this.t("location",n,this.js.copy())}return this.th()===!1&&this.es()===!1&&(this.o1(),this.YA()),!0}jA(t,i,e,s){if(t===null||this instanceof Adornment)return;const n=t.animationManager;n.wi&&n.$C(this,new Point(e,s),i,!1)}bc(t,i,e){const s=this.js,n=this.at;if(e){if(s.x===t&&s.y===i)return;this.th()||this.es()?n.e(NaN,NaN):n.e(n.x+t-s.x,n.y+i-s.y),s.e(t,i)}else{if(n.x===t&&n.y===i)return;s.e(s.x+t-n.x,s.y+i-n.y),n.e(t,i)}this.o1()}u2(){this.P&=-2097153,this.o1()}GA(t,i){const e=this.wA(Point.l()),s=this.diagram,n=i.isReal(),o=t.isReal();n&&o?this.P&2097152?this.HA(t,i,s,e):this.qA(t,i,s,e):n?this.HA(t,i,s,e):o&&this.qA(t,i,s,e),this.P|=2097152,Point.s(e),this.Qc()}HA(t,i,e,s){const n=t.x,o=t.y;if(t.e(i.x-s.x,i.y-s.y),e!==null){const r=e.animationManager,l=r.defaultAnimation.isAnimating;!l&&r.wi&&!(this instanceof Adornment)&&r.$C(this,new Point(n,o),t,!1),!l&&!(t.x===n&&t.y===o)&&this.t("position",new Point(n,o),t.copy())}}qA(t,i,e,s){const n=i.copy();i.e(t.x+s.x,t.y+s.y),!i.equals(n)&&e!==null&&this.t("location",n,i.copy())}LL(t,i){this.o2(!1),this instanceof Node&&i.BS(this),!this.layer.isTemporary&&!t&&i.invalidateDocumentBounds();const e=this.Li,s=i.viewportBounds;s.isReal()?this.Sl()?(e.intersectsRectPlus(s,10)||this.Bs(!1),this.updateAdornments()):this.isVisible()&&e.intersectsRect(s)?(this.Bs(!0),this.updateAdornments()):this.invalidateAdornments():i.Ec=!0}jr(){return!0}Pe(){return!0}Nl(){return!1}Xs(){return!0}hasPlaceholder(){return!1}get category(){return this.jo}set category(t){const i=this.jo;if(i===t)return;this.svg!==null&&(this.svg.remove(),this.Ke(!0)),Util.i(t,"string",Part,"category");const e=this.diagram,s=this.data;let n=null;if(e!==null&&s!==null&&!(this instanceof Adornment)){const o=e.model.undoManager;o.isEnabled&&!o.isUndoingRedoing&&(n=this.clone(),n.L.addAll(this.L))}if(this.jo=t,this.t("category",i,t),e!==null&&s!==null&&!(this instanceof Adornment)){const o=e.model;if(o.undoManager.isUndoingRedoing)return;if(this.Nl()){e.partManager.setLinkCategoryForData(s,t);const r=e.partManager.findLinkTemplateForCategory(t);if(r!==null){r.Vt();const l=r.copy();l!==null&&this.G2(l,i,t)}}else{o!==null&&o.setCategoryForNodeData(s,t);const r=e.partManager.findTemplateForNodeData(s,t);if(r!==null){r.Vt();const l=r.copy();if(l!==null&&!(l instanceof Link)){const h=this.location.copy();this.G2(l,i,t),this.location.isReal()||(this.location=h)}}}if(n!==null){const r=this.clone();r.L.addAll(this.L),this.t("self",n,r)}}else if(this instanceof Adornment){const o=this.adornedPart;if(o!==null){const r=o.Ho;r!==null&&r.delete(i),o.addAdornment(this.category,this)}}}get self(){return this}set self(t){this.G2(t,this.category,t.category)}static WA=!1;G2(t,i,e){t.constructor!==this.constructor&&(Part.WA||(Part.WA=!0,Util.ei('Should not change the class of the Part when changing category from "'+i+'" to "'+e+'"'),Util.ei("  Old class: "+Util.sn(this.constructor)+", new class: "+Util.sn(t.constructor)+", part: "+this.toString()))),this.clearAdornments();const s=this.data,n=this.layerName,o=this.isSelected,r=this.isHighlighted;let l=!0,h=!0,a=!1;this instanceof Node&&(l=this.isTreeLeaf,h=this.isTreeExpanded,a=this.wasTreeExpanded),t.Uo(this),t.cloneProtected(this),this.jo=e,this.svg!==null&&(this.svg.remove(),this.svg=null,this.Ke(!0)),this.c(),this.C();const c=this.diagram;let f=!0;c!==null&&(f=c.skipsUndoManager,c.skipsUndoManager=!0),this._t=s,this.P=o?this.P|4096:this.P&-4097,this.P=r?this.P|524288:this.P&-524289,this instanceof Node&&(this.E=l?this.E|4:this.E&-5,this.E=h?this.E|1:this.E&-2,this.E=a?this.E|2:this.E&-3),s!==null&&this.updateTargetBindings();const u=this.layerName;u!==n&&(this.rl=n,this.layerName=u),c!==null&&(c.skipsUndoManager=f),this.Pe()&&this.invalidateLayout(64)}canCopy(){if(!this.copyable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowCopy)return!1;const i=t.diagram;return i===null?!0:!!i.allowCopy}canDelete(){if(!this.deletable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowDelete)return!1;const i=t.diagram;return i===null?!0:!!i.allowDelete}canEdit(){if(!this.textEditable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowTextEdit)return!1;const i=t.diagram;return i===null?!0:!!i.allowTextEdit}canGroup(){if(!this.groupable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowGroup)return!1;const i=t.diagram;return i===null?!0:!!i.allowGroup}canMove(){if(!this.movable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowMove)return!1;const i=t.diagram;return i===null?!0:!!i.allowMove}canReshape(){if(!this.reshapable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowReshape)return!1;const i=t.diagram;return i===null?!0:!!i.allowReshape}canResize(){if(!this.resizable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowResize)return!1;const i=t.diagram;return i===null?!0:!!i.allowResize}canRotate(){if(!this.rotatable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowRotate)return!1;const i=t.diagram;return i===null?!0:!!i.allowRotate}canSelect(){if(!this.selectable)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowSelect)return!1;const i=t.diagram;return i===null?!0:!!i.allowSelect}get copyable(){return(this.P&1)!==0}set copyable(t){const i=(this.P&1)!==0;i!==t&&(this.P=this.P^1,this.t("copyable",i,t))}get deletable(){return(this.P&2)!==0}set deletable(t){const i=(this.P&2)!==0;i!==t&&(this.P=this.P^2,this.t("deletable",i,t))}get textEditable(){return(this.P&4)!==0}set textEditable(t){const i=(this.P&4)!==0;i!==t&&(this.P=this.P^4,this.t("textEditable",i,t),this.invalidateAdornments())}get groupable(){return(this.P&8)!==0}set groupable(t){const i=(this.P&8)!==0;i!==t&&(this.P=this.P^8,this.t("groupable",i,t))}get movable(){return(this.P&16)!==0}set movable(t){const i=(this.P&16)!==0;i!==t&&(this.P=this.P^16,this.t("movable",i,t))}get selectionAdorned(){return(this.P&32)!==0}set selectionAdorned(t){const i=(this.P&32)!==0;i!==t&&(this.P=this.P^32,this.t("selectionAdorned",i,t),this.invalidateAdornments())}get isInDocumentBounds(){return(this.P&64)!==0}set isInDocumentBounds(t){const i=(this.P&64)!==0;if(i!==t){this.P=this.P^64;const e=this.diagram;e!==null&&e.invalidateDocumentBounds(),this.t("isInDocumentBounds",i,t)}}get isLayoutPositioned(){return(this.P&128)!==0}set isLayoutPositioned(t){const i=(this.P&128)!==0;i!==t&&(this.P=this.P^128,this.t("isLayoutPositioned",i,t),this.invalidateLayout(t?4:8))}get selectable(){return(this.P&256)!==0}set selectable(t){const i=(this.P&256)!==0;i!==t&&(this.P=this.P^256,this.t("selectable",i,t),this.invalidateAdornments())}get reshapable(){return(this.P&512)!==0}set reshapable(t){const i=(this.P&512)!==0;i!==t&&(this.P=this.P^512,this.t("reshapable",i,t),this.invalidateAdornments())}get resizable(){return(this.P&1024)!==0}set resizable(t){const i=(this.P&1024)!==0;i!==t&&(this.P=this.P^1024,this.t("resizable",i,t),this.invalidateAdornments())}get rotatable(){return(this.P&2048)!==0}set rotatable(t){const i=(this.P&2048)!==0;i!==t&&(this.P=this.P^2048,this.t("rotatable",i,t),this.invalidateAdornments())}get isSelected(){return(this.P&4096)!==0}set isSelected(t){const i=(this.P&4096)!==0;if(i!==t){const e=this.diagram;if(t){if(!this.canSelect())return;if(e!==null){const o=e.maxSelectionCount;if(e.selection.count>=o)return}}this.P=this.P^4096;let s=!1;if(e!==null){s=e.skipsUndoManager,e.skipsUndoManager=!0;const o=e.selection;o.ot(),t?o.add(this):o.delete(this),o.g()}this.t("isSelected",i,t),this.invalidateAdornments();const n=this.selectionChanged;n!==null&&n(this),e!==null&&(e.requestUpdate(),e.skipsUndoManager=s)}}get isHighlighted(){return(this.P&524288)!==0}set isHighlighted(t){const i=(this.P&524288)!==0;if(i!==t){this.P=this.P^524288;const e=this.diagram;if(e!==null){const n=e.highlighteds;n.ot(),t?n.add(this):n.delete(this),n.g()}this.t("isHighlighted",i,t),this.C();const s=this.highlightedChanged;s!==null&&s(this)}}get isShadowed(){return(this.P&8192)!==0}set isShadowed(t){const i=(this.P&8192)!==0;i!==t&&(this.P=this.P^8192,this.Ke(!0),this.t("isShadowed",i,t),this.C())}XA(){return(this.P&16384)!==0}KA(t){t?this.P|=16384:this.P&=-16385}th(){return(this.P&32768)!==0}Y2(t){t?this.P|=32768:this.P&=-32769}Bv(){return(this.P&65536)!==0}o2(t){t?this.P|=65536:this.P&=-65537}Sl(){return(this.P&131072)!==0}Bs(t){t?this.P|=131072:this.P&=-131073}JA(){return(this.P&1048576)!==0}l1(t){t?this.P|=1048576:this.P&=-1048577}get isAnimated(){return(this.P&262144)!==0}set isAnimated(t){const i=(this.P&262144)!==0;i!==t&&(this.P=this.P^262144,this.t("isAnimated",i,t))}get highlightedChanged(){return this.F!==null?this.F.jp:null}set highlightedChanged(t){const i=this.highlightedChanged;i!==t&&(t!==null&&Util.i(t,"function",Part,"highlightedChanged"),this.qi(),this.F.jp=t,this.t("highlightedChanged",i,t))}get selectionObjectName(){return this.F!==null?this.F.Hp:""}set selectionObjectName(t){const i=this.selectionObjectName;i!==t&&(this.qi(),this.F.Hp=t,this.ll=null,this.t("selectionObjectName",i,t))}get selectionAdornmentTemplate(){return this.F!==null?this.F.qp:null}set selectionAdornmentTemplate(t){const i=this.selectionAdornmentTemplate;i!==t&&(t!==null&&t.Vt(),this.qi(),this.F.qp=t,this.t("selectionAdornmentTemplate",i,t))}get selectionObject(){if(this.ll===null){const t=this.selectionObjectName;if(t!==null&&t!==""){const i=this.findObject(t);i!==null?this.ll=i:this.ll=this}else if(this instanceof Link){const i=this.path;i!==null?this.ll=i:this.ll=this}else this.ll=this}return this.ll}get selectionChanged(){return this.F!==null?this.F.Wp:null}set selectionChanged(t){const i=this.selectionChanged;i!==t&&(t!==null&&Util.i(t,"function",Part,"selectionChanged"),this.qi(),this.F.Wp=t,this.t("selectionChanged",i,t))}get resizeAdornmentTemplate(){return this.F!==null?this.F.Jp:null}set resizeAdornmentTemplate(t){const i=this.resizeAdornmentTemplate;i!==t&&(this.qi(),this.F.Jp=t.Vt(),this.t("resizeAdornmentTemplate",i,t))}get resizeObjectName(){return this.F!==null?this.F.$p:""}set resizeObjectName(t){const i=this.resizeObjectName;i!==t&&(this.qi(),this.F.$p=t,this.t("resizeObjectName",i,t))}get resizeObject(){const t=this.resizeObjectName;if(t!==""){const i=this.findObject(t);if(i!==null)return i}return this}get resizeCellSize(){return this.F!==null?this.F.Zp:Size.gw}set resizeCellSize(t){const i=this.resizeCellSize;i.equals(t)||(t=t.N(),this.qi(),this.F.Zp=t,this.t("resizeCellSize",i,t))}get rotateAdornmentTemplate(){return this.F!==null?this.F.Qp:null}set rotateAdornmentTemplate(t){const i=this.rotateAdornmentTemplate;i!==t&&(this.qi(),this.F.Qp=t.Vt(),this.t("rotateAdornmentTemplate",i,t))}get rotateObjectName(){return this.F!==null?this.F._p:""}set rotateObjectName(t){const i=this.rotateObjectName;i!==t&&(this.qi(),this.F._p=t,this.t("rotateObjectName",i,t))}get rotateObject(){const t=this.rotateObjectName;if(t!==""){const i=this.findObject(t);if(i!==null)return i}return this}get rotationSpot(){return this.F!==null?this.F.ty:Spot.Default}set rotationSpot(t){const i=this.rotationSpot;i.equals(t)||(t=t.N(),this.qi(),this.F.ty=t,this.t("rotationSpot",i,t))}get text(){return this.hi}set text(t){const i=this.hi;i!==t&&(this.hi=t,this.t("text",i,t))}get containingGroup(){return this.ph}set containingGroup(t){if(this.Pe()){const i=this.ph;if(i!==t){t!==null&&(this===t||t.isMemberOf(this))&&(this===t&&Util.o("Cannot make a Group a member of itself: "+this.toString()),Util.o("Cannot make a Group indirectly contain itself: "+this.toString()+" already contains "+t.toString())),this.invalidateLayout(2);const e=this.diagram;if(i!==null?i.j2(this):this instanceof Group&&e!==null&&e.Yr.delete(this),this.ph=t,t!==null?t.H2(this):this instanceof Group&&e!==null&&e.Yr.add(this),this.invalidateLayout(1),e!==null&&e.Y){const n=this.data,o=e.model;if(n!==null&&o.qc()){const r=t!==null?t.data:null;o.setGroupForData(n,o.getKeyForNodeData(r))}}const s=this.containingGroupChanged;if(s!==null){let n=!0;e!==null&&(n=e.Y,e.Y=!0),s(this,i,t),e!==null&&(e.Y=n)}if(this instanceof Group){const n=new GSet;Part.sh(n,this,!0,0,!0);const o=n.iterator;for(;o.next();){const r=o.value;if(r instanceof Node){const l=r.linksConnected;for(;l.next();)l.value.Ad()}}}if(this instanceof Node){const n=this.linksConnected;for(;n.next();)n.value.Ad();const o=this.labeledLink;o!==null&&o.Ad()}this.t("containingGroup",i,t),t!==null&&t.Iv()}}else Util.o("cannot set the Part.containingGroup of a Link or Adornment")}ch(){const t=this.containingGroup;t!==null&&(t.hasPlaceholder()&&t.placeholder.c(),t.c(),t.invalidateConnectedLinks())}C(){const t=this.diagram;t!==null&&!this.es()&&!this.th()&&this.isVisible()&&this.Li.isReal()&&t.C(this.Hh(this.Li))}c(){if(this.vo())return;super.c();const t=this.diagram;t!==null&&(t.r0(this),this instanceof Node&&this.labeledLink!==null&&this.labeledLink.sf(),t.requestUpdate(!0))}sf(t){if(this.es())return;const i=this.diagram;i!==null&&(i.r0(this),this instanceof Node&&this.invalidateConnectedLinks(),i.requestUpdate()),this._n(!0)}Um(t){if(!t){const i=this.ph;i!==null&&i.H2(this)}}Vm(t){if(!t){const i=this.ph;i!==null&&i.j2(this)}}Kc(){const t=this.data;if(t!==null){const i=this.diagram;if(i!==null){const e=i.model;e!==null&&e.removeNodeData(t)}}}get containingGroupChanged(){return this.F!==null?this.F.iy:null}set containingGroupChanged(t){const i=this.containingGroupChanged;i!==t&&(t!==null&&Util.i(t,"function",Part,"containingGroupChanged"),this.qi(),this.F.iy=t,this.t("containingGroupChanged",i,t))}findSubGraphLevel(){return this.q2(this)}q2(t){const i=t.containingGroup;if(i!==null)return 1+this.q2(i);if(t instanceof Node){const e=t.labeledLink;if(e!==null)return this.q2(e)}return 0}findTopLevelPart(){return this.W2(this)}W2(t){const i=t.containingGroup;if(i!==null)return this.W2(i);if(t instanceof Node){const e=t.labeledLink;if(e!==null)return this.W2(e)}return t}get isTopLevel(){return!(this.containingGroup!==null||this instanceof Node&&this.labeledLink!==null)}isMemberOf(t){return t instanceof Group?this.J2(this,t):!1}J2(t,i){if(t===i||i===null)return!1;const e=t.containingGroup;if(e!==null&&(e===i||this.J2(e,i)))return!0;if(t instanceof Node){const s=t.labeledLink;if(s!==null)return this.J2(s,i)}return!1}findCommonContainingGroup(t){if(t===null)return null;if(this===t)return this.containingGroup;let i=this;for(;i!==null;){if(i instanceof Group&&i.l1(!0),i instanceof Node){const s=i.labeledLink;s!==null&&(i=s)}i=i.containingGroup}let e=null;for(i=t;i!==null;){if(i.JA()){e=i;break}if(i instanceof Node){const s=i.labeledLink;s!==null&&(i=s)}i=i.containingGroup}for(i=this;i!==null;){if(i instanceof Group&&i.l1(!1),i instanceof Node){const s=i.labeledLink;s!==null&&(i=s)}i=i.containingGroup}return e}get layoutConditions(){return this.F!==null?this.F.ey:127}set layoutConditions(t){const i=this.layoutConditions;i!==t&&(this.qi(),this.F.ey=t,this.t("layoutConditions",i,t))}canLayout(){if(!this.isLayoutPositioned||!this.isVisible())return!1;const t=this.layer;return!(t!==null&&t.isTemporary||this instanceof Node&&this.isLinkLabel)}Vv(t){if(!this.isLayoutPositioned||!(t&this.layoutConditions))return!1;const i=this.layer;if(i!==null&&i.isTemporary||this instanceof Node&&this.isLinkLabel)return!1;const e=this.diagram;return!(e!==null&&e.undoManager.isUndoingRedoing)}invalidateLayout(t){if(t===void 0&&(t=16777215),!this.Vv(t))return;const i=this.ph;if(i!==null){const e=i.layout;e!==null?e.invalidateLayout():i.invalidateLayout(t)}else{const e=this.diagram;if(e!==null){const s=e.layout;s!==null&&s.invalidateLayout()}}}AL(){if(!this.isVisible())return!1;const t=this.layer;return!(t!==null&&t.isTemporary)}static sh(t,i,e,s,n,o){if(o===void 0&&(o=null),!t.has(i)&&!(o!==null&&!o(i))&&!(i instanceof Adornment)){if(t.add(i),i instanceof Node){if(e&&i instanceof Group){const r=i.memberParts;for(;r.next();){const l=r.value;Part.sh(t,l,e,s,n,o)}}if(n!==!1){const r=i.linksConnected;for(;r.next();){const l=r.value;if(t.has(l))continue;const h=l.fromNode,a=l.toNode,c=h===null||t.has(h),f=a===null||t.has(a);(n?c&&f:c||f)&&Part.sh(t,l,e,s,n,o)}}if(s>1){const r=i.findTreeChildrenNodes();for(;r.next();){const l=r.value;Part.sh(t,l,e,s-1,n,o)}}}else if(i instanceof Link){const r=i.labelNodes;for(;r.next();){const l=r.value;Part.sh(t,l,e,s,n,o)}}}}get dragComputation(){return this.F!==null?this.F.sy:null}set dragComputation(t){const i=this.dragComputation;i!==t&&(t!==null&&Util.i(t,"function",Part,"dragComputation"),this.qi(),this.F.sy=t,this.t("dragComputation",i,t))}get shadowOffset(){return this.F!==null?this.F.ny:Point._N}set shadowOffset(t){const i=this.shadowOffset;i.equals(t)||(t=t.N(),this.qi(),this.F.ny=t,this.C(),this.t("shadowOffset",i,t))}get shadowColor(){return this.F!==null?this.F.oy:"gray"}set shadowColor(t){const i=this.shadowColor;i!==t&&(this.qi(),this.F.oy=t,this.C(),this.t("shadowColor",i,t))}get shadowBlur(){return this.F!==null?this.F.xn:4}set shadowBlur(t){const i=this.shadowBlur;i!==t&&(this.qi(),this.F.xn=t,this.C(),this.t("shadowBlur",i,t))}}class PartTemplateSettings{gi;zp;iy;qp;Hp;Wp;jp;Jp;$p;Zp;Qp;_p;ty;Yp;Gp;Xp;Kp;sy;ey;ny;oy;xn;constructor(){this.gi=!1,this.zp=null,this.iy=null,this.qp=null,this.Hp="",this.Wp=null,this.jp=null,this.Jp=null,this.$p="",this.Zp=Size.gw,this.Qp=null,this._p="",this.ty=Spot.Default,this.Yp="",this.Gp=Spot.TopLeft,this.Xp=Point.ZN,this.Kp=Point.QN,this.sy=null,this.ey=127,this.ny=Point._N,this.oy="gray",this.xn=4}copy(){const t=new PartTemplateSettings;return t.zp=this.zp,t.iy=this.iy,t.qp=this.qp,t.Hp=this.Hp,t.Wp=this.Wp,t.jp=this.jp,t.Jp=this.Jp,t.$p=this.$p,t.Zp=this.Zp.N(),t.Qp=this.Qp,t._p=this._p,t.ty=this.ty.N(),t.Yp=this.Yp,t.Gp=this.Gp.N(),t.Xp=this.Xp.N(),t.Kp=this.Kp.N(),t.sy=this.sy,t.ey=this.ey,t.ny=this.ny.N(),t.oy=this.oy,t.xn=this.xn,t}}class Adornment extends Part{us;It;JP;$P;af;constructor(t,i){let e;t===void 0||t instanceof PanelLayout||typeof t=="string"?e=t:t&&(i=t),super(e),this.P&=-257,this.rl="Adornment",this.us=null,this.JP=0,this.$P=!1,this.It=null,this.af=null,i&&Object.assign(this,i)}toString(){const t=this.adornedPart;return"Adornment("+this.category+")"+(t!==null?t.toString():"")}updateRelationshipsFromData(){}ad(t){const i=this.adornedObject,e=i?.part;if(!(e instanceof Link)||!(i instanceof Shape))return;const s=e.path;let n=s.geometry;e.ad(t),n=s.geometry;const o=this.L.r,r=o.length;for(let l=0;l<r;l++){const h=o[l];h.isPanelMain&&h instanceof Shape&&(h.ct=n)}}hasPlaceholder(){return this.It!==null&&this.It.isVisibleObject()}get placeholder(){return this.It}get adornedObject(){return this.us}set adornedObject(t){const i=this.adornedPart;let e=null;t!==null&&(e=t.part),i!==null&&(t===null||i!==e)&&i.removeAdornment(this.category),this.us=t,e!==null&&e.addAdornment(this.category,this)}get adornedPart(){const t=this.us;return t!==null?t.part:null}jr(){const t=this.us;if(t===null)return!0;const i=t.part;return i===null||!i.es()}Pe(){return!1}get containingGroup(){return null}Jc(t,i,e,s,n,o,r){if(t===3&&i==="elements"){if(n instanceof Placeholder)this.It===null&&(this.It=n);else if(n instanceof Panel){const l=n.findInVisualTree(h=>h instanceof Placeholder);l instanceof Placeholder&&this.It===null&&(this.It=l)}}else t===4&&i==="elements"&&this.It!==null&&(s===this.It?this.It=null:s instanceof Panel&&this.It.isContainedBy(s)&&(this.It=null));super.Jc(t,i,e,s,n,o,r)}updateAdornments(){}Kc(){}}var PortSpreading=(w=>(w[w.None=0]="None",w[w.Evenly=1]="Evenly",w[w.Packed=2]="Packed",w))(PortSpreading||{});class Node extends Part{E;gt;Pf;hl;yh;ne;ti;constructor(t,i){let e;t===void 0||t instanceof PanelLayout||typeof t=="string"?e=t:t&&(i=t),super(e),this.E=13,this.gt=null,this.ti=new List,this.Pf=null,this.hl=null,this.ne=null,this.yh=!1,i&&Object.assign(this,i)}cloneProtected(t){super.cloneProtected(t),t.E=this.E,this.gt!==null&&(this.gt.gi?t.gt=this.gt:t.gt=this.gt.copy())}Uo(t){super.Uo(t),t.invalidateConnectedLinks(),t.hl=this.hl,t.ne=null}static SpreadingNone=0;static SpreadingEvenly=1;static SpreadingPacked=2;al(){this.gt===null?this.gt=new NodeTemplateSettings:this.gt.gi&&(this.gt=this.gt.copy())}lh(){super.lh(),this.gt!==null&&(this.gt.gi=!0)}$A(t){t!==null&&(this.hl===null&&(this.hl=new GSet),this.hl.add(t))}ZA(t){t!==null&&this.hl!==null&&this.hl.delete(t)}QA(t,i,e){if(t===null||this.hl===null)return null;const s=this.hl.iterator;for(;s.next();){const n=s.value;if(n.ry===this&&n.h1===t&&n.$2===i&&n.Z2===e||n.ry===t&&n.h1===this&&n.$2===e&&n.Z2===i)return n}return null}invalidateLinkBundle(t,i,e){i==null&&(i=""),e==null&&(e="");const s=this.QA(t,i,e);s!==null&&s.Td()}Jc(t,i,e,s,n,o,r){t===3&&i==="elements"?this.ne=null:t===4&&i==="elements"&&(this.ne=null),super.Jc(t,i,e,s,n,o,r)}invalidateConnectedLinks(t){const i=this.linksConnected;for(;i.next();){const e=i.value;t!==void 0&&t.has(e)||(this.Wi(e.fromPort),this.Wi(e.toPort),e.invalidateRoute())}}sA(t){const i=this.linksConnected;for(;i.next();){const e=i.value;e.fromPort!==t&&e.toPort!==t||(this.Wi(e.fromPort),this.Wi(e.toPort),e.invalidateRoute())}}Wi(t){if(t===null)return;const i=t.$u;i!==null&&i.Td();const e=t.part,s=e.containingGroup;s!==null&&!e.isVisible()&&s.Wi(s.port)}jr(){return!0}get portSpreading(){return this.gt!==null?this.gt.ly:1}set portSpreading(t){const i=this.portSpreading;if(i!==t){this.al(),this.gt.ly=t,this.t("portSpreading",i,t);const e=this.diagram;if(e!==null&&e.undoManager.isUndoingRedoing)return;this.invalidateConnectedLinks()}}get avoidable(){return(this.E&8)!==0}set avoidable(t){const i=(this.E&8)!==0;if(i!==t){this.E=this.E^8;const e=this.diagram;e!==null&&e.BS(this),this.t("avoidable",i,t)}}get avoidableMargin(){return this.gt!==null?this.gt.hy:Margin.rC}set avoidableMargin(t){typeof t=="number"&&(t=new Margin(t));const i=this.avoidableMargin;if(!i.equals(t)){t=t.N(),this.al(),this.gt.hy=t;const e=this.diagram;e!==null&&e.BS(this),this.t("avoidableMargin",i,t)}}canAvoid(){return this.avoidable&&!this.isLinkLabel}getAvoidableRect(t){return t.set(this.actualBounds),t.addMargin(this.avoidableMargin),t}findVisibleNode(){let t=this;for(;t!==null&&!t.isVisible();)t=t.containingGroup;return t}isVisible(){if(!super.isVisible())return!1;let t=!0,i=1;const e=this.diagram;if(e!==null){if(e.animationManager.nx(this))return!0;t=e.isTreePathToChildren,i=e.treeCollapsePolicy}if(i===1){const n=this.findTreeParentNode();if(n!==null&&!n.isTreeExpanded)return!1}else if(i===2){const n=t?this.findLinksInto():this.findLinksOutOf();let o=!1,r=!1;for(;n.next();){const l=n.value;if(l.isTreeLink){o=!0;const h=t?l.fromNode:l.toNode;if(h&&h.isTreeExpanded){r=!0;break}}}if(o&&!r)return!1}else if(i===3){const n=t?this.findLinksInto():this.findLinksOutOf();let o=!1,r=!1;for(;n.next();){const l=n.value;if(l.isTreeLink){o=!0;const h=t?l.fromNode:l.toNode;if(h&&!h.isTreeExpanded){r=!0;break}}}if(o&&r)return!1}const s=this.labeledLink;return s!==null?s.isVisible():!0}Bi(t){super.Bi(t);const i=this.linksConnected;for(;i.next();){const e=i.value;if(t&&this.containingGroup!==null){const s=e.getOtherNode(this);s!==null&&!s.isMemberOf(this.containingGroup)&&e.invalidateRoute()}e.Bi(t)}}get linksConnected(){return this.ti.iterator}findExternalTreeLinksConnected(){const t=new GSet,i=new GSet;return this._A(this,t,i),i.iterator}_A(t,i,e){if(t===null||i.has(t))return;i.add(t);let s=!0;const n=this.diagram;n!==null&&(s=n.isTreePathToChildren),t.linksConnected.each(o=>{o.isTreeLink?(s?o.fromNode===t:o.toNode===t)&&this._A(s?o.toNode:o.fromNode,i,e):e.add(o)})}findLinksConnected(t){if(t===void 0&&(t=null),t===null)return this.ti.iterator;const i=new ListIterator(this.ti),e=this;return i.predicate=s=>s.fromNode===e&&s.fromPortId===t||s.toNode===e&&s.toPortId===t,i}findLinksOutOf(t){t===void 0&&(t=null);const i=new ListIterator(this.ti),e=this;return i.predicate=s=>s.fromNode!==e?!1:t===null?!0:s.fromPortId===t,i}findLinksInto(t){t===void 0&&(t=null);const i=new ListIterator(this.ti),e=this;return i.predicate=s=>s.toNode!==e?!1:t===null?!0:s.toPortId===t,i}findNodesConnected(t){t===void 0&&(t=null);let i=null,e=null;const s=this.ti.iterator;for(;s.next();){const n=s.value;if(n.fromNode===this){if(t===null||n.fromPortId===t){const o=n.toNode;i!==null?i.add(o):e!==null&&e!==o?(i=new GSet,i.add(e),i.add(o)):e=o}}else if(n.toNode===this&&(t===null||n.toPortId===t)){const o=n.fromNode;i!==null?i.add(o):e!==null&&e!==o?(i=new GSet,i.add(e),i.add(o)):e=o}}return i!==null?i.iterator:e!==null?new SingletonIterator(e):EmptyIterator.instance}findNodesOutOf(t){t===void 0&&(t=null);let i=null,e=null;const s=this.ti.iterator;for(;s.next();){const n=s.value;if(n.fromNode===this&&(t===null||n.fromPortId===t)){const o=n.toNode;i!==null?i.add(o):e!==null&&e!==o?(i=new GSet,i.add(e),i.add(o)):e=o}}return i!==null?i.iterator:e!==null?new SingletonIterator(e):EmptyIterator.instance}findNodesInto(t){t===void 0&&(t=null);let i=null,e=null;const s=this.ti.iterator;for(;s.next();){const n=s.value;if(n.toNode===this&&(t===null||n.toPortId===t)){const o=n.fromNode;i!==null?i.add(o):e!==null&&e!==o?(i=new GSet,i.add(e),i.add(o)):e=o}}return i!==null?i.iterator:e!==null?new SingletonIterator(e):EmptyIterator.instance}findLinksBetween(t,i,e){i===void 0&&(i=null),e===void 0&&(e=null);const s=new ListIterator(this.ti),n=this;return s.predicate=o=>o.fromNode===n&&o.toNode===t&&(i===null||o.fromPortId===i)&&(e===null||o.toPortId===e)||o.fromNode===t&&o.toNode===n&&(e===null||o.fromPortId===e)&&(i===null||o.toPortId===i),s}findLinksTo(t,i,e){i===void 0&&(i=null),e===void 0&&(e=null);const s=new ListIterator(this.ti),n=this;return s.predicate=o=>!(o.fromNode!==n||o.toNode!==t||i!==null&&o.fromPortId!==i||e!==null&&o.toPortId!==e),s}get linkConnected(){return this.gt!==null?this.gt.ay:null}set linkConnected(t){const i=this.linkConnected;i!==t&&(t!==null&&Util.i(t,"function",Node,"linkConnected"),this.al(),this.gt.ay=t,this.t("linkConnected",i,t))}get linkDisconnected(){return this.gt!==null?this.gt.cy:null}set linkDisconnected(t){const i=this.linkDisconnected;i!==t&&(t!==null&&Util.i(t,"function",Node,"linkDisconnected"),this.al(),this.gt.cy=t,this.t("linkDisconnected",i,t))}get linkValidation(){return this.gt!==null?this.gt.Ml:null}set linkValidation(t){const i=this.linkValidation;i!==t&&(t!==null&&Util.i(t,"function",Node,"linkValidation"),this.al(),this.gt.Ml=t,this.t("linkValidation",i,t))}a1(t,i){this.Wi(i);const e=this.ti.has(t);if(e||this.ti.add(t),!e||t.fromNode===t.toNode){const s=this.linkConnected;if(s!==null){let n=!0;const o=this.diagram;o!==null&&(n=o.Y,o.Y=!0),s(this,t,i),o!==null&&(o.Y=n)}}if(!e){if(!t.isTreeLink)return;const s=t.fromNode,n=t.toNode;if(s!==null&&n!==null&&s!==n){let o=!0;const r=this.diagram;r!==null&&(o=r.isTreePathToChildren);const l=o?n:s,h=o?s:n;if(l.yh||(l.yh=h),h.isTreeLeaf){if(r!==null&&r.undoManager.isUndoingRedoing)return;o?s===h&&(h.isTreeLeaf=!1):n===h&&(h.isTreeLeaf=!1)}}}}c1(t,i){this.Wi(i);const e=this.ti.delete(t);let s=null;if(e||t.toNode===t.fromNode){const n=this.linkDisconnected;if(s=this.diagram,n!==null){let o=!0;s!==null&&(o=s.Y,s.Y=!0),n(this,t,i),s!==null&&(s.Y=o)}}if(e){if(!t.isTreeLink)return;let n=!0;s!==null&&(n=s.isTreePathToChildren);const o=n?t.toNode:t.fromNode,r=n?t.fromNode:t.toNode;if(o!==null&&(o.yh=!1),r!==null&&!r.isTreeLeaf)if(r.ti.count===0){if(r.yh=null,s!==null&&s.undoManager.isUndoingRedoing)return;r.isTreeLeaf=!0}else r.u0()}}u0(){if(this.yh=!1,this.ti.count===0)return;let t=!0;const i=this.diagram;if(i!==null&&i.undoManager.isUndoingRedoing)return;i!==null&&(t=i.isTreePathToChildren);const e=this.ti.iterator;for(;e.next();){const s=e.value;if(s.isTreeLink){if(t){if(s.fromNode===this){this.isTreeLeaf=!1;return}}else if(s.toNode===this){this.isTreeLeaf=!1;return}}}this.isTreeLeaf=!0}updateRelationshipsFromData(){const t=this.diagram;t!==null&&t.partManager.updateRelationshipsFromData(this)}Um(t){if(super.Um(t),!t){this.u0();const i=this.Pf;i!==null&&i.tT(this)}}Vm(t){if(super.Vm(t),!t){const i=this.Pf;i!==null&&i.iT(this)}}Kc(){if(this.ti.count>0){const t=this.diagram;if(t!==null){const i=t.commandHandler!==null?t.commandHandler.deletesConnectedLinks:!0,s=this.ti.copy().iterator;for(;s.next();){const n=s.value;i?t.remove(n):(n.fromNode===this&&(n.fromNode=null),n.toNode===this&&(n.toNode=null))}}}this.labeledLink=null,super.Kc()}get isLinkLabel(){return this.Pf!==null}get labeledLink(){return this.Pf}set labeledLink(t){const i=this.Pf;if(i!==t){const e=this.diagram,s=this.data;if(i!==null){if(i.iT(this),e!==null&&s!==null&&!e.undoManager.isUndoingRedoing){const n=i.data,o=e.model;if(n!==null&&o.Ta()){const r=o.getKeyForNodeData(s);r!==void 0&&o.removeLabelKeyForLinkData(n,r)}}this.containingGroup=null}if(this.Pf=t,t!==null){if(t.tT(this),e!==null&&s!==null&&!e.undoManager.isUndoingRedoing){const n=t.data,o=e.model;if(n!==null&&o.Ta()){const r=o.getKeyForNodeData(s);r!==void 0&&o.addLabelKeyForLinkData(n,r)}}this.containingGroup=t.containingGroup}this.sf(),this.t("labeledLink",i,t)}}findVisiblePort(t){let i=t;for(;i!==null&&(!i.actualBounds.isReal()||!i.isVisibleObject());)i=i.panel;return i===null?this.port:i}findPort(t){if(this.ne===null){if(t===""&&this.wn===!1)return this;this.eT()}let i=this.ne.get(t);return i!==null||t!==""&&(i=this.ne.get(""),i!==null)?i:this}get port(){return this.findPort("")}get ports(){return this.ne===null&&this.eT(),this.ne.iteratorValues}eT(){this.ne===null?this.ne=new GMap:this.ne.clear(),this.walkVisualTreeFrom(this,(t,i)=>t.cA(i)),this.ne.count===0&&this.ne.set("",this)}cA(t){const i=t.portId;i!==null&&this.ne!==null&&this.ne.set(i,t)}d2(t,i){const e=t.portId;if(e!==null){this.ne!==null&&this.ne.delete(e);const s=this.diagram;if(s!==null&&i){let n=null;const o=this.findLinksConnected(e);for(;o.next();){const r=o.value;n===null&&(n=Util.nt()),n.push(r)}if(n!==null){for(let r=0;r<n.length;r++){const l=n[r];s.remove(l)}Util.tt(n)}}}}isInTreeOf(t){if(t===null||t===this)return!1;let i=!0;const e=this.diagram;e!==null&&(i=e.isTreePathToChildren);let s=this;const n=t;let o;if(i)for(;s!==n;){o=null;const r=s.ti.iterator;for(;r.next();){const l=r.value;if(l.isTreeLink&&(o=l.fromNode,o!==s&&o!==this))break}if(o===this||o===null||o===s)return!1;s=o}else for(;s!==n;){o=null;const r=s.ti.iterator;for(;r.next();){const l=r.value;if(l.isTreeLink&&(o=l.toNode,o!==s&&o!==this))break}if(o===this||o===null||o===s)return!1;s=o}return!0}findTreeRoot(){let t=!0;const i=this.diagram;i!==null&&(t=i.isTreePathToChildren);let e=this,s;if(t)for(;;){s=null;const n=e.ti.iterator;for(;n.next();){const o=n.value;if(o.isTreeLink&&(s=o.fromNode,s!==e&&s!==this))break}if(s===this)return this;if(s===null||s===e)return e;e=s}else for(;;){s=null;const n=e.ti.iterator;for(;n.next();){const o=n.value;if(o.isTreeLink&&(s=o.toNode,s!==e&&s!==this))break}if(s===this)return this;if(s===null||s===e)return e;e=s}}findCommonTreeParent(t){if(t===null)return null;if(this===t)return this;let i=this;for(;i!==null;)i.l1(!0),i=i.findTreeParentNode();let e=null;for(i=t;i!==null;){if(i.JA()){e=i;break}i=i.findTreeParentNode()}for(i=this;i!==null;)i.l1(!1),i=i.findTreeParentNode();return e}findTreeParentLink(){let t=!0;const i=this.diagram;i!==null&&(t=i.isTreePathToChildren);const e=this.ti.iterator;if(t)for(;e.next();){const s=e.value;if(s.isTreeLink&&s.fromNode!==this)return s}else for(;e.next();){const s=e.value;if(s.isTreeLink&&s.toNode!==this)return s}return null}findTreeParentNode(){const t=this.yh;if(t===null)return null;if(t instanceof Node)return t;const i=this.diagram,e=i!==null?i.isTreePathToChildren:!0,s=this.ti.iterator;for(;s.next();){const n=s.value;if(!n.isTreeLink)continue;const o=e?n.fromNode:n.toNode;if(o!==this)return this.yh=o,o}return this.yh=null,null}findTreeParentChain(){function t(e,s){s.add(e);const n=e.findTreeParentLink();if(n!==null){s.add(n);const o=e.findTreeParentNode();if(o===null)return;t(o,s)}}const i=new GSet;return t(this,i),i}findTreeLevel(){return this.zv(this)}zv(t){let i=0,e=t.findTreeParentNode();for(;e!==null&&e!==t;)e=e.findTreeParentNode(),i++;return i}findTreeChildrenLinks(){let t=!0;const i=this.diagram;i!==null&&(t=i.isTreePathToChildren);const e=new ListIterator(this.ti),s=this;return t?e.predicate=n=>!(!n.isTreeLink||n.fromNode!==s):e.predicate=n=>!(!n.isTreeLink||n.toNode!==s),e}findTreeChildrenNodes(){let t=!0;const i=this.diagram;i!==null&&(t=i.isTreePathToChildren);let e=null,s=null;const n=this.ti.iterator;if(t)for(;n.next();){const o=n.value;if(o.isTreeLink&&o.fromNode===this){const r=o.toNode;e!==null?e.add(r):s!==null&&s!==r?(e=new List,e.add(s),e.add(r)):s=r}}else for(;n.next();){const o=n.value;if(o.isTreeLink&&o.toNode===this){const r=o.fromNode;e!==null?e.add(r):s!==null&&s!==r?(e=new List,e.add(s),e.add(r)):s=r}}return e!==null?e.iterator:s!==null?new SingletonIterator(s):EmptyIterator.instance}findTreeParts(t){t===void 0&&(t=1/0),Util.i(t,"number",Node,"findTreeParts:level");const i=new GSet;return Part.sh(i,this,!1,t,!0),i}collapseTree(t){t===void 0&&(t=1),t<1&&(t=1);const i=this.diagram;if(i===null||i.isCollapsingExpanding)return;i.isCollapsingExpanding=!0;const e=new GSet;e.add(this),this.sT(e,i.isTreePathToChildren,t,i,this,i.treeCollapsePolicy===1),i.isCollapsingExpanding=!1}sT(t,i,e,s,n,o){if(e>1){const r=i?this.findLinksOutOf():this.findLinksInto();for(;r.next();){const l=r.value;if(!l.isTreeLink)continue;const h=l.getOtherNode(this);h!==null&&h!==this&&!t.has(h)&&(t.add(h),h.sT(t,i,e-1,s,n,o))}}else this.nT(t,i,s,n,o)}nT(t,i,e,s,n){const o=s===this?!0:this.isTreeExpanded,r=i?this.findLinksOutOf():this.findLinksInto();for(;r.next();){const l=r.value;if(!l.isTreeLink)continue;const h=l.getOtherNode(this);if(h!==null&&h!==this){const a=t.has(h);if(a||t.add(h),o){const c=i?h.findNodesInto():h.findNodesOutOf(),f=this;c.all(u=>u===f||!u.isTreeExpanded)&&e.Lc(h,s),h.ch(),h.Bi(!1)}h.isTreeExpanded&&(h.wasTreeExpanded=h.isTreeExpanded,a||h.nT(t,i,e,s,n))}}this.isTreeExpanded=!1}expandTree(t){t===void 0&&(t=2),t<2&&(t=2);const i=this.diagram;if(i===null||i.isCollapsingExpanding)return;i.isCollapsingExpanding=!0;const e=new GSet;e.add(this),this.oT(e,i.isTreePathToChildren,t,i,this,i.treeCollapsePolicy===1),i.isCollapsingExpanding=!1}oT(t,i,e,s,n,o){const r=n===this?!1:this.isTreeExpanded,l=i?this.findLinksOutOf():this.findLinksInto();for(;l.next();){const h=l.value;if(!h.isTreeLink)continue;r||h.Se||h.invalidateRoute();const a=h.getOtherNode(this);if(a!==null&&a!==this&&!t.has(a)){if(t.add(a),!r){a.Bi(!0),a.ch();const c=i?a.findNodesInto():a.findNodesOutOf(),f=this;c.all(u=>u===f||!u.isTreeExpanded)&&s.Cc(a,n)}(e>2||a.wasTreeExpanded)&&(a.wasTreeExpanded=!1,a.oT(t,i,e-1,s,n,o))}}this.isTreeExpanded=!0}get isTreeExpanded(){return(this.E&1)!==0}set isTreeExpanded(t){const i=(this.E&1)!==0;if(i!==t){this.E=this.E^1;const e=this.diagram;this.t("isTreeExpanded",i,t);const s=this.treeExpandedChanged;if(s!==null){let n=!0;e!==null&&(n=e.Y,e.Y=!0),s(this),e!==null&&(e.Y=n)}if(e!==null&&e.undoManager.isUndoingRedoing){this.Bi(t);return}t?this.expandTree():this.collapseTree()}}get wasTreeExpanded(){return(this.E&2)!==0}set wasTreeExpanded(t){const i=(this.E&2)!==0;i!==t&&(this.E=this.E^2,this.t("wasTreeExpanded",i,t))}get treeExpandedChanged(){return this.gt!==null?this.gt.fy:null}set treeExpandedChanged(t){const i=this.treeExpandedChanged;i!==t&&(t!==null&&Util.i(t,"function",Node,"treeExpandedChanged"),this.al(),this.gt.fy=t,this.t("treeExpandedChanged",i,t))}get isTreeLeaf(){return(this.E&4)!==0}set isTreeLeaf(t){const i=(this.E&4)!==0;i!==t&&(this.E=this.E^4,this.t("isTreeLeaf",i,t))}get isTreeRoot(){return this.findTreeParentLink()===null}}class NodeTemplateSettings{gi;ay;cy;Ml;fy;hy;ly;uy;gy;eh;my;constructor(){this.gi=!1,this.ay=null,this.cy=null,this.Ml=null,this.fy=null,this.hy=Margin.rC,this.ly=1,this.uy=null,this.gy=null,this.eh=null,this.my=null}copy(){const t=new NodeTemplateSettings;return t.ay=this.ay,t.cy=this.cy,t.Ml=this.Ml,t.fy=this.fy,t.hy=this.hy.N(),t.ly=this.ly,t.uy=this.uy,t.gy=this.gy,t.eh=this.eh,t.my=this.my,t}}var LinkAdjusting=(w=>(w[w.None=0]="None",w[w.End=17]="End",w[w.Scale=18]="Scale",w[w.Stretch=19]="Stretch",w))(LinkAdjusting||{}),Routing=(w=>(w[w.Normal=1]="Normal",w[w.Orthogonal=2]="Orthogonal",w[w.AvoidsNodes=6]="AvoidsNodes",w[w.AvoidsNodesStraight=7]="AvoidsNodesStraight",w))(Routing||{}),Curve=(w=>(w[w.None=0]="None",w[w.Bezier=9]="Bezier",w[w.JumpGap=10]="JumpGap",w[w.JumpOver=11]="JumpOver",w))(Curve||{});class Link extends Part{Nt;lo;ho;Dd;ao;co;Fd;Mf;Rd;vd;Od;Da;Id;Hs;ki;cl;Mr;Sf;Jo;Q2;_2;f1;tN;iN;py;u1;ct;$o;static Fa=null;static Ra=null;af;eN;sN;constructor(t){super(Panel.Link),this.Nt=8,this.lo=null,this.ho="",this.Dd=null,this.ao=null,this.co="",this.Fd=null,this.Mf=0,this.Rd=0,this.vd=0,this.Od=NaN,this.Da=1,this.Id=.5,this.Hs=null,this.ki=new List().g(),this.cl=null,this.Mr=null,this.Sf=new Rect,this.ct=new Geometry,this.Jo=null,this.$o=null,this.Q2=null,this._2=null,this.eN=0,this.sN=0,this.f1=new Point,this.tN=null,this.iN=null,this.py=null,this.u1=NaN,this.q=null,this.af=[],t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Nt=this.Nt&-113,t.ho=this.ho,t.Dd=this.Dd,t.co=this.co,t.Fd=this.Fd,t.Mf=this.Mf,t.Rd=this.Rd,t.vd=this.vd,t.Od=this.Od,t.Da=this.Da,t.Id=this.Id,this.q!==null&&(t.q=this.q.copy())}Uo(t){super.Uo(t),this.ho=t.ho,this.co=t.co,t.cl=null,t.invalidateRoute(),t.$o=this.$o;const i=t.fromPort;i!==null&&t.fromNode.Wi(i);const e=t.toPort;e!==null&&t.toNode.Wi(e)}li(t){t in Routing||t in Curve||t in LinkAdjusting?Link.nN(t)?this.routing=t:t===9||t===10||t===11?this.curve=t:t===17||t===18||t===19?this.adjusting=t:t===1||t===0||Util.o("Unknown Link enum value for a Link property: "+t):super.li(t)}static Normal=1;static Orthogonal=2;static AvoidsNodes=6;static AvoidsNodesStraight=7;static None=0;static Bezier=9;static JumpGap=10;static JumpOver=11;static End=17;static Scale=18;static Stretch=19;static OrientAlong=21;static OrientPlus90=22;static OrientMinus90=23;static OrientOpposite=24;static OrientUpright=25;static OrientPlus90Upright=26;static OrientMinus90Upright=27;static OrientUpright45=28;static Xv=8;static Kv=16;static Yv=14;static va=8;Xe(){this.q===null&&(this.q=new LinkSettings)}_R(t,i,e){const s=t.segmentIndex,n=t.segmentFraction;let o=t.alignmentFocus;const r=t.segmentOrientation,l=t.segmentOffset;let h=0,a=0,c=0,f=0;if(isNaN(s)){const C=this.ct,S=Util.nt();C.getPointAndAngleAlongPath(n,S);const N=Point.X(S[0],S[1]);if(N.add(this.getPoint(0)),C.type===1)N.offset(-C.startX,-C.startY);else{const T=C.figures.first();N.offset(-T.startX,-T.startY)}f=S[2],r!==0&&(c=this.computeAngle(t,r,f),t.angle=c),h=N.x,a=N.y,Point.s(N),Util.tt(S)}else if(s<-i||s>=i){const C=Point.l();this.yA(C),f=this.midAngle,r!==0&&(c=this.computeAngle(t,r,f),t.angle=c),h=C.x,a=C.y,Point.s(C)}else{let C,S,N=0;if(s>=0?(C=e.r[s],S=s<i-1?e.r[s+1]:C):(N=i+s,C=e.r[N],S=N>0?e.r[N-1]:C),C.equalsApprox(S)){let T,A;s>=0?(T=s>0?e.r[s-1]:C,A=s<i-2?e.r[s+2]:S):(T=N<i-1?e.r[N+1]:C,A=N>1?e.r[N-2]:S);const D=T.distanceSquaredPoint(C),F=S.distanceSquaredPoint(A);D>F+10?f=s>=0?T.directionPoint(C):C.directionPoint(T):F>D+10?f=s>=0?S.directionPoint(A):A.directionPoint(S):f=s>=0?T.directionPoint(A):A.directionPoint(T)}else f=s>=0?C.directionPoint(S):S.directionPoint(C);r!==0&&(c=this.computeAngle(t,r,f),t.angle=c),h=C.x+(S.x-C.x)*n,a=C.y+(S.y-C.y)*n}if(o.isNone()){t.location=new Point(h,a);return}else o.isNoSpot()&&(o=Spot.Center);const u=Transform.l();u.vi(),u.et(t.scale,t.scale),u.cs(t.angle,0,0);const d=t.naturalBounds,m=Rect.X(0,0,d.width,d.height),g=Point.l();g.setRectSpot(m,o),u.xt(g);let p=-g.x,y=-g.y;const x=d.width,k=d.height,b=Point.l();b.a(l);const P=isNaN(l.x),M=isNaN(l.y);if(P||M){const C=x/2+3,S=k/2+3,N=f>=45&&f<=135,T=f>=225&&f<=315;r===0&&(N||T)?(b.x=M?C:l.y,b.y=P?S:l.x,N?s>=0||isNaN(s)&&n<.5||P&&(b.y=-S):T&&((s>=0||isNaN(s)&&n<.5)&&P&&(b.y=-S),M&&(b.x=-C))):(P&&(s>=0||isNaN(s)&&n<.5?b.x=C:b.x=-C),M&&(b.y=-S),b.rotate(f))}else b.rotate(f);h+=b.x,a+=b.y,u.Vg(m),p+=m.x,y+=m.y;const L=Point.X(h+p,a+y);t.move(L),Point.s(L),Point.s(b),Point.s(g),Rect.s(m),Transform.s(u)}jr(){let t=this.fromNode;if(t!==null){const e=t.findVisibleNode();if(e!==null&&(t=e),t.es()||t.th())return!1}let i=this.toNode;if(i!==null){const e=i.findVisibleNode();if(e!==null&&(i=e),i.es()||i.th())return!1}return!0}f2(t,i,e){return!1}u2(){}Pe(){return!1}computeAngle(t,i,e){return Link.computeAngle(i,e)}static computeAngle(t,i){let e=0;switch(t){default:case 0:e=0;break;case 21:e=i;break;case 22:e=i+90;break;case 23:e=i-90;break;case 24:e=i+180;break;case 25:e=Geo.Yg(i),e>90&&e<270&&(e-=180);break;case 26:e=Geo.Yg(i+90),e>90&&e<270&&(e-=180);break;case 27:e=Geo.Yg(i-90),e>90&&e<270&&(e-=180);break;case 28:if(e=Geo.Yg(i),e>45&&e<135||e>225&&e<315)return 0;e>90&&e<270&&(e-=180);break}return Geo.Yg(e)}get fromNode(){return this.lo}set fromNode(t){const i=this.lo;if(i!==t){const e=this.fromPort;i!==null&&(this.ao!==i&&i.c1(this,e),this.yy(),this.invalidateLayout(2)),this.lo=t,t!==null&&this.Bi(t.isVisible()),this.Jo=null,this.invalidateRoute();const s=this.diagram;s!==null&&s.Y&&s.partManager.setFromNodeForLink(this,t,i);const n=this.fromPort,o=this.fromPortChanged;if(o!==null){let r=!0;s!==null&&(r=s.Y,s.Y=!0),o(this,e,n),s!==null&&(s.Y=r)}t!==null&&(this.ao!==t&&t.a1(this,n),this.wy(),this.invalidateLayout(1)),this.t("fromNode",i,t),this.Ad()}}get fromPortId(){return this.ho}set fromPortId(t){const i=this.ho;if(i!==t){const e=this.fromPort;e!==null&&this.fromNode.Wi(e),this.yy(),this.ho=t;const s=this.fromPort;s!==null&&this.fromNode.Wi(s);const n=this.diagram;if(n!==null){const o=this.data,r=n.model;o!==null&&r.Ta()&&r.setFromPortIdForLinkData(o,t)}if(e!==s){this.Jo=null,this.invalidateRoute();const o=this.fromPortChanged;if(o!==null){let r=!0;n!==null&&(r=n.Y,n.Y=!0),o(this,e,s),n!==null&&(n.Y=r)}}this.wy(),this.t("fromPortId",i,t)}}get fromPort(){const t=this.lo;if(t===null)return null;const i=this.ho;return t.findPort(i)}get fromPortChanged(){return this.Dd}set fromPortChanged(t){const i=this.Dd;i!==t&&(t!==null&&Util.i(t,"function",Link,"fromPortChanged"),this.Dd=t,this.t("fromPortChanged",i,t))}get toNode(){return this.ao}set toNode(t){const i=this.ao;if(i!==t){const e=this.toPort;i!==null&&(this.lo!==i&&i.c1(this,e),this.yy(),this.invalidateLayout(2)),this.ao=t,t!==null&&this.Bi(t.isVisible()),this.Jo=null,this.invalidateRoute();const s=this.diagram;s!==null&&s.Y&&s.partManager.setToNodeForLink(this,t,i);const n=this.toPort,o=this.toPortChanged;if(o!==null){let r=!0;s!==null&&(r=s.Y,s.Y=!0),o(this,e,n),s!==null&&(s.Y=r)}t!==null&&(this.lo!==t&&t.a1(this,n),this.wy(),this.invalidateLayout(1)),this.t("toNode",i,t),this.Ad()}}get toPortId(){return this.co}set toPortId(t){const i=this.co;if(i!==t){const e=this.toPort;e!==null&&this.toNode.Wi(e),this.yy(),this.co=t;const s=this.toPort;s!==null&&this.toNode.Wi(s);const n=this.diagram;if(n!==null){const o=this.data,r=n.model;o!==null&&r.Ta()&&r.setToPortIdForLinkData(o,t)}if(e!==s){this.Jo=null,this.invalidateRoute();const o=this.toPortChanged;if(o!==null){let r=!0;n!==null&&(r=n.Y,n.Y=!0),o(this,e,s),n!==null&&(n.Y=r)}}this.wy(),this.t("toPortId",i,t)}}get toPort(){const t=this.ao;if(t===null)return null;const i=this.co;return t.findPort(i)}get toPortChanged(){return this.Fd}set toPortChanged(t){const i=this.Fd;i!==t&&(t!==null&&Util.i(t,"function",Link,"toPortChanged"),this.Fd=t,this.t("toPortChanged",i,t))}get fromSpot(){return this.q!==null?this.q.fa:Spot.Default}set fromSpot(t){const i=this.fromSpot;if(!i.equals(t)){if(t=t.N(),this.Xe(),this.q.fa=t,this.t("fromSpot",i,t),i.isSide()||t.isSide()){const e=this.fromNode;e!==null&&e.Wi(this.fromPort)}this.invalidateRoute()}}get fromEndSegmentLength(){return this.q!==null?this.q.da:NaN}set fromEndSegmentLength(t){const i=this.fromEndSegmentLength;if(i!==t){if(t<0&&Util._(t,">= 0",Link,"fromEndSegmentLength"),this.Xe(),this.q.da=t,this.t("fromEndSegmentLength",i,t),this.computeSpot(!0,this.fromPort).isSide()){const e=this.fromNode;e!==null&&e.Wi(this.fromPort)}this.invalidateRoute()}}get fromShortLength(){return this.q!==null?this.q.ma:NaN}set fromShortLength(t){const i=this.fromShortLength;i!==t&&(this.Xe(),this.q.ma=t,this.ee(),this.t("fromShortLength",i,t))}get toSpot(){return this.q!==null?this.q.ua:Spot.Default}set toSpot(t){const i=this.toSpot;if(!i.equals(t)){if(t=t.N(),this.Xe(),this.q.ua=t,this.t("toSpot",i,t),i.isSide()||t.isSide()){const e=this.toNode;e!==null&&e.Wi(this.toPort)}this.invalidateRoute()}}get toEndSegmentLength(){return this.q!==null?this.q.ga:NaN}set toEndSegmentLength(t){const i=this.toEndSegmentLength;if(i!==t){if(t<0&&Util._(t,">= 0",Link,"toEndSegmentLength"),this.Xe(),this.q.ga=t,this.t("toEndSegmentLength",i,t),this.computeSpot(!1,this.toPort).isSide()){const e=this.toNode;e!==null&&e.Wi(this.toPort)}this.invalidateRoute()}}get toShortLength(){return this.q!==null?this.q.pa:NaN}set toShortLength(t){const i=this.toShortLength;i!==t&&(this.Xe(),this.q.pa=t,this.ee(),this.t("toShortLength",i,t))}Ad(){const t=this.fromNode,i=this.toNode;let e=null;if(t!==null?i!==null?e=t.findCommonContainingGroup(i):e=t.containingGroup:i!==null?e=i.containingGroup:e=null,this.Gv(e),this.isLabeledLink){const s=this.labelNodes;for(;s.next();){const n=s.value;n.containingGroup=e}}}Gv(t){const i=this.ph;if(i!==t){i!==null&&i.j2(this),this.ph=t,t!==null&&t.H2(this);const e=this.containingGroupChanged;if(e!==null){let s=!0;const n=this.diagram;n!==null&&(s=n.Y,n.Y=!0),e(this,i,t),n!==null&&(n.Y=s)}this.Se&&(this.tN===i||this.iN===i)&&this.invalidateRoute()}}ch(){const t=this.containingGroup;t!==null&&this.fromNode!==t&&this.toNode!==t&&t.computesBoundsIncludingLinks&&super.ch()}getOtherNode(t){const i=this.fromNode;return t===i?this.toNode:i}getOtherPort(t){const i=this.fromPort;return t===i?this.toPort:i}get isLabeledLink(){return this.Hs===null?!1:this.Hs.count>0}get labelNodes(){return this.Hs===null?EmptyIterator.instance:this.Hs.iterator}tT(t){this.Hs===null&&(this.Hs=new GSet),this.Hs.add(t),this.c()}iT(t){this.Hs!==null&&(this.Hs.delete(t),this.c())}Um(t){if(super.Um(t),this.Oa()&&this.invalidateOtherJumpOvers(this.actualBounds),!t){const i=this.lo;let e=null;i!==null&&(e=this.fromPort,i.a1(this,e));const s=this.ao;let n=null;s!==null&&(n=this.toPort,(s!==i||n!==e)&&s.a1(this,n)),this.wy()}}Vm(t){if(super.Vm(t),this.Oa()&&this.invalidateOtherJumpOvers(this.actualBounds),!t){const i=this.lo;let e=null;i!==null&&(e=this.fromPort,i.c1(this,e));const s=this.ao;let n=null;s!==null&&(n=this.toPort,(s!==i||n!==e)&&s.c1(this,n)),this.yy()}}Kc(){if(this.Se=!0,this.Hs!==null){const i=this.diagram;if(i!==null){const s=this.Hs.copy().iterator;for(;s.next();){const n=s.value;i.remove(n)}}}if(this.data!==null){const i=this.diagram;i!==null&&i.partManager.oN(this)}}updateRelationshipsFromData(){if(this.data===null)return;const i=this.diagram;i!==null&&i.partManager.updateRelationshipsFromData(this)}move(t,i){const e=i?this.location:this.position;let s=e.x;isNaN(s)&&(s=0);let n=e.y;isNaN(n)&&(n=0);const o=t.x-s,r=t.y-n;if(i===!0)super.move(t,!1);else{const h=Point.X(e.x+o,e.y+r);super.move(h,!1),Point.s(h)}this.mr(o,r);const l=this.labelNodes;for(;l.next();){const h=l.value,a=h.position;h.moveTo(a.x+o,a.y+r)}}get relinkableFrom(){return(this.Nt&1)!==0}set relinkableFrom(t){const i=(this.Nt&1)!==0;i!==t&&(this.Nt=this.Nt^1,this.t("relinkableFrom",i,t),this.invalidateAdornments())}get relinkableTo(){return(this.Nt&2)!==0}set relinkableTo(t){const i=(this.Nt&2)!==0;i!==t&&(this.Nt=this.Nt^2,this.t("relinkableTo",i,t),this.invalidateAdornments())}canRelinkFrom(){if(!this.relinkableFrom)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowRelink)return!1;const i=t.diagram;return!(i!==null&&!i.allowRelink)}canRelinkTo(){if(!this.relinkableTo)return!1;const t=this.layer;if(t===null)return!0;if(!t.allowRelink)return!1;const i=t.diagram;return!(i!==null&&!i.allowRelink)}get resegmentable(){return(this.Nt&4)!==0}set resegmentable(t){const i=(this.Nt&4)!==0;i!==t&&(this.Nt=this.Nt^4,this.t("resegmentable",i,t),this.invalidateAdornments())}get isTreeLink(){return(this.Nt&8)!==0}set isTreeLink(t){const i=(this.Nt&8)!==0;i!==t&&(this.Nt=this.Nt^8,this.t("isTreeLink",i,t),this.fromNode!==null&&this.fromNode.u0(),this.toNode!==null&&this.toNode.u0())}get path(){const t=this.findMainElement();return t instanceof Shape?t:null}get routeBounds(){return this.updateRoute(),this.jv(this.Sf)}jv(t){let i=1/0,e=1/0;const s=this.pointsCount;if(s===0)return t.e(NaN,NaN,0,0),t;if(s===1){const n=this.getPoint(0);i=Math.min(n.x,i),e=Math.min(n.y,e),t.e(n.x,n.y,0,0)}else if(s===2){const n=this.getPoint(0),o=this.getPoint(1);i=Math.min(n.x,o.x),e=Math.min(n.y,o.y),t.e(n.x,n.y,0,0),t.unionPoint(o)}else if(this.computeCurve()===9&&s>=3&&!this.isOrthogonal){let n=this.getPoint(0);if(i=n.x,e=n.y,t.e(i,e,0,0),s===3){const o=this.getPoint(1);i=Math.min(o.x,i),e=Math.min(o.y,e);const r=this.getPoint(2);i=Math.min(r.x,i),e=Math.min(r.y,e),Geo.hu(n.x,n.y,o.x,o.y,o.x,o.y,r.x,r.y,.5,t)}else for(let o=3;o<s;o+=3){const r=this.getPoint(o-2);o+3>=s&&(o=s-1);const l=this.getPoint(o-1),h=this.getPoint(o);Geo.hu(n.x,n.y,r.x,r.y,l.x,l.y,h.x,h.y,.5,t),i=Math.min(h.x,i),e=Math.min(h.y,e),n=h}}else{const n=this.getPoint(0),o=this.getPoint(1);i=Math.min(n.x,o.x),e=Math.min(n.y,o.y),t.e(n.x,n.y,0,0),t.unionPoint(o);for(let r=2;r<s;r++){const l=this.getPoint(r);i=Math.min(l.x,i),e=Math.min(l.y,e),t.unionPoint(l)}}return this.f1.e(i-t.x,e-t.y),t}get midPoint(){return this.updateRoute(),this.computeMidPoint(new Point)}yA(t){return this.updateRoute(),this.computeMidPoint(t)}computeMidPoint(t){const i=this.pointsCount;if(i===0)return t.a(Point.Ak),t;if(i===1)return t.a(this.getPoint(0)),t;if(i===2){const a=this.getPoint(0),c=this.getPoint(1);return t.e((a.x+c.x)/2,(a.y+c.y)/2),t}if(this.isOrthogonal&&(this.computeCorner()>=15||this.computeCurve()===9)){this.ct.getPointAlongPath(.5,t),t.add(this.getPoint(0));const a=this.ct.figures.first();return t.offset(-a.startX,-a.startY),t}if(this.computeCurve()===9){if(i===3){const f=this.getPoint(0),u=this.getPoint(1),d=this.getPoint(2);return Geo.uC(f.x,f.y,u.x,u.y,u.x,u.y,d.x,d.y,t),t}const a=(i-1)/3|0,c=(a/2|0)*3;if(a%2===1){const f=this.getPoint(c),u=this.getPoint(c+1),d=this.getPoint(c+2),m=this.getPoint(c+3);return Geo.uC(f.x,f.y,u.x,u.y,d.x,d.y,m.x,m.y,t),t}else return t.a(this.getPoint(c)),t}const e=this.flattenedLengths,s=this.flattenedTotalLength;let n=0,o=0,r=0;for(;n<s/2&&o<i&&(r=e[o],!(n+r>s/2));)n+=r,o++;const l=this.getPoint(o),h=this.getPoint(o+1);if(Math.abs(l.x-h.x)<1)l.y>h.y?t.e(l.x,l.y-(s/2-n)):t.e(l.x,l.y+(s/2-n));else if(Math.abs(l.y-h.y)<1)l.x>h.x?t.e(l.x-(s/2-n),l.y):t.e(l.x+(s/2-n),l.y);else{const a=(s/2-n)/r,c=a*(h.x-l.x),f=a*(h.y-l.y);t.e(l.x+c,l.y+f)}return t}get midAngle(){return this.updateRoute(),this.computeMidAngle()}computeMidAngle(){const t=this.pointsCount;if(t<2)return NaN;if(t===2){const h=this.getPoint(0),a=this.getPoint(1);return h.directionPoint(a)}if(this.isOrthogonal&&(this.computeCorner()>=15||this.computeCurve()===9))return this.ct.getAngleAlongPath(.5);if(this.computeCurve()===9&&t>=4){const h=(t-1)/3|0;let a=(h/2|0)*3;if(h%2===1){a=Math.floor(a);const c=this.getPoint(a),f=this.getPoint(a+1),u=this.getPoint(a+2),d=this.getPoint(a+3);return Geo.vD(c.x,c.y,f.x,f.y,u.x,u.y,d.x,d.y)}else if(a>0&&a+1<t){const c=this.getPoint(a-1),f=this.getPoint(a+1);return c.directionPoint(f)}}const i=this.flattenedLengths,e=this.flattenedTotalLength;let s=0,n=0,o=0;for(;s<e/2&&n<t&&(o=i[n],!(s+o>e/2));)s+=o,n++;const r=this.getPoint(n),l=this.getPoint(n+1);if(Math.abs(r.x-l.x)<1&&Math.abs(r.y-l.y)<1){if(n>0&&n+2<t){const h=this.getPoint(n-1),a=this.getPoint(n+2);return h.directionPoint(a)}}else{if(Math.abs(r.x-l.x)<1)return r.y>l.y?270:90;if(Math.abs(r.y-l.y)<1)return r.x>l.x?180:0}return r.directionPoint(l)}Hv(){if(this.py===null){this.Se||this.d1();const t=this.py=[];this.qv(t)}}get flattenedLengths(){return this.Hv(),this.py}get flattenedTotalLength(){let t=this.u1;if(isNaN(t)){const i=this.flattenedLengths,e=i.length;t=0;for(let s=0;s<e;s++)t+=i[s];this.u1=t}return t}qv(t){const i=this.pointsCount;for(let e=0;e<i-1;e++){let s=0;const n=this.getPoint(e),o=this.getPoint(e+1);Geo.K(n.x,o.x)?(s=o.y-n.y,s<0&&(s=-s),t.push(s)):Geo.K(n.y,o.y)?(s=o.x-n.x,s<0&&(s=-s),t.push(s)):(s=Math.sqrt(n.distanceSquaredPoint(o)),t.push(s))}}get points(){return this.ki}set points(t){const i=this.ki;if(i===t)return;let e=null;if(Array.isArray(t)){const n=t;let o=n.length%2===0;if(o){for(let r=0;r<n.length;r++)if(typeof n[r]!="number"||isNaN(n[r])){o=!1;break}}if(o){e=new List;for(let r=0;r<n.length/2;r++){const l=new Point(n[r*2],n[r*2+1]).g();e.add(l)}}else{let r=!0;for(let l=0;l<n.length;l++){const h=n[l];if(!Util.wt(h)||typeof h.x!="number"||isNaN(h.x)||typeof h.y!="number"||isNaN(h.y)){r=!1;break}}if(r){e=new List;for(let l=0;l<n.length;l++){const h=n[l];e.add(new Point(h.x,h.y).g())}}}}else if(t instanceof List){e=t.copy();const n=e.iterator;for(;n.next();)n.value.g()}else Util.o("Link.points value is not an instance of List or Array: "+t);e.g(),this.ki=e,this.ee(),this.d1();const s=this.diagram;s!==null&&(!s.Bh&&!s.undoManager.isUndoingRedoing&&s.mx.add(this),s.animationManager.wi&&s.animationManager.TM(this,e)),this.t("points",i,e)}get pointsCount(){return this.ki.count}getPoint(t){return this.ki.r[t]}setPoint(t,i){this.ki.setElt(t,i)}setPointAt(t,i,e){this.ki.setElt(t,new Point(i,e))}insertPoint(t,i){this.ki.insertAt(t,i)}insertPointAt(t,i,e){this.ki.insertAt(t,new Point(i,e))}addPoint(t){this.ki.add(t)}addPointAt(t,i){this.ki.add(new Point(t,i))}removePoint(t){this.ki.removeAt(t)}clearPoints(){this.ki.clear()}mr(t,i){if(t===0&&i===0)return;if(this.pointsCount===0){this.defaultFromPoint&&this.defaultFromPoint.offset(t,i),this.defaultToPoint&&this.defaultToPoint.offset(t,i);return}const e=this.Se,s=new List,n=this.ki.iterator;for(;n.next();){const l=n.value;s.add(new Point(l.x+t,l.y+i).g())}s.g();const o=this.ki;this.ki=s;const r=this.diagram;isNaN(t)||isNaN(i)||r!==null&&r.animationManager.wi?this.c():(this.js.e(this.js.x+t,this.js.y+i),this.at.e(this.at.x+t,this.at.y+i),this.sf()),e?this.d1():(this.defaultFromPoint&&(this.defaultFromPoint=this.getPoint(0)),this.defaultToPoint&&(this.defaultToPoint=this.getPoint(this.pointsCount-1))),r!==null&&r.animationManager.wi&&r.animationManager.TM(this,s),this.t("points",o,s)}startRoute(){this.cl===null&&(this.cl=this.ki,this.ki=this.ki.copy())}commitRoute(){if(this.cl===null)return;const t=this.cl,i=this.ki;let e=1/0,s=1/0;const n=t.r,o=n.length;for(let f=0;f<o;f++){const u=n[f];e=Math.min(u.x,e),s=Math.min(u.y,s)}let r=1/0,l=1/0;const h=i.r,a=h.length;for(let f=0;f<a;f++){const u=h[f];r=Math.min(u.x,r),l=Math.min(u.y,l),u.g()}if(i.g(),a===o)for(let f=0;f<a;f++){const u=n[f],d=h[f];if(u.x-e!==d.x-r||u.y-s!==d.y-l){this.ee();break}}else this.ee();this.cl=null;const c=this.diagram;c!==null&&c.animationManager.wi&&c.animationManager.TM(this,i),this.d1(),this.t("points",t,i)}rollbackRoute(){this.cl!==null&&(this.ki=this.cl,this.cl=null)}yF(){this.Mr!==null&&(this.points=this.Mr,this.Mr=null)}d1(){if(this.ki.count===0){this.Se=!1;return}this.Se=!0,this.py=null,this.u1=NaN,this.defaultFromPoint=this.getPoint(0),this.defaultToPoint=this.getPoint(this.pointsCount-1),this.g1(!1)}invalidateRoute(){if(this.suspendsRouting)return;const t=this.path;if(t===null)return;const i=this.diagram;if(i){if(i.mx.has(this)||i.undoManager.isUndoingRedoing)return;const e=i.animationManager;if(e.isTicking&&!e.isAnimating)return;this.Mr!==null&&!e.isTicking&&(this.Mr=null)}this.Se=!1,this.c(),t.c()}get Se(){return(this.Nt&16)!==0}set Se(t){(this.Nt&16)!==0!==t&&(this.Nt=this.Nt^16)}get suspendsRouting(){return(this.Nt&32)!==0}set suspendsRouting(t){(this.Nt&32)!==0!==t&&(this.Nt=this.Nt^32)}get xy(){return(this.Nt&64)!==0}set xy(t){(this.Nt&64)!==0!==t&&(this.Nt=this.Nt^64)}get rN(){return(this.Nt&512)!==0}set rN(t){(this.Nt&512)!==0!==t&&(this.Nt=this.Nt^512)}get defaultFromPoint(){return this.Q2}set defaultFromPoint(t){this.Q2=t.copy()}get defaultToPoint(){return this._2}set defaultToPoint(t){this._2=t.copy()}updateRoute(){if(this.Se||this.xy)return;let t=!0;try{this.xy=!0,this.startRoute(),t=this.computePoints()}catch{this.xy=!1,this.rollbackRoute()}finally{this.xy=!1,t?this.commitRoute():this.rollbackRoute()}}computePoints(){const t=this.diagram;if(t===null)return!1;let i=this.fromNode,e=null;if(i===null?(Link.Fa||(Link.Fa=new Node,Link.Fa.desiredSize=Size.ru,Link.Fa.ensureBounds()),this.defaultFromPoint&&(Link.Fa.location=this.defaultFromPoint,Link.Fa.ensureBounds(),i=Link.Fa,e=Link.Fa)):e=this.fromPort,e!==null&&!i.isVisible()){const m=i.findVisibleNode();m!==null&&m!==i?(i=m,e=m.port):i=m}if(this.tN=i,i===null||!i.location.isReal()||(e=i.findVisiblePort(e),e===null))return!1;let s=this.toNode,n=null;if(s===null?(Link.Ra||(Link.Ra=new Node,Link.Ra.desiredSize=Size.ru,Link.Ra.ensureBounds()),this.defaultToPoint&&(Link.Ra.location=this.defaultToPoint,Link.Ra.ensureBounds(),s=Link.Ra,n=Link.Ra)):n=this.toPort,n!==null&&!s.isVisible()){const m=s.findVisibleNode();m!==null&&m!==s?(s=m,n=m.port):s=m}if(this.iN=s,s===null||!s.location.isReal()||(n=s.findVisiblePort(n),n===null))return!1;const o=this.pointsCount,r=this.computeSpot(!0,e),l=this.computeSpot(!1,n),h=this.Ed(r),a=this.Ed(l),c=e===n&&e!==null,f=this.isOrthogonal;let u=this.curve===9;c&&!f?(u=!0,this.Jo=!0):this.Jo=!1;const d=this.computeAdjusting()===0||c;if(!f&&!c&&h&&a){let m=!1;if(!d&&o>=3){let g=this.getLinkPoint(i,e,r,!0,!1,s,n),p=this.getLinkPoint(s,n,l,!1,!1,i,e);m=this.adjustPoints(0,g,o-1,p),m&&(g=this.getLinkPoint(i,e,r,!0,!1,s,n),p=this.getLinkPoint(s,n,l,!1,!1,i,e),this.adjustPoints(0,g,o-1,p))}m||(this.clearPoints(),u?this.Wv(i,e,r,s,n,l):this.Jv(i,e,r,s,n,l))}else{const m=this.isAvoiding;d&&(f&&m||c)&&this.clearPoints();const g=c?this.computeCurviness():0,p=this.getLinkPoint(i,e,r,!0,f,s,n);let y=0,x=0,k=0;if(f||!h||c){let N=this.computeEndSegmentLength(i,e,r,!0);if(k=this.getLinkDirection(i,e,p,r,!0,f,s,n),c&&(h||r.equals(l)||!f&&r.x+l.x===1&&r.y+l.y===1)&&(k-=f?90:30,g<0&&(k-=180)),k<0?k+=360:k>=360&&(k-=360),c&&(N+=Math.abs(g)*(f?1:2)),k===0?y=N:k===90?x=N:k===180?y=-N:k===270?x=-N:(y=N*Math.cos(k*Math.PI/180),x=N*Math.sin(k*Math.PI/180)),r.isNoSpot()&&c){const T=e.getDocumentPoint(Spot.Center,Point.l()),A=Point.X(T.x+y*1e3,T.y+x*1e3);this.getLinkPointFromPoint(i,e,T,A,!0,p),Point.s(T),Point.s(A)}}const b=this.getLinkPoint(s,n,l,!1,f,i,e);let P=0,M=0,L=0;if(f||!a||c){let N=this.computeEndSegmentLength(s,n,l,!1);if(L=this.getLinkDirection(s,n,b,l,!1,f,i,e),c&&(a||r.equals(l)||!f&&r.x+l.x===1&&r.y+l.y===1)&&(L+=f?0:30,g<0&&(L+=180)),L<0?L+=360:L>=360&&(L-=360),c&&(N+=Math.abs(g)*(f?1:2)),L===0?P=N:L===90?M=N:L===180?P=-N:L===270?M=-N:(P=N*Math.cos(L*Math.PI/180),M=N*Math.sin(L*Math.PI/180)),l.isNoSpot()&&c){const T=n.getDocumentPoint(Spot.Center,Point.l()),A=Point.X(T.x+P*1e3,T.y+M*1e3);this.getLinkPointFromPoint(s,n,T,A,!1,b),Point.s(T),Point.s(A)}}let C=p;(f||!h||c)&&(C=new Point(p.x+y,p.y+x));let S=b;(f||!a||c)&&(S=new Point(b.x+P,b.y+M)),!d&&!f&&h&&o>3&&this.adjustPoints(0,p,o-2,S)?this.setPoint(o-1,b):!d&&!f&&a&&o>3&&this.adjustPoints(1,C,o-1,b)?this.setPoint(0,p):!d&&(f?o>=6:o>4)&&this.adjustPoints(1,C,o-2,S)?(this.setPoint(0,p),this.setPoint(o-1,b)):(this.clearPoints(),this.addPoint(p),(f||!h||c)&&this.addPoint(C),f&&this.addOrthoPoints(C,k,S,L,i,s),(f||!a||c)&&this.addPoint(S),this.addPoint(b))}return t.addInvalidRoute(this),!0}lN(t,i){return Math.abs(i.x-t.x)>Math.abs(i.y-t.y)?(i.x>=t.x?i.x=t.x+9e9:i.x=t.x-9e9,i.y=t.y):(i.y>=t.y?i.y=t.y+9e9:i.y=t.y-9e9,i.x=t.x),i}getLinkPointFromPoint(t,i,e,s,n,o){if(o===void 0&&(o=new Point),t===null||i===null)return o.a(e),o;if(!t.isVisible()){const u=t.findVisibleNode();u!==null&&u!==t&&(t=u,i=t.port)}let r=0,l=0,h=0,a=0,c=null,f=i.panel;if(f!==null&&!f.pn()&&(f=f.panel),f===null)r=s.x,l=s.y,h=e.x,a=e.y;else{c=f.Es;const u=1/(c.m11*c.m22-c.m12*c.m21),d=c.m22*u,m=-c.m12*u,g=-c.m21*u,p=c.m11*u,y=u*(c.m21*c.dy-c.m22*c.dx),x=u*(c.m12*c.dx-c.m11*c.dy);r=s.x*d+s.y*g+y,l=s.x*m+s.y*p+x,h=e.x*d+e.y*g+y,a=e.x*m+e.y*p+x}return i.Zc(r,l,h,a,o),c!==null&&o.D(c),o}$v(t,i){const e=t.$u;return e!==null?e.rT(i):null}m1(t){let i=t.$u;return i===null&&(i=new Knot,i.Zo=t,i.de=t.part,t.$u=i),i.rT(this)}getLinkPoint(t,i,e,s,n,o,r,l){if(l===void 0&&(l=new Point),e.isSpot()&&!this.Ed(e))return i.getDocumentPoint(e,l),l;if(e.isSide()){const c=this.m1(i);if(c!==null){const f=c.Bd;if(l.a(f),n&&this.routing===7){const u=this.m1(r);if(u!==null&&c.Nf<u.Nf){const d=Point.l(),m=Point.l(),g=new Rect(i.getDocumentPoint(Spot.TopLeft,d),i.getDocumentPoint(Spot.BottomRight,m)),p=this.computeSpot(!s,r),y=this.getLinkPoint(o,r,p,!s,n,t,i,m);(e.includesSide(Spot.LeftSide)||e.includesSide(Spot.RightSide))&&y.y>=g.y&&y.y<=g.y+g.height?l.y=y.y:(e.includesSide(Spot.TopSide)||e.includesSide(Spot.BottomSide))&&y.x>=g.x&&y.x<=g.x+g.width&&(l.x=y.x),Point.s(d),Point.s(m)}}return l}}const h=i.getDocumentPoint(this.p1(e,s),Point.l());let a=null;if(this.pointsCount>(n?6:2))a=s?this.getPoint(1):this.getPoint(this.pointsCount-2),n&&(a=this.lN(h,a.copy()));else{const c=this.computeSpot(!s,r),f=Point.l();a=r.getDocumentPoint(this.p1(c,!s),f),n&&(a=this.lN(h,a)),Point.s(f)}return this.getLinkPointFromPoint(t,i,h,a,s,l),Point.s(h),l}getLinkDirection(t,i,e,s,n,o,r,l){let h=this.Zv(t,i,e,s,n,o,r,l);if(r&&s.isNoSpot()&&r.isMemberOf(t)&&(h+=180,h>=360&&(h-=360)),this.Ed(s))return h;const a=i.getDocumentAngle();return a===0||(45<=a&&a<135?h+=90:135<=a&&a<225?h+=180:225<=a&&a<315&&(h+=270),h>=360&&(h-=360)),h}Zv(t,i,e,s,n,o,r,l){if(s.isSpot())return s.x>s.y?s.x>1-s.y?0:s.x<1-s.y?270:315:s.x<s.y?s.x>1-s.y?90:s.x<1-s.y?180:135:s.x<.5?225:s.x>.5?45:0;if(s.isSide()){const f=this.m1(i);if(f!==null)switch(f.me){case 1:return 270;case 2:return 180;default:case 4:return 0;case 8:return 90}}const h=i.getDocumentPoint(Spot.Center,Point.l());let a=null;if(this.pointsCount>(o?6:2))a=n?this.getPoint(1):this.getPoint(this.pointsCount-2),o?a=this.lN(h,a.copy()):a=e;else{const f=Point.l();a=l.getDocumentPoint(Spot.Center,f),Point.s(f)}let c=0;return Math.abs(a.x-h.x)>Math.abs(a.y-h.y)?a.x>=h.x?c=0:c=180:a.y>=h.y?c=90:c=270,Point.s(h),c}computeEndSegmentLength(t,i,e,s){if(i!==null&&e.isSide()){const o=this.m1(i);if(o!==null)return o.w1}let n=NaN;return s?n=this.fromEndSegmentLength:n=this.toEndSegmentLength,i!==null&&isNaN(n)&&(s?n=i.fromEndSegmentLength:n=i.toEndSegmentLength),isNaN(n)&&(n=10),n}computeSpot(t,i){return i===void 0&&(i=null),t?this.Qv(i||this.fromPort):this._v(i||this.toPort)}Qv(t){if(t===null)return Spot.Center;let i=this.fromSpot;return i.isDefault()&&(i=t.fromSpot),i===Spot.Default?Spot.None:i}_v(t){if(t===null)return Spot.Center;let i=this.toSpot;return i.isDefault()&&(i=t.toSpot),i===Spot.Default?Spot.None:i}Ed(t){return t===Spot.None||t.x===.5&&t.y===.5}p1(t,i){return t.x===.5&&t.y===.5?t:Spot.Center}computeOtherPoint(t,i){if(this.computeAdjusting()!==0&&this.pointsCount>4)return this.computeMidPoint(new Point);{const e=this.$v(i,this);return e!==null?e.Bd:i.getDocumentPoint(Spot.Center)}}computeShortLength(t){if(t){let i=this.fromShortLength;if(isNaN(i)){const e=this.fromPort;e!==null&&(i=e.fromShortLength)}return isNaN(i)?0:i}else{let i=this.toShortLength;if(isNaN(i)){const e=this.toPort;e!==null&&(i=e.toShortLength)}return isNaN(i)?0:i}}Im(t,i,e,s,n,o){if(this.pickable===!1)return!1;i===void 0&&(i=null),e===void 0&&(e=null);let r=o;if(o===void 0&&(r=Transform.l(),r.vi()),r.ic(this.D),this.containedInRect(t,r))return this.F2(i,e,n),o===void 0&&Transform.s(r),!0;if(this.intersectsRect(t,r)){let l=!1;if(!this.cf){const h=this.L.r,a=h.length;for(let c=a;c--;){const f=h[c];if(!f.visible&&f!==this.locationObject)continue;const u=f.actualBounds,d=this.naturalBounds;if(u.x>d.width||u.y>d.height||u.x+u.width<0||u.y+u.height<0)continue;const m=f,g=Transform.l();if(g.set(r),m instanceof Panel?l=m.Im(t,i,e,s,n,g):this.path===m?m instanceof Shape&&(l=m.kv(t,s,g)):l=m.iA(t,s,g),l){let p=m;i!==null&&(p=i(m)),p&&(e===null||e(p))&&n.add(p)}Transform.s(g)}}return o===void 0&&Transform.s(r),l||this.background!==null}return o===void 0&&Transform.s(r),!1}get isOrthogonal(){return(this.Da&2)===2}static nN(t){return(t&2)===2}get isAvoiding(){return(this.Da&4)===4}computeCurve(){if(this.Jo===null){const t=this.fromPort,i=t!==null&&t===this.toPort,e=this.isOrthogonal;this.Jo=i&&!e}return this.Jo?9:this.curve}computeCorner(){if(this.curve===9)return 0;let t=this.corner;return(isNaN(t)||t<0)&&(t=10),t}findMidLabel(){const t=this.path,i=this.L.r,e=i.length;for(let n=0;n<e;n++){const o=i[n];if(!(o===t||o.isPanelMain)&&(o.segmentIndex===-1/0||isNaN(o.segmentIndex)))return o}const s=this.labelNodes;for(;s.next();){const n=s.value;if(n.segmentIndex===-1/0||isNaN(n.segmentIndex))return n}return null}computeSpacing(){if(!this.isVisible())return 0;let t=Link.Yv;t=Math.max(t,this.computeThickness());const i=this.fromPort,e=this.toPort;if(i!==null&&e!==null){const s=this.findMidLabel();if(s!==null){const n=s.naturalBounds,o=s.margin,r=isNaN(n.width)?30:n.width*s.scale+o.left+o.right,l=isNaN(n.height)?14:n.height*s.scale+o.top+o.bottom,h=s.segmentOrientation;if(h===21||h===25||h===24)t=Math.max(t,l);else if(h===23||h===27||h===22||h===26)t=Math.max(t,r);else{const c=i.getDocumentPoint(Spot.Center).directionPoint(e.getDocumentPoint(Spot.Center))/180*Math.PI;t=Math.max(t,Math.abs(Math.sin(c)*r)+Math.abs(Math.cos(c)*l)+1)}this.curve===9&&(t*=1.333)}}return t}arrangeBundledLinks(t,i){if(i)for(let e=0;e<t.length;e++){const s=t[e];s.computeAdjusting()===0&&s.invalidateRoute()}}computeCurviness(){let t=this.curviness;if(isNaN(t)){t=Link.Kv;const i=this.$o;if(i!==null){const e=Util.nt();let s=0;const n=i.qs;for(let r=0;r<n.length;r++){const h=n[r].computeSpacing();e.push(h),s+=h}let o=-s/2;for(let r=0;r<n.length;r++){if(n[r]===this){t=o+e[r]/2;break}o+=e[r]}i.ry===this.fromNode&&(t=-t),Util.tt(e)}}return t}computeThickness(){if(!this.isVisible())return 0;const t=this.path;return t!==null?Math.max(t.strokeWidth,1):1}hasCurviness(){return!isNaN(this.curviness)||this.$o!==null}Jv(t,i,e,s,n,o){const r=this.getLinkPoint(t,i,e,!0,!1,s,n),l=this.getLinkPoint(s,n,o,!1,!1,t,i);if(this.hasCurviness()){const h=l.x-r.x,a=l.y-r.y,c=this.computeCurviness(),f=c,u=r.x+h/2,d=r.y+a/2;let m=u,g=d;if(Geo.u(a,0))h>0?g-=f:g+=f;else{const p=-h/a;let y=Math.sqrt(f*f/(p*p+1));c<0&&(y=-y),m=(a<0?-1:1)*y+u,g=p*(m-u)+d}this.addPoint(r),this.addPointAt(m,g),this.addPoint(l)}else{this.addPoint(r),this.addPoint(l);const h=Rect.l();i.getDocumentBounds(h);const a=h.containsPoint(l);n.getDocumentBounds(h);const c=h.containsPoint(r);if(a||c){const f=i.getDocumentPoint(this.p1(e,!0),new Point);this.setPoint(0,this.getLinkPointFromPoint(t,i,f,l,!0,f));const u=n.getDocumentPoint(this.p1(o,!1),new Point);this.setPoint(1,this.getLinkPointFromPoint(s,n,u,r,!1,u))}Rect.s(h)}}Wv(t,i,e,s,n,o){const r=this.getLinkPoint(t,i,e,!0,!1,s,n),l=this.getLinkPoint(s,n,o,!1,!1,t,i),h=l.x-r.x,a=l.y-r.y,c=this.computeCurviness();let f=0,u=0,d=r.x+h/3,m=r.y+a/3,g=d,p=m;Geo.u(a,0)?h>0?p-=c:p+=c:(f=-h/a,u=Math.sqrt(c*c/(f*f+1)),c<0&&(u=-u),g=(a<0?-1:1)*u+d,p=f*(g-d)+m),d=r.x+2*h/3,m=r.y+2*a/3;let y=d,x=m;Geo.u(a,0)?h>0?x-=c:x+=c:(y=(a<0?-1:1)*u+d,x=f*(y-d)+m),this.clearPoints(),this.addPoint(r),this.addPointAt(g,p),this.addPointAt(y,x),this.addPoint(l),this.setPoint(0,this.getLinkPoint(t,i,e,!0,!1,s,n)),this.setPoint(3,this.getLinkPoint(s,n,o,!1,!1,t,i))}adjustPoints(t,i,e,s){let n=this.computeAdjusting();if(this.isOrthogonal){if(n===18)return!1;n===19&&(n=17)}switch(n){case 18:return this.tO(t,i,e,s);case 19:return this.iO(t,i,e,s);case 17:return this.eO(t,i,e,s);default:return!1}}tO(t,i,e,s){const n=this.getPoint(t),o=this.getPoint(e);if(n.equalsApprox(i)&&o.equalsApprox(s))return!0;const r=n.x,l=n.y,h=o.x,a=o.y;let c=h-r,f=a-l;const u=Math.sqrt(c*c+f*f);if(Geo.K(u,0))return!0;let d=0;Geo.K(c,0)?f<0?d=-Math.PI/2:d=Math.PI/2:(d=Math.atan(f/Math.abs(c)),c<0&&(d=Math.PI-d));const m=i.x,g=i.y,p=s.x,y=s.y,x=p-m,k=y-g,b=Math.sqrt(x*x+k*k);let P=0;Geo.K(x,0)?k<0?P=-Math.PI/2:P=Math.PI/2:(P=Math.atan(k/Math.abs(x)),x<0&&(P=Math.PI-P));const M=b/u,L=P-d;this.setPoint(t,i);for(let C=t+1;C<e;C++){const S=this.getPoint(C);c=S.x-r,f=S.y-l;const N=Math.sqrt(c*c+f*f);if(Geo.K(N,0))continue;let T=0;Geo.K(c,0)?f<0?T=-Math.PI/2:T=Math.PI/2:(T=Math.atan(f/Math.abs(c)),c<0&&(T=Math.PI-T));const A=T+L,D=N*M,F=m+D*Math.cos(A),R=g+D*Math.sin(A);this.setPointAt(C,F,R)}return this.setPoint(e,s),!0}iO(t,i,e,s){const n=this.getPoint(t),o=this.getPoint(e);if(n.equalsApprox(i)&&o.equalsApprox(s))return!0;const r=n.x,l=n.y,h=o.x,a=o.y,c=(h-r)*(h-r)+(a-l)*(a-l),f=i.x,u=i.y,d=s.x,m=s.y;let g=0,p=1;d-f!==0?(g=(m-u)/(d-f),p=Math.sqrt(1+1/(g*g))):g=9e9,this.setPoint(t,i);for(let y=t+1;y<e;y++){const x=this.getPoint(y),k=x.x,b=x.y;let P=.5;c!==0&&(P=((r-k)*(r-h)+(l-b)*(l-a))/c);const M=r+P*(h-r),L=l+P*(a-l);let C=Math.sqrt((k-M)*(k-M)+(b-L)*(b-L));b<g*(k-M)+L&&(C=-C),g>0&&(C=-C);const S=f+P*(d-f),N=u+P*(m-u);if(g!==0){const T=S+C/p,A=N-(T-S)/g;this.setPointAt(y,T,A)}else this.setPointAt(y,S,N+C)}return this.setPoint(e,s),!0}eO(t,i,e,s){if(this.isOrthogonal){let n=this.getPoint(t),o=this.getPoint(t+1),r=this.getPoint(t+2),l=o.x,h=o.y;const a=l,c=h;Geo.u(n.y,o.y)?Geo.u(o.x,r.x)?h=i.y:Geo.u(o.y,r.y)&&(l=i.x):Geo.u(n.x,o.x)&&(Geo.u(o.y,r.y)?l=i.x:Geo.u(o.x,r.x)&&(h=i.y)),this.setPointAt(t+1,l,h),n=this.getPoint(e),o=this.getPoint(e-1),r=this.getPoint(e-2);let f=o.x,u=o.y;const d=f,m=u;if(Geo.u(n.y,o.y)?Geo.u(o.x,r.x)?u=s.y:Geo.u(o.y,r.y)&&(f=s.x):Geo.u(n.x,o.x)&&(Geo.u(o.y,r.y)?f=s.x:Geo.u(o.x,r.x)&&(u=s.y)),this.setPointAt(e-1,f,u),this.FL())return this.setPointAt(t+1,a,c),this.setPointAt(e-1,d,m),!1}return this.setPoint(t,i),this.setPoint(e,s),!0}addOrthoPoints(t,i,e,s,n,o){i<0?i+=360:i>=360&&(i-=360),s<0?s+=360:s>=360&&(s-=360);const c=s;i>=315||i<45?i=0:45<=i&&i<135?i=90:135<=i&&i<225?i=180:i=270,s>=315||s<45?s=0:45<=s&&s<135?s=90:135<=s&&s<225?s=180:s=270;const f=t,u=e,d=n.actualBounds.copy(),m=o.actualBounds.copy();if(!d.isReal()||!m.isReal())return;d.inflate(Link.va,Link.va),m.inflate(Link.va,Link.va),d.unionPoint(t),m.unionPoint(e);const g=Point.l(),p=Point.l();i===0?u.x>f.x||s===270&&u.y<f.y&&m.right>f.x||s===90&&u.y>f.y&&m.right>f.x?(g.e(u.x,f.y),p.e(u.x,(f.y+u.y)/2),s===180?(g.x=this.computeMidOrthoPosition(f.x,f.y,u.x,u.y,!1),p.x=g.x,p.y=u.y):s===270&&u.y<f.y||s===90&&u.y>f.y?(f.x<m.left?g.x=this.computeMidOrthoPosition(f.x,f.y,m.left,u.y,!1):f.x<m.right&&(s===270&&f.y<m.top||s===90&&f.y>m.bottom)?g.x=this.computeMidOrthoPosition(f.x,f.y,u.x,u.y,!1):g.x=m.right,p.x=g.x,p.y=u.y):s===0&&f.x<m.left&&f.y>m.top&&f.y<m.bottom&&(g.x=f.x,f.y<u.y?g.y=Math.min(u.y,m.top):g.y=Math.max(u.y,m.bottom),p.y=g.y)):(g.e(f.x,u.y),p.e((f.x+u.x)/2,u.y),(s===180||s===90&&u.y<d.top||s===270&&u.y>d.bottom)&&(s===180&&(m.containsPoint(f)||d.containsPoint(u))?g.y=this.computeMidOrthoPosition(f.x,f.y,u.x,u.y,!0):u.y<f.y&&(s===180||s===90)?g.y=this.computeMidOrthoPosition(f.x,d.top,u.x,Math.max(u.y,m.bottom),!0):u.y>f.y&&(s===180||s===270)&&(g.y=this.computeMidOrthoPosition(f.x,d.bottom,u.x,Math.min(u.y,m.top),!0)),p.x=u.x,p.y=g.y),g.y>d.top&&g.y<d.bottom&&(u.x>=d.left&&u.x<=f.x||f.x<=m.right&&f.x>=u.x?(s===90||s===270)&&(g.e(Math.max((f.x+u.x)/2,f.x),f.y),p.e(g.x,u.y)):(s===270||(s===0||s===180)&&u.y<f.y?g.y=Math.min(u.y,s===0?d.top:Math.min(d.top,m.top)):g.y=Math.max(u.y,s===0?d.bottom:Math.max(d.bottom,m.bottom)),p.x=u.x,p.y=g.y))):i===180?u.x<f.x||s===270&&u.y<f.y&&m.left<f.x||s===90&&u.y>f.y&&m.left<f.x?(g.e(u.x,f.y),p.e(u.x,(f.y+u.y)/2),s===0?(g.x=this.computeMidOrthoPosition(f.x,f.y,u.x,u.y,!1),p.x=g.x,p.y=u.y):s===270&&u.y<f.y||s===90&&u.y>f.y?(f.x>m.right?g.x=this.computeMidOrthoPosition(f.x,f.y,m.right,u.y,!1):f.x>m.left&&(s===270&&f.y<m.top||s===90&&f.y>m.bottom)?g.x=this.computeMidOrthoPosition(f.x,f.y,u.x,u.y,!1):g.x=m.left,p.x=g.x,p.y=u.y):s===180&&f.x>m.right&&f.y>m.top&&f.y<m.bottom&&(g.x=f.x,f.y<u.y?g.y=Math.min(u.y,m.top):g.y=Math.max(u.y,m.bottom),p.y=g.y)):(g.e(f.x,u.y),p.e((f.x+u.x)/2,u.y),(s===0||s===90&&u.y<d.top||s===270&&u.y>d.bottom)&&(s===0&&(m.containsPoint(f)||d.containsPoint(u))?g.y=this.computeMidOrthoPosition(f.x,f.y,u.x,u.y,!0):u.y<f.y&&(s===0||s===90)?g.y=this.computeMidOrthoPosition(f.x,d.top,u.x,Math.max(u.y,m.bottom),!0):u.y>f.y&&(s===0||s===270)&&(g.y=this.computeMidOrthoPosition(f.x,d.bottom,u.x,Math.min(u.y,m.top),!0)),p.x=u.x,p.y=g.y),g.y>d.top&&g.y<d.bottom&&(u.x<=d.right&&u.x>=f.x||f.x>=m.left&&f.x<=u.x?(s===90||s===270)&&(g.e(Math.min((f.x+u.x)/2,f.x),f.y),p.e(g.x,u.y)):(s===270||(s===0||s===180)&&u.y<f.y?g.y=Math.min(u.y,s===180?d.top:Math.min(d.top,m.top)):g.y=Math.max(u.y,s===180?d.bottom:Math.max(d.bottom,m.bottom)),p.x=u.x,p.y=g.y))):i===90?u.y>f.y||s===180&&u.x<f.x&&m.bottom>f.y||s===0&&u.x>f.x&&m.bottom>f.y?(g.e(f.x,u.y),p.e((f.x+u.x)/2,u.y),s===270?(g.y=this.computeMidOrthoPosition(f.x,f.y,u.x,u.y,!0),p.x=u.x,p.y=g.y):s===180&&u.x<f.x||s===0&&u.x>f.x?(f.y<m.top?g.y=this.computeMidOrthoPosition(f.x,f.y,u.x,m.top,!0):f.y<m.bottom&&(s===180&&f.x<m.left||s===0&&f.x>m.right)?g.y=this.computeMidOrthoPosition(f.x,f.y,u.x,u.y,!0):g.y=m.bottom,p.x=u.x,p.y=g.y):s===90&&f.y<m.top&&f.x>m.left&&f.x<m.right&&(f.x<u.x?g.x=Math.min(u.x,m.left):g.x=Math.max(u.x,m.right),g.y=f.y,p.x=g.x)):(g.e(u.x,f.y),p.e(u.x,(f.y+u.y)/2),(s===270||s===0&&u.x<d.left||s===180&&u.x>d.right)&&(s===270&&(m.containsPoint(f)||d.containsPoint(u))?g.x=this.computeMidOrthoPosition(f.x,f.y,u.x,u.y,!1):u.x<f.x&&(s===270||s===0)?g.x=this.computeMidOrthoPosition(d.left,f.y,Math.max(u.x,m.right),u.y,!1):u.x>f.x&&(s===270||s===180)&&(g.x=this.computeMidOrthoPosition(d.right,f.y,Math.min(u.x,m.left),u.y,!1)),p.x=g.x,p.y=u.y),g.x>d.left&&g.x<d.right&&(u.y>=d.top&&u.y<=f.y||f.y<=m.bottom&&f.y>=u.y?(s===0||s===180)&&(g.e(f.x,Math.max((f.y+u.y)/2,f.y)),p.e(u.x,g.y)):(s===180||(s===90||s===270)&&u.x<f.x?g.x=Math.min(u.x,s===90?d.left:Math.min(d.left,m.left)):g.x=Math.max(u.x,s===90?d.right:Math.max(d.right,m.right)),p.x=g.x,p.y=u.y))):u.y<f.y||s===180&&u.x<f.x&&m.top<f.y||s===0&&u.x>f.x&&m.top<f.y?(g.e(f.x,u.y),p.e((f.x+u.x)/2,u.y),s===90?(g.y=this.computeMidOrthoPosition(f.x,f.y,u.x,u.y,!0),p.x=u.x,p.y=g.y):s===180&&u.x<f.x||s===0&&u.x>=f.x?(f.y>m.bottom?g.y=this.computeMidOrthoPosition(f.x,f.y,u.x,m.bottom,!0):f.y>m.top&&(s===180&&f.x<m.left||s===0&&f.x>m.right)?g.y=this.computeMidOrthoPosition(f.x,f.y,u.x,u.y,!0):g.y=m.top,p.x=u.x,p.y=g.y):s===270&&f.y>m.bottom&&f.x>m.left&&f.x<m.right&&(f.x<u.x?g.x=Math.min(u.x,m.left):g.x=Math.max(u.x,m.right),g.y=f.y,p.x=g.x)):(g.e(u.x,f.y),p.e(u.x,(f.y+u.y)/2),(s===90||s===0&&u.x<d.left||s===180&&u.x>d.right)&&(s===90&&(m.containsPoint(f)||d.containsPoint(u))?g.x=this.computeMidOrthoPosition(f.x,f.y,u.x,u.y,!1):u.x<f.x&&(s===90||s===0)?g.x=this.computeMidOrthoPosition(d.left,f.y,Math.max(u.x,m.right),u.y,!1):u.x>f.x&&(s===90||s===180)&&(g.x=this.computeMidOrthoPosition(d.right,f.y,Math.min(u.x,m.left),u.y,!1)),p.x=g.x,p.y=u.y),g.x>d.left&&g.x<d.right&&(u.y<=d.bottom&&u.y>=f.y||f.y>=m.top&&f.y<=u.y?(s===0||s===180)&&(g.e(f.x,Math.min((f.y+u.y)/2,f.y)),p.e(u.x,g.y)):(s===180||(s===90||s===270)&&u.x<f.x?g.x=Math.min(u.x,s===270?d.left:Math.min(d.left,m.left)):g.x=Math.max(u.x,s===270?d.right:Math.max(d.right,m.right)),p.x=g.x,p.y=u.y))),this.rN=s!==c,this.eN=i,this.sN=s,this.addPoint(g.copy()),this.addPoint(p.copy()),Point.s(g),Point.s(p)}computeMidOrthoPosition(t,i,e,s,n){let o=0;return this.hasCurviness()&&!this.computeSpot(!0,this.fromPort).isSide()&&!this.computeSpot(!1,this.toPort).isSide()&&(o=this.computeCurviness()),n?(i+s)/2+o:(t+e)/2+o}FL(){if(this.diagram===null||!this.isAvoiding||this.diagram.animationManager.isTicking)return!1;const t=this.points.r,i=t.length;if(i<4)return!1;const e=this.diagram.getPositions(!1,this.containingGroup,null);for(let s=1;s<i-2;s++){const n=t[s],o=t[s+1];if(!e.isUnoccupied(Math.min(n.x,o.x),Math.min(n.y,o.y),Math.abs(n.x-o.x),Math.abs(n.y-o.y)))return!0}return!1}findClosestSegment(t){const i=t.x,e=t.y;let s=this.getPoint(0),n=this.getPoint(1),o=Point.distanceLineSegmentSquared(i,e,s.x,s.y,n.x,n.y),r=0;for(let l=1;l<this.pointsCount-1;l++){s=this.getPoint(l+1);const h=Point.distanceLineSegmentSquared(i,e,n.x,n.y,s.x,s.y);n=s,h<o&&(r=l,o=h)}return r}ee(){this.wh=!1,this.c()}get wh(){return(this.Nt&128)!==0}set wh(t){(this.Nt&128)!==0!==t&&(this.Nt=this.Nt^128)}get geometry(){if(!this.wh){if(this.updateRoute(),this.pointsCount<2)return this.wh=!0,this.ct;this.ct=this.makeGeometry()}return this.ct}ad(t){if(!t){if(this.Se===!1)return;const n=this.findMainElement();if(this.wh&&(n===null||n.geometry!==null))return}this.pointsCount<2?this.wh=!0:this.ct=this.makeGeometry();const i=this.path;if(i===null)return;i.ct=this.ct;const e=this.L.r,s=e.length;for(let n=0;n<s;n++){const o=e[n];o!==i&&o.isPanelMain&&o instanceof Shape&&(o.ct=this.ct)}}sO(t){return this.Oa()&&t.Jl.has(this)&&(this.Sf.width!==0||this.Sf.height!==0)&&(t.animationManager.isAnimating||t.currentTool!==t.toolManager)}makeGeometry(){const t=this.ct,i=this.pointsCount;let e=!1;const s=this.diagram;s!==null&&this.sO(s)&&(e=!0);let n=0,o=0,r=this.getPoint(0).copy();const l=r.copy(),h=this.ki.r,a=this.computeCurve();if(a===9&&i>=3&&!Geo.K(this.smoothness,0))if(i===3){let c=this.getPoint(1);n=Math.min(r.x,c.x),o=Math.min(r.y,c.y),c=this.getPoint(2),n=Math.min(n,c.x),o=Math.min(o,c.y)}else if(this.isOrthogonal){for(let c=0;c<i;c++){const f=h[c];l.x=Math.min(f.x,l.x),l.y=Math.min(f.y,l.y)}n=l.x,o=l.y}else{for(let c=3;c<i;c+=3){c+3>=i&&(c=i-1);const f=this.getPoint(c);l.x=Math.min(f.x,l.x),l.y=Math.min(f.y,l.y)}n=l.x,o=l.y}else{for(let c=0;c<i;c++){const f=h[c];l.x=Math.min(f.x,l.x),l.y=Math.min(f.y,l.y)}n=l.x,o=l.y}if(n-=this.f1.x,o-=this.f1.y,r.x-=n,r.y-=o,i===2&&!this.Oa()){let c=this.getPoint(1).copy();return c.x-=n,c.y-=o,this.computeShortLength(!0)!==0&&(r=this.Cf(r,!0,l)),this.computeShortLength(!1)!==0&&(c=this.Cf(c,!1,l)),t.type=1,t.startX=r.x,t.startY=r.y,t.endX=c.x,t.endY=c.y,this.wh=!0,t}else{t.type=4;const c=GeoStream.pC(t);if(this.computeShortLength(!0)!==0&&(r=this.Cf(r,!0,l)),c.fu(r.x,r.y,!1,!1),a===9&&i>=3&&!Geo.K(this.smoothness,0))if(i===3){const f=this.getPoint(1),u=f.x-n,d=f.y-o;let m=this.getPoint(2).copy();m.x-=n,m.y-=o,this.computeShortLength(!1)!==0&&(m=this.Cf(m,!1,l)),c.ur(u,d,u,d,m.x,m.y)}else if(this.isOrthogonal){const f=Point.X(n,o),u=Point.l();u.a(this.getPoint(1));const d=Point.X(n,o),m=Point.X(n,o);let g=this.getPoint(0),p=null;const y=this.smoothness/3;for(let P=1;P<this.pointsCount-1;P++){p=this.getPoint(P);const M=g,L=p,C=this.getPoint(this.hN(p,P,!1));Geo.K(M.x,L.x)&&Geo.K(L.x,C.x)||Geo.K(M.y,L.y)&&Geo.K(L.y,C.y)||(this.nO(M,L,C,y,d,m),(P===1||P===2&&Geo.K(g.x,this.getPoint(0).x)&&Geo.K(g.y,this.getPoint(0).y))&&(u.x=(g.x+p.x)*.5,u.y=(g.y+p.y)*.5),c.ur(u.x-n,u.y-o,d.x-n,d.y-o,p.x-n,p.y-o),f.set(d),u.set(m),g=p)}let x=g.x,k=g.y,b=this.getPoint(this.pointsCount-1);this.computeShortLength(!1)!==0&&(b=this.Cf(b.copy(),!1,Point.Po)),x=.5*(x+b.x),k=.5*(k+b.y),c.ur(m.x-n,m.y-o,x-n,k-o,b.x-n,b.y-o),Point.s(f),Point.s(u),Point.s(d),Point.s(m)}else for(let f=3;f<i;f+=3){const u=this.getPoint(f-2);f+3>=i&&(f=i-1);const d=this.getPoint(f-1);let m=this.getPoint(f);f===i-1&&this.computeShortLength(!1)!==0&&(m=this.Cf(m.copy(),!1,Point.Po)),c.ur(u.x-n,u.y-o,d.x-n,d.y-o,m.x-n,m.y-o)}else{const f=Point.l();f.a(this.getPoint(0));const u=Point.l();u.a(f);const d=this.computeCorner();let m=1,g=0;for(;m<i;){m=this.hN(f,m,m>1);let p=this.getPoint(m);if(m>=i-1){if(!f.equals(p))this.computeShortLength(!1)!==0&&(p=this.Cf(p.copy(),!1,Point.Po)),this.Nn(c,-n,-o,f,p,e);else if(g===0)for(m=1;m<i;)u.a(f),p=this.getPoint(m++),this.Nn(c,-n,-o,f,p,e),f.a(p);break}g=this.hN(p,m+1,m<i-3);const y=this.getPoint(g);this.oO(c,-n,-o,f,p,y,f,u,d,e),u.a(p),m=g}Point.s(f)}return GeoStream.yC(c),this.wh=!0,t}}b1(t,i,e,s){let n=e-t;if(isNaN(n)||n===1/0||n===-1/0)return NaN;n<0&&(n=-n);let o=s-i;return isNaN(o)||o===1/0||o===-1/0?NaN:(o<0&&(o=-o),Geo.K(n,0)?o:Geo.K(o,0)?n:Math.sqrt(n*n+o*o))}nO(t,i,e,s,n,o){isNaN(s)&&(s=this.smoothness/3);const r=t.x,l=t.y,h=i.x,a=i.y,c=e.x,f=e.y,u=s*this.b1(r,l,h,a),d=s*this.b1(h,a,c,f);if(Geo.K(l,a)&&Geo.K(h,c)&&(h>r?f>a?(n.x=h-u,n.y=a-u,o.x=h+d,o.y=a+d):(n.x=h-u,n.y=a+u,o.x=h+d,o.y=a-d):f>a?(n.x=h+u,n.y=a-u,o.x=h-d,o.y=a+d):(n.x=h+u,n.y=a+u,o.x=h-d,o.y=a-d)),Geo.K(r,h)&&Geo.K(a,f)&&(a>l?c>h?(n.x=h-u,n.y=a-u,o.x=h+d,o.y=a+d):(n.x=h+u,n.y=a-u,o.x=h-d,o.y=a+d):c>h?(n.x=h-u,n.y=a+u,o.x=h+d,o.y=a-d):(n.x=h+u,n.y=a+u,o.x=h-d,o.y=a-d)),Geo.K(r,h)&&Geo.K(h,c)||Geo.K(l,a)&&Geo.K(a,f)){const m=.5*(r+c),g=.5*(l+f);n.x=m,n.y=g,o.x=m,o.y=g}}Cf(t,i,e){const s=this.pointsCount;if(s<2)return t;if(i){const n=this.getPoint(1),o=n.x-e.x,r=n.y-e.y,l=this.b1(t.x,t.y,o,r);if(l===0)return t;const h=s===2?l*.5:l;let a=this.computeShortLength(!0);a>h&&(a=h);const c=a*(o-t.x)/l,f=a*(r-t.y)/l;t.x+=c,t.y+=f}else{const n=this.getPoint(s-2),o=n.x-e.x,r=n.y-e.y,l=this.b1(t.x,t.y,o,r);if(l===0)return t;const h=s===2?l*.5:l;let a=this.computeShortLength(!1);a>h&&(a=h);const c=a*(t.x-o)/l,f=a*(t.y-r)/l;t.x-=c,t.y-=f}return t}hN(t,i,e){const s=this.pointsCount;let n=t;for(;Geo.K(t.x,n.x)&&Geo.K(t.y,n.y);){if(i>=s)return s-1;n=this.getPoint(i++)}if(!Geo.K(t.x,n.x)&&!Geo.K(t.y,n.y))return i-1;let o=n;for(;Geo.K(t.x,n.x)&&Geo.K(n.x,o.x)&&(!e||(t.y>=n.y?n.y>=o.y:n.y<=o.y))||Geo.K(t.y,n.y)&&Geo.K(n.y,o.y)&&(!e||(t.x>=n.x?n.x>=o.x:n.x<=o.x));){if(i>=s)return s-1;o=this.getPoint(i++)}return i-2}oO(t,i,e,s,n,o,r,l,h,a){if(Geo.u(s.y,n.y)&&Geo.u(n.x,o.x)){let c=Math.min(h,Math.abs(n.x-l.x)/2);const f=Math.min(c,Math.abs(o.y-n.y)/2);if(c=f,Geo.u(c,0)){this.Nn(t,i,e,s,n,a),r.a(n);return}let u=n.x;const d=n.y,m=u;let g=d;n.x>s.x?(u=n.x-c,o.y>n.y?g=n.y+f:g=n.y-f):(u=n.x+c,o.y>n.y?g=n.y+f:g=n.y-f);const p=Point.X(u,d);this.Nn(t,i,e,s,p,a),Point.s(p),t.Mw(n.x+i,n.y+e,m+i,g+e),r.e(m,g)}else if(Geo.u(s.x,n.x)&&Geo.u(n.y,o.y)){let c=Math.min(h,Math.abs(n.y-l.y)/2);const f=Math.min(c,Math.abs(o.x-n.x)/2);if(c=f,Geo.u(f,0)){this.Nn(t,i,e,s,n,a),r.a(n);return}const u=n.x;let d=n.y,m=u;const g=d;n.y>s.y?(d=n.y-c,o.x>n.x?m=n.x+f:m=n.x-f):(d=n.y+c,o.x>n.x?m=n.x+f:m=n.x-f);const p=Point.X(u,d);this.Nn(t,i,e,s,p,a),Point.s(p),t.Mw(n.x+i,n.y+e,m+i,g+e),r.e(m,g)}else this.Nn(t,i,e,s,n,a),r.a(n)}computeJumpLength(){return 10}Nn(t,i,e,s,n,o){if(o||!this.Oa())t.fr(n.x+i,n.y+e);else{const r=this.computeJumpLength(),l=r/2,h=[];let a=0;this.isVisible()&&(a=this.rO(s,n,h));let c=s.x,f=s.y;if(a>0){if(Geo.u(s.y,n.y))if(s.x<n.x){let u=0;for(;u<a;){const d=Math.max(s.x,Math.min(h[u++]-l,n.x-r));t.fr(d+i,n.y+e),c=d+i,f=n.y+e;let m=Math.min(d+r,n.x);for(;u<a;){const x=h[u];if(x<m+r)u++,m=Math.min(x+l,n.x);else break}const g=n.y-r+e,p=m+i,y=n.y+e;this.curve===10?t.fu(p,y,!1,!1):t.ur(c,g,p,g,p,y),c=p,f=y}}else{let u=a-1;for(;u>=0;){const d=Math.min(s.x,Math.max(h[u--]+l,n.x+r));t.fr(d+i,n.y+e),c=d+i,f=n.y+e;let m=Math.max(d-r,n.x);for(;u>=0;){const x=h[u];if(x>m-r)u--,m=Math.max(x-l,n.x);else break}const g=n.y-r+e,p=m+i,y=n.y+e;this.curve===10?t.fu(p,y,!1,!1):t.ur(c,g,p,g,p,y),c=p,f=y}}else if(Geo.u(s.x,n.x))if(s.y<n.y){let u=0;for(;u<a;){const d=Math.max(s.y,Math.min(h[u++]-l,n.y-r));t.fr(n.x+i,d+e),c=n.x+i,f=d+e;let m=Math.min(d+r,n.y);for(;u<a;){const x=h[u];if(x<m+r)u++,m=Math.min(x+l,n.y);else break}const g=n.x-r+i,p=n.x+i,y=m+e;this.curve===10?t.fu(p,y,!1,!1):t.ur(g,f,g,y,p,y),c=p,f=y}}else{let u=a-1;for(;u>=0;){const d=Math.min(s.y,Math.max(h[u--]+l,n.y+r));t.fr(n.x+i,d+e),c=n.x+i,f=d+e;let m=Math.max(d-r,n.y);for(;u>=0;){const x=h[u];if(x>m-r)u--,m=Math.max(x-l,n.y);else break}const g=n.x-r+i,p=n.x+i,y=m+e;this.curve===10?t.fu(p,y,!1,!1):t.ur(g,f,g,y,p,y),c=p,f=y}}}t.fr(n.x+i,n.y+e)}}rO(t,i,e){const s=this.diagram;if(s===null||t.equals(i))return 0;const n=s.layers;for(;n.next();){const o=n.value;if(o!==null&&o.visible){const r=o.BM(),l=r.length;for(let h=0;h<l;h++){const a=r[h];if(!(a instanceof Link))continue;if(a===this)return e.length>0&&e.sort((u,d)=>u-d),e.length;if(!a.isVisible()||!a.Oa())continue;const c=a.routeBounds;if(!c.isReal()||!this.routeBounds.intersectsRect(c)||this.usesSamePort(a))continue;const f=a.path;f!==null&&f.isVisibleObject()&&this.lO(t,i,e,a)}}}return e.length>0&&e.sort((o,r)=>o-r),e.length}lO(t,i,e,s){const n=Geo.u(t.y,i.y),o=s.pointsCount;let r=s.getPoint(0);const l=Point.l();for(let h=1;h<o;h++){const a=s.getPoint(h);if(h<o-1){const c=s.getPoint(h+1);if(r.y===a.y&&a.y===c.y){if(a.x>r.x&&c.x>=a.x||a.x<r.x&&c.x<=a.x)continue}else if(r.x===a.x&&a.x===c.x&&(a.y>r.y&&c.y>=a.y||a.y<r.y&&c.y<=a.y))continue}this.hO(t,i,r,a,l)&&(n?e.push(l.x):e.push(l.y)),r=a}Point.s(l)}hO(t,i,e,s,n){const o=t.x,r=t.y,l=i.x,h=i.y,a=e.x,c=e.y,f=s.x,u=s.y;if(Geo.u(o,l)){if(!Geo.u(r,h)&&Geo.u(c,u)&&Math.min(r,h)<c&&Math.max(r,h)>c&&Math.min(a,f)<o&&Math.max(a,f)>o&&!Geo.u(a,f))return n.x=o,n.y=c,!0}else if(Geo.u(r,h)&&Geo.u(a,f)&&Math.min(o,l)<a&&Math.max(o,l)>a&&Math.min(c,u)<r&&Math.max(c,u)>r&&!Geo.u(c,u))return n.x=a,n.y=r,!0;return n.x=0,n.y=0,!1}get firstPickIndex(){return this.pointsCount<=2?0:this.isOrthogonal||!this.Ed(this.computeSpot(!0))?1:0}get lastPickIndex(){const t=this.pointsCount;return t===0?0:t<=2?t-1:this.isOrthogonal||!this.Ed(this.computeSpot(!1))?t-2:t-1}Oa(){const t=this.curve;return t===11||t===10}g1(t){if(t||this.Oa()){const i=this.diagram;i!==null&&!i.animationManager.isTicking&&!i.Jl.has(this)&&(this.Sf.width!==0||this.Sf.height!==0)&&i.Jl.set(this,this.Sf.copy())}}invalidateOtherJumpOvers(t){const i=this.layer;if(i===null||!i.visible||i.isTemporary)return;const e=i.diagram;if(e===null||e.animationManager.isTicking)return;let s=!1;const n=e.layers;for(;n.next();){const o=n.value;if(o.visible){if(o===i){s=!0;let r=!1;const l=o.BM(),h=l.length;for(let a=0;a<h;a++){const c=l[a];c instanceof Link&&(c===this?r=!0:r&&this.lT(c,t))}}else if(s){const r=o.BM(),l=r.length;for(let h=0;h<l;h++){const a=r[h];a instanceof Link&&this.lT(a,t)}}}}}lT(t,i){if(t===null||!t.wh||!t.Se||!t.Oa())return;const e=t.routeBounds;e.isReal()&&(!this.routeBounds.intersectsRect(e)&&!i.intersectsRect(e)||this.usesSamePort(t)||t.ee())}usesSamePort(t){const i=this.pointsCount,e=t.pointsCount;if(i>0&&e>0){const s=this.getPoint(0),n=t.getPoint(0);if(s.equalsApprox(n))return!0;const o=this.getPoint(i-1),r=t.getPoint(e-1);if(o.equalsApprox(r)||s.equalsApprox(r)||o.equalsApprox(n))return!0}else if(this.fromNode===t.fromNode||this.toNode===t.toNode||this.fromNode===t.toNode||this.toNode===t.fromNode)return!0;return!1}isVisible(){if(!super.isVisible())return!1;const t=this.containingGroup;let i=!0;const e=this.diagram;e!==null&&(i=e.isTreePathToChildren);const s=this.fromNode;if(s!==null){if(this.isTreeLink&&i&&!s.isTreeExpanded)return!1;if(s===t)return!0;let o=s;for(;o!==null;){if(o.labeledLink===this)return!0;o=o.containingGroup}const r=s.findVisibleNode();if(r===null||r===t)return!1}const n=this.toNode;if(n!==null){if(this.isTreeLink&&!i&&!n.isTreeExpanded)return!1;if(n===t)return!0;let o=n;for(;o!==null;){if(o.labeledLink===this)return!0;o=o.containingGroup}const r=n.findVisibleNode();if(r===null||r===t)return!1}return!0}Bi(t){if(super.Bi(t),t&&this.g1(!1),this.$o!==null&&this.$o.Td(),this.Hs!==null){const e=this.Hs.iterator;for(;e.next();)e.value.Bi(t)}}get adjusting(){return this.Mf}set adjusting(t){const i=this.Mf;i!==t&&(this.Mf=t,this.t("adjusting",i,t))}computeAdjusting(){return this.isAvoiding&&this.diagram!==null&&this.diagram.animationManager.defaultAnimation.isAnimating?17:this.Mf}get corner(){return this.Rd}set corner(t){const i=this.Rd;i!==t&&(this.Rd=t,this.ee(),this.t("corner",i,t))}get curve(){return this.vd}set curve(t){const i=this.vd;i!==t&&(this.vd=t,this.invalidateRoute(),this.ee(),this.g1(i===10||i===11||t===10||t===11),this.t("curve",i,t))}get curviness(){return this.Od}set curviness(t){const i=this.Od;i!==t&&(this.Od=t,this.invalidateRoute(),this.ee(),this.t("curviness",i,t))}get routing(){return this.Da}set routing(t){const i=this.Da;i!==t&&(this.Da=t,this.isAvoiding&&this.diagram!==null&&(this.diagram.jm=!0),this.Jo=null,this.invalidateRoute(),this.g1(Link.nN(i)||Link.nN(t)),this.t("routing",i,t))}get smoothness(){return this.Id}set smoothness(t){const i=this.Id;i!==t&&(this.Id=t,this.ee(),this.t("smoothness",i,t))}wy(){const t=this.lo;if(t===null)return;const i=this.ao;if(i===null||!isNaN(this.curviness))return;const e=this.ho,s=this.co;let n=null,o=null;const r=t.ti.r,l=r.length;for(let h=0;h<l;h++){const a=r[h];!(a.lo===t&&a.ho===e&&a.ao===i&&a.co===s)&&!(a.lo===i&&a.ho===s&&a.ao===t&&a.co===e)||(o===null?o=a:(n===null&&(n=[],n.push(o)),n.push(a)))}if(n!==null){let h=t.QA(i,e,s);h===null&&(h=new LinkBundle(t,e,i,s),t.$A(h),i.$A(h)),h.qs=n;for(let a=0;a<n.length;a++){const c=n[a];c.$o=h}h.Td()}}yy(){const t=this.$o;if(t!==null){if(!isNaN(this.curviness))return;this.$o=null;const i=t.qs.indexOf(this);i>=0&&(Util.tc(t.qs,i),t.Td())}}Nl(){return!0}get key(){const t=this.diagram;if(!(t===null||!t.model.Ta()))return t.model.getKeyForLinkData(this.data)}}class LinkBundle{Io;Os;ry;$2;h1;Z2;qs;constructor(t,i,e,s){GSet.ji(this),this.Io=!1,this.Os=!1,this.ry=t,this.$2=i,this.h1=e,this.Z2=s,this.qs=[]}Td(){if(!this.Io){const t=this.qs;if(t.length>0){const i=t[0].diagram;i!==null&&(i.hS.add(this),this.Os=i.undoManager.isUndoingRedoing)}}this.Io=!0}kS(){if(this.Io){this.Io=!1;const t=this.qs;if(t.length>0){const i=t[0],e=i.diagram,s=e===null||e.Bh&&!this.Os;this.Os=!1,i.arrangeBundledLinks(t,s),t.length===1&&(i.$o=null,t.length=0)}t.length===0&&(this.ry.ZA(this),this.h1.ZA(this))}}}class PositionArray{oe;re;Ia;Ea;pi;yi;Ot;xh;bh;ha;vS;Io;by;Gc;OS;IS;constructor(t){GSet.ji(this),this.ha=null,this.vS=null,this.Io=!0,this.by=!1,this.oe=1,this.re=1,this.Ia=-1,this.Ea=-1,this.pi=t.width,this.yi=t.height,this.Ot=null,this.xh=0,this.bh=0,this.Gc=11,this.OS=this.Gc*2,this.IS=this.Gc*2}static Ws=0;static Ba=1;static Ud=999999;static aN=PositionArray.Ud+1;static cN=PositionArray.Ud+2;kb(t){if(t.width<=0||t.height<=0)return;const i=t.x,e=t.y,s=t.x+t.width,n=t.y+t.height;this.oe=Math.floor((i-this.pi)/this.pi)*this.pi,this.re=Math.floor((e-this.yi)/this.yi)*this.yi,this.Ia=Math.ceil((s+2*this.pi)/this.pi)*this.pi,this.Ea=Math.ceil((n+2*this.yi)/this.yi)*this.yi;const o=1+(Math.ceil((this.Ia-this.oe)/this.pi)|0),r=1+(Math.ceil((this.Ea-this.re)/this.yi)|0);if(this.Ot===null||this.xh<o-1||this.bh<r-1){const l=[];for(let h=0;h<=o;h++)l[h]=new Uint32Array(r);this.Ot=l,this.xh=o-1,this.bh=r-1}this.aO(PositionArray.aN)}get bounds(){return new Rect(this.oe,this.re,this.Ia-this.oe,this.Ea-this.re)}get cellWidth(){return this.pi}set cellWidth(t){t>0&&t!==this.pi&&(this.pi=t,this.kb(this.bounds))}get cellHeight(){return this.yi}set cellHeight(t){t>0&&t!==this.yi&&(this.yi=t,this.kb(this.bounds))}Vd(t,i){return this.oe<=t&&t<=this.Ia&&this.re<=i&&i<=this.Ea}fo(t,i){if(!this.Vd(t,i))return PositionArray.aN;t-=this.oe,t/=this.pi,i-=this.re,i/=this.yi;const e=t|0,s=i|0;return this.Ot[e][s]}wR(t,i,e,s){if(!this.Vd(t,i))return;const n=(t-this.oe)/this.pi|0,o=(i-this.re)/this.yi|0,r=(t+e-this.oe)/this.pi|0,l=(i+s-this.re)/this.yi|0,h=Math.min(r,this.xh),a=Math.min(l,this.bh);for(let c=n;c<=h;c++){const f=this.Ot[c];if(f.fill)f.fill(PositionArray.Ws,o,a+1);else for(let u=o;u<=a;u++)f[u]=PositionArray.Ws}}aO(t){if(this.Ot!==null)for(let i=0;i<=this.xh;i++){const e=this.Ot[i];if(e.fill)e.fill(t);else for(let s=0;s<=this.bh;s++)e[s]=t}}YL(){if(this.Ot!==null)for(let t=0;t<=this.xh;t++){const i=this.Ot[t];for(let e=0;e<=this.bh;e++)i[e]>=PositionArray.Ba&&(i[e]=PositionArray.aN)}}cO(t,i){return this.fo(t,i)===PositionArray.Ws}isUnoccupied(t,i,e,s){if(t>this.Ia||t+e<this.oe||i>this.Ea||i+s<this.re)return!0;let n=(t-this.oe)/this.pi|0,o=(i-this.re)/this.yi|0,r=Math.max(0,e)/this.pi+1|0,l=Math.max(0,s)/this.yi+1|0;if(n<0&&(r+=n,n=0),o<0&&(l+=o,o=0),r<0||l<0)return!0;const h=Math.min(n+r-1,this.xh)|0,a=Math.min(o+l-1,this.bh)|0;for(let c=n;c<=h;c++){const f=this.Ot[c];for(let u=o;u<=a;u++)if(f[u]===PositionArray.Ws)return!1}return!0}maxAvoidsLinksSpaceH(t,i,e,s){if(t>this.Ia||i<this.oe||e>this.Ea||e<this.re)return 0;const n=(t-this.oe)/this.pi|0,o=(i-this.oe)/this.pi|0,r=(e-this.re)/this.yi|0,l=s/this.yi+1|0;let h;for(h=0;h<l/2;h++){let a=!1;for(let c=n;c<=o;c++)if(this.Ot[c][r+h]===PositionArray.Ws||this.Ot[c][r-h]===PositionArray.Ws){a=!0;break}if(a)return Math.max(0,(2*h-1)*this.yi)}return s}maxAvoidsLinksSpaceV(t,i,e,s){if(t>this.Ea||i<this.re||e>this.Ia||e<this.oe)return 0;const n=(t-this.re)/this.yi|0,o=(i-this.re)/this.yi|0,r=(e-this.oe)/this.pi|0,l=s/this.pi+1|0;let h;for(h=0;h<l/2;h++){let a=!1;for(let c=n;c<=o;c++)if(this.Ot[r+h][c]===PositionArray.Ws||this.Ot[r-h][c]===PositionArray.Ws){a=!0;break}if(a)return Math.max(0,(2*h-1)*this.pi)}return s}fO(t,i,e,s,n,o,r,l){t=t|0,i=i|0;let h=this.Ot[t][i];if(h>=PositionArray.Ba&&h<PositionArray.Ud)for(s?i+=e:t+=e,h+=1;n<=t&&t<=o&&r<=i&&i<=l;){const a=this.Ot[t][i];if(h>=a)break;this.Ot[t][i]=h,h+=1,s?i+=e:t+=e}return s?i:t}uo(t,i,e,s,n,o,r,l){if(t<n||t>o||i<r||i>l)return;const h=this.fO(t,i,e,s,n,o,r,l);if(s)if(e>0)for(let a=i+e;a<h;a+=e)this.uo(t,a,1,!s,n,o,r,l),this.uo(t,a,-1,!s,n,o,r,l);else for(let a=i+e;a>h;a+=e)this.uo(t,a,1,!s,n,o,r,l),this.uo(t,a,-1,!s,n,o,r,l);else if(e>0)for(let a=t+e;a<h;a+=e)this.uo(a,i,1,!s,n,o,r,l),this.uo(a,i,-1,!s,n,o,r,l);else for(let a=t+e;a>h;a+=e)this.uo(a,i,1,!s,n,o,r,l),this.uo(a,i,-1,!s,n,o,r,l)}k1(t,i,e,s,n,o,r,l,h,a){let c=t|0,f=i|0,u=PositionArray.Ws,d=PositionArray.Ba;for(this.Ot[c][f]=d;u===PositionArray.Ws&&c>r&&c<l&&f>h&&f<a;)d+=1,this.Ot[c][f]=d,o?f+=n:c+=n,u=this.Ot[c][f];return o?f:c}P1(t,i,e,s,n,o,r,l,h,a){let c=e|0,f=s|0,u=PositionArray.Ws;const d=PositionArray.Ud;for(this.Ot[c][f]=d;u===PositionArray.Ws&&c>r&&c<l&&f>h&&f<a;)this.Ot[c][f]=d,o?f+=n:c+=n,u=this.Ot[c][f]}hT(t,i,e,s,n,o){if(this.Ot===null)return;this.by=!1;let r=t.x,l=t.y;if(!this.Vd(r,l))return;r-=this.oe,r/=this.pi,l-=this.re,l/=this.yi;let h=e.x,a=e.y;if(!this.Vd(h,a))return;if(h-=this.oe,h/=this.pi,a-=this.re,a/=this.yi,Math.abs(r-h)<=1&&Math.abs(l-a)<=1){this.by=!0;return}let c=n.x,f=n.y,u=n.x+n.width,d=n.y+n.height;c-=this.oe,c/=this.pi,f-=this.re,f/=this.yi,u-=this.oe,u/=this.pi,d-=this.re,d/=this.yi;const m=Math.max(0,Math.min(this.xh,c|0)),g=Math.min(this.xh,Math.max(0,u|0)),p=Math.max(0,Math.min(this.bh,f|0)),y=Math.min(this.bh,Math.max(0,d|0)),x=0,k=90,b=270,P=this.Ot,M=r|0,L=l|0,C=h|0,S=a|0,N=i===x||i===k?1:-1,T=i===k||i===b;P[M][L]===PositionArray.Ws?(this.k1(M,L,C,S,N,T,m,g,p,y),this.k1(M,L,C,S,1,!T,m,g,p,y),this.k1(M,L,C,S,-1,!T,m,g,p,y)):this.k1(M,L,C,S,N,T,M,L,M,L),P[C][S]===PositionArray.Ws?(this.P1(M,L,C,S,s===x||s===k?1:-1,s===k||s===b,m,g,p,y),this.P1(M,L,C,S,1,!(s===k||s===b),m,g,p,y),this.P1(M,L,C,S,-1,!(s===k||s===b),m,g,p,y)):this.P1(M,L,C,S,N,T,C,S,C,S);const A=Util.nt();if(o&&this.aT(C,S,s,M,L,A)){(A[0]!==C||A[1]!==S)&&(A.unshift(S),A.unshift(C)),(A[A.length-2]!==M||A[A.length-1]!==L)&&(A.push(M),A.push(L));let D=PositionArray.Ba,F=A[A.length-2],R=A[A.length-1];P[F][R]=D++;for(let v=A.length-4;v>=0;v-=2){F=A[v+2],R=A[v+3];const O=A[v],B=A[v+1];for(;O>F?F++:O<F?F--:B>R?R++:B<R&&R--,P[F][R]=D++,!(F===O&&R===B););}}else this.uo(M,L,1,!1,m,g,p,y),this.uo(M,L,-1,!1,m,g,p,y),this.uo(M,L,1,!0,m,g,p,y),this.uo(M,L,-1,!0,m,g,p,y);Util.tt(A)}aT(t,i,e,s,n,o){const c=this.Ot;let f=t,u=i;for(;;){if(f===s&&u===n)return!0;let d=f,m=u;if(e===0)if(d<s)d++;else break;else if(e===90)if(m<n)m++;else break;else if(e===180)if(d>s)d--;else break;else if(m>n)m--;else break;const g=c[d][m];if(g===0||g===PositionArray.cN)break;f=d,u=m}for(;;){let d=e,m=f,g=u;e===0?g<n?(d=90,g++):g>n&&(d=270,g--):e===90?m<s?(d=0,m++):m>s&&(d=180,m--):e===180?g<n?(d=90,g++):g>n&&(d=270,g--):m<s?(d=0,m++):m>s&&(d=180,m--);const p=c[m][g];if(d!==e&&p!==0&&p!==PositionArray.cN){if(o.push(f),o.push(u),this.aT(f,u,d,s,n,o))return!0;o.pop(),o.pop()}if(c[f][u]=PositionArray.cN,e===0){if(f===t)return!1;f--}else if(e===90){if(u===i)return!1;u--}else if(e===180){if(f===t)return!1;f++}else{if(u===i)return!1;u++}}}}class Knot{de;Zo;rs;zd;constructor(){GSet.ji(this),this.de=null,this.Zo=null,this.rs=[],this.zd=!1}toString(){const t=this.rs;let i=this.de.toString()+" "+t.length.toString()+":";for(let e=0;e<t.length;e++){const s=t[e];s!==null&&(i+=`
  `+s.toString())}return i}uO(t,i,e,s){const n=i.offsetY;switch(n){case 8:return 90;case 2:return 180;case 1:return 270;case 4:return 0}let o=e;switch(n){case 9:return o>180?270:90;case 6:return o>90&&o<=270?180:0}const r=Math.atan2(t.height,t.width)*180/Math.PI;switch(n){case 3:return o>r&&o<=180+r?180:270;case 5:return o>180-r&&o<=360-r?270:0;case 12:return o>r&&o<=180+r?90:0;case 10:return o>180-r&&o<=360-r?180:90;case 7:return o>90&&o<=180+r?180:o>180+r&&o<=360-r?270:0;case 13:return o>180&&o<=360-r?270:o>r&&o<=180?90:0;case 14:return o>r&&o<=180-r?90:o>180-r&&o<=270?180:0;case 11:return o>180-r&&o<=180+r?180:o>180+r?270:90}return s&&n!==15&&(o-=15,o<0&&(o+=360)),o>r&&o<180-r?90:o>=180-r&&o<=180+r?180:o>180+r&&o<360-r?270:0}Td(){this.rs.length=0}rT(t){let i=this.rs;i.length===0&&(this.dO(),i=this.rs);for(let e=0;e<i.length;e++){const s=i[e];if(s!==null&&s.qe===t)return s}return null}dO(){if(!this.zd){const t=this.zd;this.zd=!0;let i,e=null;const s=this.de,n=s instanceof Group?s:null;if(n!==null&&!n.isSubGraphExpanded){if(!n.actualBounds.isReal())return this.zd=t,this.rs;e=n,i=e.findExternalLinksConnected()}else s.isTreeExpanded?i=s.findLinksConnected(this.Zo.portId):i=s.findExternalTreeLinksConnected();this.rs.length=0;let o=0;const r=this.Zo.getDocumentPoint(Spot.TopLeft,Point.l()),l=this.Zo.getDocumentPoint(Spot.BottomRight,Point.l()),h=Rect.X(r.x,r.y,0,0);h.unionPoint(l),Point.s(r),Point.s(l);const a=Point.X(h.x+h.width/2,h.y+h.height/2),c=this.Zo.getDocumentAngle(),f=i.iterator;for(;f.next();){const g=f.value;if(!g.isVisible()||g.fromPort===g.toPort)continue;const p=g.fromPort===this.Zo||g.fromNode!==null&&g.fromNode.isMemberOf(e),y=g.computeSpot(p,this.Zo);if(!y.isSide())continue;let x;if(p?x=g.toPort:x=g.fromPort,x===null)continue;let k=x.part;if(k===null)continue;const b=k.findVisibleNode();b!==null&&b!==k&&(k=b,x=k.port);const P=g.computeOtherPoint(k,x);let M=a.directionPoint(P);M-=c,M<0?M+=360:M>=360&&(M-=360);const L=this.uO(h,y,M,g.isOrthogonal);let C=0;L===0?(C=4,M>180&&(M-=360)):L===90?(C=8,M>270&&(M-=360)):L===180?C=2:(C=1,M<90&&(M+=360));let S=this.rs[o];S===void 0?(S=new LinkInfo(g,M,C),this.rs[o]=S):(S.qe=g,S.Kt=M,S.me=C),S.M1.set(P),o++}Point.s(a),this.gO();const u=this.rs.length;let d=-1,m=0;for(o=0;o<u;o++){const g=this.rs[o];g!==void 0&&(g.me!==d&&(d=g.me,m=0),g.Xd=m,m++)}for(d=-1,m=0,o=u-1;o>=0;o--){const g=this.rs[o];g!==void 0&&(g.me!==d&&(d=g.me,m=g.Xd+1),g.Nf=m)}this.mO(this.rs),this.pO(this.rs),this.zd=t,Rect.s(h)}return this.rs}yO(t,i){return t===i?0:t===null?-1:i===null?1:t.me<i.me?-1:t.me>i.me?1:t.Kt<i.Kt?-1:t.Kt>i.Kt?1:0}gO(){this.rs.sort(Knot.prototype.yO)}mO(t){const i=this.Zo,e=this.de.portSpreading,s=Point.l(),n=Point.l(),o=Point.l(),r=Point.l();i.getDocumentPoint(Spot.TopLeft,s),i.getDocumentPoint(Spot.TopRight,n),i.getDocumentPoint(Spot.BottomRight,o),i.getDocumentPoint(Spot.BottomLeft,r);let l=0,h=0,a=0,c=0;if(e===2)for(let x=0;x<t.length;x++){const k=t[x];if(k===null)continue;const b=k.qe.computeThickness();switch(k.me){case 8:a+=b;break;case 2:c+=b;break;case 1:l+=b;break;default:case 4:h+=b;break}}let f=0,u=0,d=1,m,g,p=0,y=0;for(let x=0;x<t.length;x++){const k=t[x];if(k===null)continue;if(f!==k.me){switch(f=k.me,f){case 8:m=o,g=r;break;case 2:m=r,g=s;break;case 1:m=s,g=n;break;default:case 4:m=n,g=o;break}switch(p=g.x-m.x,y=g.y-m.y,f){case 8:a>Math.abs(p)?(d=Math.abs(p)/a,a=Math.abs(p)):d=1;break;case 2:c>Math.abs(y)?(d=Math.abs(y)/c,c=Math.abs(y)):d=1;break;case 1:l>Math.abs(p)?(d=Math.abs(p)/l,l=Math.abs(p)):d=1;break;default:case 4:h>Math.abs(y)?(d=Math.abs(y)/h,h=Math.abs(y)):d=1;break}u=0}const b=k.Bd;if(e===2){let P=k.qe.computeThickness();switch(P*=d,b.set(m),f){case 8:b.x=m.x+p/2+a/2-u-P/2;break;case 2:b.y=m.y+y/2+c/2-u-P/2;break;case 1:b.x=m.x+p/2-l/2+u+P/2;break;default:case 4:b.y=m.y+y/2-h/2+u+P/2;break}u+=P}else{let P=.5;e===1&&(P=(k.Xd+1)/(k.Nf+1)),b.x=m.x+p*P,b.y=m.y+y*P}}Point.s(s),Point.s(n),Point.s(o),Point.s(r)}pO(t){for(let i=0;i<t.length;i++){const e=t[i];e!==null&&(e.w1=this.wO(e))}}wO(t){const i=t.qe,e=i.fromPort===this.Zo,s=i.computeEndSegmentLength(this.de,this.Zo,Spot.None,e);let n=t.Xd;if(n<0)return s;const o=t.Nf;if(o<=1||!i.isOrthogonal)return s;const l=t.M1,h=t.Bd;(t.me===2||t.me===8)&&(n=o-1-n);const a=Link.Xv,c=t.me===2||t.me===4;return(c?l.y<h.y:l.x<h.x)?s+n*a:(c?l.y===h.y:l.x===h.x)?s:s+(o-1-n)*a}}class LinkInfo{qe;Kt;me;M1;Xd;Nf;Bd;w1;constructor(t,i,e){this.qe=t,this.Kt=i,this.me=e,this.M1=new Point,this.Xd=0,this.Nf=0,this.Bd=new Point,this.w1=0}toString(){return this.qe.toString()+" "+this.Kt.toString()+" "+this.me.toString()+":"+this.Xd.toString()+"/"+this.Nf.toString()+" "+this.Bd.toString()+" "+this.w1.toString()+" "+this.M1.toString()}}class LinkSettings{fa;ua;da;ga;ma;pa;E0;O0;B0;I0;constructor(){this.fa=Spot.Default,this.ua=Spot.Default,this.da=NaN,this.ga=NaN,this.ma=NaN,this.pa=NaN,this.E0=null,this.O0=null,this.B0=1/0,this.I0=1/0}copy(){const t=new LinkSettings;return t.fa=this.fa.N(),t.ua=this.ua.N(),t.da=this.da,t.ga=this.ga,t.ma=this.ma,t.pa=this.pa,t.E0=this.E0,t.O0=this.O0,t.B0=this.B0,t.I0=this.I0,t}}class LinkElementSettings{L0;A0;T0;C0;xp;bp;constructor(){this.L0=-1/0,this.A0=0,this.T0=Point.Po,this.C0=0,this.xp="None",this.bp="None"}copy(){const t=new LinkElementSettings;return t.L0=this.L0,t.A0=this.A0,t.T0=this.T0.N(),t.C0=this.C0,t.xp=this.xp,t.bp=this.bp,t}}class Group extends Node{Kd;It;la;d0;oi;ie;constructor(t,i){let e;t===void 0||t instanceof PanelLayout||typeof t=="string"?e=t:t&&(i=t),super(e),this.E=this.E|4608,this.Kd=new GSet,this.It=null,this.ie=new Layout,this.ie.group=this,this.la=new GSet,this.d0=null,this.oi=null,i&&Object.assign(this,i)}cloneProtected(t){super.cloneProtected(t),this.E=this.E&-32769;const i=t.findInVisualTree(e=>e instanceof Placeholder);i instanceof Placeholder?t.It=i:t.It=null,this.ie!==null?(t.ie=this.ie.copy(),t.ie.group=t):(t.ie!==null&&(t.ie.group=null),t.ie=null),this.oi!==null&&(t.oi=this.oi.copy())}Uo(t){super.Uo(t);const i=t.findSubGraphParts(),e=t.memberParts;for(;e.next();){const s=e.value;if(s.c(),s.invalidateLayout(8),s.clearAdornments(),s instanceof Node)s.invalidateConnectedLinks(i);else if(s instanceof Link){const n=s.labelNodes;for(;n.next();)n.value.invalidateConnectedLinks(i)}}}Jc(t,i,e,s,n,o,r){if(t===3&&i==="elements"){if(n instanceof Placeholder)this.It===null?this.It=n:this.It!==n&&Util.o("Cannot insert a second Placeholder into the visual tree of a Group.");else if(n instanceof Panel){const l=n.findInVisualTree(h=>h instanceof Placeholder);l instanceof Placeholder&&(this.It===null?this.It=l:this.It!==l&&Util.o("Cannot insert a second Placeholder into the visual tree of a Group."))}}else t===4&&i==="elements"&&this.It!==null&&(s===this.It?this.It=null:s instanceof Panel&&this.It.isContainedBy(s)&&(this.It=null));super.Jc(t,i,e,s,n,o,r)}td(t,i){if(super.td(t,i),this.isClipping&&this.type!==Panel.Spot&&this.isSubGraphExpanded){let e=this.resizeObject;e instanceof Panel&&(e=e.findMainElement()),this.oi===null&&(this.oi=new Rect),e.getDocumentBounds(this.oi),e instanceof Shape&&this.oi.inflate(-e.strokeWidth,-e.strokeWidth)}}ah(t,i,e,s){this.hasPlaceholder()&&(this.Wo=this.placeholder),super.ah(t,i,e,s)}ensureBounds(){this.isSubGraphExpanded&&this.memberParts.each(i=>{i.ensureBounds()}),super.ensureBounds()}jr(){if(!super.jr())return!1;const t=this.memberParts;for(;t.next();){const i=t.value;if(i instanceof Node){if(!i.isVisible())continue;if(i.es())return!1}else if(i instanceof Link){if(!i.isVisible())continue;if(i.es()&&i.fromNode!==this&&i.toNode!==this)return!1}}return!0}hasPlaceholder(){return this.It!==null&&this.It.isVisibleObject()&&this.isSubGraphExpanded}get placeholder(){return this.It}get computesBoundsAfterDrag(){return(this.E&2048)!==0}set computesBoundsAfterDrag(t){const i=(this.E&2048)!==0;i!==t&&(Util.i(t,"boolean",Group,"computesBoundsAfterDrag"),this.E=this.E^2048,this.t("computesBoundsAfterDrag",i,t))}get computesBoundsIncludingLinks(){return(this.E&4096)!==0}set computesBoundsIncludingLinks(t){Util.i(t,"boolean",Group,"computesBoundsIncludingLinks");const i=(this.E&4096)!==0;i!==t&&(this.E=this.E^4096,this.t("computesBoundsIncludingLinks",i,t))}get computesBoundsIncludingLocation(){return(this.E&8192)!==0}set computesBoundsIncludingLocation(t){Util.i(t,"boolean",Group,"computesBoundsIncludingLocation");const i=(this.E&8192)!==0;i!==t&&(this.E=this.E^8192,this.t("computesBoundsIncludingLocation",i,t))}get handlesDragDropForMembers(){return(this.E&16384)!==0}set handlesDragDropForMembers(t){Util.i(t,"boolean",Group,"handlesDragDropForMembers");const i=(this.E&16384)!==0;i!==t&&(this.E=this.E^16384,this.t("handlesDragDropForMembers",i,t))}get avoidableMembers(){return(this.E&131072)!==0}set avoidableMembers(t){Util.i(t,"boolean",Group,"avoidableMembers");const i=(this.E&131072)!==0;i!==t&&(this.E=this.E^131072,this.t("avoidableMembers",i,t))}get memberParts(){return this.Kd.iterator}H2(t){if(this.Kd.add(t)){t instanceof Group&&this.la.add(t);const e=this.memberAdded;if(e!==null){let s=!0;const n=this.diagram;n!==null&&(s=n.Y,n.Y=!0),e(this,t),n!==null&&(n.Y=s)}(!this.isVisible()||!this.isSubGraphExpanded)&&t.Bi(!1)}if(t instanceof Link&&!this.computesBoundsIncludingLinks)return;let i=this.It;i===null&&(i=this),i.c()}j2(t){if(this.Kd.delete(t)){t instanceof Group&&this.la.delete(t);const e=this.memberRemoved;if(e!==null){let s=!0;const n=this.diagram;n!==null&&(s=n.Y,n.Y=!0),e(this,t),n!==null&&(n.Y=s)}(!this.isVisible()||!this.isSubGraphExpanded)&&t.Bi(!0)}if(t instanceof Link&&!this.computesBoundsIncludingLinks)return;let i=this.It;i===null&&(i=this),i.c()}Kc(){if(this.Kd.count>0){const t=this.diagram;if(t!==null){const e=this.Kd.copy().iterator;for(;e.next();){const s=e.value;t.remove(s)}}}super.Kc()}get layout(){return this.ie}set layout(t){const i=this.ie;if(i!==t){t!==null&&t.diagram!==null&&t.diagram.layout===t&&Util.o("A layout cannot be both the Diagram.layout and a Group.layout: "+t),i!==null&&(i.diagram=null,i.group=null),this.ie=t;const e=this.diagram;t!==null&&(t.diagram=e,t.group=this),e!==null&&(e.Kr=!0),this.t("layout",i,t),e!==null&&e.requestUpdate()}}get memberAdded(){return this.gt!==null?this.gt.uy:null}set memberAdded(t){const i=this.memberAdded;i!==t&&(t!==null&&Util.i(t,"function",Group,"memberAdded"),this.al(),this.gt.uy=t,this.t("memberAdded",i,t))}get memberRemoved(){return this.gt!==null?this.gt.gy:null}set memberRemoved(t){const i=this.memberRemoved;i!==t&&(t!==null&&Util.i(t,"function",Group,"memberRemoved"),this.al(),this.gt.gy=t,this.t("memberRemoved",i,t))}get memberValidation(){return this.gt!==null?this.gt.eh:null}set memberValidation(t){const i=this.memberValidation;i!==t&&(t!==null&&Util.i(t,"function",Group,"memberValidation"),this.al(),this.gt.eh=t,this.t("memberValidation",i,t))}canAddMembers(t){const i=this.diagram;if(i===null)return!1;const e=i.commandHandler,n=e.e2(t).iterator;for(;n.next();){const o=n.value;if(!e.isValidMember(this,o))return!1}return!0}addMembers(t,i){const e=this.diagram;if(e===null)return!1;const s=e.commandHandler,n=s.e2(t);let o=!0;const r=n.iterator;for(;r.next();){const l=r.value;!i||s.isValidMember(this,l)?l.containingGroup=this:o=!1}return o}get ungroupable(){return(this.E&256)!==0}set ungroupable(t){const i=(this.E&256)!==0;i!==t&&(Util.i(t,"boolean",Group,"ungroupable"),this.E=this.E^256,this.t("ungroupable",i,t))}canUngroup(){if(!this.ungroupable)return!1;const t=this.layer;if(t===null||!t.allowUngroup)return!1;const i=t.diagram;return!(i!==null&&!i.allowUngroup)}invalidateConnectedLinks(t){const i=this.xO();if(super.invalidateConnectedLinks(t),i)return;this.SL(!0);const e=this.findExternalLinksConnected();for(;e.next();){const s=e.value;if(t!==void 0&&t.has(s))continue;const n=s.fromNode;if(n!==null&&n!==this&&n.isMemberOf(this)&&!n.isVisible())n.Wi(s.fromPort),n.Wi(s.toPort),s.invalidateRoute();else{const o=s.toNode;o!==null&&o!==this&&o.isMemberOf(this)&&!o.isVisible()&&(o.Wi(s.fromPort),o.Wi(s.toPort),s.invalidateRoute())}}}findExternalLinksConnected(){const t=this.diagram!==null&&this.diagram.gS;if(t&&this.d0!==null)return this.d0.iterator;const i=this.findSubGraphParts();i.add(this);const e=new GSet,s=i.iterator;for(;s.next();){const n=s.value;if(!(n instanceof Node))continue;const o=n.linksConnected;for(;o.next();){const r=o.value;i.has(r)||e.add(r)}}return t&&(this.d0=e),e.iterator}findExternalNodesConnected(){const t=this.findSubGraphParts();t.add(this);const i=new GSet,e=t.iterator;for(;e.next();){const s=e.value;if(!(s instanceof Node))continue;const n=s.linksConnected;for(;n.next();){const o=n.value,r=o.fromNode;r!==null&&(!t.has(r)||r===this)&&i.add(r);const l=o.toNode;l!==null&&(!t.has(l)||l===this)&&i.add(l)}}return i.iterator}pE(){function t(e,s){e!==null&&(s.add(e),t(e.containingGroup,s))}const i=new GSet;return t(this,i),i}findSubGraphParts(){const t=new GSet;return Part.sh(t,this,!0,0,!0),t.delete(this),t}Bi(t){super.Bi(t);const i=this.memberParts;for(;i.next();)i.value.Bi(t)}collapseSubGraph(){const t=this.diagram;if(t===null||t.isCollapsingExpanding)return;t.isCollapsingExpanding=!0;const i=this.findSubGraphParts();this.cT(i,t,this),t.isCollapsingExpanding=!1}cT(t,i,e){const s=this.memberParts;for(;s.next();){const n=s.value;if(n.Bi(!1),n instanceof Group&&n.isSubGraphExpanded&&(n.wasSubGraphExpanded=n.isSubGraphExpanded,n.cT(t,i,e)),n instanceof Node)n.invalidateConnectedLinks(t),i.Lc(n,e);else if(n instanceof Link){const o=n.labelNodes;for(;o.next();)o.value.invalidateConnectedLinks(t)}}this.isSubGraphExpanded=!1}expandSubGraph(){const t=this.diagram;if(t===null||t.isCollapsingExpanding)return;t.isCollapsingExpanding=!0;const i=this.findSubGraphParts();this.fT(i,t,this),t.isCollapsingExpanding=!1}fT(t,i,e){const s=this.memberParts;for(;s.next();){const n=s.value;if(n.Bi(!0),n instanceof Group&&n.wasSubGraphExpanded&&(n.wasSubGraphExpanded=!1,n.fT(t,i,e)),n instanceof Node)n.invalidateConnectedLinks(t);else if(n instanceof Link){const o=n.labelNodes;for(;o.next();)o.value.invalidateConnectedLinks(t)}}this.isSubGraphExpanded=!0}get isSubGraphExpanded(){return(this.E&512)!==0}set isSubGraphExpanded(t){const i=(this.E&512)!==0;if(i!==t){Util.i(t,"boolean",Group,"isSubGraphExpanded"),this.E=this.E^512;const e=this.diagram;this.t("isSubGraphExpanded",i,t);const s=this.subGraphExpandedChanged;if(s!==null){let n=!0;e!==null&&(n=e.Y,e.Y=!0),s(this),e!==null&&(e.Y=n)}if(e!==null&&e.undoManager.isUndoingRedoing){this.It!==null&&this.It.c(),this.memberParts.each(n=>n.updateAdornments());return}t?this.expandSubGraph():this.collapseSubGraph()}}get wasSubGraphExpanded(){return(this.E&1024)!==0}set wasSubGraphExpanded(t){const i=(this.E&1024)!==0;i!==t&&(Util.i(t,"boolean",Group,"wasSubGraphExpanded"),this.E=this.E^1024,this.t("wasSubGraphExpanded",i,t))}get subGraphExpandedChanged(){return this.gt!==null?this.gt.my:null}set subGraphExpandedChanged(t){const i=this.subGraphExpandedChanged;i!==t&&(t!==null&&Util.i(t,"function",Group,"subGraphExpandedChanged"),this.al(),this.gt.my=t,this.t("subGraphExpandedChanged",i,t))}move(t,i){i===void 0&&(i=!1);const e=i?this.location:this.position,s=e.x,n=e.y,o=t.x,r=t.y;if((s===o||isNaN(s)&&isNaN(o))&&(n===r||isNaN(n)&&isNaN(r)))return;const l=o-(isNaN(s)?0:s),h=r-(isNaN(n)?0:n),a=Point.l();super.move(t,i);const c=new GSet,u=this.findSubGraphParts().iterator;for(;u.next();){const d=u.value;d instanceof Link&&(d.suspendsRouting&&c.add(d),!(!d.Se&&(d.fromNode===this||d.toNode===this))&&(d.suspendsRouting=!0))}for(u.reset();u.next();){const d=u.value;if(d.Nl()||d instanceof Node&&d.isLinkLabel)continue;const m=d.position,g=d.location;m.isReal()?(a.x=m.x+l,a.y=m.y+h,d.position=a):g.isReal()&&(a.x=g.x+l,a.y=g.y+h,d.location=a)}for(u.reset();u.next();){const d=u.value;if(!(d instanceof Link)||(d.suspendsRouting=c.has(d),!d.Se&&(d.fromNode===this||d.toNode===this)))continue;const m=d.position;a.x=m.x+l,a.y=m.y+h,a.isReal()?d.move(a):d.invalidateRoute()}Point.s(a)}xO(){return(this.E&65536)!==0}SL(t){(this.E&65536)!==0!==t&&(this.E=this.E^65536)}get Wr(){return(this.E&32768)!==0}set Wr(t){(this.E&32768)!==0!==t&&(this.E=this.E^32768)}}class Placeholder extends GraphObject{Zt;Yd;constructor(t){super(),this.Zt=Margin.Ug,this.Yd=new Rect(NaN,NaN,NaN,NaN),t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Zt=this.Zt.N(),t.Yd=this.Yd.copy()}hh(t){if(this.background===null)return!1;const i=this.naturalBounds;return Rect.contains(0,0,i.width,i.height,t.x,t.y)}_u(t,i,e,s){const n=this.part;if((n===null||!(n instanceof Group)&&!(n instanceof Adornment))&&Util.o("Placeholder is not inside a Group or Adornment."),n instanceof Group){const o=this.computeBorder(this.Yd),r=this.minSize,l=isFinite(r.width)?Math.max(r.width,o.width):o.width,h=isFinite(r.height)?Math.max(r.height,o.height):o.height,a=this.Xi;a.En(l||0,h||0),this.Qn(0,0,a.width,a.height);const c=n.memberParts;let f=!1;for(;c.next();)if(c.value.isVisible()){f=!0;break}const u=n.diagram;if(f&&u!==null&&!u.animationManager.LM(n)&&!isNaN(o.x)&&!isNaN(o.y)){const d=Point.l();d.setRectSpot(o,n.locationSpot),n.location=d,Point.s(d)}}else{const o=n,r=this.Xi,l=this.Zt,h=l.left+l.right,a=l.top+l.bottom,c=o.adornedObject,f=c.getDocumentAngle();o.angle=f;let u=0;c instanceof Shape&&(u=c.strokeWidth);const d=c.getDocumentScale(),m=c.naturalBounds,g=(m.width+u)*d,p=(m.height+u)*d;if(o.type!==Panel.Link){const y=o.category==="Selection"?Spot.TopLeft:o.locationSpot,x=c.getDocumentPoint(y,Point.l());o.location=x,Point.s(x)}if(!isNaN(g)&&!isNaN(p))r.En(g+h||0,p+a||0),this.Qn(-l.left,-l.top,r.width,r.height);else{const y=c.getDocumentPoint(Spot.TopLeft,Point.l()),x=Rect.X(y.x,y.y,0,0);x.unionPoint(c.getDocumentPoint(Spot.BottomRight,y)),x.unionPoint(c.getDocumentPoint(Spot.TopRight,y)),x.unionPoint(c.getDocumentPoint(Spot.BottomLeft,y)),r.En(x.width+h||0,x.height+a||0),this.Qn(-l.left,-l.top,r.width,r.height),Point.s(y),Rect.s(x)}}}ah(t,i,e,s){this.actualBounds.e(t,i,e,s)}computeBorder(t){const i=this.part,e=i.diagram,s=e===null||!e.animationManager.isAnimating;if(e!==null&&i instanceof Group&&!i.layer.isTemporary&&i.computesBoundsAfterDrag&&this.Yd.isReal()){const l=e.toolManager.findTool("Dragging");if(l===e.currentTool){const h=l.computeBorder(i,this.Yd,t);if(h!==null)return h}}const n=Rect.l(),o=this.computeMemberBounds(n),r=this.Zt;return i instanceof Group&&!i.isSubGraphExpanded?t.e(o.x-r.left,o.y-r.top,0,0):t.e(o.x-r.left,o.y-r.top,Math.max(o.width+r.left+r.right,0),Math.max(o.height+r.top+r.bottom,0)),Rect.s(n),s&&i instanceof Group&&i.computesBoundsIncludingLocation&&i.location.isReal()&&t.unionPoint(i.location),t}computeMemberBounds(t){if(!(this.part instanceof Group))return t.e(0,0,0,0),t;const i=this.part;let e=1/0,s=1/0,n=-1/0,o=-1/0;const r=i.memberParts;for(;r.next();){const l=r.value;if(!l.isVisible()||l instanceof Link&&(!i.computesBoundsIncludingLinks||l.vo()||l.fromNode===i||l.toNode===i))continue;const h=l.actualBounds;h.left<e&&(e=h.left),h.top<s&&(s=h.top),h.right>n&&(n=h.right),h.bottom>o&&(o=h.bottom)}if(!isFinite(e)||!isFinite(s)){const l=i.location;t.e(l.x,l.y,0,0)}else t.e(e,s,n-e,o-s);return t}get padding(){return this.Zt}set padding(t){typeof t=="number"&&(t=new Margin(t));const i=this.Zt;i.equals(t)||(t=t.N(),this.Zt=t,this.t("padding",i,t),this.c())}}class Layout{p;ha;Gd;kr;jd;Hd;Do;fl;qd;Wd;go;constructor(t){GSet.ji(this),this.p=null,this.ha=null,this.Gd=!0,this.kr=!0,this.jd=!1,this.Hd=new Point(0,0).g(),this.Do=!0,this.fl=null,this.qd=null,this.Wd=!1,this.go=null,t&&Object.assign(this,t)}cloneProtected(t){t.Gd=this.Gd,t.kr=this.kr,t.jd=this.jd,t.Hd.a(this.Hd),t.Do=this.Do,t.fl=this.fl,t.qd=this.qd,t.Wd=!0}copy(){const t=new this.constructor;return this.cloneProtected(t),t}li(t){Util.rr(this,t)}toString(){let t=Util.sn(this.constructor);return t+="(",this.group!==null&&(t+=" in "+this.group),this.diagram!==null&&(t+=" for "+this.diagram),t+=")",t}get diagram(){return this.p}set diagram(t){this.p=t}get group(){return this.ha}set group(t){this.ha!==t&&(this.ha=t,t!==null&&(this.p=t.diagram))}get isOngoing(){return this.Gd}set isOngoing(t){this.Gd!==t&&(Util.i(t,"boolean",Layout,"isOngoing"),this.Gd=t)}get isInitial(){return this.kr}set isInitial(t){Util.i(t,"boolean",Layout,"isInitial"),this.kr=t,t||(this.Wd=!0)}get isViewportSized(){return this.jd}set isViewportSized(t){this.jd!==t&&(Util.i(t,"boolean",Layout,"isViewportSized"),this.jd=t,t&&this.invalidateLayout())}get isRouting(){return this.Do}set isRouting(t){this.Do!==t&&(Util.i(t,"boolean",Layout,"isRouting"),this.Do=t)}get isRealtime(){return this.fl}set isRealtime(t){this.fl!==t&&(t!==null&&Util.i(t,"boolean",Layout,"isRealtime"),this.fl=t)}get isValidLayout(){return this.Wd}set isValidLayout(t){if(this.Wd!==t&&(Util.i(t,"boolean",Layout,"isValidLayout"),this.Wd=t,!t)){const i=this.diagram;i!==null&&(i.Kr=!0)}}invalidateLayout(){if(this.isValidLayout){const t=this.diagram;if(t===null||t.undoManager.isUndoingRedoing)return;const i=t.animationManager;if(i.isTicking)return;i.defaultAnimation.isAnimating&&i.stopAnimation(),(this.isOngoing&&t.Bh||this.isInitial&&!t.Bh)&&(this.isValidLayout=!1,t.requestUpdate())}}get network(){return this.go}set network(t){this.go!==t&&(this.go=t,t!==null&&(t.layout=this))}createNetwork(){return new LayoutNetwork(this)}makeNetwork(t){const i=this.createNetwork();return t instanceof Diagram?(i.addParts(t.nodes,!0),i.addParts(t.links,!0)):t instanceof Group?i.addParts(t.memberParts):i.addParts(t.iterator),i}updateParts(){this.isValidLayout=!0;let t=this.diagram;if(t===null&&this.network!==null){const i=this.network.vertexes.iterator;for(;i.next();){const s=i.value.node;if(s!==null&&(t=s.diagram,t!==null))break}}try{t!==null&&t.startTransaction("Layout"),this.commitLayout()}finally{t!==null&&t.commitTransaction("Layout")}}commitLayout(){if(this.network===null)return;const t=this.network.vertexes.iterator;for(;t.next();)t.value.commit();if(this.isRouting){const i=this.network.edges.iterator;for(;i.next();)i.value.commit()}}doLayout(t){const i=new GSet;if(t instanceof Diagram?(this.kh(i,t.nodes,!0,this.Wr,!0,!1,!0),this.kh(i,t.parts,!0,this.Wr,!0,!1,!0)):t instanceof Group?this.kh(i,t.memberParts,!1,this.Wr,!0,!1,!0):i.addAll(t.iterator),i.count>0){const s=this.diagram;s!==null&&s.startTransaction("Layout"),this.doMinimalNoNetworkLayout(i),s!==null&&s.commitTransaction("Layout")}this.isValidLayout=!0}doMinimalNoNetworkLayout(t){const i=t.count,e=Math.ceil(Math.sqrt(i));this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin);const s=this.arrangementOrigin.x,n=this.arrangementOrigin.y;let o=s,r=n,l=0,h=0;const a=t.iterator;for(;a.next();){const c=a.value;c.ensureBounds();const f=c.measuredBounds,u=f.width,d=f.height;c.moveTo(o,r),c instanceof Group&&(c.Wr=!1),o+=Math.max(u,50)+20,h=Math.max(h,Math.max(d,50)),l>=e-1?(l=0,o=s,r+=h+20,h=0):l++}}doMinimalNetworkLayout(){const t=this.network.vertexes.count,i=Math.ceil(Math.sqrt(t));this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin);const e=this.arrangementOrigin.x,s=this.arrangementOrigin.y;let n=e,o=s,r=0,l=0;const h=this.network.vertexes.iterator;for(;h.next();){const a=h.value.node;if(a===null||a instanceof Link||(a.ensureBounds(),!this.Wr(a)))continue;const c=a.measuredBounds,f=c.width,u=c.height;a.moveTo(n,o),a instanceof Group&&(a.Wr=!1),n+=Math.max(f,50)+20,l=Math.max(l,Math.max(u,50)),r>=i-1?(r=0,n=e,o+=l+20,l=0):r++}}Wr(t){return!!(!t.location.isReal()&&!t.position.isReal()||t instanceof Group&&t.Wr)}kh(t,i,e,s,n,o,r){const l=i.iterator;for(;l.next();){const h=l.value;if(!(e&&!h.isTopLevel)&&!(s!==null&&!s(h))&&h.canLayout())if(n&&h instanceof Node){if(h.isLinkLabel)continue;h instanceof Group&&h.layout===null?this.kh(t,h.memberParts,!1,s,n,o,r):(h.ensureBounds(),t.add(h))}else o&&h instanceof Link?t.add(h):r&&h.Pe()&&!(h instanceof Node)&&(h.ensureBounds(),t.add(h))}}getLayoutBounds(t,i){const e=this.boundsComputation;return e!==null?(i||(i=new Rect),e(t,this,i)):!i&&t.margin.equalTo(0,0,0,0)?t.actualBounds:(i||(i=new Rect),i.set(t.actualBounds),i.addMargin(t.margin),i)}get boundsComputation(){return this.qd}set boundsComputation(t){this.qd!==t&&(t!==null&&Util.i(t,"function",Layout,"boundsComputation"),this.qd=t,this.invalidateLayout())}collectParts(t){const i=new GSet;return t instanceof Diagram?(this.kh(i,t.nodes,!0,null,!0,!0,!0),this.kh(i,t.links,!0,null,!0,!0,!0),this.kh(i,t.parts,!0,null,!0,!0,!0)):t instanceof Group?this.kh(i,t.memberParts,!1,null,!0,!0,!0):this.kh(i,t.iterator,!1,null,!0,!0,!0),i}get arrangementOrigin(){return this.Hd}set arrangementOrigin(t){this.Hd.equals(t)||(this.Hd.a(t),this.invalidateLayout())}initialOrigin(t){const i=this.group;if(i!==null)if(i.hasPlaceholder()){const e=i.placeholder,s=e.getDocumentPoint(Spot.TopLeft);(isNaN(s.x)||isNaN(s.y))&&s.set(t);const n=e.padding;return s.x+=n.left,s.y+=n.top,s}else{const e=i.position.copy();return(isNaN(e.x)||isNaN(e.y))&&e.set(t),e}return t}}class LayoutNetwork{ie;mo;Cn;ky;Py;constructor(t){GSet.ji(this),this.ie=t,this.mo=new GSet,this.Cn=new GSet,this.ky=new GMap,this.Py=new GMap}clear(){if(this.mo){const t=this.mo.iterator;for(;t.next();)t.value.clear()}if(this.Cn){const t=this.Cn.iterator;for(;t.next();)t.value.clear()}this.mo=new GSet,this.Cn=new GSet,this.ky=new GMap,this.Py=new GMap}toString(t){t===void 0&&(t=0);let i="LayoutNetwork"+(this.layout!==null?"("+this.layout.toString()+")":"");if(t<=0)return i;if(i+=" vertexes: "+this.mo.count+" edges: "+this.Cn.count,t>1){const e=this.mo.iterator;for(;e.next();){const n=e.value;i+=`
    `+n.toString(t-1)}const s=this.Cn.iterator;for(;s.next();){const n=s.value;i+=`
    `+n.toString(t-1)}}return i}get layout(){return this.ie}set layout(t){t!==null&&(this.ie=t)}get vertexes(){return this.mo}get edges(){return this.Cn}createVertex(){return new LayoutVertex(this)}createEdge(){return new LayoutEdge(this)}addParts(t,i,e){if(t===null)return;i===void 0&&(i=!1),Util.i(i,"boolean",LayoutNetwork,"addParts:toplevelonly"),e===void 0&&(e=null),e===null&&(e=n=>{if(n instanceof Node)return!n.isLinkLabel;if(n instanceof Link){const o=n.fromNode;if(o===null||o.isLinkLabel)return!1;const r=n.toNode;return!(r===null||r.isLinkLabel)}return!1});const s=t.iterator;for(;s.next();){const n=s.value;if(n instanceof Node&&!(i&&!n.isTopLevel)&&n.canLayout()&&e(n))if(n instanceof Group&&n.layout===null)this.addParts(n.memberParts,!1);else{if(this.findVertex(n)!==null)continue;const o=this.createVertex();o.node=n,this.addVertex(o)}}for(s.reset();s.next();){const n=s.value;if(!(n instanceof Link)||i&&!n.isTopLevel||!n.canLayout()||!e(n)||this.findEdge(n)!==null)continue;const o=n.fromNode,r=n.toNode;if(o===null||r===null||o===r)continue;const l=this.findGroupVertex(o),h=this.findGroupVertex(r);this.linkVertexes(l,h,n)}}findGroupVertex(t){if(t===null)return null;const i=t.findVisibleNode();if(i===null)return null;let e=this.findVertex(i);if(e!==null)return e;let s=i.containingGroup;for(;s!==null;){if(e=this.findVertex(s),e!==null)return e;s=s.containingGroup}return null}addVertex(t){if(t===null)return;this.mo.add(t);const i=t.node;i!==null&&this.ky.set(i,t),t.network=this}addNode(t){if(t===null)return null;let i=this.findVertex(t);return i===null&&(i=this.createVertex(),i.node=t,this.addVertex(i)),i}deleteVertex(t){if(t!==null&&this.uT(t)){let i=t.Qo;for(let e=i.count-1;e>=0;e--){const s=i.elt(e);this.deleteEdge(s)}i=t._o;for(let e=i.count-1;e>=0;e--){const s=i.elt(e);this.deleteEdge(s)}}}uT(t){if(t===null)return!1;const i=this.mo.delete(t);if(i){const e=t.node;e!==null&&this.ky.delete(e)}return i}deleteNode(t){if(t===null)return;const i=this.findVertex(t);i!==null&&this.deleteVertex(i)}findVertex(t){return t===null?null:this.ky.get(t)}addEdge(t){if(t===null)return;this.fN(t);const i=t.toVertex;i!==null&&i.addSourceEdge(t);const e=t.fromVertex;e!==null&&e.addDestinationEdge(t)}fN(t){if(t===null)return;this.Cn.add(t);const i=t.link;i!==null&&this.findEdge(i)===null&&this.Py.set(i,t),t.network=this}addLink(t){if(t===null)return null;const i=t.fromNode,e=t.toNode;let s=this.findEdge(t);return s===null?(s=this.createEdge(),s.link=t,i!==null&&(s.fromVertex=this.addNode(i)),e!==null&&(s.toVertex=this.addNode(e)),this.addEdge(s)):(i!==null?s.fromVertex=this.addNode(i):s.fromVertex=null,e!==null?s.toVertex=this.addNode(e):s.toVertex=null),s}deleteEdge(t){if(t===null)return;const i=t.toVertex;i!==null&&i.deleteSourceEdge(t);const e=t.fromVertex;e!==null&&e.deleteDestinationEdge(t),this.uN(t)}uN(t){if(t===null)return!1;const i=this.Cn.delete(t);if(i){const e=t.link;e!==null&&this.Py.delete(e)}return i}deleteLink(t){if(t===null)return;const i=this.findEdge(t);i!==null&&this.deleteEdge(i)}findEdge(t){return t===null?null:this.Py.get(t)}linkVertexes(t,i,e){if(t===null||i===null)return null;if(t.network===this&&i.network===this){const s=this.createEdge();return s.link=e,s.fromVertex=t,s.toVertex=i,this.addEdge(s),s}return null}reverseEdge(t){if(t===null)return;const i=t.fromVertex,e=t.toVertex;i===null||e===null||(i.deleteDestinationEdge(t),e.deleteSourceEdge(t),t.reverseEdge(),i.addSourceEdge(t),e.addDestinationEdge(t))}deleteSelfEdges(){const t=Util.nt(),i=this.Cn.iterator;for(;i.next();){const s=i.value;s.fromVertex===s.toVertex&&t.push(s)}const e=t.length;for(let s=0;s<e;s++)this.deleteEdge(t[s]);Util.tt(t)}deleteArtificialVertexes(){const t=Util.nt(),i=this.mo.iterator;for(;i.next();){const o=i.value;o.node===null&&o.data===null&&t.push(o)}let e=t.length;for(let o=0;o<e;o++)this.deleteVertex(t[o]);const s=Util.nt(),n=this.Cn.iterator;for(;n.next();){const o=n.value;o.link===null&&o.data===null&&s.push(o)}e=s.length;for(let o=0;o<e;o++)this.deleteEdge(s[o]);Util.tt(t),Util.tt(s)}deleteUselessEdges(){const t=Util.nt(),i=this.Cn.iterator;for(;i.next();){const s=i.value;(s.fromVertex===null||s.toVertex===null)&&t.push(s)}const e=t.length;for(let s=0;s<e;s++)this.deleteEdge(t[s]);Util.tt(t)}isSingleton(t){return!(t.Qo.count>0||t._o.count>0)}splitIntoSubNetworks(t){t===void 0&&(t=!0),t&&(this.deleteArtificialVertexes(),this.deleteUselessEdges(),this.deleteSelfEdges());const i=new List;let e=!0;for(;e;){e=!1;const s=this.mo.iterator;for(;s.next();){const n=s.value;if(this.isSingleton(n))continue;const o=this.layout.createNetwork();i.add(o),this.bO(o,n),e=!0;break}}return i.sort((s,n)=>s===null||n===null||s===n?0:n.vertexes.count-s.vertexes.count),i}bO(t,i){if(i===null)return;const e=new List;for(e.add(i);e.count>0;){const s=e.first();if(e.removeAt(0),s.network===t)continue;this.uT(s),t.addVertex(s);let n=s.sourceEdges;for(;n.next();){const o=n.value;o.network!==t&&(this.uN(o),t.fN(o),e.add(o.fromVertex))}for(n=s.destinationEdges;n.next();){const o=n.value;o.network!==t&&(this.uN(o),t.fN(o),e.add(o.toVertex))}}}findAllParts(){const t=new GSet,i=this.mo.iterator;for(;i.next();){const s=i.value;t.add(s.node)}const e=this.Cn.iterator;for(;e.next();){const s=e.value;t.add(s.link)}return t}}class LayoutVertex{go;_t;de;Ae;We;Qo;_o;constructor(t){GSet.ji(this),this.go=t,this.Ae=new Rect(0,0,10,10).g(),this.We=new Point(5,5).g(),this._t=null,this.de=null,this.Qo=new List,this._o=new List}clear(){this._t=null,this.de=null,this.Qo=new List,this._o=new List}toString(t){t===void 0&&(t=0);let i="LayoutVertex#"+GSet.as(this);if(t>0&&(i+=this.node!==null?"("+this.node.toString()+")":"",t>1)){let e="",s=!0,n=this.Qo.iterator;for(;n.next();){const r=n.value;s?s=!1:e+=",",e+=r.toString(0)}let o="";for(s=!0,n=this._o.iterator;n.next();){const r=n.value;s?s=!1:o+=",",o+=r.toString(0)}i+=" sources: "+e+" destinations: "+o}return i}get po(){return this.Qo.JN}get tr(){return this._o.JN}get data(){return this._t}set data(t){if(this._t=t,t!==null&&t.bounds){const i=t.bounds,e=i.x,s=i.y,n=i.width,o=i.height;this.We.e(n/2,o/2),this.Ae.e(e,s,n,o)}}get node(){return this.de}set node(t){if(this.de!==t){this.de=t,t.ensureBounds();const i=this.network.layout,e=Rect.l(),s=i.getLayoutBounds(t,e);let n=s.x,o=s.y;const r=s.width,l=s.height;if(isNaN(n)&&(n=0),isNaN(o)&&(o=0),this.Ae.e(n,o,r,l),Rect.s(e),!(t instanceof Group)){const h=t.locationObject.getDocumentPoint(Spot.Center);if(h.isReal()){this.We.e(h.x-n,h.y-o);return}}this.We.e(r/2,l/2)}}get bounds(){return this.Ae}set bounds(t){this.Ae.equals(t)||this.Ae.a(t)}get focus(){return this.We}set focus(t){this.We.equals(t)||this.We.a(t)}get centerX(){return this.Ae.x+this.We.x}set centerX(t){const i=this.Ae;i.x+this.We.x!==t&&(i.ot(),i.x=t-this.We.x,i.g())}get centerY(){return this.Ae.y+this.We.y}set centerY(t){const i=this.Ae;i.y+this.We.y!==t&&(i.ot(),i.y=t-this.We.y,i.g())}get focusX(){return this.We.x}set focusX(t){const i=this.We;i.x!==t&&(i.ot(),i.x=t,i.g())}get focusY(){return this.We.y}set focusY(t){const i=this.We;i.y!==t&&(i.ot(),i.y=t,i.g())}get x(){return this.Ae.x}set x(t){const i=this.Ae;i.x!==t&&(i.ot(),i.x=t,i.g())}get y(){return this.Ae.y}set y(t){const i=this.Ae;i.y!==t&&(i.ot(),i.y=t,i.g())}get width(){return this.Ae.width}set width(t){const i=this.Ae;i.width!==t&&(i.ot(),i.width=t,i.g())}get height(){return this.Ae.height}set height(t){const i=this.Ae;i.height!==t&&(i.ot(),i.height=t,i.g())}commit(){const t=this._t;if(t!==null){const e=this.bounds,s=t.bounds;Util.wt(s)?(s.x=e.x,s.y=e.y,s.width=e.width,s.height=e.height):t.bounds=e.copy();return}const i=this.node;if(i!==null){const e=this.bounds;if(!(i instanceof Group)){const s=Rect.l();i.ensureBounds();const n=this.network.layout.getLayoutBounds(i,s),o=i.locationObject.getDocumentPoint(Spot.Center);if(n.isReal()&&o.isReal()){i.moveTo(e.x+this.focusX-(o.x-n.x)+i.margin.left,e.y+this.focusY-(o.y-n.y+i.margin.top)),Rect.s(s);return}Rect.s(s)}i.moveTo(e.x+i.margin.left,e.y+i.margin.top)}}addSourceEdge(t){t!==null&&(this.Qo.has(t)||this.Qo.add(t))}deleteSourceEdge(t){t!==null&&this.Qo.delete(t)}addDestinationEdge(t){t!==null&&(this._o.has(t)||this._o.add(t))}deleteDestinationEdge(t){t!==null&&this._o.delete(t)}get network(){return this.go}set network(t){this.go=t}get sourceVertexes(){const t=new GSet,i=this.sourceEdges;for(;i.next();){const e=i.value;t.add(e.fromVertex)}return t.iterator}get destinationVertexes(){const t=new GSet,i=this.destinationEdges;for(;i.next();){const e=i.value;t.add(e.toVertex)}return t.iterator}get vertexes(){const t=new GSet;let i=this.sourceEdges;for(;i.next();){const e=i.value;t.add(e.fromVertex)}for(i=this.destinationEdges;i.next();){const e=i.value;t.add(e.toVertex)}return t.iterator}get sourceEdges(){return this.Qo.iterator}get destinationEdges(){return this._o.iterator}get edges(){const t=new List;let i=this.sourceEdges;for(;i.next();){const e=i.value;t.add(e)}for(i=this.destinationEdges;i.next();){const e=i.value;t.add(e)}return t.iterator}get edgesCount(){return this.Qo.count+this._o.count}static standardComparer(t,i){const e=t.de,s=i.de;if(e)if(s){const n=e.text,o=s.text;return n<o?-1:n>o?1:0}else return 1;else return s!==null?-1:0}static smartComparer(t,i){if(t!==null)if(i!==null){const e=t.de,s=i.de;if(e!==null)if(s!==null){const n=e.text.toLocaleLowerCase(),o=s.text.toLocaleLowerCase(),r=n.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/),l=o.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/);let h=0;for(;h<r.length;h++)if(l[h]!==""&&l[h]!==void 0){const a=parseFloat(r[h]),c=parseFloat(l[h]);if(isNaN(a))if(isNaN(c)){if(r[h].localeCompare(l[h])!==0)return r[h].localeCompare(l[h]);continue}else return 1;else{if(isNaN(c))return-1;if(a-c!==0)return a-c;continue}}else{if(r[h]==="")continue;return 1}return l[h]!==""&&l[h]!==void 0?-1:0}else return 1;else return s!==null?-1:0}else return 1;else return i!==null?-1:0}}class LayoutEdge{go;_t;qe;Je;$e;constructor(t){GSet.ji(this),this.go=t,this._t=null,this.qe=null,this.Je=null,this.$e=null}clear(){this._t=null,this.qe=null,this.Je=null,this.$e=null}toString(t){t===void 0&&(t=0);let i="LayoutEdge#"+GSet.as(this);return t>0&&(i+=this.qe!==null?"("+this.qe.toString()+")":"",t>1&&(i+=" "+(this.Je?this.Je.toString():"null")+" --> "+(this.$e?this.$e.toString():"null"))),i}reverseEdge(){const t=this.Je;this.Je=this.$e,this.$e=t}commit(){}getOtherVertex(t){return this.$e===t?this.Je:this.Je===t?this.$e:null}get network(){return this.go}set network(t){this.go=t}get data(){return this._t}set data(t){this._t!==t&&(this._t=t)}get link(){return this.qe}set link(t){this.qe!==t&&(this.qe=t)}get fromVertex(){return this.Je}set fromVertex(t){this.Je!==t&&(this.Je=t)}get toVertex(){return this.$e}set toVertex(t){this.$e!==t&&(this.$e=t)}}var GridAlignment=(w=>(w[w.Position=0]="Position",w[w.Location=1]="Location",w))(GridAlignment||{}),GridArrangement=(w=>(w[w.LeftToRight=10]="LeftToRight",w[w.RightToLeft=11]="RightToLeft",w))(GridArrangement||{}),GridSorting=(w=>(w[w.Forwards=20]="Forwards",w[w.Reverse=21]="Reverse",w[w.Ascending=22]="Ascending",w[w.Descending=23]="Descending",w))(GridSorting||{});class GridLayout extends Layout{Jd;$d;Co;Ln;ri;Ki;pe;ye;constructor(t){super(),this.isViewportSized=!0,this.Jd=NaN,this.$d=NaN,this.Co=new Size(NaN,NaN).g(),this.Ln=new Size(10,10).g(),this.ri=1,this.Ki=10,this.pe=22,this.ye=GridLayout.standardComparer,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Jd=this.Jd,t.$d=this.$d,t.Co.a(this.Co),t.Ln.a(this.Ln),t.ri=this.ri,t.Ki=this.Ki,t.pe=this.pe,t.ye=this.ye}li(t){t in GridSorting?this.sorting=t:t in GridArrangement?this.arrangement=t:t in GridAlignment?this.alignment=t:super.li(t)}doLayout(t){this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin);const i=this.collectParts(t),e=this.diagram,n=i.copy().iterator;for(;n.next();){const m=n.value;if(m.Nl()&&(m.fromNode!==null||m.toNode!==null)){i.delete(m);continue}if(m.ensureBounds(),m instanceof Group){const g=m.memberParts;for(;g.next();){const p=g.value;i.delete(p)}}}const o=i.toArray();if(o.length===0)return;switch(this.sorting){case 20:break;case 21:o.reverse();break;case 22:o.sort(this.comparer);break;case 23:o.sort(this.comparer),o.reverse();break}let r=this.wrappingColumn;isNaN(r)&&(r=0);let l=this.wrappingWidth;if(isNaN(l)&&e!==null){const m=e.viewportBounds,g=e.padding;l=Math.max(m.width-g.left-g.right,0)}else l=Math.max(this.wrappingWidth,0);r<=0&&l<=0&&(r=1);let h=this.spacing.width;isFinite(h)||(h=0);let a=this.spacing.height;isFinite(a)||(a=0),e!==null&&e.startTransaction("Layout");const c=[];switch(this.alignment){case 0:this.kO(o,l,r,h,a,c);break;case 1:this.PO(o,l,r,h,a,c);break}let f=0,u=0,d=0;for(let m=0;m<c.length;m++){const g=c[m];f=Math.min(f,g.x),u=Math.min(u,g.y),d=Math.max(d,g.x+g.width)}this.arrangement===11?this.commitLayers(c,new Point(f+h/2-(d+f),u-a/2)):this.commitLayers(c,new Point(f-h/2,u-a/2)),e!==null&&e.commitTransaction("Layout"),this.isValidLayout=!0}kO(t,i,e,s,n,o){const r=Rect.l();let l=Math.max(this.cellSize.width,1);if(!isFinite(l)){l=0;for(let p=0;p<t.length;p++){const y=t[p],x=this.getLayoutBounds(y,r);l=Math.max(l,x.width)}}l+=s,l=Math.max(l,1);let h=Math.max(this.cellSize.height,1);if(!isFinite(h)){h=0;for(let p=0;p<t.length;p++){const y=t[p],x=this.getLayoutBounds(y,r);h=Math.max(h,x.height)}}h+=n,h=Math.max(h,1);const a=this.arrangement,c=this.arrangementOrigin.x,f=this.arrangementOrigin.y;let u=c,d=f,m=0,g=0;for(let p=0;p<t.length;p++){const y=t[p],x=this.getLayoutBounds(y,r),k=Math.ceil((x.width+s)/l),b=Math.ceil((x.height+n)/h),P=k*l,M=b*h;let L=0;switch(a){case 11:L=Math.abs(u-x.width);break;default:L=u+x.width;break}(e>0&&m>e-1||i>0&&m>0&&L-c>i)&&(o.push(new Rect(0,d,i+s,g)),m=0,u=c,d+=g,g=0),g=Math.max(g,M);let C=0;switch(a){case 11:C=-x.width;break;default:C=0;break}switch(y.moveTo(u+C+y.margin.left,d+y.margin.top),a){case 11:u-=P;break;default:u+=P;break}m++}o.push(new Rect(0,d,i+s,g)),Rect.s(r)}PO(t,i,e,s,n,o){const r=Rect.l();let l=Math.max(this.cellSize.width,1),h=0,a=0,c=0;const f=Point.l();for(let C=0;C<t.length;C++){const S=t[C],N=this.getLayoutBounds(S,r),T=S.getRelativePoint(S.locationObject,S.locationSpot,f);h=Math.max(h,T.x),a=Math.max(a,N.width-T.x),c=Math.max(c,T.y)}const u=this.arrangement;switch(u){case 11:h+=s;break;default:a+=s;break}isFinite(l)?l=Math.max(l+s,1):l=Math.max(h+a,1);const d=this.arrangementOrigin.x,m=this.arrangementOrigin.y;let g=d,p=m,y=0;i>=h&&(i-=h);let x=0,k=0;const b=Math.max(this.cellSize.height,1);c=0;let P=0,M=!0;const L=Point.l();for(let C=0;C<t.length;C++){const S=t[C],N=this.getLayoutBounds(S,r),T=S.getRelativePoint(S.locationObject,S.locationSpot,f);if(y>0)switch(u){case 11:{let D=(g-d-(N.width-T.x))/l;Geo.K(Math.round(D),D)?D=Math.round(D):D=Math.floor(D),g=D*l+d;break}default:{let D=(g-d+T.x)/l;Geo.K(Math.round(D),D)?D=Math.round(D):D=Math.ceil(D),g=D*l+d;break}}else switch(u){case 11:x=g+T.x+N.width;break;default:x=g-T.x;break}let A=0;switch(u){case 11:A=-(g+T.x)+x;break;default:A=g+N.width-T.x-x;break}if(e>0&&y>e-1||i>0&&y>0&&A>i){o.push(new Rect(0,M?p-c:p,i+s,P+c+n));for(let D=0;D<y&&C!==y;D++){const F=t[C-y+D],R=F.getRelativePoint(F.locationObject,F.locationSpot,L);F.moveTo(F.position.x,F.position.y+c-R.y)}P+=n,M?p+=P:p+=P+c,c=0,P=0,y=0,g=d,M=!1}switch(g===d&&(u===11?k=Math.max(k,N.width-T.x):k=Math.min(k,-T.x)),c=Math.max(c,T.y),P=Math.max(P,N.height-T.y),isFinite(b)&&(P=Math.max(P,Math.max(N.height,b)-T.y)),M?S.moveTo(g-T.x,p-T.y):S.moveTo(g-T.x,p),u){case 11:g-=T.x+s;break;default:g+=N.width-T.x+s;break}y++}if(o.push(new Rect(0,p,i+s,(M?P:P+c)+n)),t.length!==y)for(let C=0;C<y;C++){const S=t[t.length-y+C],N=S.getRelativePoint(S.locationObject,S.locationSpot,f);S.moveTo(S.position.x,S.position.y+c-N.y)}if(Point.s(f),Point.s(L),u===11)for(let C=0;C<o.length;C++){const S=o[C];S.width+=k,S.x-=k}else for(let C=0;C<o.length;C++){const S=o[C];S.x>k&&(S.width+=S.x-k,S.x=k)}Rect.s(r)}commitLayers(t,i){}get wrappingWidth(){return this.Jd}set wrappingWidth(t){this.Jd!==t&&(Util.i(t,"number",GridLayout,"wrappingWidth"),(t>0||isNaN(t))&&(this.Jd=t,this.isViewportSized=isNaN(t),this.invalidateLayout()))}get wrappingColumn(){return this.$d}set wrappingColumn(t){this.$d!==t&&(Util.i(t,"number",GridLayout,"wrappingColumn"),(t>0||isNaN(t))&&(this.$d=t,this.invalidateLayout()))}get cellSize(){return this.Co}set cellSize(t){this.Co.equals(t)||(this.Co.a(t),this.invalidateLayout())}get spacing(){return this.Ln}set spacing(t){this.Ln.equals(t)||(this.Ln.a(t),this.invalidateLayout())}get alignment(){return this.ri}set alignment(t){this.ri!==t&&(t===1||t===0)&&(this.ri=t,this.invalidateLayout())}get arrangement(){return this.Ki}set arrangement(t){this.Ki!==t&&(t===10||t===11)&&(this.Ki=t,this.invalidateLayout())}get sorting(){return this.pe}set sorting(t){this.pe!==t&&(t===20||t===21||t===22||t===23)&&(this.pe=t,this.invalidateLayout())}get comparer(){return this.ye}set comparer(t){this.ye!==t&&(Util.i(t,"function",GridLayout,"comparer"),this.ye=t,this.invalidateLayout())}static standardComparer(t,i){const e=t.text,s=i.text;return e<s?-1:e>s?1:0}static smartComparer(t,i){if(t!==null)if(i!==null){const e=t.text.toLocaleLowerCase(),s=i.text.toLocaleLowerCase(),n=e.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/),o=s.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/);let r=0;for(;r<n.length;r++)if(o[r]!==""&&o[r]!==void 0){const l=parseFloat(n[r]),h=parseFloat(o[r]);if(isNaN(l))if(isNaN(h)){if(n[r].localeCompare(o[r])!==0)return n[r].localeCompare(o[r]);continue}else return 1;else{if(isNaN(h))return-1;if(l-h!==0)return l-h;continue}}else{if(n[r]==="")continue;return 1}return o[r]!==""&&o[r]!==void 0?-1:0}else return 1;else return i!==null?-1:0}static Position=0;static Location=1;static LeftToRight=10;static RightToLeft=11;static Forward=20;static Reverse=21;static Ascending=22;static Descending=23}class PartManager{Zd;qs;At;Ua;p;My;yo;ul;dN;constructor(){this.Zd=new GSet,this.qs=new GSet,this.At=new GSet,this.yo=new GMap,this.ul=new GMap,this.Ua=new GMap,this.p=null,this.My=!1,this.dN=!0}clear(){this.Zd.clear(),this.qs.clear(),this.At.clear(),this.yo.clear(),this.ul.clear(),this.Ua.clear()}Ao(t){this.p=t}qh(t){if(t instanceof Node){if(this.Zd.add(t),t instanceof Group){const e=t.containingGroup;e===null?this.p.Yr.add(t):e.la.add(t);const s=t.layout;s!==null&&(s.diagram=this.p)}}else t instanceof Link?(this.qs.add(t),t.isAvoiding&&(this.p.jm=!0)):t instanceof Adornment||this.At.add(t);const i=t.data;i!==null&&(t instanceof Adornment||(t instanceof Link?this.dT(i,t):this.yo.set(i,t)))}te(t){if(t.clearAdornments(),t instanceof Node){if(this.Zd.delete(t),t instanceof Group){const e=t.containingGroup;e===null?this.p.Yr.delete(t):e.la.delete(t);const s=t.layout;s!==null&&(s.diagram=null)}}else t instanceof Link?this.qs.delete(t):t instanceof Adornment||this.At.delete(t);const i=t.data;i!==null&&(t instanceof Adornment||(t instanceof Link?this.gT(i,t):this.yo.delete(i)))}dT(t,i){this.ul.set(t,i)}gT(t,i){this.ul.delete(t)}rebuildParts(){const t=this.p;if(t===null)return;const i=t.nodeTemplateMap.iterator;for(;i.next();){const a=i.value,c=i.key;(!a.Pe()||a instanceof Group)&&Util.o(`Invalid node template in Diagram.nodeTemplateMap: template for "${c}" must be a Node or a simple Part, not a Group or Link: ${a}`)}const e=t.groupTemplateMap.iterator;for(;e.next();){const a=e.value,c=e.key;a instanceof Group||Util.o(`Invalid group template in Diagram.groupTemplateMap: template for "${c}" must be a Group, not a normal Node or Link: ${a}`)}const s=t.linkTemplateMap.iterator;for(;s.next();){const a=s.value,c=s.key;a instanceof Link||Util.o(`Invalid link template in Diagram.linkTemplateMap: template for "${c}" must be a Link, not a normal Node or simple Part: ${a}`)}const n=Util.nt(),o=t.selection.iterator;for(;o.next();){const c=o.value.data;c&&n.push(c)}const r=Util.nt(),l=t.highlighteds.iterator;for(;l.next();){const c=l.value.data;c&&r.push(c)}const h=Util.nt();if(this.preservesRebuildLocations){const a=this.nodes.iterator;for(;a.next();){const u=a.value;u.data!==null&&(h.push(u.data),h.push(u.location))}const c=this.links.iterator;for(;c.next();){const u=c.value;u.data!==null&&(h.push(u.data),h.push(u.location))}const f=this.parts.iterator;for(;f.next();){const u=f.value;u.data!==null&&(h.push(u.data),h.push(u.location))}}this.mT(),this.AS();for(let a=0;a<n.length;a++){const c=this.findPartForData(n[a]);c!==null&&(c.isSelected=!0)}for(let a=0;a<r.length;a++){const c=this.findPartForData(r[a]);c!==null&&(c.isHighlighted=!0)}if(this.preservesRebuildLocations)for(let a=0;a<h.length;a+=2){const c=this.findPartForData(h[a]);c!==null&&(c.location=h[a+1])}Util.tt(n),Util.tt(r),Util.tt(h)}AS(){const t=this.diagram.model;this.Sy(t.nodeDataArray)}Sy(t,i){const e=this.diagram.model;t.forEach(s=>{e.containsNodeData(s)&&this.pT(s,!1)}),t.forEach(s=>{e.containsNodeData(s)&&this.S1(s)}),i!==!1&&this.diagram.bb(!1)}pT(t,i){if(t==null||this.diagram.undoManager.isUndoingRedoing||this.yo.has(t))return null;i===void 0&&(i=!0);const e=this.MO(t);return e!==null&&i&&this.S1(t),e}MO(t){if(t==null||this.p.undoManager.isUndoingRedoing||this.yo.has(t))return null;const i=this.SO(t),e=this.findTemplateForNodeData(t,i);if(e!==null){e.Vt();const s=e.copy();if(s!==null){const n=this.diagram.fe;return this.diagram.fe=!0,s.jo=i,s._t=t,this.My&&(s.rl="Tool"),this.diagram.add(s),s._t=null,s.data=t,this.diagram.fe=n,s}}return null}insertLink(t,i,e,s){return null}S1(t){}SO(t){return this.p.model.getCategoryForNodeData(t)}static yT=!1;static wT=!1;findTemplateForNodeData(t,i){const e=this.p,s=e.model,n=s.qc()&&s.isGroupForData(t);let o=null;return n?(o=e.groupTemplateMap.get(i),o===null&&(o=e.groupTemplateMap.get(""),o===null&&(PartManager.wT||(PartManager.wT=!0,Util.ei('No Group template found for category "'+i+'"'),Util.ei("  Using default group template")),o=e.lS))):(o=e.nodeTemplateMap.get(i),o===null&&(o=e.nodeTemplateMap.get(""),o===null&&(PartManager.yT||(PartManager.yT=!0,Util.ei('No Node template found for category "'+i+'"'),Util.ei("  Using default node template")),o=e.nS))),o}getLinkCategoryForData(t){return""}setLinkCategoryForData(t,i){}setFromNodeForLink(t,i,e){}setToNodeForLink(t,i,e){}static xT=!1;findLinkTemplateForCategory(t){const i=this.p;let e=i.linkTemplateMap.get(t);return e===null&&(e=i.linkTemplateMap.get(""),e===null&&(PartManager.xT||(PartManager.xT=!0,Util.ei('No Link template found for category "'+t+'"'),Util.ei("  Using default link template")),e=i.oS)),e}uv(t,i,e){t instanceof Link?(i!==null&&this.gT(i,t),e!==null&&this.dT(e,t)):t instanceof Part&&(i!==null&&this.yo.delete(i),e!==null&&this.yo.set(e,t))}mT(){const t=this.diagram.model;this.gN(t.nodeDataArray)}gN(t){t.forEach(i=>{this.N1(i)})}N1(t){const i=this.findPartForData(t);i!==null&&(this.diagram.CS(i,!1),this.mN(i))}mN(t){}oN(t){}findPartForKey(t){if(t==null)return null;const i=this.p.model.findNodeDataForKey(t);return i!==null?this.yo.get(i):null}findNodeForKey(t){if(t==null)return null;const i=this.p.model.findNodeDataForKey(t);if(i===null)return null;const e=this.yo.get(i);return e instanceof Node?e:null}findLinkForKey(t){return null}findPartForData(t){if(t===null)return null;let i=this.yo.get(t);return i!==null||(i=this.ul.get(t)),i}findNodeForData(t){if(t===null)return null;const i=this.yo.get(t);return i instanceof Node?i:null}findLinkForData(t,i){return t===null?null:this.ul.get(t)}findNodesByExample(...t){const i=new GSet,e=this.Zd.iterator;for(;e.next();){const s=e.value,n=s.data;if(n!==null)for(let o=0;o<arguments.length;o++){const r=arguments[o];if(Util.wt(r)&&this.pN(n,r)){i.add(s);break}}}return i.iterator}findLinksByExample(...t){const i=new GSet,e=this.qs.iterator;for(;e.next();){const s=e.value,n=s.data;if(n!==null)for(let o=0;o<arguments.length;o++){const r=arguments[o];if(Util.wt(r)&&this.pN(n,r)){i.add(s);break}}}return i.iterator}pN(t,i){for(const e in i){const s=t[e],n=i[e];if(Array.isArray(n)){if(!Array.isArray(s))return!1;const o=s,r=n;if(o.length<r.length)return!1;for(let l=0;l<o.length;l++){const h=o[l],a=r[l];if(a!==void 0&&!this.bT(h,a))return!1}}else if(!this.bT(s,n))return!1}return!0}bT(t,i){if(typeof i=="function"){if(!i(t))return!1}else if(i instanceof RegExp){if(!t||!i.test(t.toString()))return!1}else if(Util.wt(t)&&Util.wt(i)){if(!this.pN(t,i))return!1}else if(t!==i)return!1;return!0}doModelDataChanged(t){if(t.model===this.diagram.model&&this.diagram.Y){this.diagram.Y=!1;try{const i=t.change;t.modelChange===""&&i===2&&this.Ny(t.object,t.propertyName)}finally{this.diagram.Y=!0}}}doModelChanged(t){if(!this.p)return;const i=this.p;if(t.model!==i.model)return;const e=t.change;if(i.gR(t),!!i.Y){i.Y=!1;try{const s=t.modelChange;if(s!=="")if(e===2){if(s==="nodeCategory"){const n=t.object,o=this.findPartForData(n),r=t.newValue;o!==null&&typeof r=="string"&&(o.category=r)}else if(s==="nodeDataArray"){const n=t.oldValue;this.gN(n);const o=t.newValue;this.Sy(o)}i.isModified=!0}else if(e===3){const n=t.newValue;s==="nodeDataArray"&&Util.wt(n)&&this.pT(n),i.isModified=!0}else if(e===4){const n=t.oldValue;s==="nodeDataArray"&&Util.wt(n)&&this.N1(n),i.isModified=!0}else e===1&&(s==="SourceChanged"?t.object!==null?this.Ny(t.object,t.propertyName):(this.updateAllRelationshipsFromData(),this.updateAllTargetBindings()):s==="ModelDisplaced"&&this.rebuildParts());else if(e===2){const n=t.propertyName,o=t.object,r=i.model;o===r?(n==="nodeKeyProperty"||n==="nodeCategoryProperty")&&(i.undoManager.isUndoingRedoing||this.rebuildParts()):this.Ny(o,n),i.isModified=!0}else(e===3||e===4)&&(this.NO(t),i.isModified=!0)}finally{i.Y=!0}}}updateAllTargetBindings(t){t===void 0&&(t="");let i=this.parts.iterator;for(;i.next();)i.value.updateTargetBindings(t);for(i=this.nodes.iterator;i.next();)i.value.updateTargetBindings(t);for(i=this.links.iterator;i.next();)i.value.updateTargetBindings(t)}updateAllThemeBindings(){let t=this.parts.iterator;for(;t.next();)t.value.Oo();for(t=this.nodes.iterator;t.next();)t.value.Oo();for(t=this.links.iterator;t.next();)t.value.Oo()}updateAllRelationshipsFromData(){const t=this.p.model,i=new GSet,e=t.nodeDataArray;for(let o=0;o<e.length;o++){const r=e[o];i.add(r)}const s=[];this.nodes.each(o=>{o.data!==null&&!i.has(o.data)&&s.push(o.data)}),this.parts.each(o=>{o.data!==null&&!i.has(o.data)&&s.push(o.data)}),s.forEach(o=>t.kT(o,!1));for(let o=0;o<e.length;o++){const r=e[o];this.findPartForData(r)===null&&t.PT(r,!1)}this.MT();let n=this.parts.iterator;for(;n.next();)n.value.updateRelationshipsFromData();for(n=this.nodes.iterator;n.next();)n.value.updateRelationshipsFromData();for(n=this.links.iterator;n.next();)n.value.updateRelationshipsFromData()}MT(){}updateRelationshipsFromData(t){}Ny(t,i){if(typeof i=="string"){const e=this.findPartForData(t);if(e!==null)e.updateTargetBindings(i);else{const s=this.CO(t);if(s!==null&&s.length>0){for(let o=0;o<s.length;o++)s[o].updateTargetBindings(i);const n=s[0].part;if(n!==null){const o=n.adornments;for(;o.next();)o.value.updateTargetBindings(i)}Util.tt(s)}}t===this.diagram.model.modelData&&this.updateAllTargetBindings(i)}}CO(t){let i=null;const e=this.Ua.iterator;for(;e.next();){const s=e.value;for(let n=0;n<s.length;n++){const r=s[n].findItemPanelForData(t);r!==null&&(i===null&&(i=Util.nt()),i.push(r))}if(i!==null)break}return i}NO(t){const i=t.object,e=t.change===3,s=e?t.newParam:t.oldParam,n=e?t.newValue:t.oldValue,o=this.Ua.get(i);if(Array.isArray(o))for(let r=0;r<o.length;r++){const l=o[r];e?l.Wb(n,s,!0):l.gv(s)}}SS(t,i){i!==null&&t.Hr(s=>i.CL(s));const e=t.mh;if(Array.isArray(e)){const s=this.Ua.get(e);if(s===null){const n=[];n.push(t),this.Ua.set(e,n)}else{for(let n=0;n<s.length;n++)if(s[n]===t)return;s.push(t)}}}NS(t,i){t.Hr(s=>i.pR(s));const e=t.mh;if(Array.isArray(e)){const s=this.Ua.get(e);if(s!==null){for(let n=0;n<s.length;n++)if(s[n]===t){s.splice(n,1),s.length===0&&this.Ua.delete(e);return}}}}copyParts(t,i,e){e===void 0&&(e=!1);const s=new GMap;if(Array.isArray(t))for(let o=0;o<t.length;o++)this.C1(t[o],i,s,e);else{const o=t.iterator;for(;o.next();)this.C1(o.value,i,s,e)}if(i!==null){const o=i.model,r=i.c0().dragsLink,l=new GSet,h=new GMap,a=s.iterator;for(;a.next();){const c=a.value;if(c instanceof Link)!r&&(c.fromNode===null||c.toNode===null)&&l.add(c);else if(c instanceof Node&&c.data!==null){if(o.pc()){const f=c,u=a.key,d=u.findTreeParentNode();if(d!==null){const m=s.get(d);if(m!==null){o.setParentKeyForNodeData(f.data,o.getKeyForNodeData(m.data));const g=i.findLinkForData(f.data),p=u.findTreeParentLink();p!==null&&g!==null&&h.set(p,g)}else o.setParentKeyForNodeData(f.data,void 0)}}else if(o.Hu()){const f=c,u=a.key,d=o.isRelatedKeysPathTo?u.findNodesOutOf():u.findNodesInto();for(;d.next();){const m=d.value,g=s.get(m);if(g!==null){o.addRelatedKeyForNodeData(f.data,g.key);const p=i.partManager.findLinkForData(f.data,g.key),y=this.findLinkForData(u.data,m.key);y!==null&&p!==null&&h.set(y,p)}else o.removeRelatedKeyForNodeData(f.data,m.key)}}}}if(l.count>0&&i.removeParts(l,!1),h.count>0){const c=h.iterator;for(;c.next();){const f=c.key,u=c.value;s.set(f,u)}}}if(i!==null&&this.p!==null){const o=i.model,r=o.afterCopyFunction;if(r!==null){const l=new GMap;s.each(a=>{a.key.data!==null&&l.set(a.key.data,a.value.data)});const h=this.p.model;r(l,o,h)}}const n=s.iterator;for(;n.next();)n.value.updateTargetBindings();return s}C1(t,i,e,s){if(t===null||s&&!t.canCopy())return null;if(e.has(t))return e.get(t);const n=this.yN(t,i);if(!(n instanceof Part))return null;if(n.isSelected=!1,n.isHighlighted=!1,e.set(t,n),t instanceof Node){const o=t.linksConnected;for(;o.next();){const r=o.value;if(r.fromNode===t){const l=e.get(r);l!==null&&(l.fromNode=n)}if(r.toNode===t){const l=e.get(r);l!==null&&(l.toNode=n)}}if(t instanceof Group&&n instanceof Group){const r=t.memberParts;for(;r.next();){const l=r.value,h=this.C1(l,i,e,s);h instanceof Link||h!==null&&(h.containingGroup=n)}}}else if(t instanceof Link&&n instanceof Link){const o=t.fromNode;if(o!==null){const h=e.get(o);h!==null&&(n.fromNode=h)}const r=t.toNode;if(r!==null){const h=e.get(r);h!==null&&(n.toNode=h)}const l=t.labelNodes;for(;l.next();){const h=l.value,a=this.C1(h,i,e,s);a!==null&&a instanceof Node&&(a.labeledLink=n)}}return n}yN(t,i){let e=null;const s=t.data;if(s!==null&&i!==null){const n=i.model;if(!(t instanceof Link)){const o=n.copyNodeData(s);Util.wt(o)&&(n.addNodeData(o),e=i.findPartForData(o))}}else if(t.Vt(),e=t.copy(),e!==null){const n=this.p;if(i!==null)i.add(e);else if(s!==null&&n!==null&&n.commandHandler!==null&&n.commandHandler.copiesClipboardData){const o=n.model;let r=null;e instanceof Link||(r=o.copyNodeData(s)),Util.wt(r)&&(e.data=r)}}return e}get nodes(){return this.Zd}get links(){return this.qs}get parts(){return this.At}get diagram(){return this.p}get addsToTemporaryLayer(){return this.My}set addsToTemporaryLayer(t){this.My=t}get preservesRebuildLocations(){return this.dN}set preservesRebuildLocations(t){this.dN=t}}class GraphLinksPartManager extends PartManager{AS(){const t=this.diagram.model;this.Sy(t.nodeDataArray),this.ST(t.linkDataArray)}Sy(t){super.Sy(t,!1);const i=this.links.iterator;for(;i.next();)i.value.Ad();this.diagram.bb(!1)}ST(t){t.forEach(i=>{this.NT(i)}),this.diagram.bb(!1)}NT(t){if(t==null||this.diagram.undoManager.isUndoingRedoing||this.ul.has(t))return null;const i=this.getLinkCategoryForData(t),e=this.findLinkTemplateForCategory(i);if(e!==null){e.Vt();const s=e.copy();if(s!==null){const n=this.diagram.fe;this.diagram.fe=!0,s.jo=i,s._t=t;const o=this.diagram.model,r=o.L1(t,!0);r!==""&&(s.fromPortId=r);const l=o.Te(t,!0);if(l!==void 0){const f=this.findNodeForKey(l);f instanceof Node&&(s.fromNode=f)}const h=o.L1(t,!1);h!==""&&(s.toPortId=h);const a=o.Te(t,!1);if(a!==void 0){const f=this.findNodeForKey(a);f instanceof Node&&(s.toNode=f)}const c=o.getLabelKeysForLinkData(t);return Array.isArray(c)&&c.forEach(f=>{const u=this.findNodeForKey(f);u!==null&&(u.labeledLink=s)}),this.My&&(s.rl="Tool"),this.diagram.add(s),s._t=null,s.data=t,this.diagram.fe=n,s}}return null}mT(){const t=this.diagram.model;this.CT(t.linkDataArray),this.gN(t.nodeDataArray)}CT(t){t.forEach(i=>{this.N1(i)})}getLinkCategoryForData(t){return this.diagram.model.getCategoryForLinkData(t)}setLinkCategoryForData(t,i){return this.diagram.model.setCategoryForLinkData(t,i)}setFromNodeForLink(t,i){const e=this.diagram.model,s=i!==null?i.data:null;e.setFromKeyForLinkData(t.data,e.getKeyForNodeData(s))}setToNodeForLink(t,i){const e=this.diagram.model,s=i!==null?i.data:null;e.setToKeyForLinkData(t.data,e.getKeyForNodeData(s))}oN(t){this.diagram.model.removeLinkData(t.data)}findPartForKey(t){const i=super.findPartForKey(t);if(i===null){const s=this.diagram.model.findLinkDataForKey(t);if(s!==null)return this.ul.get(s)}return i}findLinkForKey(t){if(t==null)return null;const e=this.diagram.model.findLinkDataForKey(t);return e!==null?this.ul.get(e):null}doModelChanged(t){if(super.doModelChanged(t),!this.diagram)return;const i=this.diagram;if(t.model!==i.model)return;const e=t.change;if(i.Y){i.Y=!1;try{const s=t.modelChange;if(s!==""){if(e===2){if(s==="linkFromKey"){const n=t.object,o=this.findLinkForData(n);if(o!==null){const r=t.newValue,l=this.findNodeForKey(r);o.fromNode=l}}else if(s==="linkToKey"){const n=t.object,o=this.findLinkForData(n);if(o!==null){const r=t.newValue,l=this.findNodeForKey(r);o.toNode=l}}else if(s==="linkFromPortId"){const n=t.object,o=this.findLinkForData(n);if(o!==null){const r=t.newValue;typeof r=="string"&&(o.fromPortId=r)}}else if(s==="linkToPortId"){const n=t.object,o=this.findLinkForData(n);if(o!==null){const r=t.newValue;typeof r=="string"&&(o.toPortId=r)}}else if(s==="nodeGroupKey"){const n=t.object,o=this.findPartForData(n);if(o!==null){const r=t.newValue;if(r!==void 0){const l=this.findNodeForKey(r);l instanceof Group?o.containingGroup=l:o.containingGroup=null}else o.containingGroup=null}}else if(s==="linkLabelKeys"){const n=t.object,o=this.findLinkForData(n);if(o!==null){const r=t.oldValue,l=t.newValue;Array.isArray(r)&&r.forEach(h=>{if(l.indexOf(h)>=0)return;const a=this.findNodeForKey(h);a!==null&&(a.labeledLink=null)}),Array.isArray(l)&&l.forEach(h=>{const a=this.findNodeForKey(h);a!==null&&(a.labeledLink=o)})}}else if(s==="linkCategory"){const n=t.object,o=this.findLinkForData(n),r=t.newValue;o!==null&&typeof r=="string"&&(o.category=r)}else if(s==="linkDataArray"){const n=t.oldValue;this.CT(n);const o=t.newValue;this.ST(o)}i.isModified=!0}else if(e===3){const n=t.newValue;if(s==="linkDataArray"&&typeof n=="object"&&n!==null)this.NT(n);else if(s==="linkLabelKeys"&&t.model.isKeyType(n)){const o=t.object,r=this.findLinkForData(o),l=this.findNodeForKey(n);r!==null&&l!==null&&(l.labeledLink=r)}i.isModified=!0}else if(e===4){const n=t.oldValue;if(s==="linkDataArray"&&typeof n=="object"&&n!==null)this.N1(n);else if(s==="linkLabelKeys"&&t.model.isKeyType(n)){const o=this.findNodeForKey(n);o!==null&&(o.labeledLink=null)}i.isModified=!0}}else if(e===2){const n=t.propertyName,o=t.object,r=i.model;o===r&&(n==="linkFromKeyProperty"||n==="linkToKeyProperty"||n==="linkFromPortIdProperty"||n==="linkToPortIdProperty"||n==="linkLabelKeysProperty"||n==="nodeIsGroupProperty"||n==="nodeGroupKeyProperty"||n==="linkCategoryProperty")&&(i.undoManager.isUndoingRedoing||this.rebuildParts()),i.isModified=!0}}finally{i.Y=!0}}}MT(){const t=this.diagram.model,i=new GSet,e=t.linkDataArray;e.forEach(n=>{i.add(n)});const s=[];this.links.each(n=>{n.data!==null&&!i.has(n.data)&&s.push(n.data)}),s.forEach(n=>{t.LT(n,!1)}),e.forEach(n=>{this.findLinkForData(n)===null&&t.AT(n,!1)})}updateRelationshipsFromData(t){const i=t.data;if(i===null)return;const e=t.diagram;if(e===null)return;const s=e.model;if(t instanceof Link){let n=s.Te(i,!0),o=e.findNodeForKey(n);t.fromNode=o,n=s.Te(i,!1),o=e.findNodeForKey(n),t.toNode=o;const r=s.getLabelKeysForLinkData(i);if(r.length>0||t.labelNodes.count>0){if(r.length===1&&t.labelNodes.count===1){const f=r[0],u=t.labelNodes.first();if(s.getKeyForNodeData(u.data)===f)return}const l=new GSet().addAll(r),h=new GSet;t.labelNodes.each(f=>{if(f.data!==null){const u=s.getKeyForNodeData(f.data);u!==void 0&&h.add(u)}});const a=h.copy();a.removeAll(l);const c=l.copy();if(c.removeAll(h),a.count>0||c.count>0){const f=t;a.each(u=>{const d=e.findNodeForKey(u);d!==null&&d.labeledLink===f&&(d.labeledLink=null)}),c.each(u=>{const d=e.findNodeForKey(u);d!==null&&d.labeledLink!==f&&(d.labeledLink=f)})}}}else if(!(t instanceof Adornment)){const n=s.getGroupKeyForNodeData(i),o=e.findPartForKey(n);(o===null||o instanceof Group)&&(t.containingGroup=o)}}S1(t){const i=this.diagram.model,e=i.getKeyForNodeData(t);if(e!==void 0){const s=i.Cy(e),n=this.findPartForData(t);if(s!==null&&n!==null){const r=s.iterator;for(;r.next();){const l=r.value;if(i.containsNodeData(l)){if(n instanceof Group&&i.getGroupKeyForNodeData(l)===e){const h=this.findPartForData(l);h!==null&&(h.containingGroup=n)}}else{const h=this.findLinkForData(l);if(h!==null&&n instanceof Node){i.Te(l,!0)===e&&(h.fromNode=n),i.Te(l,!1)===e&&(h.toNode=n);const a=i.getLabelKeysForLinkData(l);Array.isArray(a)&&a.some(c=>c===e?(n.labeledLink=h,!0):!1)}}}i.Js(e)}const o=i.getGroupKeyForNodeData(t);if(o!==void 0){const r=this.findNodeForKey(o);r instanceof Group&&(n.containingGroup=r)}}}mN(t){const i=this.diagram.model;if(t instanceof Node){const e=i.getKeyForNodeData(t.data);if(e!==void 0){const s=t.linksConnected;for(;s.next();){const n=s.value;i.$s(e,n.data)}if(t.isLinkLabel){const n=t.labeledLink;n!==null&&i.$s(e,n.data)}if(t instanceof Group){const n=t.memberParts;for(;n.next();){const r=n.value.data;i.containsNodeData(r)&&i.$s(e,r)}}}}}yN(t,i){let e=super.yN(t,i);if(t instanceof Link){const s=t.data;if(s!==null&&i!==null){const n=i.model,o=n.copyLinkData(s);typeof o=="object"&&o!==null&&(n.addLinkData(o),e=i.findLinkForData(o))}else if(e!==null){const n=this.diagram;if(s!==null&&n!==null&&n.commandHandler!==null&&n.commandHandler.copiesClipboardData){const r=n.model.copyLinkData(s);typeof r=="object"&&r!==null&&(e.data=r)}}}return e}insertLink(t,i,e,s){const n=this.diagram,o=n.model,r=n.toolManager.findTool("Linking");let l="";t!==null&&(i===null&&(i=t),l=i.portId,l===null&&(l=""));let h="";e!==null&&(s===null&&(s=e),h=s.portId,h===null&&(h=""));const a=r.archetypeLinkData;if(a instanceof Link){a.Vt();const c=a.copy();if(c!==null){c.fromNode=t,c.fromPortId=l,c.toNode=e,c.toPortId=h,n.add(c);const f=r.archetypeLabelNodeData;if(f instanceof Node){f.Vt();const u=f.copy();u!==null&&(u.labeledLink=c,n.add(u))}return c}}else if(a!==null){const c=o.copyLinkData(a);if(typeof c=="object"&&c!==null){t!==null&&o.Qd(c,o.getKeyForNodeData(t.data),!0),o._d(c,l,!0),e!==null&&o.Qd(c,o.getKeyForNodeData(e.data),!1),o._d(c,h,!1),o.addLinkData(c);const f=r.archetypeLabelNodeData;if(f!==null&&!(f instanceof Node)){const d=o.copyNodeData(f);if(typeof d=="object"&&d!==null){o.addNodeData(d);const m=o.getKeyForNodeData(d);m!==void 0&&o.addLabelKeyForLinkData(c,m)}}return n.findLinkForData(c)}}return null}}class TreePartManager extends PartManager{Ph=null;A1(t,i){if(t===null||i===null||i.findTreeParentLink()!==null)return null;const e=this.diagram.toolManager.findTool("Linking");let s=t,n=i;if(this.diagram.isTreePathToChildren){if(e!==null&&e.xu(s,n,null,!0))return null}else if(s=i,n=t,e!==null&&e.xu(s,n,null,!0))return null;const o=this.getLinkCategoryForData(i.data),r=this.findLinkTemplateForCategory(o);if(r!==null){r.Vt();const l=r.copy();if(l!==null){const h=this.diagram.fe;return this.diagram.fe=!0,l.jo=o,l._t=i.data,l.fromNode=s,l.toNode=n,this.diagram.add(l),l._t=null,l.data=i.data,this.diagram.fe=h,l}}return null}getLinkCategoryForData(t){return this.diagram.model.getParentLinkCategoryForNodeData(t)}setLinkCategoryForData(t,i){this.diagram.model.setParentLinkCategoryForNodeData(t,i)}setFromNodeForLink(t,i,e){const s=this.diagram.model;e===void 0&&(e=null);const n=i!==null?i.data:null;if(this.diagram.isTreePathToChildren)s.setParentKeyForNodeData(t.data,s.getKeyForNodeData(n));else{const o=this.Ph;this.Ph=t,e!==null&&s.setParentKeyForNodeData(e.data,void 0);const r=t.toNode!==null?t.toNode.data:null;s.setParentKeyForNodeData(n,s.getKeyForNodeData(r)),this.Ph=o}}setToNodeForLink(t,i,e){const s=this.diagram.model;e===void 0&&(e=null);const n=i!==null?i.data:null;if(this.diagram.isTreePathToChildren){const o=this.Ph;this.Ph=t,e!==null&&s.setParentKeyForNodeData(e.data,void 0);const r=t.fromNode!==null?t.fromNode.data:null;s.setParentKeyForNodeData(n,s.getKeyForNodeData(r)),this.Ph=o}else s.setParentKeyForNodeData(t.data,s.getKeyForNodeData(n))}oN(t){this.diagram.model.setParentKeyForNodeData(t.data,void 0)}findLinkForKey(t){if(t==null)return null;const e=this.diagram.model.findNodeDataForKey(t);return e!==null?this.ul.get(e):null}doModelChanged(t){if(super.doModelChanged(t),!this.diagram)return;const i=this.diagram;if(t.model!==i.model)return;const e=t.change;if(i.Y){i.Y=!1;try{const s=t.modelChange;if(s!==""){if(e===2){if(s==="nodeParentKey"){const n=t.object,o=t.newValue,r=this.findNodeForKey(o),l=this.findNodeForData(n);if(this.Ph!==null)r!==null&&(this.Ph.data=n,this.Ph.category=this.getLinkCategoryForData(n));else if(l!==null){const h=l.findTreeParentLink();h!==null?r===null?i.remove(h):i.isTreePathToChildren?h.fromNode=r:h.toNode=r:this.A1(r,l)}}else if(s==="parentLinkCategory"){const n=t.object,o=this.findNodeForData(n),r=t.newValue;if(o!==null&&typeof r=="string"){const l=o.findTreeParentLink();l!==null&&(l.category=r)}}i.isModified=!0}}else if(e===2){const n=t.propertyName,o=t.object,r=i.model;o===r&&n==="nodeParentKeyProperty"&&(i.undoManager.isUndoingRedoing||this.rebuildParts()),i.isModified=!0}}finally{i.Y=!0}}}updateRelationshipsFromData(t){const i=t.data;if(i===null)return;const e=t.diagram;if(e===null)return;const s=e.model;if(t instanceof Node){const n=s.getParentKeyForNodeData(i),o=e.findNodeForKey(n),r=t.findTreeParentNode();if(o!==r){const l=t.findTreeParentLink();o!==null?l!==null?e.isTreePathToChildren?l.fromNode=o:l.toNode=o:this.A1(o,t):l!==null&&e.CS(l,!1)}}}Ny(t,i){if(super.Ny(t,i),typeof i=="string"&&this.findPartForData(t)!==null){const s=this.findLinkForData(t);s!==null&&s.updateTargetBindings(i)}}S1(t){const i=this.diagram.model,e=i.getKeyForNodeData(t);if(e!==void 0){const s=i.Cy(e),n=this.findPartForData(t);if(s!==null&&n!==null){const r=s.iterator;for(;r.next();){const l=r.value;if(i.containsNodeData(l)&&n instanceof Node&&i.getParentKeyForNodeData(l)===e){const h=this.findNodeForData(l);this.A1(n,h)}}i.Js(e)}const o=i.getParentKeyForNodeData(t);if(o!==void 0&&n instanceof Node){const r=this.findNodeForKey(o);this.A1(r,n)}}}mN(t){const i=this.diagram.model;if(t instanceof Node){const e=i.getKeyForNodeData(t.data),s=this.findLinkForData(t.data);if(s!==null){s.isSelected=!1,s.isHighlighted=!1;const r=s.layer;if(r!==null){const l=r.te(-1,s,!1);l>=0&&this.diagram.raiseChangedEvent(4,"parts",r,s,null,l,null);const h=s.layerChanged;h!==null&&h(s,r,null)}}const n=this.diagram.isTreePathToChildren,o=t.linksConnected;for(;o.next();){const r=o.value,h=(n?r.toNode:r.fromNode).data;i.containsNodeData(h)&&i.$s(e,h)}}}insertLink(t,i,e,s){const n=this.diagram.model;let o=t,r=e;if(this.diagram.isTreePathToChildren||(o=e,r=t),o!==null&&r!==null){const l=o.data,h=r.data;return n.setParentKeyForNodeData(h,n.getKeyForNodeData(l)),r.findTreeParentLink()}return null}}var BindingMode=(w=>(w[w.OneWay=1]="OneWay",w[w.TwoWay=2]="TwoWay",w))(BindingMode||{});class Binding{n;wN;Va;Lf;Mh;Af;Tf;Df;T1;ke;md;uf;constructor(t,i,e,s){GSet.ji(this),t===void 0?t="":Util.i(t,"string",Binding,"constructor:targetprop"),i===void 0?i=t:Util.i(i,"string",Binding,"constructor:sourceprop"),e===void 0?e=null:e!==null&&Util.i(e,"function",Binding,"constructor:conv"),this.wN=-1,this.ke=null,this.Va=t,this.md=0,this.uf=0,this.Lf=null,this.Mh=i,this.Af=e,s===void 0?(this.Tf=1,this.Df=null):(this.Tf=2,this.Df=s),this.T1=new GSet,this.n=2}copy(){const t=new this.constructor;return this.cloneProtected(t),t}cloneProtected(t){t.Va=this.Va,t.md=this.md,t.uf=this.uf,t.Lf=this.Lf,t.Mh=this.Mh,t.Af=this.Af,t.Tf=this.Tf,t.Df=this.Df,t.n=this.n&-2}static OneWay=1;static TwoWay=2;static parseEnum(t,i){return Util.i(t,"function",Binding,"parseEnum:ctor"),e=>{let s=parseInt(e);return isNaN(s)&&(s=Util.Ih(t,e),s===null)?i:s}}li(t){t in BindingMode?this.mode=t:Util.rr(this,t)}static toString(t){return Util.toString(t)}toString(){return"Binding("+this.targetProperty+":"+this.sourceProperty+(this.targetId!==-1?" "+this.targetId:"")+" "+BindingMode[this.mode]+")"}g(){return this.n=this.n|1,this}ot(){return this.n=this.n&-2,this}get targetId(){return this.wN}set targetId(t){this.h&&Util.T(this),Util.i(t,"number",Binding,"targetId"),this.wN=t}get targetProperty(){return this.Va}set targetProperty(t){this.h&&Util.T(this),Util.i(t,"string",Binding,"targetProperty"),this.Va=t}get sourceProperty(){return this.Mh}set sourceProperty(t){this.h&&Util.T(this),Util.i(t,"string",Binding,"sourceProperty"),this.Mh=t}get h(){return(this.n&1)!==0}get isToData(){return(this.n&2)!==0}get isToObject(){return(this.n&4)!==0}get isToModel(){return(this.n&8)!==0}get isToTheme(){return(this.n&16)!==0}get xN(){return this.isToTheme&&!(this.isToData||this.isToObject||this.isToModel)}Qu(){return!1}get sourceName(){return this.Lf}set sourceName(t){this.h&&Util.T(this),t!==null&&Util.i(t,"string",Binding,"sourceName"),this.Lf=t,t!==null?this.n=this.n&-3|4:this.n=this.n|2}get converter(){return this.Af}set converter(t){this.h&&Util.T(this),t!==null&&Util.i(t,"function",Binding,"converter"),this.Af=t}get backConverter(){return this.Df}set backConverter(t){this.h&&Util.T(this),t!==null&&Util.i(t,"function",Binding,"backConverter"),this.Df=t}get mode(){return this.Tf}set mode(t){this.h&&Util.T(this),this.isToTheme&&t===2&&Util.o("Theme Bindings cannot be TwoWay."),this.Tf=t}makeTwoWay(t){return this.isToTheme&&Util.o("Theme Bindings cannot be TwoWay."),this.mode=2,t&&(Util.i(t,"function",Binding,"makeTwoWay"),this.backConverter=t),this}ofObject(t){return this.h&&Util.T(this),t===void 0&&(t=""),this.sourceName=t,this}ofModel(){return this.h&&Util.T(this),this.n=this.n&-3&-5|8,this.Lf=null,this}tA(t,i){const e=this.sourceName;let s=null;return e===null||e===""?s=t:e==="/"?s=i.part:e==="."?s=i:e===".."?s=i.panel:s=t.findObject(e),s}check(t){const i=this.Va,e=this.Mh,s=this.Af;(this.Qu()&&s===null&&this.Sh===null&&i===""||s===null&&i==="")&&Util.ei("Binding error: target property is the empty string: "+this.toString()),this.Qu()&&this.xN&&e===""&&s===null&&this.Sh===null&&Util.ei("Binding error: theme bindings require a source property when not using a converter: "+this.toString()),t&&typeof i=="string"&&(typeof t.setAttribute!="function"&&i.length>0&&i[0]!=="_"&&!Util.fw(t,i)?Util.ei("Binding error: undefined target property: "+i+" on "+t.toString()):i==="name"&&t instanceof GraphObject&&Util.ei("Binding error: cannot modify GraphObject.name on "+t.toString()))}updateTarget(t,i,e){const s=this.Mh;if(e!==void 0&&s!==""&&s!==e)return;const n=this.Va,o=this.Af;let r=i;if(s!==""&&!this.xN&&(r=Model.vt(i,s)),r===void 0)return;const l=t.diagram?.themeManager??t.panel?.diagram?.themeManager;if(o===null){if(n!==""){if(this.Qu()&&(r=this.TT(l,r,t,n),r===void 0))return;Model.rt(t,n,r)}}else try{if(n!==""){let h=o(r,t);if(this.Qu()&&(h=this.TT(l,h,t,n),h===void 0))return;Model.rt(t,n,h)}else o(r,t)}catch{}}updateSource(t,i,e,s){if(this.Tf!==2)return;const n=this.Va;if(e!==void 0&&n!==e)return;const o=this.Mh,r=this.Df;let l=t;if(n!==""&&(l=Model.vt(t,n)),l!==void 0&&!this.T1.has(t))try{this.T1.add(t);const h=s!==null?s.diagram:null,a=h!==null?h.model:null;if(r===null){if(o!=="")a!==null?a.setDataProperty(i,o,l):Model.rt(i,o,l);else if(a!==null&&s!==null&&s.itemIndex>=0&&s.panel!==null&&Array.isArray(s.panel.itemArray)){const c=s.itemIndex,f=s.panel.itemArray;a.removeArrayItem(f,c),a.insertArrayItem(f,c,l)}}else try{if(o!==""){const c=r(l,i,a);a!==null?a.setDataProperty(i,o,c):Model.rt(i,o,c)}else{const c=r(l,i,a);if(c!==void 0&&a!==null&&s!==null&&s.itemIndex>=0&&s.panel!==null&&Array.isArray(s.panel.itemArray)){const f=s.itemIndex,u=s.panel.itemArray;a.removeArrayItem(u,f),a.insertArrayItem(u,f,c)}}}catch{}}finally{this.T1.delete(t)}}}class ThemeBinding extends Binding{Ly;Sh;za;constructor(t,i,e,s,n){super(t,i,s),e==null&&(e=""),n===void 0&&(n=null),this.Ly=e,this.Sh=n,this.za=null,this.n=16}cloneProtected(t){super.cloneProtected(t),t.Ly=this.Ly,t.Sh=this.Sh,t.za=this.za}Qu(){return!0}get themeSource(){return this.Ly}set themeSource(t){this.h&&Util.T(this),t!==null&&Util.i(t,"string",ThemeBinding,"themeSource"),this.Ly=t,this.za=null,t!==null?this.n=this.n|16:this.n=this.n&-17}get themeConverter(){return this.Sh}set themeConverter(t){this.h&&Util.T(this),t!==null&&Util.i(t,"function",ThemeBinding,"themeConverter"),this.Sh=t}ofData(){return this.h&&Util.T(this),this.n=this.n|2,this.Lf=null,this}TT(t,i,e,s){if(!t||(this.xN&&(i=this.Mh),!i&&i!==0))return;let n=this.themeSource;this.za!==null?n=this.za:typeof n=="string"&&n.includes(".")&&(this.za=n.split("."),n=this.za);let o=t.findValue(i,n,s);return o===void 0&&Util.ei(`Theme warning: ${i} could not be found when setting target property ${s}.`),typeof this.Sh=="function"&&(o=this.Sh(o,e)),o}}class Model{St;tg;Ro;D1;De;Ff;Rf;ig;eg;sg;ng;Xa;ir;F1;Fo;R1;ii;Nh;og=new GSet;rg=new GSet;Ay;constructor(t,i){if(GSet.ji(this),this.St="",this.tg="",this.Ro=!1,this.D1={},this.De=[],this.ii=new GMap,this.Nh="key",this.Ff=null,this.Rf=null,this.ig=!1,this.eg=!1,this.sg=!1,this.ng=null,this.Xa="category",this.ir=new GMap,this.Ay=100,this.F1=new List,this.Fo=!1,this.R1=null,this.undoManager=new UndoManager,t!==void 0&&(Array.isArray(t)?this.nodeDataArray=t:i=t),i){Object.assign(this,i);const e=i.Changed;e&&(delete this.Changed,this.addChangedListener(e))}}cloneProtected(t){t.St=this.St,t.tg=this.tg,t.Ro=this.Ro,t.Nh=this.Nh,t.Ff=this.Ff,t.Rf=this.Rf,t.ig=this.ig,t.eg=this.eg,t.sg=this.sg,t.Ay=this.Ay,t.ng=this.ng,t.Xa=this.Xa}copy(){const t=new this.constructor;return this.cloneProtected(t),t}clear(){this.De=[],this.ii.clear(),this.ir.clear(),this.undoManager.clear()}toString(t){if(t===void 0&&(t=0),t>1)return this.toJson();{let i=(this.name!==""?this.name:"")+" Model";if(t>0){i+=`
 node data:`;const e=this.nodeDataArray,s=e.length;for(let n=0;n<s;n++){const o=e[n];i+=" "+this.getKeyForNodeData(o)+":"+Util.toString(o)}}return i}}toIncrementalData(t){t.change!==1&&Util.o("Model.toIncrementalData argument is not a Transaction ChangedEvent:"+t.toString());const i=t.object;if(!t.isTransactionFinished||!(i instanceof Transaction))return null;this.DT(i);const e=this.bN(i,t.propertyName==="FinishedUndo");return this.Ka=null,e}bN(t,i){const e=this;let s=!1;const n=new GSet,o=new GSet,r=new GSet,l=this.Ka;t.changes.each(u=>{if(u.model===e){if(u.modelChange==="nodeDataArray")u.change===3?n.add(u.newValue):u.change===4&&r.add(u.oldValue);else if(e.containsNodeData(u.object))o.add(u.object);else if(u.change===2&&(e.modelData===u.object||u.propertyName==="modelData"))s=!0;else if(u.object!==null)if(l&&l.has(u.object))l.get(u.object).each(m=>{e.containsNodeData(m)&&o.add(m)});else{if(u.object instanceof Model||e.Ta()&&e.containsLinkData(u.object))return;e.FT(u.object).each(m=>{o.add(m)})}}});const h=this.rg;h.clear(),n.each(u=>{h.add(e.getKeyForNodeData(u)),i||o.add(u)});const a=this.og;a.clear(),r.each(u=>{a.add(e.getKeyForNodeData(u)),i&&o.add(u)});const c=e.cloneDeep(o.toArray());let f=null;return s&&(f===null&&(f={}),f.modelData=this.cloneDeep(this.modelData)),h.count>0&&(f===null&&(f={}),i?f.removedNodeKeys=h.toArray():f.insertedNodeKeys=h.toArray()),c.length>0&&(f===null&&(f={}),f.modifiedNodeData=c),a.count>0&&(f===null&&(f={}),i?f.insertedNodeKeys=a.toArray():f.removedNodeKeys=a.toArray()),a.clear(),h.clear(),f}cloneDeep(t){return this.lg(t,!0)}lg(t,i,e,s,n){if(!Util.wt(t))return t;n||(n=[]);const o=Object.isExtensible(t);if(e||(e=new GMap),o){const h=e.get(t);if(h)return h}else{s||(s=new GMap);const h=s.iterator;for(;h.next();){const a=h.key;if(h.value===t){const f=e.get(a);if(f)return f}}}function r(h,a){if(o)h.__gohashid===void 0&&n.push(h),e.set(h,a);else{const c=GSet.Eg++;e.set(c,a),s.set(c,t)}}let l;if(Array.isArray(t)){l=[],r(t,l);for(let h=0;h<t.length;h++){const a=t[h];l.push(this.lg(a,!1,e,s,n))}}else if(t instanceof Point||t instanceof Size||t instanceof Rect||t instanceof Margin||t instanceof Spot)l=t.copy(),r(t,l);else{if(t instanceof Brush||t instanceof Geometry)return t;if(t instanceof List)l=new List().addAll(this.lg(t.toArray(),!1,e,s,n)),r(t,l);else if(t instanceof GSet)l=new GSet().addAll(this.lg(t.toArray(),!1,e,s,n)),r(t,l);else if(t instanceof GMap)l=new GMap().addAll(this.lg(t.toArray(),!1,e,s,n)),r(t,l);else if(t instanceof Date)l=new Date(t.getTime()),r(t,l);else if(t instanceof RegExp)l=new RegExp(t),r(t,l),l.lastIndex=t.lastIndex;else if(typeof t.copy=="function")l=t.copy(),r(t,l);else{l={},r(t,l);for(const h in t){if(h==="__gohashid")continue;const a=t[h];l[h]=this.lg(a,!1,e,s,n)}}}return i&&n.forEach(h=>{delete h.__gohashid}),l}Fe(t){return JSON.stringify(t).replace(/[\u007F-\uFFFF]/g,e=>{const s="0000"+e.charCodeAt(0).toString(16);return"\\u"+s.substring(s.length-4)})}hg(){let t="";return this.name!==""&&(t+=`,
  "name": `+this.Fe(this.name)),this.dataFormat!==""&&(t+=`,
  "dataFormat": `+this.Fe(this.dataFormat)),this.isReadOnly&&(t+=`,
  "isReadOnly": `+this.isReadOnly),this.nodeKeyProperty!=="key"&&typeof this.nodeKeyProperty=="string"&&(t+=`,
  "nodeKeyProperty": `+this.Fe(this.nodeKeyProperty)),this.copiesArrays&&(t+=`,
  "copiesArrays": true`),this.copiesArrayObjects&&(t+=`,
  "copiesArrayObjects": true`),this.copiesKey&&(t+=`,
  "copiesKey": true`),this.pointsDigits!==100&&(t+=`,
  "pointsDigits": `+this.pointsDigits.toString()),this.nodeCategoryProperty!=="category"&&typeof this.nodeCategoryProperty=="string"&&(t+=`,
  "nodeCategoryProperty": `+this.Fe(this.nodeCategoryProperty)),t}Ty(t){t.name&&(this.name=t.name),t.dataFormat&&(this.dataFormat=t.dataFormat),t.isReadOnly&&(this.isReadOnly=!0),t.nodeKeyProperty&&(this.nodeKeyProperty=t.nodeKeyProperty),t.copiesArrays&&(this.copiesArrays=!0),t.copiesArrayObjects&&(this.copiesArrayObjects=!0),t.copiesKey!==void 0&&(this.copiesKey=t.copiesKey),t.pointsDigits!==void 0&&(this.pointsDigits=parseInt(t.pointsDigits)),t.nodeCategoryProperty&&(this.nodeCategoryProperty=t.nodeCategoryProperty)}RT(){const t=this.modelData;return`,
  "modelData": `+this.vT(t)}OT(t){const i=t.modelData;Util.wt(i)&&(this.replaceJsonObjects(i),this.modelData=i)}kN(){const t=this.modelData;let i=!1;for(const s in t)if(!this.v1(t,s,t[s])){i=!0;break}let e="";return i&&(e=this.RT()),e+`,
  "nodeDataArray": `+this.Ch(this.nodeDataArray,!0)}PN(t){this.OT(t);const i=t.nodeDataArray;Array.isArray(i)&&(this.replaceJsonObjects(i),this.nodeDataArray=i)}MN(t,i,e){if(t===i)return!0;if(typeof t!=typeof i||typeof t=="function"||typeof i=="function")return!1;if(Array.isArray(t)&&Array.isArray(i)){if(e.get(t)===i)return!0;if(e.set(t,i),t.length!==i.length)return!1;for(let s=0;s<t.length;s++)if(!this.MN(t[s],i[s],e))return!1;return!0}else if(Util.wt(t)&&Util.wt(i)){if(e.get(t)===i)return!0;e.set(t,i);for(const s in t){const n=t[s];if(this.v1(t,s,n))continue;const o=i[s];if(o===void 0||!this.MN(n,o,e))return!1}for(const s in i){const n=i[s];if(this.v1(i,s,n))continue;const o=t[s];if(o===void 0||!this.MN(o,n,e))return!1}return!0}return!1}IT=`,
  "insertedNodeKeys": `;LO=`,
  "modifiedNodeData": `;ET=`,
  "removedNodeKeys": `;Ka=null;DT(t){let i=this.Ka;const e=(s,n)=>{const o=n.part;if(!o)return;const r=o.data;if(s===r)return;let l=i.get(s);l===null?(l=new GSet,l.add(r),i.set(s,l)):l.add(r)};i===null&&(i=new GMap,t.changes.each(s=>{if(s.diagram!==null){const n=s.change;if(n===2){const o=s.object.panel;if(o){const r=o.data;r&&e(r,o)}}else if(n===3||n===4){const o=s.object,r=o.itemArray;r&&e(r,o)}}}),this.Ka=i)}FT(t){const i=new GSet;for(let e=0;e<this.nodeDataArray.length;e++){const s=this.nodeDataArray[e];this.O1(t,s,s,i)}return i}O1(t,i,e,s){if(Array.isArray(i))for(let n=0;n<i.length;n++){const o=i[n];if(o===t)return s.add(e),!0;if(this.O1(t,o,e,s))return!0}else if(Util.wt(i)&&Object.getPrototypeOf(i)===Object.prototype)for(const n in i){const o=i[n];if(o===t)return s.add(e),!0;if(this.O1(t,o,e,s))return!0}return!1}SN(t,i){const e=this;let s=!1;const n=new GSet,o=new GSet,r=new GSet,l=this.Ka;t.changes.each(f=>{if(f.model===e){if(f.modelChange==="nodeDataArray")f.change===3?n.add(f.newValue):f.change===4&&r.add(f.oldValue);else if(e.containsNodeData(f.object))o.add(f.object);else if(f.change===2&&(e.modelData===f.object||f.propertyName==="modelData"))s=!0;else if(f.object!==null)if(l&&l.has(f.object))l.get(f.object).each(d=>{e.containsNodeData(d)&&o.add(d)});else{if(f.object instanceof Model||e.Ta()&&e.containsLinkData(f.object))return;e.FT(f.object).each(d=>{o.add(d)})}}});const h=this.rg;h.clear(),n.each(f=>{h.add(e.getKeyForNodeData(f)),i||o.add(f)});const a=this.og;a.clear(),r.each(f=>{a.add(e.getKeyForNodeData(f)),i&&o.add(f)});let c="";return s&&(c+=this.RT()),h.count>0&&(c+=(i?this.ET:this.IT)+this.Ch(h.toArray(),!0)),o.count>0&&(c+=this.LO+this.Ch(o.toArray(),!0)),a.count>0&&(c+=(i?this.IT:this.ET)+this.Ch(a.toArray(),!0)),a.clear(),h.clear(),c}Dy(t){(t.name!==void 0&&t.name!==this.name||t.dataFormat!==void 0&&t.dataFormat!==this.dataFormat||t.isReadOnly!==void 0&&t.isReadOnly!==this.isReadOnly||t.nodeKeyProperty!==void 0&&t.nodeKeyProperty!==this.nodeKeyProperty||t.copiesArrays!==void 0&&t.copiesArrays!==this.copiesArrays||t.copiesArrayObjects!==void 0&&t.copiesArrayObjects!==this.copiesArrayObjects||t.copiesKey!==void 0&&t.copiesKey!==this.copiesKey||t.nodeCategoryProperty!==void 0&&t.nodeCategoryProperty!==this.nodeCategoryProperty)&&Util.o("applyIncrementalJson cannot change Model properties"),this.OT(t);const i=t.insertedNodeKeys,e=t.modifiedNodeData,s=new GMap;if(Array.isArray(e))for(let o=0;o<e.length;o++){const r=e[o],l=this.getKeyForNodeData(r);l!=null&&s.set(l,r)}if(Array.isArray(i)){const o=i.length;for(let r=0;r<o;r++){const l=i[r];let h=this.findNodeDataForKey(l);if(h===null){const a=s.get(l);h=a||this.copyNodeData({}),this.setKeyForNodeData(h,l),this.addNodeData(h)}}}if(Array.isArray(e)){const o=e.length;for(let r=0;r<o;r++){const l=e[r],h=this.getKeyForNodeData(l),a=this.findNodeDataForKey(h);if(a!==null){for(const c in l)c==="__gohashid"||c===this.nodeKeyProperty||(this.gc()||this.Hu())&&c===this.nodeIsGroupProperty||this.setDataProperty(a,c,l[c]);this.ag(l,a)}}}const n=t.removedNodeKeys;if(Array.isArray(n)){const o=n.length;for(let r=0;r<o;r++){const l=n[r],h=this.findNodeDataForKey(l);h!==null&&this.removeNodeData(h)}}}toIncrementalJson(t,i){t.change!==1&&Util.o("Model.toIncrementalJson argument is not a Transaction ChangedEvent:"+t.toString());const e=t.object;if(!t.isTransactionFinished||!(e instanceof Transaction))return'{ "incremental": 0 }';i===void 0&&(i=Util.sn(this)),this.DT(e);const s=this.SN(e,t.propertyName==="FinishedUndo");return this.Ka=null,i==="2"?'{ "incremental": 2'+s+"}":'{ "class": '+this.Fe(i)+', "incremental": 1'+this.hg()+s+"}"}toIncrementalJSON(t,i){return this.toIncrementalJson(t,i)}toJson(t){return t===void 0&&(t=Util.sn(this)),'{ "class": '+this.Fe(t)+this.hg()+this.kN()+"}"}toJSON(t){return this.toJson(t)}applyIncrementalJson(t){let i=null;if(typeof t=="string")try{i=root.JSON.parse(t)}catch{}else typeof t=="object"?i=t:Util.o("Unable to modify a Model from: "+t);const e=i.incremental;typeof e!="number"&&Util.o("Unable to apply non-incremental changes to Model: "+t),e!==0&&(this.startTransaction("applyIncrementalJson"),this.Dy(i),this.commitTransaction("applyIncrementalJson"))}applyIncrementalJSON(t){return this.applyIncrementalJson(t)}static fromJson(t,i){i===void 0&&(i=null);let e=null;if(typeof t=="string")try{e=root.JSON.parse(t)}catch{}else typeof t=="object"?e=t:Util.o("Unable to construct a Model from: "+t);if(i===null){const s=Model.AO(e);s===null||s instanceof Model?i=s:Util.o("Unable to construct a Model of declared class: "+e.class)}return i===null&&(i=Model.constructGraphLinksModel()),i.Ty(e),i.PN(e),i}static fromJSON(t,i){return this.fromJson(t,i)}static constructGraphLinksModel(){return new Model}static AO(t){let i=null,e=t.class;if(typeof e=="string")try{let s=null;e.indexOf("go.")===0?(e=e.substring(3),s=Model.I1(e)):(s=Model.I1(e),s===null&&(s=root[e])),typeof s=="function"&&(i=new s)}catch{}return i}replaceJsonObjects(t){if(Array.isArray(t)){const i=t.length;for(let e=0;e<i;e++){const s=t[e];Util.wt(s)&&(t[e]=this.replaceJsonObjects(s))}}else if(Util.wt(t)){for(const i in t){const e=t[i];if(Util.wt(e)){const s=this.replaceJsonObjects(e);if(t[i]=s,i==="points"&&Array.isArray(s)){let n=s.length%2===0;for(let o=0;o<s.length;o++)if(typeof s[o]!="number"){n=!1;break}if(n){const o=new List;for(let r=0;r<s.length/2;r++)o.add(new Point(s[r*2],s[r*2+1]));o.g(),t[i]=o}}}}return this.TO(t)}return t}writeJsonValue(t){return t===void 0?"undefined":t===null?"null":t===!0?"true":t===!1?"false":typeof t=="string"?this.Fe(t):typeof t=="number"?t===1/0?"9e9999":t===-1/0?"-9e9999":isNaN(t)?'{"class":"NaN"}':t.toString():t instanceof Date?'{"class":"Date", "value":"'+t.toJSON()+'"}':t instanceof Number?this.writeJsonValue(t.valueOf()):Array.isArray(t)?this.Ch(t):Util.wt(t)?this.vT(t):typeof t=="function"?"null":t.toString()}Ch(t,i){i===void 0&&(i=!1);const e=t.length;if(e<=0)return"[]";const s=new StringBuilder;s.add("["),i&&e>1&&s.add(`
`);for(let n=0;n<e;n++){const o=t[n];o!==void 0&&(n>0&&(s.add(","),i&&s.add(`
`)),s.add(this.writeJsonValue(o)))}return i&&e>1&&s.add(`
`),s.add("]"),s.toString()}v1(t,i,e){return e===void 0||i==="__gohashid"||i[0]==="_"||typeof e=="function"}Yi(t){return isNaN(t)?"NaN":t===1/0?"9e9999":t===-1/0?"-9e9999":t}vT(t){const i=t;if(i instanceof Point)t={class:"go.Point",x:this.Yi(i.x),y:this.Yi(i.y)};else if(i instanceof Size)t={class:"go.Size",width:this.Yi(i.width),height:this.Yi(i.height)};else if(i instanceof Rect)t={class:"go.Rect",x:this.Yi(i.x),y:this.Yi(i.y),width:this.Yi(i.width),height:this.Yi(i.height)};else if(i instanceof Margin)t={class:"go.Margin",top:this.Yi(i.top),right:this.Yi(i.right),bottom:this.Yi(i.bottom),left:this.Yi(i.left)};else if(i instanceof Spot)i.isSpot()?t={class:"go.Spot",x:this.Yi(i.x),y:this.Yi(i.y),offsetX:this.Yi(i.offsetX),offsetY:this.Yi(i.offsetY)}:t={class:"go.Spot",enum:i.toString()};else if(i instanceof Brush){if(t={class:"go.Brush",type:BrushType[i.type]},i.type===1?t.color=i.color:(i.type===2||i.type===3)&&(t.start=i.start,t.end=i.end,i.type===3&&(i.startRadius!==0&&(t.startRadius=this.Yi(i.startRadius)),isNaN(i.endRadius)||(t.endRadius=this.Yi(i.endRadius)))),i.colorStops!==null){const n={},o=i.colorStops.iterator;for(;o.next();){const r=o.key,l=o.value;n[r]=l}t.colorStops=n}}else if(i instanceof Geometry)t={class:"go.Geometry",type:GeometryType[i.type]},i.startX!==0&&(t.startX=this.Yi(i.startX)),i.startY!==0&&(t.startY=this.Yi(i.startY)),i.endX!==0&&(t.endX=this.Yi(i.endX)),i.endY!==0&&(t.endY=this.Yi(i.endY)),i.spot1.equals(Spot.TopLeft)||(t.spot1=i.spot1),i.spot2.equals(Spot.BottomRight)||(t.spot2=i.spot2),i.type===4&&(t.path=Geometry.stringify(i));else if(Model.I1(Util.sn(i))!==null)return Util.ei("ERROR: trying to convert a GraphObject or Diagram or Model or Tool or Layout or UndoManager or other unknown data type into JSON text: "+i.toString()),"{}";let e="{",s=!0;for(const n in t){const o=Model.vt(t,n);if(!this.v1(t,n,o))if(s?s=!1:e+=",",e+=this.Fe(n)+":",n==="points"&&o instanceof List){const r=o;let l="[";const h=r.iterator;for(;h.next();){const a=h.value;l.length>1&&(l+=","),l+=this.BT(a.x),l+=",",l+=this.BT(a.y)}l+="]",e+=l}else e+=this.writeJsonValue(o)}return e+="}",e}BT(t){if(t===1/0)return"9e9999";if(t===-1/0)return"-9e9999";if(isNaN(t))return"0";const i=this.pointsDigits;return i>16?t.toString():t.toFixed(i)}get pointsDigits(){return this.Ay}set pointsDigits(t){t<0?t=0:t>100&&(t=100),this.Ay=t}Gi(t){return typeof t=="number"?t:t==="NaN"?NaN:t==="9e9999"?1/0:t==="-9e9999"?-1/0:parseFloat(t)}TO(t){if(typeof t!="object")return t;let i=t.class||"";if(typeof i!="string"||i==="")return t;if(i==="NaN")return NaN;if(i==="Date")return new Date(t.value);if(i.indexOf("go.")!==0)return t;i=i.substring(3);let e=t;if(i==="Point")e=new Point(this.Gi(t.x),this.Gi(t.y));else if(i==="Size")e=new Size(this.Gi(t.width),this.Gi(t.height));else if(i==="Rect")e=new Rect(this.Gi(t.x),this.Gi(t.y),this.Gi(t.width),this.Gi(t.height));else if(i==="Margin")e=new Margin(this.Gi(t.top),this.Gi(t.right),this.Gi(t.bottom),this.Gi(t.left));else if(i==="Spot")typeof t.enum=="string"?e=Spot.parse(t.enum):e=new Spot(this.Gi(t.x),this.Gi(t.y),this.Gi(t.offsetX),this.Gi(t.offsetY));else if(i==="Brush"){const s=new Brush;s.type=Util.Ih(BrushType,t.type)??1,typeof t.color=="string"&&(s.color=t.color),t.start instanceof Spot&&(s.start=t.start),t.end instanceof Spot&&(s.end=t.end),typeof t.startRadius=="number"&&(s.startRadius=this.Gi(t.startRadius)),typeof t.endRadius=="number"&&(s.endRadius=this.Gi(t.endRadius));const n=t.colorStops;if(Util.wt(n))for(const o in n){const r=parseFloat(o);s.addColorStop(r,n[o])}e=s}else if(i==="Geometry"){let s=null;typeof t.path=="string"?s=Geometry.parse(t.path):s=new Geometry,s.type=Util.Ih(GeometryType,t.type)??1,typeof t.startX=="number"&&(s.startX=this.Gi(t.startX)),typeof t.startY=="number"&&(s.startY=this.Gi(t.startY)),typeof t.endX=="number"&&(s.endX=this.Gi(t.endX)),typeof t.endY=="number"&&(s.endY=this.Gi(t.endY)),t.spot1 instanceof Spot&&(s.spot1=t.spot1),t.spot2 instanceof Spot&&(s.spot2=t.spot2),e=s}else if(i==="EnumValue"){let s=t.classType;s.indexOf("go.")===0&&(s=s.substring(3));const n=Model.I1(s);typeof n=="function"&&(e=Util.Ih(n,t.name))}return e}get name(){return this.St}set name(t){const i=this.St;i!==t&&(Util.i(t,"string",Model,"name"),this.St=t,this.t("name",i,t))}get dataFormat(){return this.tg}set dataFormat(t){const i=this.tg;i!==t&&(Util.i(t,"string",Model,"dataFormat"),this.tg=t,this.t("dataFormat",i,t))}get isReadOnly(){return this.Ro}set isReadOnly(t){const i=this.Ro;i!==t&&(Util.i(t,"boolean",Model,"isReadOnly"),this.Ro=t,this.t("isReadOnly",i,t))}get modelData(){return this.D1}set modelData(t){const i=this.D1;i!==t&&(Util.i(t,"object",Model,"modelData"),this.D1=t,this.t("modelData",i,t),this.updateTargetBindings(t))}addChangedListener(t){return Util.i(t,"function",Model,"addChangedListener:listener"),this.F1.add(t),this}removeChangedListener(t){Util.i(t,"function",Model,"removeChangedListener:listener"),this.F1.delete(t)}Iw(t){this.skipsUndoManager||this.undoManager.handleChanged(t);const i=this.F1,e=i.length;for(let s=0;s<e;s++)i.elt(s)(t)}raiseChangedEvent(t,i,e,s,n,o,r){this.Et("",t,i,e,s,n,o,r)}raiseChanged(t,i,e,s,n){this.Et("",2,t,this,i,e,s,n)}t(t,i,e,s,n){this.Et("",2,t,this,i,e,s,n)}raiseDataChanged(t,i,e,s,n,o){this.Et("",2,i,t,e,s,n,o)}Et(t,i,e,s,n,o,r,l){r===void 0&&(r=null),l===void 0&&(l=null);const h=new ChangedEvent;h.model=this,h.change=i,h.modelChange=t,h.propertyName=e,h.object=s,h.oldValue=n,h.oldParam=r,h.newValue=o,h.newParam=l,this.Iw(h)}get undoManager(){return this.R1}set undoManager(t){const i=this.R1;i!==t&&(i!==null&&i.removeModel(this),this.R1=t,t!==null&&t.addModel(this))}get skipsUndoManager(){return this.Fo}set skipsUndoManager(t){Util.i(t,"boolean",Model,"skipsUndoManager"),this.Fo=t}changeState(t,i){if(t!==null&&t.model===this)if(t.change===2){const e=t.object,s=t.propertyName,n=t.getValue(i);if(s===this.nodeKeyProperty&&this.containsNodeData(e)){const o=t.getValue(!i);o!==void 0&&this.ii.delete(o),n!==void 0&&this.ii.set(n,e)}Model.rt(e,s,n)}else if(t.change===3){const e=t.newParam;if(t.modelChange==="nodeDataArray"){const s=t.newValue;if(Util.wt(s)&&typeof e=="number"){const n=this.getKeyForNodeData(s);i?(this.De[e]===s&&Util.tc(this.De,e),n!==void 0&&this.ii.delete(n)):(this.De[e]!==s&&Util.su(this.De,e,s),n!==void 0&&this.ii.set(n,s))}}else if(t.modelChange===""){let s=t.object;if(s&&!Array.isArray(s)&&t.propertyName&&(s=Model.vt(t.object,t.propertyName)),Array.isArray(s)&&typeof e=="number"){const n=t.newValue;i?Util.tc(s,e):Util.su(s,e,n)}}else Util.o("unknown ChangeType.Insert modelChange: "+t.toString())}else if(t.change===4){const e=t.oldParam;if(t.modelChange==="nodeDataArray"){const s=t.oldValue;if(Util.wt(s)&&typeof e=="number"){const n=this.getKeyForNodeData(s);i?(this.De[e]!==s&&Util.su(this.De,e,s),n!==void 0&&this.ii.set(n,s)):(this.De[e]===s&&Util.tc(this.De,e),n!==void 0&&this.ii.delete(n))}}else if(t.modelChange===""){let s=t.object;if(s&&!Array.isArray(s)&&t.propertyName&&(s=Model.vt(t.object,t.propertyName)),Array.isArray(s)&&typeof e=="number"){const n=t.oldValue;i?Util.su(s,e,n):Util.tc(s,e)}}else Util.o("unknown ChangeType.Remove modelChange: "+t.toString())}else t.change===1||Util.o("unknown ChangedEvent: "+t.toString())}startTransaction(t){return this.undoManager.startTransaction(t)}commitTransaction(t){return this.undoManager.commitTransaction(t)}rollbackTransaction(){return this.undoManager.rollbackTransaction()}commit(t,i){let e=i;e===void 0&&(e="");const s=this.skipsUndoManager;e===null&&(this.skipsUndoManager=!0,e=""),this.undoManager.startTransaction(e);let n=!1;try{t(this),n=!0}finally{n?this.undoManager.commitTransaction(e):this.undoManager.rollbackTransaction(),this.skipsUndoManager=s}}updateTargetBindings(t,i){i===void 0&&(i=""),this.Et("SourceChanged",1,i,t,null,null)}get nodeKeyProperty(){return this.Nh}set nodeKeyProperty(t){const i=this.Nh;i!==t&&(this.An(t,Model,"nodeKeyProperty"),t===""&&Util.o("Model.nodeKeyProperty may not be the empty string"),this.ii.count>0&&Util.o("Cannot set Model.nodeKeyProperty when there is existing node data"),this.Nh=t,this.t("nodeKeyProperty",i,t))}An(t,i,e){typeof t!="string"&&typeof t!="function"&&Util.we(t,"string or function",i,e)}getKeyForNodeData(t){if(t===null)return;const i=this.Nh;if(i==="")return;const e=Model.vt(t,i);if(e!==void 0){if(this.isKeyType(e))return e;Util.o("Key value for node data "+t+" is not a number or a string: "+e)}}setKeyForNodeData(t,i){if((i==null||!this.isKeyType(i))&&Util.we(i,"number or string",Model,"setKeyForNodeData:key"),t===null)return;const e=this.Nh;if(e==="")return;if(!this.containsNodeData(t)){Model.rt(t,e,i);return}const s=Model.vt(t,e);if(s!==i){if(this.findNodeDataForKey(i)!==null)return;Model.rt(t,e,i),s!==void 0&&this.ii.delete(s),this.ii.set(i,t),this.Et("nodeKey",2,e,t,s,i),typeof e=="string"&&this.updateTargetBindings(t,e),this.Fy(s,i)}}get makeUniqueKeyFunction(){return this.Ff}set makeUniqueKeyFunction(t){const i=this.Ff;i!==t&&(t!==null&&Util.i(t,"function",Model,"makeUniqueKeyFunction"),this.Ff=t,this.t("makeUniqueKeyFunction",i,t))}isKeyType(t){return typeof t=="number"||typeof t=="string"}containsNodeData(t){if(t===null)return!1;const i=this.getKeyForNodeData(t);return i===void 0?!1:this.ii.get(i)===t}findNodeDataForKey(t){return t===null&&Util.o("Model.findNodeDataForKey:key must not be null"),t===void 0||!this.isKeyType(t)?null:this.ii.get(t)}get nodeDataArray(){return this.De}set nodeDataArray(t){const i=this.De;if(i!==t){this.ii.clear(),this.NN();const e=t.length;for(let o=0;o<e;o++){const r=t[o];Util.wt(r)||Util.o("Model.nodeDataArray must only contain Objects, not: "+r)}this.De=t;const s=new List;for(let o=0;o<e;o++){const r=t[o],l=this.getKeyForNodeData(r);l===void 0||this.ii.get(l)!==null?s.add(r):this.ii.set(l,r)}const n=s.iterator;for(;n.next();){const o=n.value;this.makeNodeDataKeyUnique(o);const r=this.getKeyForNodeData(o);r!==void 0&&this.ii.set(r,o)}this.Et("nodeDataArray",2,"nodeDataArray",this,i,t);for(let o=0;o<e;o++){const r=t[o];this.cg(r),this.fg(r)}}}makeNodeDataKeyUnique(t){if(t===null)return;const i=this.Nh;if(i==="")return;let e=this.getKeyForNodeData(t);if(e!==void 0&&!this.ii.has(e))return;const s=this.Ff;if(s!==null&&(e=s(this,t),e!=null&&!this.ii.has(e))){Model.rt(t,i,e);return}if(typeof e=="string"){let n=2;for(;this.ii.has(e+n);)n++;Model.rt(t,i,e+n)}else if(e===void 0||typeof e=="number"){let n=-this.ii.count-1;for(;this.ii.has(n);)n--;Model.rt(t,i,n)}}addNodeData(t){t!==null&&(this.containsNodeData(t)||this.PT(t,!0))}PT(t,i){let e=this.getKeyForNodeData(t);if(e===void 0)this.makeNodeDataKeyUnique(t),e=this.getKeyForNodeData(t);else{if(this.ii.get(e)===t)return;this.makeNodeDataKeyUnique(t),e=this.getKeyForNodeData(t)}e===void 0&&Util.o("Model.makeNodeDataKeyUnique failed on "+t+".  Data not added to Model."),this.ii.set(e,t);let s=null;i&&(s=this.De.length,Util.su(this.De,s,t)),this.Et("nodeDataArray",3,"nodeDataArray",this,null,t,null,s),this.cg(t),this.fg(t)}addNodeDataCollection(t){if(Array.isArray(t)){const i=t.length;for(let e=0;e<i;e++)this.addNodeData(t[e])}else{const i=t.iterator;for(;i.next();){const e=i.value;this.addNodeData(e)}}}removeNodeData(t){t!==null&&this.kT(t,!0)}kT(t,i){const e=this.getKeyForNodeData(t);e!==void 0&&this.ii.delete(e);let s=null;if(i){if(s=this.De.indexOf(t),s<0)return;Util.tc(this.De,s)}this.Et("nodeDataArray",4,"nodeDataArray",this,t,null,s,null),this.Ry(t)}removeNodeDataCollection(t){if(Array.isArray(t)){const i=t.length;for(let e=0;e<i;e++)this.removeNodeData(t[e])}else{const i=t.iterator;for(;i.next();){const e=i.value;this.removeNodeData(e)}}}mergeNodeDataArray(t){if(t!==this.nodeDataArray&&Array.isArray(t)){const i=this.og;i.clear(),i.addAll(this.ii.iteratorKeys);const e=this.rg;e.clear();const s=t.length;for(let o=0;o<s;o++){const r=t[o],l=this.getKeyForNodeData(r);if(l!==void 0){e.add(l);const h=this.findNodeDataForKey(l);if(h===r)continue;if(h!==null)this.assignAllDataProperties(h,r),this.ag(r,h);else{const a=this.cloneDeep(r);this.setKeyForNodeData(a,l),this.addNodeData(a)}}else{const h=this.cloneDeep(r);this.addNodeData(h),e.add(this.getKeyForNodeData(h))}}const n=i.iterator;for(;n.next();){const o=n.value;if(!e.has(o)){const r=this.findNodeDataForKey(o);r&&this.removeNodeData(r)}}i.clear(),e.clear()}}Fy(t,i){if(i===void 0)return;const e=this.Cy(t);e instanceof GSet&&this.ir.set(i,e)}NN(){}cg(t){}fg(t){}Ry(t){}$s(t,i){if(t===void 0)return;let e=this.ir.get(t);e===null&&(e=new GSet,this.ir.set(t,e)),e.add(i)}Js(t,i){if(t===void 0)return;const e=this.ir.get(t);e instanceof GSet&&(i==null?this.ir.delete(t):(e.delete(i),e.count===0&&this.ir.delete(t)))}Cy(t){if(t===void 0)return null;const i=this.ir.get(t);return i instanceof GSet?i:null}yE(t){t===void 0?this.ir.clear():this.ir.delete(t)}get copyNodeDataFunction(){return this.Rf}set copyNodeDataFunction(t){const i=this.Rf;i!==t&&(t!==null&&Util.i(t,"function",Model,"copyNodeDataFunction"),this.Rf=t,this.t("copyNodeDataFunction",i,t))}get copiesArrays(){return this.ig}set copiesArrays(t){const i=this.ig;i!==t&&(t!==null&&Util.i(t,"boolean",Model,"copiesArrays"),this.ig=t,this.t("copiesArrays",i,t))}get copiesArrayObjects(){return this.eg}set copiesArrayObjects(t){const i=this.eg;i!==t&&(t!==null&&Util.i(t,"boolean",Model,"copiesArrayObjects"),this.eg=t,this.t("copiesArrayObjects",i,t))}get copiesKey(){return this.sg}set copiesKey(t){const i=this.sg;i!==t&&(t!==null&&Util.i(t,"boolean",Model,"copiesKey"),this.sg=t,this.t("copiesKey",i,t))}copyNodeData(t){if(t===null)return null;let i=null;const e=this.Rf;return e!==null?i=e(t,this):i=this.E1(t,!0),Util.wt(i),i}E1(t,i){if(this.copiesArrays&&Array.isArray(t)){const e=t,s=[];for(let n=0;n<e.length;n++){const o=e[n],r=this.E1(o,this.copiesArrayObjects);s.push(r)}return s}else if(i&&Util.wt(t)){const e=t,s=e.constructor,n=s?new s:{},o=!this.copiesKey&&typeof this.nodeKeyProperty=="string"?this.nodeKeyProperty:null;for(const r in e){if(r==="__gohashid"){n.__gohashid=void 0;continue}if(r===o){n[o]=void 0;continue}const l=Model.vt(e,r);if(this.DO(e,r,l))Model.rt(n,r,l);else{const h=this.E1(l,!1);Model.rt(n,r,h)}}return n}else return t instanceof Point||t instanceof Size||t instanceof Rect||t instanceof Spot||t instanceof Margin?t.copy():t}get afterCopyFunction(){return this.ng}set afterCopyFunction(t){const i=this.ng;i!==t&&(t!==null&&Util.i(t,"function",Model,"afterCopyFunction"),this.ng=t,this.t("afterCopyFunction",i,t))}DO(t,i,e){const s=Util.sn(e);return s==="GraphObject"||s==="Diagram"||s==="Layer"||s==="RowColumnDefinition"||s==="AnimationManager"||s==="Tool"||s==="CommandHandler"||s==="Layout"||s==="InputEvent"||s==="DiagramEvent"?!0:e instanceof Model||e instanceof UndoManager||e instanceof Transaction||e instanceof ChangedEvent}static UT=!1;setDataProperty(t,i,e){if(this.containsNodeData(t)){if(i===this.nodeKeyProperty){this.setKeyForNodeData(t,e);return}else if(i===this.nodeCategoryProperty){this.setCategoryForNodeData(t,e);return}}else!Model.UT&&t instanceof GraphObject&&(Model.UT=!0,Util.ei('Model.setDataProperty is modifying a GraphObject, "'+t.toString()+'"'),Util.ei("  Is that really your intent?"));const s=Model.vt(t,i);s!==e&&(Model.rt(t,i,e),this.raiseDataChanged(t,i,s,e))}set(t,i,e){this.setDataProperty(t,i,e)}assignAllDataProperties(t,i){if(!i)return;const e=this.containsNodeData(t);for(const s in i)s!=="__gohashid"&&(e&&s===this.nodeKeyProperty||this.setDataProperty(t,s,i[s]))}addArrayItem(t,i){this.insertArrayItem(t,-1,i)}insertArrayItem(t,i,e){i<0&&(i=t.length),Util.su(t,i,e),this.Et("",3,"",t,null,e,null,i)}removeArrayItem(t,i){i===void 0&&(i=-1),t===this.De&&Util.o("Model.removeArrayItem should not be called on the Model.nodeDataArray"),i===-1&&(i=t.length-1);const e=t[i];Util.tc(t,i),this.Et("",4,"",t,e,null,i,null)}get nodeCategoryProperty(){return this.Xa}set nodeCategoryProperty(t){const i=this.Xa;i!==t&&(this.An(t,Model,"nodeCategoryProperty"),this.Xa=t,this.t("nodeCategoryProperty",i,t))}getCategoryForNodeData(t){if(t===null)return"";const i=this.Xa;if(i==="")return"";const e=Model.vt(t,i);if(e===void 0)return"";if(typeof e=="string")return e;Util.o("getCategoryForNodeData found a non-string category for "+t+": "+e)}setCategoryForNodeData(t,i){if(Util.i(i,"string",Model,"setCategoryForNodeData:cat"),t===null)return;const e=this.Xa;if(e==="")return;if(!this.containsNodeData(t)){Model.rt(t,e,i);return}let s=Model.vt(t,e);s===void 0&&(s=""),s!==i&&(Model.rt(t,e,i),this.Et("nodeCategory",2,e,t,s,i))}ag(t,i){this.setCategoryForNodeData(i,this.getCategoryForNodeData(t))}get type(){return"Model"}pc(){return!1}gc(){return!1}Hu(){return!1}Ta(){return!1}zw(){return!1}qc(){return!1}static initDiagramModel(){return new Model}static I1(t){return Model.classMap[t]?Model.classMap[t]:root.go!==void 0&&root.go[t]?root.go[t]:null}static registerClass(t,i){Model.classMap[i]=t}static classMap={};static vt(t,i){if(!t||!i)return null;let e;try{typeof i=="function"?e=i(t):typeof t.getAttribute=="function"?(e=t.getAttribute(i),e===null&&(e=void 0)):e=t[i]}catch{}return e}static rt(t,i,e){if(!(!t||!i))try{typeof i=="function"?i(t,e):typeof t.setAttribute=="function"?t.setAttribute(i,e):t[i]=e}catch{}}static{Model.registerClass(Brush,"Brush"),Model.registerClass(ChangedEvent,"ChangedEvent"),Model.registerClass(Geometry,"Geometry"),Model.registerClass(Margin,"Margin"),Model.registerClass(Panel,"Panel"),Model.registerClass(Point,"Point"),Model.registerClass(Rect,"Rect"),Model.registerClass(Size,"Size"),Model.registerClass(Spot,"Spot"),Model.registerClass(Transaction,"Transaction"),Model.registerClass(UndoManager,"UndoManager")}}Model.fromJSON=Model.fromJson=Model.fromJson;class GraphLinksModel extends Model{Ze;er;fi;Lh;vf;Of;Cl;wo;xo;Ya;Ga;ja;Zs;If;Tn;ug;constructor(t,i,e){if(super(),this.Ze=[],this.er=new GSet,this.fi=new GMap,this.Lh="",this.vf=null,this.Of=null,this.Cl=null,this.wo="from",this.xo="to",this.Ya="",this.Ga="",this.ja="category",this.Zs="",this.If="isGroup",this.Tn="group",this.ug=!1,i!==void 0&&(this.linkDataArray=i),t!==void 0&&(Array.isArray(t)?this.nodeDataArray=t:e=t),e){Object.assign(this,e);const s=e.Changed;s&&(delete this.Changed,this.addChangedListener(s))}}cloneProtected(t){super.cloneProtected(t),t.Lh=this.Lh,t.vf=this.vf,t.Of=this.Of,t.wo=this.wo,t.xo=this.xo,t.Ya=this.Ya,t.Ga=this.Ga,t.ja=this.ja,t.Zs=this.Zs,t.If=this.If,t.Tn=this.Tn,t.ug=this.ug}clear(){super.clear(),this.Ze=[],this.fi.clear(),this.er.clear()}toString(t){if(t===void 0&&(t=0),t>=2)return this.toJson();{let i=(this.name!==""?this.name:"")+" GraphLinksModel";if(t>0){i+=`
 node data:`;let e=this.nodeDataArray,s=e.length,n=0;for(n=0;n<s;n++){const o=e[n];i+=" "+this.getKeyForNodeData(o)+":"+Binding.toString(o)}for(i+=`
 link data:`,e=this.linkDataArray,s=e.length,n=0;n<s;n++){const o=e[n];i+=" "+this.Te(o,!0)+"-->"+this.Te(o,!1)}}return i}}bN(t,i){if(this.linkKeyProperty===""){const f=this.skipsUndoManager;this.skipsUndoManager=!0,this.linkKeyProperty="key",this.skipsUndoManager=f}let e=super.bN(t,i);const s=this,n=new GSet,o=new GSet,r=new GSet,l=this.Ka;t.changes.each(f=>{if(f.model===s){if(f.modelChange==="linkDataArray")f.change===3?n.add(f.newValue):f.change===4&&r.add(f.oldValue);else if(s.containsLinkData(f.object))o.add(f.object);else if(f.object!==null)if(f.object!==null&&l&&l.has(f.object))l.get(f.object).each(d=>{s.containsLinkData(d)&&o.add(d)});else{if(f.object instanceof Model||s.containsNodeData(f.object))return;s.VT(f.object).each(d=>o.add(d))}}});const h=this.rg;h.clear(),n.each(f=>{h.add(s.getKeyForLinkData(f)),i||o.add(f)});const a=this.og;a.clear(),r.each(f=>{a.add(s.getKeyForLinkData(f)),i&&o.add(f)});const c=s.cloneDeep(o.toArray());return h.count>0&&(e===null&&(e={}),i?e.removedLinkKeys=h.toArray():e.insertedLinkKeys=h.toArray()),c.length>0&&(e===null&&(e={}),e.modifiedLinkData=c),a.count>0&&(e===null&&(e={}),i?e.insertedLinkKeys=a.toArray():e.removedLinkKeys=a.toArray()),a.clear(),h.clear(),e}hg(){const t=super.hg();let i="";return this.linkCategoryProperty!=="category"&&typeof this.linkCategoryProperty=="string"&&(i+=`,
  "linkCategoryProperty": `+this.Fe(this.linkCategoryProperty)),this.linkKeyProperty!==""&&typeof this.linkKeyProperty=="string"&&(i+=`,
  "linkKeyProperty": `+this.Fe(this.linkKeyProperty)),this.linkFromKeyProperty!=="from"&&typeof this.linkFromKeyProperty=="string"&&(i+=`,
  "linkFromKeyProperty": `+this.Fe(this.linkFromKeyProperty)),this.linkToKeyProperty!=="to"&&typeof this.linkToKeyProperty=="string"&&(i+=`,
  "linkToKeyProperty": `+this.Fe(this.linkToKeyProperty)),this.linkFromPortIdProperty!==""&&typeof this.linkFromPortIdProperty=="string"&&(i+=`,
  "linkFromPortIdProperty": `+this.Fe(this.linkFromPortIdProperty)),this.linkToPortIdProperty!==""&&typeof this.linkToPortIdProperty=="string"&&(i+=`,
  "linkToPortIdProperty": `+this.Fe(this.linkToPortIdProperty)),this.linkLabelKeysProperty!==""&&typeof this.linkLabelKeysProperty=="string"&&(i+=`,
  "linkLabelKeysProperty": `+this.Fe(this.linkLabelKeysProperty)),this.nodeIsGroupProperty!=="isGroup"&&typeof this.nodeIsGroupProperty=="string"&&(i+=`,
  "nodeIsGroupProperty": `+this.Fe(this.nodeIsGroupProperty)),this.nodeGroupKeyProperty!=="group"&&typeof this.nodeGroupKeyProperty=="string"&&(i+=`,
  "nodeGroupKeyProperty": `+this.Fe(this.nodeGroupKeyProperty)),t+i}Ty(t){super.Ty(t),t.linkKeyProperty&&(this.linkKeyProperty=t.linkKeyProperty),t.linkFromKeyProperty&&(this.linkFromKeyProperty=t.linkFromKeyProperty),t.linkToKeyProperty&&(this.linkToKeyProperty=t.linkToKeyProperty),t.linkFromPortIdProperty&&(this.linkFromPortIdProperty=t.linkFromPortIdProperty),t.linkToPortIdProperty&&(this.linkToPortIdProperty=t.linkToPortIdProperty),t.linkCategoryProperty&&(this.linkCategoryProperty=t.linkCategoryProperty),t.linkLabelKeysProperty&&(this.linkLabelKeysProperty=t.linkLabelKeysProperty),t.nodeIsGroupProperty&&(this.nodeIsGroupProperty=t.nodeIsGroupProperty),t.nodeGroupKeyProperty&&(this.nodeGroupKeyProperty=t.nodeGroupKeyProperty)}kN(){const t=super.kN(),i=`,
  "linkDataArray": `+this.Ch(this.linkDataArray,!0);return t+i}PN(t){super.PN(t);const i=t.linkDataArray;Array.isArray(i)&&(this.replaceJsonObjects(i),this.linkDataArray=i)}zT=`,
  "insertedLinkKeys": `;FO=`,
  "modifiedLinkData": `;XT=`,
  "removedLinkKeys": `;VT(t){const i=new GSet;for(let e=0;e<this.linkDataArray.length;e++){const s=this.linkDataArray[e];this.O1(t,s,s,i)}return i}SN(t,i){if(this.linkKeyProperty===""){const f=this.skipsUndoManager;this.skipsUndoManager=!0,this.linkKeyProperty="key",this.skipsUndoManager=f}const e=super.SN(t,i),s=this,n=new GSet,o=new GSet,r=new GSet,l=this.Ka;t.changes.each(f=>{if(f.model===s){if(f.modelChange==="linkDataArray")f.change===3?n.add(f.newValue):f.change===4&&r.add(f.oldValue);else if(s.containsLinkData(f.object))o.add(f.object);else if(f.object!==null)if(f.object!==null&&l&&l.has(f.object))l.get(f.object).each(d=>{s.containsLinkData(d)&&o.add(d)});else{if(f.object instanceof Model||s.containsNodeData(f.object))return;s.VT(f.object).each(d=>o.add(d))}}});const h=this.rg;h.clear(),n.each(f=>{h.add(s.getKeyForLinkData(f)),i||o.add(f)});const a=this.og;a.clear(),r.each(f=>{a.add(s.getKeyForLinkData(f)),i&&o.add(f)});let c=e;return h.count>0&&(c+=(i?this.XT:this.zT)+this.Ch(h.toArray(),!0)),o.count>0&&(c+=this.FO+this.Ch(o.toArray(),!0)),a.count>0&&(c+=(i?this.zT:this.XT)+this.Ch(a.toArray(),!0)),a.clear(),h.clear(),c}Dy(t){(t.linkCategoryProperty!==void 0&&t.linkCategoryProperty!==this.linkCategoryProperty||t.linkKeyProperty!==void 0&&t.linkKeyProperty!==this.linkKeyProperty||t.linkFromKeyProperty!==void 0&&t.linkFromKeyProperty!==this.linkFromKeyProperty||t.linkToKeyProperty!==void 0&&t.linkToKeyProperty!==this.linkToKeyProperty||t.linkFromPortIdProperty!==void 0&&t.linkFromPortIdProperty!==this.linkFromPortIdProperty||t.linkToPortIdProperty!==void 0&&t.linkToPortIdProperty!==this.linkToPortIdProperty||t.linkLabelKeysProperty!==void 0&&t.linkLabelKeysProperty!==this.linkLabelKeysProperty||t.nodeIsGroupProperty!==void 0&&t.nodeIsGroupProperty!==this.nodeIsGroupProperty||t.nodeGroupKeyProperty!==void 0&&t.nodeGroupKeyProperty!==this.nodeGroupKeyProperty)&&Util.o("applyIncrementalJson cannot change Model properties"),super.Dy(t);const i=t.insertedLinkKeys;if(Array.isArray(i)){const n=i.length;for(let o=0;o<n;o++){const r=i[o];let l=this.findLinkDataForKey(r);l===null&&(l=this.copyLinkData({}),this.setKeyForLinkData(l,r),this.addLinkData(l))}}const e=t.modifiedLinkData;if(Array.isArray(e)){const n=e.length;for(let o=0;o<n;o++){const r=e[o],l=this.getKeyForLinkData(r),h=this.findLinkDataForKey(l);if(h!==null){for(const a in r)a==="__gohashid"||a===this.linkKeyProperty||this.setDataProperty(h,a,r[a]);this.KT(r,h)}}}const s=t.removedLinkKeys;if(Array.isArray(s)){const n=s.length;for(let o=0;o<n;o++){const r=s[o],l=this.findLinkDataForKey(r);l!==null&&this.removeLinkData(l)}}}changeState(t,i){if(!(t===null||t.model!==this)){if(t.change===2){const e=t.object,s=t.propertyName;if(s===this.linkKeyProperty&&this.containsLinkData(e)){const n=t.getValue(i),o=t.getValue(!i);o!==void 0&&this.fi.delete(o),n!==void 0&&this.fi.set(n,e),Model.rt(e,s,n);return}}else if(t.change===3){let e=t.newParam;if(t.modelChange==="linkDataArray"){const s=t.newValue;if(Util.wt(s)&&typeof e=="number"){const n=this.getKeyForLinkData(s);i?(this.er.delete(s),this.Ze[e]===s&&this.Ze.splice(e,1),n!==void 0&&this.fi.delete(n)):(this.er.add(s),this.Ze[e]!==s&&this.Ze.splice(e,0,s),n!==void 0&&this.fi.set(n,s))}return}else if(t.modelChange==="linkLabelKeys"){const s=this.getLabelKeysForLinkData(t.object);Array.isArray(s)&&typeof e=="number"&&(i?(e=s.indexOf(t.newValue),e>=0&&s.splice(e,1)):s.indexOf(t.newValue)<0&&s.splice(e,0,t.newValue));return}}else if(t.change===4){let e=t.oldParam;if(t.modelChange==="linkDataArray"){const s=t.oldValue;if(Util.wt(s)&&typeof e=="number"){const n=this.getKeyForLinkData(s);i?(this.er.add(s),this.Ze[e]!==s&&this.Ze.splice(e,0,s),n!==void 0&&this.fi.set(n,s)):(this.er.delete(s),this.Ze[e]===s&&this.Ze.splice(e,1),n!==void 0&&this.fi.delete(n))}return}else if(t.modelChange==="linkLabelKeys"){const s=this.getLabelKeysForLinkData(t.object);Array.isArray(s)&&typeof e=="number"&&(i?s.indexOf(t.newValue)<0&&s.splice(e,0,t.newValue):(e=s.indexOf(t.newValue),e>=0&&s.splice(e,1)));return}}super.changeState(t,i)}}get archetypeNodeData(){return this.Cl}set archetypeNodeData(t){const i=this.Cl;i!==t&&(t!==null&&Util.i(t,"object",GraphLinksModel,"archetypeNodeData"),this.Cl=t,this.t("archetypeNodeData",i,t))}CN(t){if(t===void 0)return;const i=this.Cl;if(i!==null){let e=this.findNodeDataForKey(t);e===null&&(e=this.copyNodeData(i),Model.rt(e,this.nodeKeyProperty,t),this.addNodeData(e))}return t}get linkFromKeyProperty(){return this.wo}set linkFromKeyProperty(t){const i=this.wo;i!==t&&(this.An(t,GraphLinksModel,"linkFromKeyProperty"),this.wo=t,this.t("linkFromKeyProperty",i,t))}getFromKeyForLinkData(t){return this.Te(t,!0)}setFromKeyForLinkData(t,i){this.Qd(t,i,!0)}get linkToKeyProperty(){return this.xo}set linkToKeyProperty(t){const i=this.xo;i!==t&&(this.An(t,GraphLinksModel,"linkToKeyProperty"),this.xo=t,this.t("linkToKeyProperty",i,t))}getToKeyForLinkData(t){return this.Te(t,!1)}setToKeyForLinkData(t,i){this.Qd(t,i,!1)}Te(t,i){if(t===null)return;const e=i?this.wo:this.xo;if(e==="")return;const s=Model.vt(t,e);if(s!==void 0){if(this.isKeyType(s))return s;Util.o((i?"FromKey":"ToKey")+" value for link data "+t+" is not a number or a string: "+s)}}Qd(t,i,e){if(i===null&&(i=void 0),i!==void 0&&!this.isKeyType(i)&&Util.we(i,"number or string",GraphLinksModel,e?"setFromKeyForLinkData:key":"setToKeyForLinkData:key"),t===null)return;const s=e?this.wo:this.xo;if(s==="")return;if(i=this.CN(i),!this.containsLinkData(t)){Model.rt(t,s,i);return}const n=Model.vt(t,s);n!==i&&(this.Js(n,t),Model.rt(t,s,i),this.findNodeDataForKey(i)===null&&this.$s(i,t),this.Et(e?"linkFromKey":"linkToKey",2,s,t,n,i),typeof s=="string"&&this.updateTargetBindings(t,s))}get linkFromPortIdProperty(){return this.Ya}set linkFromPortIdProperty(t){const i=this.Ya;i!==t&&(this.An(t,GraphLinksModel,"linkFromPortIdProperty"),this.Ya=t,this.t("linkFromPortIdProperty",i,t))}getFromPortIdForLinkData(t){return this.L1(t,!0)}setFromPortIdForLinkData(t,i){this._d(t,i,!0)}get linkToPortIdProperty(){return this.Ga}set linkToPortIdProperty(t){const i=this.Ga;i!==t&&(this.An(t,GraphLinksModel,"linkToPortIdProperty"),this.Ga=t,this.t("linkToPortIdProperty",i,t))}getToPortIdForLinkData(t){return this.L1(t,!1)}setToPortIdForLinkData(t,i){this._d(t,i,!1)}L1(t,i){if(t===null)return"";const e=i?this.Ya:this.Ga;if(e==="")return"";const s=Model.vt(t,e);return s===void 0?"":s}_d(t,i,e){if(Util.i(i,"string",GraphLinksModel,e?"setFromPortIdForLinkData:portname":"setToPortIdForLinkData:portname"),t===null)return;const s=e?this.Ya:this.Ga;if(s==="")return;if(!this.containsLinkData(t)){Model.rt(t,s,i);return}let n=Model.vt(t,s);n===void 0&&(n=""),n!==i&&(Model.rt(t,s,i),this.Et(e?"linkFromPortId":"linkToPortId",2,s,t,n,i),typeof s=="string"&&this.updateTargetBindings(t,s))}get linkLabelKeysProperty(){return this.Zs}set linkLabelKeysProperty(t){const i=this.Zs;i!==t&&(this.An(t,GraphLinksModel,"linkLabelKeysProperty"),this.Zs=t,this.t("linkLabelKeysProperty",i,t))}getLabelKeysForLinkData(t){if(t===null)return GraphLinksModel.EmptyArray;const i=this.Zs;if(i==="")return GraphLinksModel.EmptyArray;const e=Model.vt(t,i);return e===void 0?GraphLinksModel.EmptyArray:e}setLabelKeysForLinkData(t,i){if(t===null)return;const e=this.Zs;if(e==="")return;if(!this.containsLinkData(t)){Model.rt(t,e,i);return}let s=Model.vt(t,e);if(s===void 0&&(s=GraphLinksModel.EmptyArray),s!==i){if(Array.isArray(s)){const o=s.length;for(let r=0;r<o;r++){const l=s[r];this.Js(l,t)}}Model.rt(t,e,i);const n=i.length;for(let o=0;o<n;o++){const r=i[o];this.findNodeDataForKey(r)===null&&this.$s(r,t)}this.Et("linkLabelKeys",2,e,t,s,i),typeof e=="string"&&this.updateTargetBindings(t,e)}}addLabelKeyForLinkData(t,i){if(i==null||(this.isKeyType(i)||Util.we(i,"number or string",GraphLinksModel,"addLabelKeyForLinkData:key"),t===null))return;const e=this.Zs;if(e==="")return;const s=Model.vt(t,e);if(s===void 0){const n=[];n.push(i),this.setLabelKeysForLinkData(t,n)}else if(Array.isArray(s)){let n=s.indexOf(i);if(n>=0)return;n=s.length,s.push(i),this.containsLinkData(t)&&(this.findNodeDataForKey(i)===null&&this.$s(i,t),this.Et("linkLabelKeys",3,e,t,null,i,null,n))}else Util.o(e+" property is not an Array; cannot addLabelKeyForLinkData: "+t)}removeLabelKeyForLinkData(t,i){if(i==null||(this.isKeyType(i)||Util.we(i,"number or string",GraphLinksModel,"removeLabelKeyForLinkData:key"),t===null))return;const e=this.Zs;if(e==="")return;const s=Model.vt(t,e);if(Array.isArray(s)){const n=s.indexOf(i);if(n<0)return;s.splice(n,1),this.containsLinkData(t)&&(this.Js(i,t),this.Et("linkLabelKeys",4,e,t,i,null,n,null))}else s!==void 0&&Util.o(e+" property is not an Array; cannot removeLabelKeyforLinkData: "+t)}get linkDataArray(){return this.Ze}set linkDataArray(t){const i=this.Ze;if(i!==t){this.fi.clear();const e=t.length;for(let n=0;n<e;n++){const o=t[n];Util.wt(o)||Util.o("GraphLinksModel.linkDataArray must only contain Objects, not: "+o)}if(this.Ze=t,this.linkKeyProperty!==""){const n=new List;for(let r=0;r<e;r++){const l=t[r],h=this.getKeyForLinkData(l);h===void 0||this.fi.get(h)!==null?n.add(l):this.fi.set(h,l)}const o=n.iterator;for(;o.next();){const r=o.value;this.makeLinkDataKeyUnique(r);const l=this.getKeyForLinkData(r);l!==void 0&&this.fi.set(l,r)}}const s=new GSet;for(let n=0;n<e;n++){const o=t[n];s.add(o)}this.er=s,this.Et("linkDataArray",2,"linkDataArray",this,i,t);for(let n=0;n<e;n++){const o=t[n];this.LN(o)}}}get linkKeyProperty(){return this.Lh}set linkKeyProperty(t){const i=this.Lh;if(i!==t){this.An(t,GraphLinksModel,"linkKeyProperty"),this.Lh=t,this.fi.clear();const e=this.linkDataArray.length;for(let s=0;s<e;s++){const n=this.linkDataArray[s];let o=this.getKeyForLinkData(n);o===void 0&&(this.makeLinkDataKeyUnique(n),o=this.getKeyForLinkData(n)),o!==void 0&&this.fi.set(o,n)}this.t("linkKeyProperty",i,t)}}getKeyForLinkData(t){if(t===null)return;const i=this.Lh;if(i==="")return;const e=Model.vt(t,i);if(e!==void 0){if(this.isKeyType(e))return e;Util.o("Key value for link data "+t+" is not a number or a string: "+e)}}setKeyForLinkData(t,i){if((i==null||!this.isKeyType(i))&&Util.we(i,"number or string",GraphLinksModel,"setKeyForLinkData:key"),t===null)return;const e=this.Lh;if(e==="")return;if(!this.containsLinkData(t)){Model.rt(t,e,i);return}const s=Model.vt(t,e);if(s!==i){if(this.findLinkDataForKey(i)!==null)return;Model.rt(t,e,i),s!==void 0&&this.fi.delete(s),this.fi.set(i,t),this.Et("linkKey",2,e,t,s,i),typeof e=="string"&&this.updateTargetBindings(t,e)}}get makeUniqueLinkKeyFunction(){return this.vf}set makeUniqueLinkKeyFunction(t){const i=this.vf;i!==t&&(t!==null&&Util.i(t,"function",GraphLinksModel,"makeUniqueLinkKeyFunction"),this.vf=t,this.t("makeUniqueLinkKeyFunction",i,t))}findLinkDataForKey(t){return t===null&&Util.o("GraphLinksModel.findLinkDataForKey:key must not be null"),t===void 0||!this.isKeyType(t)?null:this.fi.get(t)}makeLinkDataKeyUnique(t){if(t===null)return;const i=this.Lh;if(i==="")return;let e=this.getKeyForLinkData(t);if(e!==void 0&&!this.fi.has(e))return;const s=this.vf;if(s!==null&&(e=s(this,t),e!=null&&!this.fi.has(e))){Model.rt(t,i,e);return}if(typeof e=="string"){let n=2;for(;this.fi.has(e+n);)n++;Model.rt(t,i,e+n)}else if(e===void 0||typeof e=="number"){let n=-this.fi.count-1;for(;this.fi.has(n);)n--;Model.rt(t,i,n)}}containsLinkData(t){return t===null?!1:this.er.has(t)}addLinkData(t){t!==null&&(this.containsLinkData(t)||this.AT(t,!0))}AT(t,i){if(this.linkKeyProperty!==""){let s=this.getKeyForLinkData(t);if(s===void 0)this.makeLinkDataKeyUnique(t),s=this.getKeyForLinkData(t);else{if(this.fi.get(s)===t)return;this.makeLinkDataKeyUnique(t),s=this.getKeyForLinkData(t)}s===void 0&&Util.o("GraphLinksModel.makeLinkDataKeyUnique failed on "+t+". Data not added to model."),this.fi.set(s,t)}this.er.add(t);let e=null;i&&(e=this.Ze.length,this.Ze.splice(e,0,t)),this.Et("linkDataArray",3,"linkDataArray",this,null,t,null,e),this.LN(t)}addLinkDataCollection(t){if(Array.isArray(t)){const i=t.length;for(let e=0;e<i;e++)this.addLinkData(t[e])}else{const i=t.iterator;for(;i.next();){const e=i.value;this.addLinkData(e)}}}removeLinkData(t){t!==null&&this.LT(t,!0)}LT(t,i){this.er.delete(t);const e=this.getKeyForLinkData(t);e!==void 0&&this.fi.delete(e);let s=null;if(i){if(s=this.Ze.indexOf(t),s<0)return;this.Ze.splice(s,1)}this.Et("linkDataArray",4,"linkDataArray",this,t,null,s,null),this.RO(t)}removeLinkDataCollection(t){if(Array.isArray(t)){const i=t.length;for(let e=0;e<i;e++)this.removeLinkData(t[e])}else{const i=t.iterator;for(;i.next();){const e=i.value;this.removeLinkData(e)}}}mergeLinkDataArray(t){if(this.linkKeyProperty===""&&Util.o("GraphLinksModel.linkKeyProperty must not be an empty string for .mergeLinkDataArray() to succeed."),t!==this.linkDataArray&&Array.isArray(t)){const i=this.og;i.clear(),i.addAll(this.fi.iteratorKeys);const e=this.rg;e.clear();const s=t.length;for(let o=0;o<s;o++){const r=t[o],l=this.getKeyForLinkData(r);if(l!==void 0){e.add(l);const h=this.findLinkDataForKey(l);if(h===r)continue;if(h!==null)this.assignAllDataProperties(h,r),this.KT(r,h);else{const a=this.cloneDeep(r);this.setKeyForLinkData(a,l),this.addLinkData(a)}}else{const h=this.cloneDeep(r);this.addLinkData(h),e.add(this.getKeyForLinkData(h))}}const n=i.iterator;for(;n.next();){const o=n.value;if(!e.has(o)){const r=this.findLinkDataForKey(o);r&&this.removeLinkData(r)}}i.clear(),e.clear()}}LN(t){let i=this.Te(t,!0);i=this.CN(i),this.findNodeDataForKey(i)===null&&this.$s(i,t),i=this.Te(t,!1),i=this.CN(i),this.findNodeDataForKey(i)===null&&this.$s(i,t);const e=this.getLabelKeysForLinkData(t);if(Array.isArray(e)){const s=e.length;for(let n=0;n<s;n++)i=e[n],this.findNodeDataForKey(i)===null&&this.$s(i,t)}}RO(t){let i=this.Te(t,!0);this.Js(i,t),i=this.Te(t,!1),this.Js(i,t);const e=this.getLabelKeysForLinkData(t);if(Array.isArray(e)){const s=e.length;for(let n=0;n<s;n++)i=e[n],this.Js(i,t)}}get copyLinkDataFunction(){return this.Of}set copyLinkDataFunction(t){const i=this.Of;i!==t&&(t!==null&&Util.i(t,"function",GraphLinksModel,"copyLinkDataFunction"),this.Of=t,this.t("copyLinkDataFunction",i,t))}copyLinkData(t){if(t===null)return null;let i=null;const e=this.Of;return e!==null?i=e(t,this):i=this.E1(t,!0),Util.wt(i)&&(this.wo!==""&&Model.rt(i,this.wo,void 0),this.xo!==""&&Model.rt(i,this.xo,void 0),this.Zs!==""&&Model.rt(i,this.Zs,[])),i}get nodeIsGroupProperty(){return this.If}set nodeIsGroupProperty(t){const i=this.If;i!==t&&(this.An(t,GraphLinksModel,"nodeIsGroupProperty"),this.If=t,this.t("nodeIsGroupProperty",i,t))}isGroupForNodeData(t){if(t===null)return!1;const i=this.If;return i===""?!1:!!Model.vt(t,i)}isGroupForData(t){return this.isGroupForNodeData(t)}get nodeGroupKeyProperty(){return this.Tn}set nodeGroupKeyProperty(t){const i=this.Tn;i!==t&&(this.An(t,GraphLinksModel,"nodeGroupKeyProperty"),this.Tn=t,this.t("nodeGroupKeyProperty",i,t))}get copiesGroupKeyOfNodeData(){return this.ug}set copiesGroupKeyOfNodeData(t){this.ug!==t&&(Util.i(t,"boolean",GraphLinksModel,"copiesGroupKeyOfNodeData"),this.ug=t)}getGroupKeyForNodeData(t){if(t===null)return;const i=this.Tn;if(i==="")return;const e=Model.vt(t,i);if(e!==void 0){if(this.isKeyType(e))return e;Util.o("GroupKey value for node data "+t+" is not a number or a string: "+e)}}getGroupForData(t){return this.getGroupKeyForNodeData(t)}setGroupKeyForNodeData(t,i){if(i===null&&(i=void 0),i!==void 0&&!this.isKeyType(i)&&Util.we(i,"number or string",GraphLinksModel,"setGroupKeyForNodeData:key"),t===null)return;const e=this.Tn;if(e==="")return;if(!this.containsNodeData(t)){Model.rt(t,e,i);return}const s=Model.vt(t,e);s!==i&&(this.Js(s,t),Model.rt(t,e,i),this.findNodeDataForKey(i)===null&&this.$s(i,t),this.Et("nodeGroupKey",2,e,t,s,i),typeof e=="string"&&this.updateTargetBindings(t,e))}setGroupForData(t,i){this.setGroupKeyForNodeData(t,i)}copyNodeData(t){if(t===null)return null;const i=super.copyNodeData(t);return!this.copiesGroupKeyOfNodeData&&this.Tn!==""&&Model.vt(i,this.Tn)!==void 0&&Model.rt(i,this.Tn,void 0),i}setDataProperty(t,i,e){if(this.containsNodeData(t)){if(i===this.nodeKeyProperty){this.setKeyForNodeData(t,e);return}else if(i===this.nodeCategoryProperty){this.setCategoryForNodeData(t,e);return}else if(i===this.nodeGroupKeyProperty){this.setGroupKeyForNodeData(t,e);return}}else if(this.containsLinkData(t)){if(i===this.linkFromKeyProperty){this.Qd(t,e,!0);return}else if(i===this.linkToKeyProperty){this.Qd(t,e,!1);return}else if(i===this.linkFromPortIdProperty){this._d(t,e,!0);return}else if(i===this.linkToPortIdProperty){this._d(t,e,!1);return}else if(i===this.linkKeyProperty){this.setKeyForLinkData(t,e);return}else if(i===this.linkCategoryProperty){this.setCategoryForLinkData(t,e);return}else if(i===this.linkLabelKeysProperty){this.setLabelKeysForLinkData(t,e);return}}const s=Model.vt(t,i);s!==e&&(Model.rt(t,i,e),this.raiseDataChanged(t,i,s,e))}assignAllDataProperties(t,i){if(!i)return;const e=this.containsNodeData(t),s=this.containsLinkData(t);for(const n in i)if(n!=="__gohashid"&&!(e&&n===this.nodeKeyProperty)){{if(e&&n===this.nodeIsGroupProperty&&Model.vt(t,n)===i[n])continue;if(s&&n===this.linkKeyProperty)continue}this.setDataProperty(t,n,i[n])}}Fy(t,i){super.Fy(t,i);const e=this.ii.iterator;for(;e.next();){const n=e.value;this.AN(n,t,i)}const s=this.er.iterator;for(;s.next();){const n=s.value;this.vO(n,t,i)}}AN(t,i,e){if(this.getGroupKeyForNodeData(t)===i){const n=this.Tn;Model.rt(t,n,e),this.Et("nodeGroupKey",2,n,t,i,e),typeof n=="string"&&this.updateTargetBindings(t,n)}}vO(t,i,e){if(this.Te(t,!0)===i){const r=this.wo;Model.rt(t,r,e),this.Et("linkFromKey",2,r,t,i,e),typeof r=="string"&&this.updateTargetBindings(t,r)}if(this.Te(t,!1)===i){const r=this.xo;Model.rt(t,r,e),this.Et("linkToKey",2,r,t,i,e),typeof r=="string"&&this.updateTargetBindings(t,r)}const o=this.getLabelKeysForLinkData(t);if(Array.isArray(o)){const r=o.length,l=this.Zs;for(let h=0;h<r;h++)o[h]===i&&(o[h]=e,this.Et("linkLabelKeys",3,l,t,i,e,h,h))}}NN(){super.NN();const t=this.linkDataArray,i=t.length;for(let e=0;e<i;e++){const s=t[e];this.LN(s)}}cg(t){super.cg(t);const i=this.getKeyForNodeData(t),e=this.Cy(i);if(e!==null){const s=Util.nt(),n=e.iterator;for(;n.next();){const o=n.value;if(this.containsNodeData(o)){if(this.getGroupKeyForNodeData(o)===i){const l=this.Tn;this.Et("nodeGroupKey",2,l,o,i,i),typeof l=="string"&&this.updateTargetBindings(o,l),s.push(o)}}else{if(this.Te(o,!0)===i){const a=this.wo;this.Et("linkFromKey",2,a,o,i,i),typeof a=="string"&&this.updateTargetBindings(o,a),s.push(o)}if(this.Te(o,!1)===i){const a=this.xo;this.Et("linkToKey",2,a,o,i,i),typeof a=="string"&&this.updateTargetBindings(o,a),s.push(o)}const h=this.getLabelKeysForLinkData(o);if(Array.isArray(h)){const a=h.length,c=this.Zs;for(let f=0;f<a;f++)h[f]===i&&(this.Et("linkLabelKeys",3,c,o,i,i,f,f),s.push(o))}}}for(let o=0;o<s.length;o++)this.Js(i,s[o]);Util.tt(s)}}fg(t){super.fg(t);const i=this.getGroupKeyForNodeData(t);this.findNodeDataForKey(i)===null&&this.$s(i,t)}Ry(t){super.Ry(t);const i=this.getGroupKeyForNodeData(t);this.Js(i,t)}get linkCategoryProperty(){return this.ja}set linkCategoryProperty(t){const i=this.ja;i!==t&&(this.An(t,GraphLinksModel,"linkCategoryProperty"),this.ja=t,this.t("linkCategoryProperty",i,t))}getCategoryForLinkData(t){if(t===null)return"";const i=this.ja;if(i==="")return"";const e=Model.vt(t,i);if(e===void 0)return"";if(typeof e=="string")return e;Util.o("getCategoryForLinkData found a non-string category for "+t+": "+e)}getLinkCategoryForData(t){return this.getCategoryForLinkData(t)}setCategoryForLinkData(t,i){if(Util.i(i,"string",GraphLinksModel,"setCategoryForLinkData:cat"),t===null)return;const e=this.ja;if(e==="")return;if(!this.containsLinkData(t)){Model.rt(t,e,i);return}let s=Model.vt(t,e);s===void 0&&(s=""),s!==i&&(Model.rt(t,e,i),this.Et("linkCategory",2,e,t,s,i),typeof e=="string"&&this.updateTargetBindings(t,e))}setLinkCategoryForData(t,i){this.setCategoryForLinkData(t,i)}ag(t,i){super.ag(t,i),this.setGroupKeyForNodeData(i,this.getGroupKeyForNodeData(t))}KT(t,i){this.setCategoryForLinkData(i,this.getCategoryForLinkData(t)),this.setFromKeyForLinkData(i,this.getFromKeyForLinkData(t)),this.setToKeyForLinkData(i,this.getToKeyForLinkData(t)),this.setLabelKeysForLinkData(i,this.getLabelKeysForLinkData(t)),this.setFromPortIdForLinkData(i,this.getFromPortIdForLinkData(t)),this.setToPortIdForLinkData(i,this.getToPortIdForLinkData(t))}get type(){return"GraphLinksModel"}gc(){return!0}Ta(){return!0}zw(){return!0}qc(){return!0}static EmptyArray=Object.freeze([])}Model.registerClass(GraphLinksModel,"GraphLinksModel");Model.constructGraphLinksModel=Model.constructGraphLinksModel=()=>new GraphLinksModel;Model.initDiagramModel=Model.initDiagramModel=()=>new GraphLinksModel;class TreeModel extends Model{Dn;dg;Ha;constructor(t,i){if(super(),this.Dn="parent",this.dg=!1,this.Ha="parentLinkCategory",t!==void 0&&(Array.isArray(t)?this.nodeDataArray=t:i=t),i){Object.assign(this,i);const e=i.Changed;e&&(delete this.Changed,this.addChangedListener(e))}}cloneProtected(t){super.cloneProtected(t),t.Dn=this.Dn,t.dg=this.dg,t.Ha=this.Ha}toString(t){if(t===void 0&&(t=0),t>=2)return this.toJson();{let i=(this.name!==""?this.name:"")+" TreeModel";if(t>0){i+=`
 node data:`;const e=this.nodeDataArray,s=e.length;for(let n=0;n<s;n++){const o=e[n];i+=" "+this.getKeyForNodeData(o)+":"+Binding.toString(o)}}return i}}hg(){const t=super.hg();let i="";return this.nodeParentKeyProperty!=="parent"&&typeof this.nodeParentKeyProperty=="string"&&(i+=`,
  "nodeParentKeyProperty": `+this.Fe(this.nodeParentKeyProperty)),t+i}Ty(t){super.Ty(t),t.nodeParentKeyProperty&&(this.nodeParentKeyProperty=t.nodeParentKeyProperty)}Dy(t){t.nodeParentKeyProperty!==void 0&&t.nodeParentKeyProperty!==this.nodeParentKeyProperty&&Util.o("applyIncrementalJson cannot change Model properties"),super.Dy(t)}maybeEnsureLinkReference(t){return t}get nodeParentKeyProperty(){return this.Dn}set nodeParentKeyProperty(t){const i=this.Dn;i!==t&&(this.An(t,TreeModel,"nodeParentKeyProperty"),this.Dn=t,this.t("nodeParentKeyProperty",i,t))}get copiesParentKeyOfNodeData(){return this.dg}set copiesParentKeyOfNodeData(t){this.dg!==t&&(Util.i(t,"boolean",TreeModel,"copiesParentKeyOfNodeData"),this.dg=t)}getParentKeyForNodeData(t){if(t===null)return;const i=this.Dn;if(i==="")return;const e=Model.vt(t,i);if(e!==void 0){if(this.isKeyType(e))return e;Util.o("ParentKey value for node data "+t+" is not a number or a string: "+e)}}setParentKeyForNodeData(t,i){if(i===null&&(i=void 0),i!==void 0&&!this.isKeyType(i)&&Util.we(i,"number or string",TreeModel,"setParentKeyForNodeData:key"),t===null)return;const e=this.Dn;if(e==="")return;if(i=this.maybeEnsureLinkReference(i),!this.containsNodeData(t)){Model.rt(t,e,i);return}const s=Model.vt(t,e);s!==i&&(this.Js(s,t),Model.rt(t,e,i),this.findNodeDataForKey(i)===null&&this.$s(i,t),this.Et("nodeParentKey",2,e,t,s,i),typeof e=="string"&&this.updateTargetBindings(t,e))}get parentLinkCategoryProperty(){return this.Ha}set parentLinkCategoryProperty(t){const i=this.Ha;i!==t&&(this.An(t,TreeModel,"parentLinkCategoryProperty"),this.Ha=t,this.t("parentLinkCategoryProperty",i,t))}get linkCategoryProperty(){return this.parentLinkCategoryProperty}set linkCategoryProperty(t){this.parentLinkCategoryProperty=t}getParentLinkCategoryForNodeData(t){if(t===null)return"";const i=this.Ha;if(i==="")return"";const e=Model.vt(t,i);if(e===void 0)return"";if(typeof e=="string")return e;Util.o("getParentLinkCategoryForNodeData found a non-string category for "+t+": "+e)}getLinkCategoryForData(t){return this.getParentLinkCategoryForNodeData(t)}setParentLinkCategoryForNodeData(t,i){if(Util.i(i,"string",TreeModel,"setParentLinkCategoryForNodeData:cat"),t===null)return;const e=this.Ha;if(e==="")return;if(!this.containsNodeData(t)){Model.rt(t,e,i);return}let s=Model.vt(t,e);s===void 0&&(s=""),s!==i&&(Model.rt(t,e,i),this.Et("parentLinkCategory",2,e,t,s,i),typeof e=="string"&&this.updateTargetBindings(t,e))}setLinkCategoryForData(t,i){this.setParentLinkCategoryForNodeData(t,i)}copyNodeData(t){if(t===null)return null;const i=super.copyNodeData(t);return!this.copiesParentKeyOfNodeData&&this.Dn!==""&&Model.vt(i,this.Dn)!==void 0&&Model.rt(i,this.Dn,void 0),i}setDataProperty(t,i,e){if(this.containsNodeData(t)){if(i===this.nodeKeyProperty){this.setKeyForNodeData(t,e);return}else if(i===this.nodeCategoryProperty){this.setCategoryForNodeData(t,e);return}else if(i===this.nodeParentKeyProperty){this.setParentKeyForNodeData(t,e);return}else if(i===this.parentLinkCategoryProperty){this.setParentLinkCategoryForNodeData(t,e);return}}const s=Model.vt(t,i);s!==e&&(Model.rt(t,i,e),this.raiseDataChanged(t,i,s,e))}Fy(t,i){super.Fy(t,i);const e=this.ii.iterator;for(;e.next();){const s=e.value;this.AN(s,t,i)}}AN(t,i,e){if(this.getParentKeyForNodeData(t)===i){const n=this.Dn;Model.rt(t,n,e),this.Et("nodeParentKey",2,n,t,i,e),typeof n=="string"&&this.updateTargetBindings(t,n)}}cg(t){super.cg(t);const i=this.getKeyForNodeData(t),e=this.Cy(i);if(e!==null){const s=Util.nt(),n=e.iterator;for(;n.next();){const o=n.value;if(this.containsNodeData(o)&&this.getParentKeyForNodeData(o)===i){const l=this.Dn;this.Et("nodeParentKey",2,l,o,i,i),typeof l=="string"&&this.updateTargetBindings(o,l),s.push(o)}}for(let o=0;o<s.length;o++)this.Js(i,s[o]);Util.tt(s)}}fg(t){super.fg(t);let i=this.getParentKeyForNodeData(t);i=this.maybeEnsureLinkReference(i),this.findNodeDataForKey(i)===null&&this.$s(i,t)}Ry(t){super.Ry(t);const i=this.getParentKeyForNodeData(t);this.Js(i,t)}ag(t,i){super.ag(t,i),this.setParentLinkCategoryForNodeData(i,this.getParentLinkCategoryForNodeData(t)),this.setParentKeyForNodeData(i,this.getParentKeyForNodeData(t))}get type(){return"TreeModel"}pc(){return!0}zw(){return!0}}Model.registerClass(TreeModel,"TreeModel");var CircularArrangement=(w=>(w[w.ConstantSpacing=0]="ConstantSpacing",w[w.ConstantDistance=1]="ConstantDistance",w[w.ConstantAngle=2]="ConstantAngle",w[w.Packed=3]="Packed",w))(CircularArrangement||{}),CircularDirection=(w=>(w[w.Clockwise=10]="Clockwise",w[w.Counterclockwise=11]="Counterclockwise",w[w.BidirectionalLeft=12]="BidirectionalLeft",w[w.BidirectionalRight=13]="BidirectionalRight",w))(CircularDirection||{}),CircularSorting=(w=>(w[w.Forwards=20]="Forwards",w[w.Reverse=21]="Reverse",w[w.Ascending=22]="Ascending",w[w.Descending=23]="Descending",w[w.Optimized=24]="Optimized",w))(CircularSorting||{}),CircularNodeDiameterFormula=(w=>(w[w.Pythagorean=30]="Pythagorean",w[w.Circular=31]="Circular",w))(CircularNodeDiameterFormula||{});class CircularLayout extends Layout{le;Ef;B1;gg;U1;Ah;TN;DN;FN;bs;vy;Oy;qa;Iy;YT;mg;pg;yg;Bf;Ki;S;pe;ye;Ln;wg;constructor(t){super(),this.le=0,this.Ef=0,this.B1=0,this.gg=360,this.U1=0,this.Ah=0,this.TN=new Point,this.DN=30,this.FN=0,this.bs=0,this.vy=0,this.Oy=new VertexArrangement,this.qa=0,this.Iy=0,this.YT=600,this.mg=NaN,this.pg=1,this.yg=0,this.Bf=360,this.Ki=0,this.S=10,this.pe=24,this.ye=LayoutVertex.standardComparer,this.Ln=6,this.wg=30,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.mg=this.mg,t.pg=this.pg,t.yg=this.yg,t.Bf=this.Bf,t.Ki=this.Ki,t.S=this.S,t.pe=this.pe,t.ye=this.ye,t.Ln=this.Ln,t.wg=this.wg}li(t){t in CircularSorting?this.sorting=t:t in CircularDirection?this.direction=t:t in CircularArrangement?this.arrangement=t:t in CircularNodeDiameterFormula?this.nodeDiameterFormula=t:super.li(t)}createNetwork(){return new CircularNetwork(this)}OO(t,i,e){t=this.IO(t);let s=this.U1,n=this.DN,o=this.le,r=this.Ef,l=this.B1,h=this.gg,a=this.Ah,c=this.FN,f=this.bs,u=this.vy;if(s=this.arrangement,n=this.nodeDiameterFormula,o=this.radius,(!isFinite(o)||o<=0)&&(o=NaN),r=this.aspectRatio,(!isFinite(r)||r<=0)&&(r=1),l=this.startAngle,isFinite(l)||(l=0),h=this.sweepAngle,(!isFinite(h)||h>360||h<1)&&(h=360),a=this.spacing,isFinite(a)||(a=NaN),s===3&&n===31?s=0:s===3&&n!==31&&(n=31,s=this.arrangement),(this.direction===12||this.direction===13)&&this.sorting!==24){for(let g=0;!(g>=t.length||(i.add(t.elt(g)),g+1>=t.length));g+=2)e.add(t.elt(g+1));this.direction===12?(this.arrangement===3&&i.reverse(),t=new List,t.addAll(i),t.addAll(e)):(this.arrangement===3&&e.reverse(),t=new List,t.addAll(e),t.addAll(i))}const d=t.length;c=0;let m=0;for(let g=0;g<t.length;g++){const p=l+h*m*(this.direction===10?1:-1)/d;let y=t.elt(g).diameter;isNaN(y)&&(y=t.elt(g).Th(p)),h<360&&(g===0||g===t.length-1)&&(y/=2),c+=y,m++}if(isNaN(o)||s===3){if(isNaN(a)&&(a=6),s!==0&&s!==3){let g=-1/0;for(let p=0;p<d;p++){const y=t.elt(p),x=t.elt(p===d-1?0:p+1);isNaN(y.diameter)&&y.Th(0),isNaN(x.diameter)&&x.Th(0),g=Math.max(g,(y.diameter+x.diameter)/2)}if(u=g+a,s===2){const p=2*Math.PI/d,y=(g+a)/p;r>1?(o=y,f=o*r):(f=y,o=f)}else o=this.V1(u*(h>=360?d:d-1),r,l*Math.PI/180,h*Math.PI/180)}else o=this.V1(c+(h>=360?d:d-1)*(s!==3?a:a*1.6),r,l*Math.PI/180,h*Math.PI/180);f=o*r}else{f=o*r;const g=this.RN(o,f,l*Math.PI/180,h*Math.PI/180);if(isNaN(a))s===0&&(a=(g-c)/(h>=360?d:d-1));else if(s===0){const p=(g-c)/(h>=360?d:d-1);p<a?(o=this.V1(c+a*(h>=360?d:d-1),r,l*Math.PI/180,h*Math.PI/180),f=o*r):a=p}else{let p=-1/0;for(let k=0;k<d;k++){const b=t.elt(k),P=t.elt(k===d-1?0:k+1);isNaN(b.diameter)&&b.Th(0),isNaN(P.diameter)&&P.Th(0),p=Math.max(p,(b.diameter+P.diameter)/2)}const y=p+a,x=this.V1(y*(h>=360?d:d-1),r,l*Math.PI/180,h*Math.PI/180);x>o?(o=x,f=o*r,u=y):u=g/(h>=360?d:d-1)}}return this.U1=s,this.DN=n,this.le=o,this.Ef=r,this.B1=l,this.gg=h,this.Ah=a,this.FN=c,this.bs=f,this.vy=u,t}doLayout(t){this.network===null&&(this.network=this.makeNetwork(t)),this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin);const i=this.network.vertexes;if(i.count<=1){if(i.count===1){const u=i.first();u.centerX=0,u.centerY=0}this.updateParts(),this.network=null,this.isValidLayout=!0;return}let e=new List;e.addAll(i.iterator);const s=new List,n=new List;e=this.OO(e,s,n);const o=this.U1,r=this.le,l=this.B1,h=this.gg,a=this.Ah,c=this.bs,f=this.vy;if((this.direction===12||this.direction===13)&&o===3)this.GT(e,h,l-h/2,10);else if(this.direction===12||this.direction===13){let u=0;switch(o){case 1:u=this.z1(r,c,l,f)*180/Math.PI;break;case 0:{let d=0,m=0;const g=s.first();g!==null&&(d=g.Th(Math.PI/2));const p=n.first();p!==null&&(m=p.Th(Math.PI/2)),u=this.z1(r,c,l,a+(d+m)/2)*180/Math.PI;break}case 2:u=h/e.length;break}if(this.direction===12){switch(o){case 1:this.Ey(s,h/2,l,11);break;case 0:this.By(s,h/2,l,11);break;case 2:this.Uy(s,h/2,l,11);break}switch(o){case 1:this.Ey(n,h/2,l+u,10);break;case 0:this.By(n,h/2,l+u,10);break;case 2:this.Uy(n,h/2,l+u,10);break}}else{switch(o){case 1:this.Ey(n,h/2,l,11);break;case 0:this.By(n,h/2,l,11);break;case 2:this.Uy(n,h/2,l,11);break}switch(o){case 1:this.Ey(s,h/2,l+u,10);break;case 0:this.By(s,h/2,l+u,10);break;case 2:this.Uy(s,h/2,l+u,10);break}}}else switch(o){case 1:this.Ey(e,h,l,this.direction);break;case 0:this.By(e,h,l,this.direction);break;case 2:this.Uy(e,h,l,this.direction);break;case 3:this.GT(e,h,l,this.direction);break}this.updateParts(),this.network=null,this.isValidLayout=!0}Uy(t,i,e,s){const n=this.gg,o=this.le,r=this.bs,l=e*Math.PI/180,h=i*Math.PI/180,a=t.length;for(let c=0;c<a;c++){const f=l+(s===10?c*h/(n>=360?a:a-1):-(c*h)/a),u=t.elt(c),d=o*Math.tan(f)/r,m=Math.sqrt((o*o+r*r*d*d)/(1+d*d));u.centerX=m*Math.cos(f),u.centerY=m*Math.sin(f),u.actualAngle=f*180/Math.PI}}By(t,i,e,s){const n=this.le,o=this.bs,r=this.Ah;let l=e*Math.PI/180;const h=t.length;for(let a=0;a<h;a++){const c=t.elt(a),f=t.elt(a===h-1?0:a+1),u=n*Math.cos(l),d=o*Math.sin(l);c.centerX=u,c.centerY=d,c.actualAngle=l*180/Math.PI,isNaN(c.diameter)&&c.Th(0),isNaN(f.diameter)&&f.Th(0);const m=(c.diameter+f.diameter)/2,g=this.z1(n,o,s===10?l:-l,m+r);l+=s===10?g:-g}}Ey(t,i,e,s){const n=this.le,o=this.bs,r=this.vy;let l=e*Math.PI/180;const h=t.length;for(let a=0;a<h;a++){const c=t.elt(a);c.centerX=n*Math.cos(l),c.centerY=o*Math.sin(l),c.actualAngle=l*180/Math.PI;const f=this.z1(n,o,s===10?l:-l,r);l+=s===10?f:-f}}GT(t,i,e,s){let n=this.Iy;const o=this.gg;if(this.qa=0,this.Oy=new VertexArrangement,i<360){for(n=e+(s===10?o:-o);n<0;)n+=360;n%=360,n>180&&(n-=360),n*=Math.PI/180,this.Iy=n,this.jT(t,i,e,s)}else this.HT(t,i,e,s);this.Oy.commit(t)}HT(t,i,e,s){const n=this.le,o=this.bs,r=this.Ah,l=this.Ef;let h=n*Math.cos(e*Math.PI/180),a=o*Math.sin(e*Math.PI/180);const c=t.toArray();if(c.length===3){c[0].centerX=n,c[0].centerY=0,c[1].centerX=c[0].centerX-c[0].width/2-c[1].width/2-r,c[1].y=c[0].y,c[2].centerX=(c[0].centerX+c[1].centerX)/2,c[2].y=c[0].y-c[2].height-r;return}else if(c.length===4){c[0].centerX=n,c[0].centerY=0,c[2].centerX=-c[0].centerX,c[2].centerY=c[0].centerY,c[1].centerX=0,c[1].y=Math.min(c[0].y,c[2].y)-c[1].height-r,c[3].centerX=0,c[3].y=Math.max(c[0].y+c[0].height+r,c[2].y+c[2].height+r);return}const f=Point.l();for(let b=0;b<c.length&&(c[b].centerX=h,c[b].centerY=a,!(b>=c.length-1));b++)this.qT(h,a,c,b,s,f)||this.WT(h,a,c,b,s,f),h=f.x,a=f.y;if(Point.s(f),this.qa++,this.qa>23)return;const u=c[0].centerX,d=c[0].centerY,m=c[c.length-1].centerX,g=c[c.length-1].centerY;let p=Math.abs(u-m)-((c[0].width+c[c.length-1].width)/2+r);const y=Math.abs(d-g)-((c[0].height+c[c.length-1].height)/2+r);let x=0;if(Math.abs(y)<1){const b=Math.abs(u-m),P=(c[0].width+c[c.length-1].width)/2;b<P&&(x=0),p=b-P}else y>0?x=y:Math.abs(p)<1?x=0:x=p;let k=!1;Math.abs(m)>Math.abs(g)?k=m>0!=d>g:k=g>0!=u<m,k=s===10?k:!k,k&&(x=-Math.abs(x),x=Math.min(x,-c[c.length-1].width),x=Math.min(x,-c[c.length-1].height)),this.Oy.EO(x,c),Math.abs(x)>1&&(this.qa<8?this.le-=x/(2*Math.PI):c.length<5&&x>10?this.le/=2:this.le-=x>0?1.7:-2.3,this.bs=this.le*l,this.HT(t,i,e,s))}jT(t,i,e,s){const n=this.le,o=this.bs,r=this.Ef;let l=n*Math.cos(e*Math.PI/180),h=o*Math.sin(e*Math.PI/180);const a=Point.l(),c=t.toArray();for(let m=0;m<c.length&&(c[m].centerX=l,c[m].centerY=h,!(m>=c.length-1));m++)this.qT(l,h,c,m,s,a)||this.WT(l,h,c,m,s,a),l=a.x,h=a.y;if(Point.s(a),this.qa++,this.qa>23)return;const f=Math.atan2(h,l);let u=s===10?this.Iy-f:f-this.Iy;u=Math.abs(u)<Math.abs(u-2*Math.PI)?u:u-2*Math.PI;const d=u*(n+o)/2;this.Oy.BO(d,c),Math.abs(d)>1&&(this.qa<8?this.le-=d/(2*Math.PI):this.le-=d>0?1.7:-2.3,this.bs=this.le*r,this.jT(t,i,e,s))}qT(t,i,e,s,n,o){const r=this.Ah,l=this.le,h=this.bs;let a=0,c=0;const f=(e[s].width+e[s+1].width)/2+r;let u=!1;if(i>=0!=(n===10)){if(a=t+f,a>l){if(a=t-f,a<-l)return o.x=a,o.y=c,!1;u=!0}}else if(a=t-f,a<-l){if(a=t+f,a>l)return o.x=a,o.y=c,!1;u=!0}return c=Math.sqrt(1-Math.min(1,a*a/(l*l)))*h,i<0!==u&&(c=-c),Math.abs(i-c)>(e[s].height+e[s+1].height)/2?(o.x=a,o.y=c,!1):(o.x=a,o.y=c,!0)}WT(t,i,e,s,n,o){const r=this.Ah,l=this.le,h=this.bs;let a=0,c=0;const f=(e[s].height+e[s+1].height)/2+r;let u=!1;if(t>=0!=(n===10)){if(c=i-f,c<-h){if(c=i+f,c>h)return o.x=a,o.y=c,!1;u=!0}}else if(c=i+f,c>h){if(c=i-f,c<-h)return o.x=a,o.y=c,!1;u=!0}return a=Math.sqrt(1-Math.min(1,c*c/(h*h)))*l,t<0!==u&&(a=-a),Math.abs(t-a)>(e[s].width+e[s+1].width)/2?(o.x=a,o.y=c,!1):(o.x=a,o.y=c,!0)}commitLayout(){this.commitNodes(),this.isRouting&&this.commitLinks()}commitNodes(){const t=this.group!==null&&this.group.hasPlaceholder(),i=t?this.group.location.copy():null;let e=this.actualCenter;t?e=new Point(0,0):(e.x=this.arrangementOrigin.x+this.le,e.y=this.arrangementOrigin.y+this.bs);const s=this.network.vertexes.iterator;for(;s.next();){const n=s.value;n.x+=e.x,n.y+=e.y,n.commit()}if(t){this.group.ensureBounds();const n=this.group.position.copy(),o=this.group.location.copy(),r=i.subtract(o.subtract(n));this.group.move(r),this.TN=r.subtract(n)}}commitLinks(){const t=this.network.edges.iterator;for(;t.next();)t.value.commit()}RN(t,i,e,s){const n=this.YT;if(Math.abs(this.Ef-1)<.001)return e!==void 0&&s!==void 0?s*t:2*Math.PI*t;const o=t>i?Math.sqrt(t*t-i*i)/t:Math.sqrt(i*i-t*t)/i;let r=0,l=0;e!==void 0&&s!==void 0?l=s/(n+1):l=Math.PI/(2*(n+1));let h=0;for(let a=0;a<=n;a++){e!==void 0&&s!==void 0?h=e+a*s/n:h=a*Math.PI/(2*n);const c=Math.sin(h);r+=Math.sqrt(1-o*o*c*c)*l}return e!==void 0&&s!==void 0?(t>i?t:i)*r:4*(t>i?t:i)*r}V1(t,i,e,s){let n=0;return e!==void 0&&s!==void 0?n=this.RN(1,i,e,s):n=this.RN(1,i),t/n}z1(t,i,e,s){if(Math.abs(this.Ef-1)<.001)return s/t;const n=t>i?Math.sqrt(t*t-i*i)/t:Math.sqrt(i*i-t*t)/i;let o=0;const r=2*Math.PI/(this.network.vertexes.count*700);t>i&&(e+=Math.PI/2);for(let l=0;;l++){const h=e+l*r,a=Math.sin(h);if(o+=(t>i?t:i)*Math.sqrt(1-n*n*a*a)*r,o>=s)return l*r}}IO(t){switch(this.sorting){case 20:break;case 21:t.reverse();break;case 22:t.sort(this.comparer);break;case 23:t.sort(this.comparer),t.reverse();break;case 24:return this.UO(this.VO(t));default:Util.o("Invalid sorting type.")}return t}VO(t){const i=[];for(let s=0;s<t.length;s++)i.push(0);const e=new List;for(let s=0;s<t.length;s++){let n=-1,o=-1;if(s===0)for(let c=0;c<t.length;c++){const u=t.elt(c).edgesCount;u>n&&(n=u,o=c)}else for(let c=0;c<t.length;c++){const f=i[c];f>n&&(n=f,o=c)}e.add(t.elt(o)),i[o]=-1;const r=t.elt(o);let l=0;const h=r.sourceEdges;for(;h.next();){const f=h.value.fromVertex;l=t.indexOf(f),!(l<0)&&i[l]>=0&&i[l]++}const a=r.destinationEdges;for(;a.next();){const f=a.value.toVertex;l=t.indexOf(f),!(l<0)&&i[l]>=0&&i[l]++}}return e}UO(t){const i=[];for(let f=0;f<t.length;f++){const u=t.elt(f);i[f]=[];let d=0;const m=u.destinationEdges;for(;m.next();){const p=m.value.toVertex;d=t.indexOf(p),d!==f&&i[f].indexOf(d)<0&&i[f].push(d)}const g=u.sourceEdges;for(;g.next();){const p=g.value.fromVertex;d=t.indexOf(p),d!==f&&i[f].indexOf(d)<0&&i[f].push(d)}}const e=[];for(let f=0;f<i.length;f++)e[f]=0;const s=[],n=[],o=[],r=[],l=new List;let h=0;for(let f=0;f<i.length;f++){const u=i[f].length;if(u===1){r.push(f);continue}if(u===0){l.add(t.elt(f));continue}if(h===0){s.push(f),h++;continue}let d=1/0,m=1/0,g=-1;const p=[];for(let y=0;y<s.length;y++)i[s[y]].indexOf(s[y===s.length-1?0:y+1])<0&&p.push(y===s.length-1?0:y+1);if(p.length===0)for(let y=0;y<s.length;y++)p.push(y);for(let y=0;y<p.length;y++){const x=p[y],k=this.zO(i[f],n,o,e,x,s);let b=0;for(let P=0;P<i[f].length;P++){const M=i[f][P],L=s.indexOf(M);if(L>=0){const C=Math.abs(x-(L>=x?L+1:L));b+=C<s.length+1-C?C:s.length+1-C}}for(let P=0;P<n.length;P++){let M=e[n[P]],L=e[o[P]];if(M>=x&&M++,L>=x&&L++,M>L){const C=L;L=M,M=C}L-M<(s.length+2)/2==(M<x&&x<=L)&&b++}(k<d||k===d&&b<m)&&(d=k,m=b,g=x)}s.splice(g,0,f);for(let y=0;y<s.length;y++)e[s[y]]=y;for(let y=0;y<i[f].length;y++){const x=i[f][y];s.indexOf(x)>=0&&(n.push(f),o.push(x))}h++}let a=!1;const c=s.length;for(;;){a=!0;for(let f=0;f<r.length;f++){const u=r[f],d=i[u][0],m=s.indexOf(d);if(m>=0){let g=0;for(let p=0;p<i[d].length;p++){const y=i[d][p],x=s.indexOf(y);if(x<0||x===m)continue;const k=x>m?x-m:m-x,b=c-k;g+=x<m!=k>b?1:-1}s.splice(g<0?m:m+1,0,u),r.splice(f,1),f--}else a=!1}if(a)break;s.push(r[0]),r.splice(0,1)}for(let f=0;f<s.length;f++){const u=s[f];l.add(t.elt(u))}return l}zO(t,i,e,s,n,o){let r=0;for(let l=0;l<i.length;l++){const h=i[l],a=e[l],c=s[h],f=s[a];let u=0,d=0;if(c<f?(u=c,d=f):(u=f,d=c),u<n&&n<=d)for(let m=0;m<t.length;m++){const g=t[m];o.indexOf(g)<0||u<s[g]&&s[g]<d||u===s[g]||d===s[g]||r++}else for(let m=0;m<t.length;m++){const g=t[m];o.indexOf(g)<0||!(u<s[g]&&s[g]<d)||u===s[g]||d===s[g]||r++}}return r}get radius(){return this.mg}set radius(t){this.mg!==t&&(Util.i(t,"number",CircularLayout,"radius"),(t>0||isNaN(t))&&(this.mg=t,this.invalidateLayout()))}get aspectRatio(){return this.pg}set aspectRatio(t){this.pg!==t&&(Util.i(t,"number",CircularLayout,"aspectRatio"),t>0&&(this.pg=t,this.invalidateLayout()))}get startAngle(){return this.yg}set startAngle(t){this.yg!==t&&(Util.i(t,"number",CircularLayout,"startAngle"),this.yg=t,this.invalidateLayout())}get sweepAngle(){return this.Bf}set sweepAngle(t){this.Bf!==t&&(Util.i(t,"number",CircularLayout,"sweepAngle"),t>0&&t<=360?this.Bf=t:this.Bf=360,this.invalidateLayout())}get arrangement(){return this.Ki}set arrangement(t){this.Ki!==t&&(t===3||t===0||t===1||t===2)&&(this.Ki=t,this.invalidateLayout())}get direction(){return this.S}set direction(t){this.S!==t&&(t===10||t===11||t===12||t===13)&&(this.S=t,this.invalidateLayout())}get sorting(){return this.pe}set sorting(t){this.pe!==t&&(this.pe=t,this.invalidateLayout())}get comparer(){return this.ye}set comparer(t){this.ye!==t&&(Util.i(t,"function",CircularLayout,"comparer"),this.ye=t,this.invalidateLayout())}get spacing(){return this.Ln}set spacing(t){this.Ln!==t&&(Util.i(t,"number",CircularLayout,"spacing"),this.Ln=t,this.invalidateLayout())}get nodeDiameterFormula(){return this.wg}set nodeDiameterFormula(t){this.wg!==t&&(t===30||t===31)&&(this.wg=t,this.invalidateLayout())}get actualXRadius(){return this.le}get actualYRadius(){return this.bs}get actualSpacing(){return this.Ah}get actualCenter(){return this.TN}static ConstantSpacing=0;static ConstantDistance=1;static ConstantAngle=2;static Packed=3;static Clockwise=10;static Counterclockwise=11;static BidirectionalLeft=12;static BidirectionalRight=13;static Forwards=20;static Reverse=21;static Ascending=22;static Descending=23;static Optimized=24;static Pythagorean=30;static Circular=31}class VertexArrangement{Uf;Wa;Vf;constructor(){this.Uf=-1/0,this.Wa=null,this.Vf=null}EO(t,i){if(t>0&&this.Uf<0||Math.abs(t)<Math.abs(this.Uf)&&!(t<0&&this.Uf>0)){this.Uf=t,this.Wa=[],this.Vf=[];for(let e=0;e<i.length;e++)this.Wa[e]=i[e].bounds.x,this.Vf[e]=i[e].bounds.y}}BO(t,i){if(Math.abs(t)<Math.abs(this.Uf)){this.Uf=t,this.Wa=[],this.Vf=[];for(let e=0;e<i.length;e++)this.Wa[e]=i[e].bounds.x,this.Vf[e]=i[e].bounds.y}}commit(t){if(!(this.Wa===null||this.Vf===null))for(let i=0;i<this.Wa.length;i++){const e=t.elt(i);e.x=this.Wa[i],e.y=this.Vf[i]}}}class CircularNetwork extends LayoutNetwork{constructor(t){super(t)}createVertex(){return new CircularVertex(this)}createEdge(){return new CircularEdge(this)}}class CircularVertex extends LayoutVertex{bo;X1;constructor(t){super(t),this.bo=NaN,this.X1=NaN}Th(t){const i=this.network;if(i===null)return NaN;const e=i.layout;if(e===null)return NaN;if(e.arrangement===3){if(e.nodeDiameterFormula===31)return this.bo=Math.max(this.width,this.height),this.bo;{const s=Math.abs(Math.sin(t)),n=Math.abs(Math.cos(t));return s===0?this.width:n===0?this.height:(this.bo=Math.min(this.height/s,this.width/n),this.bo)}}else return e.nodeDiameterFormula===31?(this.bo=Math.max(this.width,this.height),this.bo):(this.bo=Math.sqrt(this.width*this.width+this.height*this.height),this.bo)}get diameter(){return this.bo}set diameter(t){this.bo!==t&&(Util.i(t,"number",CircularVertex,"diameter"),this.bo=t)}get actualAngle(){return this.X1}set actualAngle(t){this.X1!==t&&(Util.i(t,"number",CircularVertex,"actualAngle"),this.X1=t)}}class CircularEdge extends LayoutEdge{constructor(t){super(t)}}class ForceDirectedLayout extends Layout{Vy;Dh;ks;xg;Fn;Re;bg;kg;Pg;zf;Mg;Sg;Xf;Kf;Yf;Gf;Ng;Cg;jf;Ja;constructor(t){super(),this.Vy=0,this.Dh=0,this.ks=new Size(100,100).g(),this.xg=!1,this.Fn=!0,this.Re=!1,this.bg=100,this.kg=300,this.Pg=1,this.zf=1e3,this.Mg=10,this.Sg=Math,this.Xf=.05,this.Kf=50,this.Yf=150,this.Gf=0,this.Ng=10,this.Cg=5,this.jf=NaN,this.Ja=10,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.ks.a(this.ks),t.xg=this.xg,t.Fn=this.Fn,t.Re=this.Re,t.bg=this.bg,t.kg=this.kg,t.Pg=this.Pg,t.zf=this.zf,t.Mg=this.Mg,t.Sg=this.Sg,t.Xf=this.Xf,t.Kf=this.Kf,t.Yf=this.Yf,t.Gf=this.Gf,t.Ng=this.Ng,t.Cg=this.Cg,t.jf=this.jf,t.Ja=this.Ja}createNetwork(){return new ForceDirectedNetwork(this)}doLayout(t){this.network=this.makeNetwork(t);let i=this.network.vertexes.iterator;const e=this.maxIterations;if(this.network.vertexes.count>0){for(this.network.deleteSelfEdges(),i=this.network.vertexes.iterator;i.next();){const o=i.value;o.charge=this.electricalCharge(o),o.mass=this.gravitationalMass(o)}const s=this.network.edges.iterator;for(;s.next();){const o=s.value;o.stiffness=this.springStiffness(o),o.length=this.springLength(o)}if(this.vN(),this.Dh=0,this.needsPrelayout()){const o=this.network,r=o.splitIntoSubNetworks(!1);let l=r.iterator;for(;l.next();){const h=l.value;this.doConnectedSubnetLayout(h)}for(l=r.iterator,this.XO(l,o),l=r.iterator;l.next();){const h=l.value,a=h.vertexes.iterator;for(;a.next();){const f=a.value;o.addVertex(f)}const c=h.edges.iterator;for(;c.next();){const f=c.value;o.addEdge(f)}}}else this.JT(this.network,this.maxIterations);this.updateParts()}this.maxIterations=e,this.isValidLayout=!0}needsPrelayout(){if(this.network.vertexes.count<3)return!1;let t=0,i=0;const e=this.network.vertexes.first().bounds,s=this.network.vertexes.iterator;for(;s.next();){const n=s.value,o=n.bounds;if(isNaN(n.x)||isNaN(n.y)||o.intersectsRect(e)&&(t++,t>2))return!0;if(i>10)return!1;i++}return!1}doConnectedSubnetLayout(t){let i=t.vertexes.iterator;for(;i.next();){const l=i.value;l.hierarchicalVertexes.add(l)}let e=t,s=this.jf;if(isNaN(s)&&(s=t.edges.count/t.vertexes.count),s<t.vertexes.count)for(;e.vertexes.count>Math.max(100,Math.sqrt(s*t.vertexes.count));)e=this.coarsenNetwork(e);let n=0;i=e.vertexes.iterator;let o=this.randomNumberGenerator;for(o===null&&(this.randomNumberGenerator=o=new RandomNumberGenerator(0));i.next();){i.value.idInCluster=n++;const l=10*(o.random()-.5),h=10*(o.random()-.5);this.isFixed(i.value)||(i.value.x=l,i.value.y=h);const a=i.value.hierarchicalVertexes.iterator;for(;a.next();)this.isFixed(a.value)||(a.value.x=l,a.value.y=h)}const r=this.computePairwiseDistances(e);this.KO(e,r,this.maxPrelayoutIterations,t.vertexes.count),this.JT(t,this.maxIterations)}computePairwiseDistances(t){const i=t.vertexes.count,e=new Array(i);for(let r=0;r<i;r++)e[r]=new Array(i).fill(-1),e[r][r]=0;const s=t.vertexes.iterator;let n=new Map,o=[];for(;s.next();){const r=s.value;for(o=[r],n=new Map,n.set(r.idInCluster,0);o.length>0;){const l=o.shift(),h=l.vertexes.iterator;for(;h.next();){const a=h.value;n.has(a.idInCluster)||(n.set(a.idInCluster,n.get(l.idInCluster)+1),o.push(a))}}for(let l=0;l<i;l++){const h=Math.min(e[r.idInCluster][l],e[l][r.idInCluster]),a=n.get(l);(h<0||a<h)&&(e[r.idInCluster][l]=a,e[l][r.idInCluster]=a)}}return e}coarsenNetwork(t){const i=this.createNetwork(),e=new Map;let s=0,n=t.vertexes.iterator;for(;n.next();)n.value.idInCluster=s++;for(n=t.vertexes.iterator;n.next();){const r=n.value;if(e.has(r.idInCluster))continue;let l=Number.MAX_SAFE_INTEGER,h=null;const a=r.vertexes.iterator;for(;a.next();){const f=a.value;e.has(f.idInCluster)||f.hierarchicalVertexes.length<l&&(l=f.hierarchicalVertexes.length,h=f)}const c=i.createVertex();c.hierarchicalVertexes.addAll(r.hierarchicalVertexes),h!=null&&c.hierarchicalVertexes.addAll(h.hierarchicalVertexes),e.set(r.idInCluster,c),h!=null&&e.set(h.idInCluster,c),i.addVertex(c)}const o=t.edges.iterator;for(;o.next();){const r=o.value,l=e.get(r.fromVertex.idInCluster),h=e.get(r.toVertex.idInCluster);if(l===h)continue;const a=i.createEdge();a.fromVertex=l,a.toVertex=h,i.addEdge(a)}return i}Sw(t,i){let e=!0;const s=t.vertexes.iterator;for(;s.next();){const n=s.value;e?(e=!1,i.set(n.bounds)):i.unionRect(n.bounds)}return i}XO(t,i){const e=this.arrangementSpacing,s=t.count;let n=!0,o=0,r=0;const l=Util.nt();for(let f=0;f<s+i.vertexes.count+2;f++)l[f]=null;let h=0;t.reset();const a=Rect.l();let c;for(;t.next();){const f=t.value;if(this.Sw(f,a),n)n=!1,o=a.x+a.width/2,r=a.y+a.height/2,l[0]=new Point(a.x+a.width+e.width,a.y),l[1]=new Point(a.x,a.y+a.height+e.height),h=2;else{const u=this.$T(l,h,o,r,a.width,a.height,e),d=l[u],m=new Point(d.x+a.width+e.width,d.y),g=new Point(d.x,d.y+a.height+e.height);u+1<h&&l.splice(u+1,0,null),l[u]=m,l[u+1]=g,h++;const p=d.x-a.x,y=d.y-a.y;for(c=f.vertexes.iterator;c.next();){const x=c.value;this.isFixed(x)||(x.centerX+=p,x.centerY+=y)}}}for(Rect.s(a),c=i.vertexes.iterator;c.next();){const f=c.value,u=f.bounds;if(h<2){o=u.x+u.width/2,r=u.y+u.height/2,l[0]=new Point(u.x+u.width+e.width,u.y),l[1]=new Point(u.x,u.y+u.height+e.height),h=2;continue}const d=this.$T(l,h,o,r,u.width,u.height,e),m=l[d],g=new Point(m.x+u.width+e.width,m.y),p=new Point(m.x,m.y+u.height+e.height);d+1<h&&l.splice(d+1,0,null),l[d]=g,l[d+1]=p,h++,this.isFixed(f)||(f.centerX=m.x+f.width/2,f.centerY=m.y+f.height/2)}Util.tt(l)}$T(t,i,e,s,n,o,r){let l=9e19,h=-1;t:for(let a=0;a<i;a++){const c=t[a],f=c.x-e,u=c.y-s,d=f*f+u*u;if(d<l){for(let m=a-1;m>=0;m--)if(t[m].y>c.y&&t[m].x-c.x<n+r.width)continue t;for(let m=a+1;m<i;m++)if(t[m].x>c.x&&t[m].y-c.y<o+r.height)continue t;h=a,l=d}}return h}vN(){if(!this.comments)return;const t=this.network.vertexes.iterator;for(;t.next();){const i=t.value;this.addComments(i)}}addComments(t){const i=t.node;if(i!==null){const e=i.findNodesConnected();for(;e.next();){const s=e.value;if(s.category!=="Comment"||!s.isVisible())continue;let n=this.network.findVertex(s);n===null&&(n=this.network.addNode(s)),n.charge=this.defaultCommentElectricalCharge;let o=null;const r=n.destinationEdges;for(;r.next();){const l=r.value;if(l.toVertex===t){o=l;break}}if(o===null){const l=n.sourceEdges;for(;l.next();){const h=l.value;if(h.fromVertex===t){o=h;break}}}o===null&&(o=this.network.linkVertexes(t,n,null)),o.length=this.defaultCommentSpringLength}}}ON(t,i){const e=t.bounds,s=e.x,n=e.y,o=e.width,r=e.height,l=i.bounds,h=l.x,a=l.y,c=l.width,f=l.height;if(s+o<h)if(n>a+f){const u=s+o-h,d=n-a-f;return Geo.xw(u*u+d*d)}else if(n+r<a){const u=s+o-h,d=n+r-a;return Geo.xw(u*u+d*d)}else return h-(s+o);else if(s>h+c)if(n>a+f){const u=s-h-c,d=n-a-f;return Geo.xw(u*u+d*d)}else if(n+r<a){const u=s-h-c,d=n+r-a;return Geo.xw(u*u+d*d)}else return s-(h+c);else return n>a+f?n-(a+f):n+r<a?a-(n+r):.1}JT(t,i){const e=this.Dh+i;for(;this.Dh<e&&(this.Dh++,!!this.YO(t)););}YO(t){const i=t.vertexes.toArray();if(i.length<=0)return!1;const e=i[0];e.forceX=0,e.forceY=0;let s=e.centerX,n=s,o=e.centerY,r=o;for(let m=1;m<i.length;m++){const g=i[m];g.forceX=0,g.forceY=0;const p=g.centerX,y=g.centerY;s=Math.min(s,p),n=Math.max(n,p),o=Math.min(o,y),r=Math.max(r,y)}const l=n-s>r-o;l?i.sort((m,g)=>m===null||g===null||m===g?0:m.centerX-g.centerX):i.sort((m,g)=>m===null||g===null||m===g?0:m.centerY-g.centerY);const h=this.zf;let a=0,c=0,f=0;for(let m=0;m<i.length;m++){const g=i[m],p=g.bounds,y=g.focus,x=p.x+y.x,k=p.y+y.y;c=g.charge*this.electricalFieldX(x,k),f=g.charge*this.electricalFieldY(x,k),c+=g.mass*this.gravitationalFieldX(x,k),f+=g.mass*this.gravitationalFieldY(x,k),g.forceX+=c,g.forceY+=f;for(let b=m+1;b<i.length;b++){const P=i[b];if(!this.shouldInteract(g,P)||b===m)continue;const M=P.bounds,L=P.focus,C=M.x+L.x,S=M.y+L.y;if(x-C>h||C-x>h){if(l)break;continue}if(k-S>h||S-k>h){if(!l)break;continue}const N=this.ON(g,P),T=2*g.charge,A=2*P.charge;if(N>1)a=T*A/(N*N),c=a*(x-C)/N,f=a*(k-S)/N;else{let D=this.randomNumberGenerator;D===null&&(this.randomNumberGenerator=D=new RandomNumberGenerator(0));const F=D.random(),R=D.random();if(x>C)c=Math.abs(P.bounds.right-g.bounds.x),c=T*A*(1+c)*F;else if(x<C)c=Math.abs(P.bounds.x-g.bounds.right),c=-(T*A)*(1+c)*F;else{const v=Math.max(P.width,g.width);c=T*A*((1+v)*F-v/2)}if(k>S)f=Math.abs(P.bounds.bottom-g.bounds.y),f=T*A*(1+f)*R;else if(x<C)f=Math.abs(P.bounds.y-g.bounds.bottom),f=-(T*A)*(1+f)*R;else{const v=Math.max(P.height,g.height);f=T*A*((1+v)*R-v/2)}}g.forceX+=c,g.forceY+=f,P.forceX-=c,P.forceY-=f}}const u=t.edges.iterator;for(;u.next();){const m=u.value,g=m.fromVertex,p=m.toVertex,y=g.bounds,x=g.focus,k=y.x+x.x,b=y.y+x.y,P=p.bounds,M=p.focus,L=P.x+M.x,C=P.y+M.y,S=this.ON(g,p);S>1&&(a=.1*m.stiffness*(S-m.length),c=a*.5*(g.width+p.height)*(k-L)/S,f=a*.5*(g.width+p.height)*(b-C)/S),g.forceX-=c,g.forceY-=f,p.forceX+=c,p.forceY+=f}let d=0;for(let m=0;m<i.length;m++){const g=i[m];this.isFixed(g)?this.moveFixedVertex(g):d=Math.max(d,this.moveVertex(g)||0)}return d>this.epsilonDistance*this.epsilonDistance}KO(t,i,e,s){const n=this.Dh+e,o=Math.sqrt(s);this.Vy=this.Ja*t.vertexes.count;const r=t.vertexes.toArray();let l=0,h=0,a=0;for(;this.Dh<n;){this.Dh++,h=l,l=0;for(let c=0;c<r.length;c++){r[c].forceX=0,r[c].forceY=0;for(let u=0;u<r.length;u++){if(c===u)continue;const d=this.ON(r[c],r[u]),m=i[r[c].idInCluster][r[u].idInCluster],g=(d-this.Ja*o*m)/d;r[c].forceX+=g*(r[u].x-r[c].x),r[c].forceY+=g*(r[u].y-r[c].y)}const f=Math.sqrt(r[c].forceX*r[c].forceX+r[c].forceY*r[c].forceY);if(f>0){r[c].forceX=this.Vy*r[c].forceX/f,r[c].forceY=this.Vy*r[c].forceY/f,this.isFixed(r[c])||(r[c].x+=r[c].forceX,r[c].y+=r[c].forceY);const u=r[c].hierarchicalVertexes.iterator;for(;u.next();){const d=u.value;this.isFixed(d)||(d.centerX+=r[c].forceX,d.centerY+=r[c].forceY)}}l+=f*f}if(l>=h){if(a++,a>=5)break}else a=0;this.Vy*=.95}}moveVertex(t){let i=t.forceX,e=t.forceY;const s=this.moveLimit;return i<-s?i=-s:i>s&&(i=s),e<-s?e=-s:e>s&&(e=s),t.centerX+=i,t.centerY+=e,i*i+e*e}shouldInteract(t,i){return!0}moveFixedVertex(t){}commitLayout(){this.zy(),this.commitNodes(),this.isRouting&&this.commitLinks()}zy(){if(!this.setsPortSpots)return;const t=this.network.edges.iterator;for(;t.next();){const e=t.value.link;e!==null&&(e.fromSpot=Spot.Default,e.toSpot=Spot.Default)}}commitNodes(){let t=0,i=0;if(this.arrangesToOrigin){const n=Rect.l();this.Sw(this.network,n);const o=this.arrangementOrigin;t=o.x-n.x,i=o.y-n.y,Rect.s(n)}const e=Rect.l(),s=this.network.vertexes.iterator;for(;s.next();){const n=s.value;(t!==0||i!==0)&&(e.a(n.bounds),e.x+=t,e.y+=i,n.bounds=e),n.commit()}Rect.s(e)}commitLinks(){const t=this.network.edges.iterator;for(;t.next();)t.value.commit()}springStiffness(t){const i=t.stiffness;return isNaN(i)?this.Xf:i}springLength(t){const i=t.length;return isNaN(i)?this.Kf:i}electricalCharge(t){const i=t.charge;return isNaN(i)?this.Yf:i}electricalFieldX(t,i){return 0}electricalFieldY(t,i){return 0}gravitationalMass(t){const i=t.mass;return isNaN(i)?this.Gf:i}gravitationalFieldX(t,i){return 0}gravitationalFieldY(t,i){return 0}isFixed(t){return t.isFixed}get currentIteration(){return this.Dh}get arrangementSpacing(){return this.ks}set arrangementSpacing(t){this.ks.equals(t)||(this.ks.a(t),this.invalidateLayout())}get arrangesToOrigin(){return this.xg}set arrangesToOrigin(t){this.xg!==t&&(Util.i(t,"boolean",ForceDirectedLayout,"arrangesToOrigin"),this.xg=t,this.invalidateLayout())}get setsPortSpots(){return this.Fn}set setsPortSpots(t){this.Fn!==t&&(Util.i(t,"boolean",ForceDirectedLayout,"setsPortSpots"),this.Fn=t,this.invalidateLayout())}get comments(){return this.Re}set comments(t){this.Re!==t&&(Util.i(t,"boolean",ForceDirectedLayout,"comments"),this.Re=t,this.invalidateLayout())}get maxPrelayoutIterations(){return this.bg}set maxPrelayoutIterations(t){this.bg!==t&&(Util.i(t,"number",ForceDirectedLayout,"maxPrelayoutIterations"),t>=0&&(this.bg=t,this.invalidateLayout()))}get maxIterations(){return this.kg}set maxIterations(t){this.kg!==t&&(Util.i(t,"number",ForceDirectedLayout,"maxIterations"),t>=0&&(this.kg=t,this.invalidateLayout()))}get epsilonDistance(){return this.Pg}set epsilonDistance(t){this.Pg!==t&&(Util.i(t,"number",ForceDirectedLayout,"epsilonDistance"),t>0&&(this.Pg=t,this.invalidateLayout()))}get infinityDistance(){return this.zf}set infinityDistance(t){this.zf!==t&&(Util.i(t,"number",ForceDirectedLayout,"infinityDistance"),t>1&&(this.zf=t,this.invalidateLayout()))}get moveLimit(){return this.Mg}set moveLimit(t){this.Mg!==t&&(Util.i(t,"number",ForceDirectedLayout,"moveLimit"),this.Mg=t,this.invalidateLayout())}get randomNumberGenerator(){return this.Sg}set randomNumberGenerator(t){this.Sg!==t&&(t!==null&&typeof t.random!="function"&&Util.o('ForceDirectedLayout.randomNumberGenerator must have a "random()" function on it: '+t),this.Sg=t)}get defaultSpringStiffness(){return this.Xf}set defaultSpringStiffness(t){this.Xf!==t&&(Util.i(t,"number",ForceDirectedLayout,"defaultSpringStiffness"),this.Xf=t,this.invalidateLayout())}get defaultSpringLength(){return this.Kf}set defaultSpringLength(t){this.Kf!==t&&(Util.i(t,"number",ForceDirectedLayout,"defaultSpringLength"),this.Kf=t,this.invalidateLayout())}get defaultElectricalCharge(){return this.Yf}set defaultElectricalCharge(t){this.Yf!==t&&(Util.i(t,"number",ForceDirectedLayout,"defaultElectricalCharge"),this.Yf=t,this.invalidateLayout())}get defaultGravitationalMass(){return this.Gf}set defaultGravitationalMass(t){this.Gf!==t&&(Util.i(t,"number",ForceDirectedLayout,"defaultGravitationalMass"),this.Gf=t,this.invalidateLayout())}get defaultCommentSpringLength(){return this.Ng}set defaultCommentSpringLength(t){this.Ng!==t&&(Util.i(t,"number",ForceDirectedLayout,"defaultCommentSpringLength"),this.Ng=t,this.invalidateLayout())}get defaultCommentElectricalCharge(){return this.Cg}set defaultCommentElectricalCharge(t){this.Cg!==t&&(Util.i(t,"number",ForceDirectedLayout,"defaultCommentElectricalCharge"),this.Cg=t,this.invalidateLayout())}get prelayoutQuality(){return this.jf}set prelayoutQuality(t){this.jf!==t&&(Util.i(t,"number",ForceDirectedLayout,"prelayoutQuality"),this.jf=t,this.invalidateLayout())}get prelayoutSpread(){return this.Ja}set prelayoutSpread(t){this.Ja!==t&&(Util.i(t,"number",ForceDirectedLayout,"prelayoutSpread"),this.Ja=t,this.invalidateLayout())}}class ForceDirectedNetwork extends LayoutNetwork{constructor(t){super(t)}createVertex(){return new ForceDirectedVertex(this)}createEdge(){return new ForceDirectedEdge(this)}}class ForceDirectedVertex extends LayoutVertex{K1;Y1;G1;j1;H1;hierarchicalVertexes;idInCluster;constructor(t){super(t),this.K1=!1,this.Y1=NaN,this.G1=NaN,this.j1=0,this.H1=0,this.hierarchicalVertexes=new List,this.idInCluster=-1}get isFixed(){return this.K1}set isFixed(t){this.K1!==t&&(Util.i(t,"boolean",ForceDirectedVertex,"isFixed"),this.K1=t)}get charge(){return this.Y1}set charge(t){this.Y1!==t&&(Util.i(t,"number",ForceDirectedVertex,"charge"),this.Y1=t)}get mass(){return this.G1}set mass(t){this.G1!==t&&(Util.i(t,"number",ForceDirectedVertex,"mass"),this.G1=t)}get forceX(){return this.j1}set forceX(t){this.j1!==t&&(Util.i(t,"number",ForceDirectedVertex,"forceX"),this.j1=t)}get forceY(){return this.H1}set forceY(t){this.H1!==t&&(Util.i(t,"number",ForceDirectedVertex,"forceY"),this.H1=t)}}class ForceDirectedEdge extends LayoutEdge{q1;W1;constructor(t){super(t),this.q1=NaN,this.W1=NaN}get stiffness(){return this.q1}set stiffness(t){this.q1!==t&&(Util.i(t,"number",ForceDirectedEdge,"stiffness"),this.q1=t)}get length(){return this.W1}set length(t){this.W1!==t&&(Util.i(t,"number",ForceDirectedEdge,"length"),this.W1=t)}}class RandomNumberGenerator{I;R;Q;M;A;seed;constructor(t){t===void 0&&(t=42),this.seed=t,this.A=48271,this.M=2147483647,this.Q=this.M/this.A,this.R=this.M%this.A,this.I=1/this.M,this.random()}random(){const t=this.seed/this.Q,i=this.seed%this.Q,e=this.A*i-this.R*t;return e>0?this.seed=e:this.seed=e+this.M,this.seed*this.I}}var LayeredDigraphCycleRemove=(w=>(w[w.DepthFirst=0]="DepthFirst",w[w.Greedy=1]="Greedy",w[w.FromLayers=2]="FromLayers",w))(LayeredDigraphCycleRemove||{}),LayeredDigraphLayering=(w=>(w[w.OptimalLinkLength=10]="OptimalLinkLength",w[w.LongestPathSink=11]="LongestPathSink",w[w.LongestPathSource=12]="LongestPathSource",w))(LayeredDigraphLayering||{}),LayeredDigraphInit=(w=>(w[w.DepthFirstOut=20]="DepthFirstOut",w[w.DepthFirstIn=21]="DepthFirstIn",w[w.Naive=22]="Naive",w))(LayeredDigraphInit||{}),LayeredDigraphAggressive=(w=>(w[w.None=30]="None",w[w.Less=31]="Less",w[w.More=32]="More",w))(LayeredDigraphAggressive||{}),LayeredDigraphPack=(w=>(w[w.None=0]="None",w[w.Expand=1]="Expand",w[w.Straighten=2]="Straighten",w[w.Median=4]="Median",w[w.MaybeExpand=8]="MaybeExpand",w[w.All=15]="All",w))(LayeredDigraphPack||{}),LayeredDigraphAlign=(w=>(w[w.None=0]="None",w[w.UpperLeft=1]="UpperLeft",w[w.UpperRight=2]="UpperRight",w[w.LowerLeft=4]="LowerLeft",w[w.LowerRight=8]="LowerRight",w[w.All=15]="All",w))(LayeredDigraphAlign||{});class LayeredDigraphLayout extends Layout{Ps;Ji;S;Hf;qf;Wf;$a;Jf;sr;$f;Fn;Mt;Xy;Yt;Lg;Ms;ui;Qs;Ss;Ns;Ut;Ag;Za;Tg;_s;Zf;nr;Rn;vn;IN;constructor(t){super(),this.Ps=25,this.Ji=25,this.S=0,this.Hf=0,this.qf=10,this.Wf=20,this.$a=4,this.Jf=31,this.sr=15,this.$f=10,this.Fn=!0,this.Mt=-1,this.Xy=-1,this.Yt=-1,this.Lg=0,this.Ms=0,this.ui=null,this.Qs=null,this.Ss=null,this.Ns=null,this.Ut=null,this.Ag=0,this.Za=null,this.Tg=null,this._s=0,this.Zf=null,this.nr=new Point,this.Rn=[],this.Rn.length=100,this.vn=15,this.IN=0,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Ps=this.Ps,t.Ji=this.Ji,t.S=this.S,t.Hf=this.Hf,t.qf=this.qf,t.Wf=this.Wf,t.$a=this.$a,t.Jf=this.Jf,t.sr=this.sr,t.$f=this.$f,t.Fn=this.Fn,t.vn=this.vn}li(t){t in LayeredDigraphAggressive?this.aggressiveOption=t:t in LayeredDigraphCycleRemove?this.cycleRemoveOption=t:t in LayeredDigraphInit?this.initializeOption=t:t in LayeredDigraphLayering?this.layeringOption=t:super.li(t)}createNetwork(){return new LayeredDigraphNetwork(this)}doLayout(t){this.network===null&&(this.network=this.makeNetwork(t)),this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin),this.GO(),this.network.vertexes.count>0&&(this.network.deleteSelfEdges(),this.cycleRemoveOption!==2&&this.removeCycles(),this.jO(),this.cycleRemoveOption===2&&this.removeCycles(),this.HO(),this.qO(),this.WO(),this.reduceCrossings(),this.straightenAndPack(),this.updateParts()),this.network=null,this.isValidLayout=!0}linkMinLength(t){return 1}linkLengthWeight(t){return 1}linkStraightenWeight(t){const i=t.fromVertex.node||t.fromVertex.data,e=t.toVertex.node||t.toVertex.data;return i===null&&e===null?8:i===null||e===null?4:1}nodeMinLayerSpace(t,i){return t.node===null&&t.data===null?0:this.S===90||this.S===270?i?t.focus.y+10:t.bounds.height-t.focus.y+10:i?t.focus.x+10:t.bounds.width-t.focus.x+10}nodeMinColumnSpace(t,i){if(t.node===null&&t.data===null)return 0;const e=i?t.J1:t.$1;if(e!==null)return e;const s=this.S;return s===90||s===270?i?t.J1=t.focus.x/this.Ji+1|0:t.$1=(t.bounds.width-t.focus.x)/this.Ji+1|0:i?t.J1=t.focus.y/this.Ji+1|0:t.$1=(t.bounds.height-t.focus.y)/this.Ji+1|0}$i(){this.Za===null&&(this.Za=[]);let t=0;const i=this.network.vertexes.iterator;for(;i.next();){const e=i.value;this.Za[t]=e.layer,t++,this.Za[t]=e.column,t++,this.Za[t]=e.index,t++}return this.Za}Qe(t){let i=0;const e=this.network.vertexes.iterator;for(;e.next();){const s=e.value;s.layer=t[i],i++,s.column=t[i],i++,s.index=t[i],i++}}ZT(t,i){const e=this.Fh(t),s=this.ui[t];(this.Tg===null||this.Tg.length<s*s)&&(this.Tg=[]);const n=this.Tg;for(let o=0;o<s;o++){let r=0;const l=e[o],h=l.near;let a=0;h!==null&&h!==l&&h.layer===l.layer&&(r+=Math.max(0,Math.abs(h.index-l.index)-1));let c,f=0,u,d=0,m=0,g=0,p,y=0,x,k=0,b=0,P=0,M;if(i>=0){for(c=e[o].po,f=0;f<c.length;f++)if(u=c[f],u.valid&&u.fromVertex.layer!==t)for(d=u.fromVertex.index,m=u.portToPos,g=u.portFromPos,y=f+1;y<c.length;y++)x=c[y],x.valid&&x.fromVertex.layer!==t&&(k=x.fromVertex.index,b=x.portToPos,P=x.portFromPos,m<b&&(d>k||d===k&&g>P)&&r++,b<m&&(k>d||k===d&&P>g)&&r++)}if(i<=0){for(c=e[o].tr,f=0;f<c.length;f++)if(u=c[f],u.valid&&u.toVertex.layer!==t)for(d=u.toVertex.index,m=u.portToPos,g=u.portFromPos,y=f+1;y<c.length;y++)x=c[y],x.valid&&x.toVertex.layer!==t&&(k=x.toVertex.index,b=x.portToPos,P=x.portFromPos,g<P&&(d>k||d===k&&m>b)&&r++,P<g&&(k>d||k===d&&b>m)&&r++)}for(n[o*s+o]=r,a=o+1;a<s;a++){let L=0,C=0;if(i>=0){for(p=e[o].po,M=e[a].po,f=0;f<p.length;f++)if(u=p[f],u.valid&&u.fromVertex.layer!==t)for(d=u.fromVertex.index,m=u.portToPos,g=u.portFromPos,y=0;y<M.length;y++)x=M[y],x.valid&&x.fromVertex.layer!==t&&(k=x.fromVertex.index,b=x.portToPos,P=x.portFromPos,(d<k||d===k&&g<P)&&C++,(k<d||k===d&&P<g)&&L++)}if(i<=0){for(p=e[o].tr,M=e[a].tr,f=0;f<p.length;f++)if(u=p[f],u.valid&&u.toVertex.layer!==t)for(d=u.toVertex.index,m=u.portToPos,g=u.portFromPos,y=0;y<M.length;y++)x=M[y],x.valid&&x.toVertex.layer!==t&&(k=x.toVertex.index,b=x.portToPos,P=x.portFromPos,(d<k||d===k&&m<b)&&C++,(k<d||k===d&&b<m)&&L++)}n[o*s+a]=L,n[a*s+o]=C}}return this.Rh(t,e),n}countCrossings(){let t=0;for(let i=0;i<=this.Mt;i++){const e=this.ZT(i,1),s=this.ui[i];for(let n=0;n<s;n++)for(let o=n;o<s;o++)t+=e[n*s+o]}return t}JO(t,i,e){const s=this.Fh(t),n=this.ui[t];let o=0;for(let r=0;r<n;r++){let l=null;i<=0&&(l=s[r].po);let h=null;i>=0&&(h=s[r].tr);let a,c=0,f=0;if(l!==null)for(let u=0;u<l.length;u++)a=l[u],a.valid&&a.fromVertex.layer!==t&&(c=a.fromVertex.column+a.portFromColOffset,f=a.toVertex.column+a.portToColOffset,e?o+=Math.abs(c-f)*this.linkStraightenWeight(a):o+=Math.abs(c-f));if(h!==null)for(let u=0;u<h.length;u++)a=h[u],a.valid&&a.toVertex.layer!==t&&(c=a.fromVertex.column+a.portFromColOffset,f=a.toVertex.column+a.portToColOffset,e?o+=(Math.abs(c-f)+1)*this.linkStraightenWeight(a):o+=Math.abs(c-f))}return this.Rh(t,s),o}Z1(t){let i=0;for(let e=0;e<=this.Mt;e++)i+=this.JO(e,1,t);return i}Ky(){let t=1/0;this.Yt=-1;const i=this.network.vertexes.iterator;for(;i.next();){const e=i.value;t=Math.min(t,e.column-this.nodeMinColumnSpace(e,!0)),this.Yt=Math.max(this.Yt,e.column+this.nodeMinColumnSpace(e,!1))}for(i.reset();i.next();){const e=i.value;e.column-=t}this.Yt-=t}Yy(t,i){const e=this.Fh(t),s=this.ui[t],n=[];for(let o=0;o<s;o++){const r=e[o];let l=null;i<=0&&(l=r.po);let h=null;i>=0&&(h=r.tr);let a=0,c=0;const f=r.near;f!==null&&f.layer===r.layer&&(a+=f.column-1,c++);let u;if(l!==null)for(let d=0;d<l.length;d++){u=l[d];const m=u.fromVertex;u.valid&&!u.rev&&m.layer!==t&&(a+=m.column,c++)}if(h!==null)for(let d=0;d<h.length;d++){u=h[d];const m=u.toVertex;u.valid&&!u.rev&&m.layer!==t&&(a+=m.column,c++)}c===0?n[o]=-1:n[o]=a/c}return this.Rh(t,e),n}QT(t,i){const e=this.Fh(t),s=this.ui[t],n=[];for(let o=0;o<s;o++){const r=e[o];let l=null;i<=0&&(l=r.po);let h=null;i>=0&&(h=r.tr);let a=0;const c=[],f=r.near;f!==null&&f.layer===r.layer&&(c[a]=f.column-1,a++);let u;if(l!==null)for(let d=0;d<l.length;d++){u=l[d];const m=u.fromVertex;u.valid&&!u.rev&&m.layer!==t&&(c[a]=m.column+u.portFromColOffset,a++)}if(h!==null)for(let d=0;d<h.length;d++){u=h[d];const m=u.toVertex;u.valid&&!u.rev&&m.layer!==t&&(c[a]=m.column+u.portToColOffset,a++)}if(a===0)n[o]=-1;else{c.sort((m,g)=>m-g);const d=a>>1;a&1?n[o]=c[d]:n[o]=c[d-1]+c[d]>>1}}return this.Rh(t,e),n}Gy(t,i,e,s,n){if(t.component===e){t.component=i;let o=0,r=0;if(s){const l=t.destinationEdges;for(;l.next();){const h=l.value,a=h.toVertex;o=t.layer-a.layer,r=this.linkMinLength(h),o===r&&this.Gy(a,i,e,s,n)}}if(n){const l=t.sourceEdges;for(;l.next();){const h=l.value,a=h.fromVertex;o=a.layer-t.layer,r=this.linkMinLength(h),o===r&&this.Gy(a,i,e,s,n)}}}}EN(t,i,e,s,n){if(t.component===e){if(t.component=i,s){const o=t.destinationEdges;for(;o.next();){const l=o.value.toVertex;this.EN(l,i,e,s,n)}}if(n){const o=t.sourceEdges;for(;o.next();){const l=o.value.fromVertex;this.EN(l,i,e,s,n)}}}}removeCycles(){const t=this.network.edges.iterator;for(;t.next();){const i=t.value;i.rev=!1}switch(this.Hf){default:case 1:this.$O();break;case 0:this.ZO();break;case 2:this.QO();break}}QO(){const t=this.network,i=t.vertexes.iterator;let e=1/0;for(;i.next();){const s=i.value;e=Math.min(e,s.layer)}if(e<1/0){if(e<0)for(i.reset();i.next();){const r=i.value;r.layer-=e}const s=[];for(i.reset();i.next();){const r=i.value,l=s[r.layer];l===void 0?s[r.layer]=[r]:l.push(r)}let n=0;for(let r=0;r<s.length;r++){const l=s[r];if(!l||l.length===0)n++;else if(r>0)for(let h=0;h<l.length;h++){const a=l[h];a.layer-=n}}const o=t.edges.iterator;for(;o.next();){const r=o.value,l=r.fromVertex,h=r.toVertex;l.layer<h.layer&&(t.reverseEdge(r),r.rev=!0)}}}$O(){const t=this.network;let i=0,e=t.vertexes.count-1;const s=[];s.length=e+1;const n=t.vertexes.iterator;for(;n.next();){const r=n.value;r.Zi=!0}for(;this._O(t)!==null;){let r;for(r=this._T(t);r!==null;)s[e]=r,e--,r.Zi=!1,r=this._T(t);for(r=this.tD(t);r!==null;)s[i]=r,i++,r.Zi=!1,r=this.tD(t);r=this.tI(t),r!==null&&(s[i]=r,i++,r.Zi=!1)}for(let r=0;r<t.vertexes.count;r++)s[r].index=r;const o=t.edges.iterator;for(;o.next();){const r=o.value,l=r.fromVertex,h=r.toVertex;l.index>h.index&&(t.reverseEdge(r),r.rev=!0)}}_O(t){const i=t.vertexes.iterator;for(;i.next();){const e=i.value;if(e.Zi)return e}return null}_T(t){const i=t.vertexes.iterator;for(;i.next();){const e=i.value;if(e.Zi){let s=!0;const n=e.destinationEdges;for(;n.next();)if(n.value.toVertex.Zi){s=!1;break}if(s)return e}}return null}tD(t){const i=t.vertexes.iterator;for(;i.next();){const e=i.value;if(e.Zi){let s=!0;const n=e.sourceEdges;for(;n.next();)if(n.value.fromVertex.Zi){s=!1;break}if(s)return e}}return null}tI(t){let i=null,e=0;const s=this.network.vertexes.iterator;for(;s.next();){const n=s.value;if(n.Zi){let o=0;const r=n.destinationEdges;for(;r.next();)r.value.toVertex.Zi&&o++;let l=0;const h=n.sourceEdges;for(;h.next();)h.value.fromVertex.Zi&&l++;(i===null||e<o-l)&&(i=n,e=o-l)}}return i}ZO(){const t=this.network.vertexes.iterator;for(;t.next();){const e=t.value;e.Qf=-1,e.jn=-1}const i=this.network.edges.iterator;for(;i.next();){const e=i.value;e.forest=!1}for(this.Ag=0,t.reset();t.next();){const e=t.value;e.sourceEdges.count===0&&this.BN(e)}for(t.reset();t.next();){const e=t.value;e.Qf===-1&&this.BN(e)}for(i.reset();i.next();){const e=i.value;if(!e.forest){const s=e.fromVertex,n=s.Qf,o=s.jn,r=e.toVertex,l=r.Qf,h=r.jn;l<n&&o<h&&(this.network.reverseEdge(e),e.rev=!0)}}}BN(t){t.Qf=this.Ag,this.Ag++;const i=t.destinationEdges;for(;i.next();){const e=i.value,s=e.toVertex;s.Qf===-1&&(e.forest=!0,this.BN(s))}t.jn=this.Ag,this.Ag++}jO(){const t=this.network.vertexes.iterator;for(;t.next();){const i=t.value;i.layer=-1}for(this.Mt=-1,this.assignLayers(),t.reset();t.next();){const i=t.value;this.Mt=Math.max(this.Mt,i.layer)}}assignLayers(){switch(this.qf){case 11:this.iD();break;case 12:this.iI();break;default:case 10:this.eI();break}}iD(){const t=this.network.vertexes.iterator;for(;t.next();){const i=t.value,e=this.eD(i);this.Mt=Math.max(e,this.Mt)}}eD(t){let i=0;if(t.layer===-1){const e=t.destinationEdges;for(;e.next();){const s=e.value,n=s.toVertex,o=this.linkMinLength(s);i=Math.max(i,this.eD(n)+o)}t.layer=i}else i=t.layer;return i}iI(){let t=0;const i=this.network.vertexes.iterator;for(;i.next();){const e=i.value;t=this.sD(e),this.Mt=Math.max(t,this.Mt)}for(i.reset();i.next();){const e=i.value;e.layer=this.Mt-e.layer}}sD(t){let i=0;if(t.layer===-1){const e=t.sourceEdges;for(;e.next();){const s=e.value,n=s.fromVertex,o=this.linkMinLength(s);i=Math.max(i,this.sD(n)+o)}t.layer=i}else i=t.layer;return i}eI(){this.iD();const t=this.network.vertexes.iterator;for(;t.next();){const e=t.value;e.Zi=!1}for(t.reset();t.next();){const e=t.value;e.sourceEdges.count===0&&this.nD(e)}let i=1/0;for(t.reset();t.next();){const e=t.value;i=Math.min(i,e.layer)}for(this.Mt=-1,t.reset();t.next();){const e=t.value;e.layer-=i,this.Mt=Math.max(this.Mt,e.layer)}}nD(t){if(!t.Zi){t.Zi=!0;const i=t.destinationEdges;for(;i.next();){const s=i.value.toVertex;this.nD(s)}this.sI(t),this.nI(t)}}sI(t){const i=this.network.vertexes.iterator;for(;i.next();){const r=i.value;r.component=-1}const e=0,s=1,n=t.po;let o=n.length;for(let r=0;r<o;r++){const l=n[r],h=l.fromVertex,a=l.toVertex,c=this.linkMinLength(l);h.layer-a.layer>c&&this.Gy(h,e,-1,!0,!1)}for(this.Gy(t,s,-1,!0,!0);t.component!==e;){let r=0,l=1/0,h=0,a=null;const c=this.network.vertexes.iterator;for(;c.next();){const f=c.value;if(f.component===s){let u=0,d=!1;const m=f.po;o=m.length;for(let p=0;p<o;p++){const y=m[p],x=y.fromVertex;if(u+=this.linkLengthWeight(y),x.component!==s){r+=this.linkLengthWeight(y);const k=x.layer-f.layer,b=this.linkMinLength(y);l=Math.min(l,k-b)}}const g=f.tr;o=g.length;for(let p=0;p<o;p++){const y=g[p],x=y.toVertex;u-=this.linkLengthWeight(y),x.component!==s?r-=this.linkLengthWeight(y):d=!0}(a===null||u<h)&&!d&&(a=f,h=u)}}if(r>0){for(i.reset();i.next();){const f=i.value;f.component===s&&(f.layer+=l)}t.component=e}else a.component=e}}nI(t){const i=this.network.vertexes.iterator;for(;i.next();){const n=i.value;n.component=-1}const e=0,s=1;for(this.Gy(t,s,-1,!0,!1);t.component!==e;){let n=0,o=1/0,r=0,l=null;const h=this.network.vertexes.iterator;for(;h.next();){const a=h.value;if(a.component===s){let c=0,f=!1;const u=a.po;let d=u.length;for(let g=0;g<d;g++){const p=u[g],y=p.fromVertex;c+=this.linkLengthWeight(p),y.component!==s?n+=this.linkLengthWeight(p):f=!0}const m=a.tr;d=m.length;for(let g=0;g<d;g++){const p=m[g],y=p.toVertex;if(c-=this.linkLengthWeight(p),y.component!==s){n-=this.linkLengthWeight(p);const x=a.layer-y.layer,k=this.linkMinLength(p);o=Math.min(o,x-k)}}(l===null||c>r)&&!f&&(l=a,r=c)}}if(n<0){for(i.reset();i.next();){const a=i.value;a.component===s&&(a.layer-=o)}t.component=e}else l.component=e}}HO(){const t=this.network,i=[],e=t.edges.iterator;for(;e.next();){const s=e.value;s.valid=!1,i.push(s)}for(let s=0;s<i.length;s++){const n=i[s];let o=n.fromVertex;const r=n.toVertex;if(n.valid||(o.node===null&&o.data===null||r.node===null&&r.data===null)&&o.layer===r.layer)continue;let l=0,h=0,a=0,c=0;if(n.link!==null){const P=n.link;if(P===null)continue;const M=o.node,L=r.node;if(M===null||L===null)continue;let C=P.fromNode,S=P.toNode,N=P.fromPort;for(;N!==null&&!N.isVisibleObject();)N=N.panel;let T=P.toPort;for(;T!==null&&!T.isVisibleObject();)T=T.panel;if(n.rev){const B=C,X=N;C=S,N=T,S=B,T=X}const A=o.focus,D=r.focus,F=n.rev?r.bounds:o.bounds,R=Point.l();M!==C?F.isReal()&&C.isVisible()?C.actualBounds.isReal()?(C.getRelativePoint(N,Spot.Center,R),R.x+=C.actualBounds.x-F.x,R.y+=C.actualBounds.y-F.y):(C.getRelativePoint(N,Spot.Center,R),R.isReal()||R.a(A)):R.a(A):F.isReal()?(C.getRelativePoint(N,Spot.Center,R),R.isReal()||R.a(A)):R.a(A);const v=n.rev?o.bounds:r.bounds,O=Point.l();L!==S?v.isReal()&&S.isVisible()?S.actualBounds.isReal()?(S.getRelativePoint(T,Spot.Center,O),O.x+=S.actualBounds.x-v.x,O.y+=S.actualBounds.y-v.y):(S.getRelativePoint(T,Spot.Center,O),O.isReal()||O.a(D)):O.a(D):v.isReal()?(S.getRelativePoint(T,Spot.Center,O),O.isReal()||O.a(D)):O.a(D),this.S===90||this.S===270?(l=Math.round((R.x-A.x)/this.Ji),a=R.x,h=Math.round((O.x-D.x)/this.Ji),c=O.x):(l=Math.round((R.y-A.y)/this.Ji),a=R.y,h=Math.round((O.y-D.y)/this.Ji),c=O.y),Point.s(R),Point.s(O),n.portFromColOffset=l,n.portFromPos=a,n.portToColOffset=h,n.portToPos=c}else n.portFromColOffset=0,n.portFromPos=0,n.portToColOffset=0,n.portToPos=0;let f=o.layer;const u=r.layer,d=this.oI(n),m=d===1||d===3,g=d===2||d===3;let p,y,x=null,k;g&&(x=this.rI(o,r),k=1,y=t.createVertex(),y.node=null,y.Q1=1,y.layer=f,y.near=o,t.addVertex(y),p=t.linkVertexes(o,y,n.link),p.valid=!1,p.rev=n.rev,p.portFromColOffset=l,p.portToColOffset=0,p.portFromPos=a,p.portToPos=0,o=y);let b=1;if(m&&b--,f-u>b&&f>0){for(n.valid=!1,y=t.createVertex(),y.node=null,y.Q1=2,y.layer=f-1,x&&k<x.length&&y.layer===x[k].layer&&(y.near=x[k++]),t.addVertex(y),p=t.linkVertexes(o,y,n.link),p.valid=!0,p.rev=n.rev,p.portFromColOffset=g?0:l,p.portToColOffset=0,p.portFromPos=g?0:a,p.portToPos=0,o=y,f--;f-u>b&&f>0;)y=t.createVertex(),y.node=null,y.Q1=3,y.layer=f-1,x&&k<x.length&&y.layer===x[k].layer&&(y.near=x[k++]),t.addVertex(y),p=t.linkVertexes(o,y,n.link),p.valid=!0,p.rev=n.rev,p.portFromColOffset=0,p.portToColOffset=0,p.portFromPos=0,p.portToPos=0,o=y,f--;p=t.linkVertexes(y,r,n.link),p.valid=!m,m&&(y.near=r),p.rev=n.rev,p.portFromColOffset=0,p.portToColOffset=h,p.portFromPos=0,p.portToPos=c}else n.valid=!0}}oI(t){let i=0;const e=t.link;if(e!==null){const s=e.fromPort,n=e.toPort;if(s!==null&&n!==null){const o=e.fromNode,r=e.toNode;if(o!==null&&r!==null){const l=this._1(!0),h=this._1(!1),a=this.setsPortSpots?l:e.computeSpot(!0,s),c=this.setsPortSpots?h:e.computeSpot(!1,n),f=e.isOrthogonal;if(a.isSide()&&a.includesSide(h)&&c.isSide()&&c.includesSide(l))return 0;const u=e.getLinkPoint(o,s,a,!0,f,r,n,Point.l()),d=e.getLinkDirection(o,s,u,a,!0,f,r,n);Point.s(u),(!a.isNone()&&d===this.oD(t,!0)||this.setsPortSpots&&o!==null&&o.ports.count===1&&t.rev)&&(i+=1);const m=e.getLinkPoint(r,n,c,!1,f,o,s,Point.l()),g=e.getLinkDirection(r,n,m,c,!1,f,o,s);Point.s(m),(!c.isNone()&&g===this.oD(t,!1)||this.setsPortSpots&&r!==null&&r.ports.count===1&&t.rev)&&(i+=2)}}}return i}oD(t,i){return this.S===90?i&&!t.rev||!i&&t.rev?270:90:this.S===180?i&&!t.rev||!i&&t.rev?0:180:this.S===270?i&&!t.rev||!i&&t.rev?90:270:i&&!t.rev||!i&&t.rev?180:0}rI(t,i){const e=[];return e.push(i),this.rD(t,e)?e.reverse():[]}rD(t,i){const e=i[i.length-1].sourceEdges.iterator;for(;e.next();){const s=e.value;if(s.rev||!s.valid)continue;const n=s.fromVertex;if(i.push(n),n===t||this.rD(t,i))return!0;i.pop()}return!1}qO(){const t=this.ui=[];for(let e=0;e<=this.Mt;e++)t[e]=0;const i=this.network.vertexes.iterator;for(;i.next();){const e=i.value;e.index=-1}this.initializeIndices(),this.Xy=-1,this.Lg=0,this.Ms=0;for(let e=0;e<=this.Mt;e++)t[e]>t[this.Ms]&&(this.Xy=t[e]-1,this.Ms=e),t[e]<t[this.Lg]&&(this.Lg=e);this.Zf=[];for(let e=0;e<t.length;e++)this.Zf[e]=[];for(i.reset();i.next();){const e=i.value,s=e.layer,n=this.Zf[s];n[e.index]=e}}initializeIndices(){switch(this.Wf){default:case 22:this.lI();break;case 20:this.hI();break;case 21:this.aI();break}}lI(){let t=null;const i=this.network.vertexes.iterator;for(;i.next();){const e=i.value;if(e.near&&(t===null&&(t=new Map),e.layer===e.near.layer)){const s=t.get(e.near)||[];s.push(e),t.set(e.near,s)}}for(i.reset();i.next();){const e=i.value;if(e.near)continue;const s=e.layer;if(e.index=this.ui[s],this.ui[s]++,!t)continue;const n=t.get(e);Array.isArray(n)&&n.forEach(o=>{o.index=this.ui[s],this.ui[s]++})}}hI(){let t=null;const i=this.network.vertexes.iterator;for(;i.next();){const e=i.value;if(e.near&&(t===null&&(t=new Map),e.layer===e.near.layer)){const s=t.get(e.near)||[];s.push(e),t.set(e.near,s)}}for(let e=this.Mt;e>=0;e--)for(i.reset();i.next();){const s=i.value;s.layer===e&&s.index===-1&&this.lD(s,t)}}lD(t,i){if(t.near)return;const e=t.layer;if(t.index=this.ui[e],this.ui[e]++,i){const o=i.get(t);Array.isArray(o)&&o.forEach(r=>{r.index=this.ui[e],this.ui[e]++})}const s=t.tr;let n=!0;for(;n;){n=!1;for(let o=0;o<s.length-1;o++){const r=s[o],l=s[o+1];r.portFromColOffset>l.portFromColOffset&&(n=!0,s[o]=l,s[o+1]=r)}}for(let o=0;o<s.length;o++){const r=s[o];if(r.valid){const l=r.toVertex;l.index===-1&&this.lD(l,i)}}}aI(){let t=null;const i=this.network.vertexes.iterator;for(;i.next();){const e=i.value;if(e.near&&(t===null&&(t=new Map),e.layer===e.near.layer)){const s=t.get(e.near)||[];s.push(e),t.set(e.near,s)}}for(let e=0;e<=this.Mt;e++)for(i.reset();i.next();){const s=i.value;s.layer===e&&s.index===-1&&this.hD(s,t)}}hD(t,i){if(t.near)return;const e=t.layer;if(t.index=this.ui[e],this.ui[e]++,i){const h=i.get(t);Array.isArray(h)&&h.forEach(a=>{a.index=this.ui[e],this.ui[e]++})}const s=t.po;let n=!0,o=0;for(;n;)for(n=!1,o=0;o<s.length-1;o++){const h=s[o],a=s[o+1];h.portToColOffset>a.portToColOffset&&(n=!0,s[o]=a,s[o+1]=h)}let r,l;for(o=0;o<s.length;o++)l=s[o],l.valid&&(r=l.fromVertex,r.index===-1&&this.hD(r,i))}WO(){this.Yt=-1;for(let t=0;t<=this.Mt;t++){const i=this.Fh(t);let e=0;const s=this.ui[t];for(let n=0;n<s;n++){const o=i[n];e+=this.nodeMinColumnSpace(o,!0),o.column=e,e+=1,e+=this.nodeMinColumnSpace(o,!1)}this.Yt=Math.max(this.Yt,e-1),this.Rh(t,i)}}reduceCrossings(){let t=this.countCrossings(),i=this.$i(),e=0,s=0,n=0;for(e=0;e<this.$a;e++){for(s=0;s<=this.Mt;s++)this.tk(s,1),this.ls(s,1,!1,1);for(n=this.countCrossings(),n<t&&(t=n,i=this.$i()),s=this.Mt;s>=0;s--)this.tk(s,-1),this.ls(s,-1,!1,-1);n=this.countCrossings(),n<t&&(t=n,i=this.$i())}for(this.Qe(i),e=0;e<this.$a;e++){for(s=0;s<=this.Mt;s++)this.tk(s,0),this.ls(s,0,!1,0);for(n=this.countCrossings(),n<t&&(t=n,i=this.$i()),s=this.Mt;s>=0;s--)this.tk(s,0),this.ls(s,0,!1,0);n=this.countCrossings(),n<t&&(t=n,i=this.$i())}this.Qe(i);let o=!1,r=0,l=0,h=0,a=0;switch(this.Jf){case 30:break;case 32:for(h=t+1;(a=this.countCrossings())<h;)for(h=a,r=this.Mt;r>=0;r--)for(l=0;l<=r;l++){for(o=!0;o;)for(o=!1,s=r;s>=l;s--)o=this.ls(s,-1,!1,-1)||o;for(n=this.countCrossings(),n>=t?this.Qe(i):(t=n,i=this.$i()),o=!0;o;)for(o=!1,s=r;s>=l;s--)o=this.ls(s,1,!1,1)||o;for(n=this.countCrossings(),n>=t?this.Qe(i):(t=n,i=this.$i()),o=!0;o;)for(o=!1,s=l;s<=r;s++)o=this.ls(s,1,!1,1)||o;for(n>=t?this.Qe(i):(t=n,i=this.$i()),o=!0;o;)for(o=!1,s=l;s<=r;s++)o=this.ls(s,-1,!1,-1)||o;for(n>=t?this.Qe(i):(t=n,i=this.$i()),o=!0;o;)for(o=!1,s=r;s>=l;s--)o=this.ls(s,0,!1,0)||o;for(n>=t?this.Qe(i):(t=n,i=this.$i()),o=!0;o;)for(o=!1,s=l;s<=r;s++)o=this.ls(s,0,!1,0)||o;n>=t?this.Qe(i):(t=n,i=this.$i())}break;default:case 31:for(r=this.Mt,l=0,h=t+1;(a=this.countCrossings())<h;){for(h=a,o=!0;o;)for(o=!1,s=r;s>=l;s--)o=this.ls(s,-1,!1,-1)||o;for(n=this.countCrossings(),n>=t?this.Qe(i):(t=n,i=this.$i()),o=!0;o;)for(o=!1,s=r;s>=l;s--)o=this.ls(s,1,!1,1)||o;for(n=this.countCrossings(),n>=t?this.Qe(i):(t=n,i=this.$i()),o=!0;o;)for(o=!1,s=l;s<=r;s++)o=this.ls(s,1,!1,1)||o;for(n>=t?this.Qe(i):(t=n,i=this.$i()),o=!0;o;)for(o=!1,s=l;s<=r;s++)o=this.ls(s,-1,!1,-1)||o;for(n>=t?this.Qe(i):(t=n,i=this.$i()),o=!0;o;)for(o=!1,s=r;s>=l;s--)o=this.ls(s,0,!1,0)||o;for(n>=t?this.Qe(i):(t=n,i=this.$i()),o=!0;o;)for(o=!1,s=l;s<=r;s++)o=this.ls(s,0,!1,0)||o;n>=t?this.Qe(i):(t=n,i=this.$i())}break}this.Qe(i)}tk(t,i){let e=0,s=!1;const n=this.Fh(t),o=this.ui[t],r=this.QT(t,i),l=this.Yy(t,i);for(e=0;e<o;e++)l[e]===-1&&(l[e]=n[e].column),r[e]===-1&&(r[e]=n[e].column);let h=!0,a;for(;h;)for(h=!1,e=0;e<o-1;e++)if(r[e+1]<r[e]||r[e+1]===r[e]&&l[e+1]<l[e]){s=!0,h=!0;const f=r[e];r[e]=r[e+1],r[e+1]=f;const u=l[e];l[e]=l[e+1],l[e+1]=u,a=n[e],n[e]=n[e+1],n[e+1]=a}let c=0;for(e=0;e<o;e++)a=n[e],a.index=e,c+=this.nodeMinColumnSpace(a,!0),a.column=c,c+=1,c+=this.nodeMinColumnSpace(a,!1);return this.Rh(t,n),s}ls(t,i,e,s){const n=this.Fh(t),o=this.ui[t],r=this.ZT(t,i);let l=0,h;if(!e||s>0)for(h=[],l=0;l<o;l++)h[l]=-1;else h=this.Yy(t,-1);let a;if(!e||s<0)for(a=[],l=0;l<o;l++)a[l]=-1;else a=this.Yy(t,1);let c=!1,f=!0;for(;f;)for(f=!1,l=0;l<o-1;l++){const u=r[n[l].index*o+n[l+1].index],d=r[n[l+1].index*o+n[l].index];let m=0,g=0;const p=n[l].column,y=n[l+1].column,x=this.nodeMinColumnSpace(n[l],!0),k=this.nodeMinColumnSpace(n[l],!1),b=this.nodeMinColumnSpace(n[l+1],!0),P=this.nodeMinColumnSpace(n[l+1],!1),M=p-x+b,L=y-k+P;let C=0,S=0,N=0,T=0,A=0,D=0,F=0,R,v=0,O,B=0;const X=n[l].sourceEdges.iterator;if(e&&s<=0)for(;X.next();){const q=X.value;R=q.fromVertex,q.valid&&R.layer!==t&&(N=this.linkStraightenWeight(q),T=q.portFromColOffset,A=q.portToColOffset,D=R.column,C+=(Math.abs(p+A-(D+T))+1)*N,S+=(Math.abs(L+A-(D+T))+1)*N)}for(X.reset();X.next();){const q=X.value;if(R=q.fromVertex,q.valid&&R.layer===t){for(v=0;v<n.length&&n[v]!==R;)v++;v<l&&(m+=2*(l-v),g+=2*(l+1-v)),v===l+1&&(m+=1),v>l+1&&(m+=4*(v-l),g+=4*(v-(l+1)))}}const E=n[l].destinationEdges.iterator;if(e&&s>=0)for(;E.next();){const q=E.value;O=q.toVertex,q.valid&&O.layer!==t&&(N=this.linkStraightenWeight(q),T=q.portFromColOffset,A=q.portToColOffset,F=O.column,C+=(Math.abs(p+T-(F+A))+1)*N,S+=(Math.abs(L+T-(F+A))+1)*N)}for(E.reset();E.next();){const q=E.value;if(O=q.toVertex,q.valid&&O.layer===t){for(B=0;B<n.length&&n[B]!==O;)B++;B===l+1&&(g+=1)}}const V=n[l+1].sourceEdges.iterator;if(e&&s<=0)for(;V.next();){const q=V.value;R=q.fromVertex,q.valid&&R.layer!==t&&(N=this.linkStraightenWeight(q),T=q.portFromColOffset,A=q.portToColOffset,D=R.column,C+=(Math.abs(y+A-(D+T))+1)*N,S+=(Math.abs(M+A-(D+T))+1)*N)}for(V.reset();V.next();){const q=V.value;if(R=q.fromVertex,q.valid&&R.layer===t){for(v=0;v<n.length&&n[v]!==R;)v++;v<l&&(m+=2*(l+1-v),g+=2*(l-v)),v===l&&(g+=1),v>l+1&&(m+=4*(v-(l+1)),g+=4*(v-l))}}const U=n[l+1].destinationEdges.iterator;if(e&&s>=0)for(;U.next();){const q=U.value;O=q.toVertex,q.valid&&O.layer!==t&&(N=this.linkStraightenWeight(q),T=q.portFromColOffset,A=q.portToColOffset,F=O.column,C+=(Math.abs(y+T-(F+A))+1)*N,S+=(Math.abs(M+T-(F+A))+1)*N)}for(U.reset();U.next();){const q=U.value;if(O=q.toVertex,q.valid&&O.layer===t){for(B=0;B<n.length&&n[B]!==O;)B++;B===l&&(m+=1)}}let Y=0,G=0;const H=h[n[l].index],J=a[n[l].index],z=h[n[l+1].index],W=a[n[l+1].index];if(H!==-1&&(Y+=Math.abs(H-p),G+=Math.abs(H-L)),J!==-1&&(Y+=Math.abs(J-p),G+=Math.abs(J-L)),z!==-1&&(Y+=Math.abs(z-y),G+=Math.abs(z-M)),W!==-1&&(Y+=Math.abs(W-y),G+=Math.abs(W-M)),g<m-.5||g===m&&d<u-.5||g===m&&d===u&&S<C-.5||g===m&&d===u&&S===C&&G<Y-.5){c=!0,f=!0,n[l].column=L,n[l+1].column=M;const q=n[l];n[l]=n[l+1],n[l+1]=q}}for(l=0;l<o;l++)n[l].index=l;return this.Rh(t,n),c}straightenAndPack(){if(this.vn!==0){this.cI();return}let t=0,i=!1,e=(this.sr&1)!==0;const s=(this.sr&8)!==0;if(this.network.edges.count>1e3&&s&&(e=!1),e){const n=[];let o=0;for(o=0;o<=this.Mt;o++)n[o]=0;let r=0;const l=this.network.vertexes.iterator;for(;l.next();){const a=l.value;t=a.layer,r=a.column;const c=this.nodeMinColumnSpace(a,!1);n[t]=Math.max(n[t],r+c)}const h=8;for(l.reset();l.next();){const a=l.value;t=a.layer,r=a.column,a.column=((this.Yt-n[t])*h>>1)+r*h}this.Yt*=h}if(this.sr&2){i=!0;let n=0;for(;i&&n<this.$f;){for(i=!1,t=this.Ms+1;t<=this.Mt;t++)i=this.Dg(t,1)||i;for(t=this.Ms-1;t>=0;t--)i=this.Dg(t,-1)||i;i=this.Dg(this.Ms,0)||i,n++}}if(this.sr&4){for(t=this.Ms+1;t<=this.Mt;t++)this.UN(t,1);for(t=this.Ms-1;t>=0;t--)this.UN(t,-1);this.UN(this.Ms,0)}if(e&&(this.aD(-1),this.aD(1)),this.sr&2){i=!0;let n=0;for(;i&&n<this.$f;){for(i=!1,i=this.Dg(this.Ms,0)||i,t=this.Ms+1;t<=this.Mt;t++)i=this.Dg(t,0)||i;for(t=this.Ms-1;t>=0;t--)i=this.Dg(t,0)||i;n++}}}Dg(t,i){let e=!1;for(;this.fI(t,i);)e=!0;return e}fI(t,i){let e=0;const s=this.Fh(t),n=this.ui[t],o=this.Yy(t,-1);if(i>0)for(e=0;e<n;e++)o[e]=-1;const r=this.Yy(t,1);if(i<0)for(e=0;e<n;e++)r[e]=-1;let l=!1,h=!0;for(;h;)for(h=!1,e=0;e<n;e++){const a=s[e].column,c=this.nodeMinColumnSpace(s[e],!0),f=this.nodeMinColumnSpace(s[e],!1);let u=0;e-1<0||a-s[e-1].column-1>c+this.nodeMinColumnSpace(s[e-1],!1)?u=a-1:u=a;let d=0;e+1>=n||s[e+1].column-a-1>f+this.nodeMinColumnSpace(s[e+1],!0)?d=a+1:d=a;let m=0,g=0,p=0,y=0,x=0,k=0;if(i<=0){const S=s[e].sourceEdges.iterator;for(;S.next();){const N=S.value,T=N.fromVertex;if(N.valid&&T.layer!==t){y=this.linkStraightenWeight(N),x=N.portFromColOffset,k=N.portToColOffset;const A=T.column;m+=(Math.abs(a+k-(A+x))+1)*y,g+=(Math.abs(u+k-(A+x))+1)*y,p+=(Math.abs(d+k-(A+x))+1)*y}}}if(i>=0){const S=s[e].destinationEdges.iterator;for(;S.next();){const N=S.value,T=N.toVertex;if(N.valid&&T.layer!==t){y=this.linkStraightenWeight(N),x=N.portFromColOffset,k=N.portToColOffset;const A=T.column;m+=(Math.abs(a+x-(A+k))+1)*y,g+=(Math.abs(u+x-(A+k))+1)*y,p+=(Math.abs(d+x-(A+k))+1)*y}}}let b=0,P=0,M=0;const L=o[s[e].index],C=r[s[e].index];L!==-1&&(b+=Math.abs(L-a),P+=Math.abs(L-u),M+=Math.abs(L-d)),C!==-1&&(b+=Math.abs(C-a),P+=Math.abs(C-u),M+=Math.abs(C-d)),g<m||g===m&&P<b?(l=!0,h=!0,s[e].column=u):(p<m||p===m&&M<b)&&(l=!0,h=!0,s[e].column=d)}return this.Rh(t,s),this.Ky(),l}UN(t,i){let e=0;const s=this.Fh(t),n=this.ui[t],o=this.QT(t,i),r=[];for(e=0;e<n;e++)r[e]=o[e];let l=!1,h=!0;for(;h;)for(h=!1,e=0;e<n;e++){const a=s[e].column,c=this.nodeMinColumnSpace(s[e],!0),f=this.nodeMinColumnSpace(s[e],!1);let u=0,d=0,m=0,g=0,p=0;r[e]===-1?e===0&&e===n-1?u=a:e===0?(d=s[e+1].column,d-a===f+this.nodeMinColumnSpace(s[e+1],!0)?u=a-1:u=a):e===n-1?(m=s[e-1].column,a-m===c+this.nodeMinColumnSpace(s[e-1],!1)?u=a+1:u=a):(m=s[e-1].column,p=m+this.nodeMinColumnSpace(s[e-1],!1)+c+1,d=s[e+1].column,g=d-this.nodeMinColumnSpace(s[e+1],!0)-f-1,u=(p+g)/2|0):e===0&&e===n-1?u=r[e]:e===0?(d=s[e+1].column,g=d-this.nodeMinColumnSpace(s[e+1],!0)-f-1,u=Math.min(r[e],g)):e===n-1?(m=s[e-1].column,p=m+this.nodeMinColumnSpace(s[e-1],!1)+c+1,u=Math.max(r[e],p)):(m=s[e-1].column,p=m+this.nodeMinColumnSpace(s[e-1],!1)+c+1,d=s[e+1].column,g=d-this.nodeMinColumnSpace(s[e+1],!0)-f-1,p<r[e]&&r[e]<g?u=r[e]:p>=r[e]?u=p:g<=r[e]&&(u=g)),u!==a&&(l=!0,h=!0,s[e].column=u)}return this.Rh(t,s),this.Ky(),l}uI(){for(let t=0;t<=this.Yt;t++)for(;this.dI(t,1););this.Ky()}dI(t,i){let e=!0;const s=this.network.vertexes.iterator;for(;s.next();){const o=s.value,r=this.nodeMinColumnSpace(o,!0),l=this.nodeMinColumnSpace(o,!1);if(o.column-r<=t&&o.column+l>=t){e=!1;break}}let n=!1;if(e){if(i>0)for(s.reset();s.next();){const o=s.value;o.column>t&&(o.column-=1,n=!0)}if(i<0)for(s.reset();s.next();){const o=s.value;o.column<t&&(o.column+=1,n=!0)}}return n}gI(){this.uI();for(let t=0;t<this.Yt;t++)for(;this.mI(t,1););this.Ky()}mI(t,i){let e=t;i>0&&(e=t+1),i<0&&(e=t-1);let s=0;const n=[],o=[];for(s=0;s<=this.Mt;s++)n[s]=!1,o[s]=!1;const r=this.network.vertexes.iterator;for(;r.next();){const a=r.value,c=a.column-this.nodeMinColumnSpace(a,!0),f=a.column+this.nodeMinColumnSpace(a,!1);c<=t&&f>=t&&(n[a.layer]=!0),c<=e&&f>=e&&(o[a.layer]=!0)}let l=!0,h=!1;for(s=0;s<=this.Mt;s++)l=l&&!(n[s]&&o[s]);if(l){if(i>0)for(r.reset();r.next();){const a=r.value;a.column>t&&(a.column-=1,h=!0)}if(i<0)for(r.reset();r.next();){const a=r.value;a.column<t&&(a.column+=1,h=!0)}}return h}aD(t){this.gI();let i=0,e,s=0,n=0,o=0;if(t>0)for(i=0;i<=this.Yt;i++)for(e=this.$i(),s=this.Z1(!0),n=s+1;s<n;)n=s,this.cD(i,1),o=this.Z1(!0),o>s?this.Qe(e):o<s&&(s=o,e=this.$i());if(t<0)for(i=this.Yt;i>=0;i--)for(e=this.$i(),s=this.Z1(!0),n=s+1;s<n;)n=s,this.cD(i,-1),o=this.Z1(!0),o>s?this.Qe(e):o<s&&(s=o,e=this.$i());this.Ky()}cD(t,i){this._s=0;const e=this.network.vertexes.iterator;for(;e.next();){const c=e.value;c.component=-1}if(i>0)for(e.reset();e.next();){const c=e.value;c.column-this.nodeMinColumnSpace(c,!0)<=t&&(c.component=this._s)}if(i<0)for(e.reset();e.next();){const c=e.value;c.column+this.nodeMinColumnSpace(c,!1)>=t&&(c.component=this._s)}for(this._s++,e.reset();e.next();){const c=e.value;c.component===-1&&(this.EN(c,this._s,-1,!0,!0),this._s++)}let s=0;const n=[];for(s=0;s<this._s*this._s;s++)n[s]=!1;const o=[];for(s=0;s<(this.Mt+1)*(this.Yt+1);s++)o[s]=-1;for(e.reset();e.next();){const c=e.value,f=c.layer,u=Math.max(0,c.column-this.nodeMinColumnSpace(c,!0)),d=Math.min(this.Yt,c.column+this.nodeMinColumnSpace(c,!1));for(let m=u;m<=d;m++)o[f*(this.Yt+1)+m]=c.component}for(let c=0;c<=this.Mt;c++){if(i>0)for(let f=0;f<this.Yt;f++)o[c*(this.Yt+1)+f]!==-1&&o[c*(this.Yt+1)+f+1]!==-1&&o[c*(this.Yt+1)+f]!==o[c*(this.Yt+1)+f+1]&&(n[o[c*(this.Yt+1)+f]*this._s+o[c*(this.Yt+1)+f+1]]=!0);if(i<0)for(let f=this.Yt;f>0;f--)o[c*(this.Yt+1)+f]!==-1&&o[c*(this.Yt+1)+f-1]!==-1&&o[c*(this.Yt+1)+f]!==o[c*(this.Yt+1)+f-1]&&(n[o[c*(this.Yt+1)+f]*this._s+o[c*(this.Yt+1)+f-1]]=!0)}const r=[];for(s=0;s<this._s;s++)r[s]=!0;const l=[];l.push(0);let h=0;for(;l.length!==0;)if(h=l[l.length-1],l.pop(),r[h])for(r[h]=!1,s=0;s<this._s;s++)n[h*this._s+s]&&l.splice(0,0,s);let a=!1;if(i>0)for(e.reset();e.next();){const c=e.value;r[c.component]&&(c.column-=1,a=!0)}if(i<0)for(e.reset();e.next();){const c=e.value;r[c.component]&&(c.column+=1,a=!0)}return a}cI(){const t=Util.nt(),i=this.Zf.length;for(let u=0;u<=i;u++)t[u]=[];const e=this.network.vertexes.iterator;for(;e.next();){const u=e.value,d=i-u.layer,m=t[d];m[u.index]=u}const s=new GSet;this.pI(t,s);let n=null,o=null,r=null,l=null;const h=(this.vn&1)!==0,a=(this.vn&2)!==0,c=(this.vn&4)!==0,f=(this.vn&8)!==0;h&&(this.el(t,s,!0),n=this.ik(t,!0,!1)),t.reverse(),c&&(this.el(t,s,!1),r=this.ik(t,!1,!1));for(const u of t)u.reverse();f&&(this.el(t,s,!1),l=this.ik(t,!1,!0)),t.reverse(),a&&(this.el(t,s,!0),o=this.ik(t,!0,!0)),Util.tt(t),this.yI(n,o,r,l),this.network.vertexes.each(u=>{const d=u,m=Util.nt();h&&m.push(n.get(d)),a&&m.push(o.get(d)),c&&m.push(r.get(d)),f&&m.push(l.get(d)),m.sort((k,b)=>k-b);const g=m.length,p=Math.floor((g-1)/2),y=Math.ceil((g-1)/2),x=(m[p]+m[y])/2;Util.tt(m),d.he=x})}pI(t,i){const e=t.length;for(let s=1;s<e-1;s++){let n=0,o=0;const r=t[s],l=t[s+1];for(let h=0;o<l.length;h++){const a=l[h],c=this.wI(a);if(h===l.length-1||c){let f=r.length-1;for(c&&(f=a.getProperSourceVertexes()[0].index);o<=h;){const d=l[o].getProperSourceEdges();for(const m of d){const p=m.fromVertex.index;(p<n||p>f)&&i.add(m)}o++}n=f}}}}wI(t){if(t.node===null){const i=t.getProperSourceVertexes();if(i.length>0)return i[0].node===null}return!1}el(t,i,e){this.xI(t);for(const s of t){let n=-1;for(const o of s){const r=e?o.getProperSourceVertexes():o.getProperDestinationVertexes(),l=r.length;if(l>0){r.sort((a,c)=>a.vh-c.vh);const h=(l-1)/2;for(let a=Math.floor(h),c=Math.ceil(h);a<=c;a++)if(o.On===o){const f=r[a];let u;e?u=f.getDestinationEdge(o):u=o.getDestinationEdge(f),!i.has(u)&&n<f.vh&&(f.On=o,o.Qa=f.Qa,o.On=f.Qa,n=f.vh)}}}}}xI(t){for(let i=0;i<t.length;i++){const e=t[i];for(let s=0;s<e.length;s++){const n=e[s];n.Qa=n,n.On=n,n.fD=i,n.vh=s}}}ik(t,i,e){const s=this.S===90||this.S===270;for(const o of t)for(const r of o)r._e=r,r._f=1/0,r.he=NaN,r.In=0;this.bI(t,i,e);for(const o of t)for(const r of o)r.Qa===r&&this.uD(r,t);for(let o=0;o<t.length;o++){if(t[o].length<=0)continue;const r=t[o][0];if(r._e===r){r._e._f===1/0&&(r._e._f=0);let l=o,h=0,a;do{for(a=t[l][h];a.On!==a.Qa;)if(a=a.On,l++,a.vh>0){const c=this.dD(a,t),f=s?c.width:c.height,u=a._e._f+a.he+a.In-(c.he+c.In+f+this.columnSpacing);c._e._f=Math.min(c._e._f,u)}h=a.vh+1}while(l<t.length&&h<t[l].length&&a._e===t[l][h]._e)}}const n=new GMap;for(const o of t)for(const r of o){r.he=r.he+r._e._f+r.In;const l=s?r.width:r.height;n.set(r,e?-r.he-l:r.he)}return n}bI(t,i,e){const s=this.S===90||this.S===270;for(const n of t)for(const o of n)if(o.Qa===o){let r=0,l=o;for(;l.On!==o;){const h=l.On,a=s?l.width:l.height,c=s?h.width:h.height;let f,u,d,m;i?(d=l.getDestinationEdge(h),f=d.portFromPos,u=d.portToPos,d.link!==null&&(l.node&&l.node!==d.link.fromNode&&(f=s?l.focusX:l.focusY),h.node&&h.node!==d.link.toNode&&(u=s?h.focusX:h.focusY)),e?m=l.In+(a-f)-(c-u):m=l.In+f-u):(d=h.getDestinationEdge(l),f=d.portToPos,u=d.portFromPos,d.link!==null&&(l.node&&l.node!==d.link.toNode&&(f=s?l.focusX:l.focusY),h.node&&h.node!==d.link.fromNode&&(u=s?h.focusX:h.focusY)),e?m=l.In+(a-f)-(c-u):m=l.In+f-u),h.In=m,r=Math.min(r,m),l=l.On}l=o;do l.In=l.In-r,l=l.On;while(l!==o)}}uD(t,i){if(!isNaN(t.he))return;t.he=0;let e=t;do{if(e.vh>0){const s=this.dD(e,i),n=s.Qa;this.uD(n,i),t._e===t&&(t._e=n._e);const o=this.S===90||this.S===270?s.width:s.height;if(t._e===n._e){const r=n.he+s.In+o-e.In+this.columnSpacing;t.he=Math.max(t.he,r)}}e=e.On}while(e!==t);for(;e.On!==t;)e=e.On,e.he=t.he,e._e=t._e}dD(t,i){const e=t.fD,s=t.vh;return s<1&&Util.o("Could not determine previous vertex in layer"),i[e][s-1]}yI(...t){let i=-1;const e=Util.nt(),s=Util.nt();let n=1/0;for(let o=0;o<4;o++){if(!t[o])continue;const r=this.kI(t[o],e,s,o);r<n&&(i=o,n=r)}for(let o=0;o<4;o++){const r=t[o];if(!r)continue;const l=o===0||o===2?e[i]-e[o]:s[i]-s[o];l!==0&&r.each(h=>{r.set(h.key,h.value+l)})}Util.tt(e),Util.tt(s)}kI(t,i,e,s){if(!t||t.count===0)return i[s]=0,e[s]=0,1/0;let n=1/0,o=-1/0;return t.each(r=>{const l=r.key,h=r.value,a=this.S===90||this.S===270?l.width:l.height;h<n&&(n=h),h+a>o&&(o=h+a)}),i[s]=n,e[s]=o,o-n}commitLayout(){this.zy(),this.commitNodes(),this.VN(),this.isRouting&&this.commitLinks()}zy(){if(!this.setsPortSpots)return;const t=this._1(!0),i=this._1(!1),e=this.network.edges.iterator;for(;e.next();){const n=e.value.link;n!==null&&(n.fromSpot=t,n.toSpot=i)}}_1(t){return this.S===270?t?Spot.MiddleTop:Spot.MiddleBottom:this.S===90?t?Spot.MiddleBottom:Spot.MiddleTop:this.S===180?t?Spot.MiddleLeft:Spot.MiddleRight:t?Spot.MiddleRight:Spot.MiddleLeft}commitNodes(){this.Qs=[],this.Ss=[],this.Ns=[],this.Ut=[];for(let d=0;d<=this.Mt;d++)this.Qs[d]=0,this.Ss[d]=0,this.Ns[d]=0,this.Ut[d]=0;const t=this.network.vertexes.iterator;for(;t.next();){const d=t.value,m=d.layer;this.Qs[m]=Math.max(this.Qs[m],this.nodeMinLayerSpace(d,!0)),this.Ss[m]=Math.max(this.Ss[m],this.nodeMinLayerSpace(d,!1))}let i=0;const e=this.Ps;for(let d=0;d<=this.Mt;d++){let m=e;this.Qs[d]+this.Ss[d]<=0&&(m=0),d>0&&(i+=m/2),this.S===90||this.S===0?(i+=this.Ss[d],this.Ns[d]=i,i+=this.Qs[d]):(i+=this.Qs[d],this.Ns[d]=i,i+=this.Ss[d]),d<this.Mt&&(i+=m/2),this.Ut[d]=i}const s=i,n=this.arrangementOrigin;for(let d=0;d<=this.Mt;d++)this.S===270?this.Ns[d]=n.y+this.Ns[d]:this.S===90?(this.Ns[d]=n.y+s-this.Ns[d],this.Ut[d]=s-this.Ut[d]):this.S===180?this.Ns[d]=n.x+this.Ns[d]:(this.Ns[d]=n.x+s-this.Ns[d],this.Ut[d]=s-this.Ut[d]);const o=this.vn!==0;t.reset();const r=this.S===270||this.S===90;let l=1/0,h=1/0,a=1/0,c=-1/0;for(;t.next();){const d=t.value,m=d.layer,g=d.column|0;let p=0,y=0;r?(p=n.x+this.Ji*g,y=this.Ns[m]):(p=this.Ns[m],y=n.y+this.Ji*g),d.centerX=p,d.centerY=y,o&&isFinite(d.he)&&(r?d.node?d.x=n.x+d.he:d.centerX=n.x+d.he:d.node?d.y=n.y+d.he:d.centerY=n.y+d.he),l=Math.min(d.x,l),h=Math.min(d.y,h),r?(a=l,c=Math.max(c,d.bounds.right)):(a=h,c=Math.max(c,d.bounds.bottom))}this.IN=c-a;const f=n.x-l,u=n.y-h;for(this.nr=new Point(o&&r?0:f,o&&!r?0:u),t.reset();t.next();){const d=t.value;d.x+=f,d.y+=u,d.commit()}}VN(){let t=0;const i=this.Ps;for(let n=0;n<=this.Mt;n++)t+=this.Qs[n],t+=this.Ss[n];t+=this.Mt*i;const e=[],s=this.vn!==0?this.IN:this.Ji*this.Yt;for(let n=this.maxLayer;n>=0;n--)this.S===270?n===0?e.push(new Rect(0,0,s,Math.abs(this.Ut[0]))):e.push(new Rect(0,this.Ut[n-1],s,Math.abs(this.Ut[n-1]-this.Ut[n]))):this.S===90?n===0?e.push(new Rect(0,this.Ut[0],s,Math.abs(this.Ut[0]-t))):e.push(new Rect(0,this.Ut[n],s,Math.abs(this.Ut[n-1]-this.Ut[n]))):this.S===180?n===0?e.push(new Rect(0,0,Math.abs(this.Ut[0]),s)):e.push(new Rect(this.Ut[n-1],0,Math.abs(this.Ut[n-1]-this.Ut[n]),s)):n===0?e.push(new Rect(this.Ut[0],0,Math.abs(this.Ut[0]-t),s)):e.push(new Rect(this.Ut[n],0,Math.abs(this.Ut[n-1]-this.Ut[n]),s));this.commitLayers(e,this.nr)}commitLayers(t,i){}commitLinks(){const t=this.network.edges.iterator;let i;for(;t.next();)i=t.value.link,i!==null&&(i.startRoute(),i.clearPoints(),i.commitRoute());for(t.reset();t.next();)i=t.value.link,i!==null&&i.updateRoute();for(t.reset();t.next();){const e=t.value;if(i=e.link,i===null||i.pointsCount===0)continue;i.startRoute();const s=i;let n=s.fromNode,o=s.toNode,r=s.fromPort,l=s.toPort;if(n!==null){const N=n.findVisibleNode();N!==null&&N!==n&&(n=N,r=N.port)}if(o!==null){const N=o.findVisibleNode();N!==null&&N!==o&&(o=N,l=N.port)}const h=i.computeSpot(!0,r),a=i.computeSpot(!1,l);let c=e.fromVertex,f=e.toVertex;if(e.valid){if(i.curve===9&&i.pointsCount===4)if(c.column===f.column&&this.alignOption===0){const N=i.getLinkPoint(n,r,h,!0,!1,o,l),T=i.getLinkPoint(o,l,a,!1,!1,n,r);N.isReal()||N.set(n.actualBounds.center),T.isReal()||T.set(o.actualBounds.center),i.clearPoints(),i.addPointAt(N.x,N.y),i.addPointAt((2*N.x+T.x)/3,(2*N.y+T.y)/3),i.addPointAt((N.x+2*T.x)/3,(N.y+2*T.y)/3),i.addPointAt(T.x,T.y)}else{let N=!1,T=!1;if(r!==null&&h===Spot.None&&(N=!0),l!==null&&a===Spot.None&&(T=!0),N||T){let A=null;N&&(A=i.getLinkPointFromPoint(n,r,r.getDocumentPoint(Spot.Center),i.getPoint(3),!0),A.isReal()||A.set(n.actualBounds.center),i.setPointAt(0,A.x,A.y));let D=null;if(T&&(D=i.getLinkPointFromPoint(o,l,l.getDocumentPoint(Spot.Center),i.getPoint(0),!1),D.isReal()||D.set(o.actualBounds.center),i.setPointAt(3,D.x,D.y)),A){const F=i.getPoint(2);i.setPointAt(1,(A.x*2+F.x)/3,(A.y*2+F.y)/3)}if(D){const F=i.getPoint(1);i.setPointAt(2,(D.x*2+F.x)/3,(D.y*2+F.y)/3)}}}i.commitRoute();continue}if(c.layer===f.layer){i.commitRoute();continue}let u=!1,d=!1;const m=this.Ps;let g=0,p=i.firstPickIndex+1;if(i.isOrthogonal)d=!0,g=i.pointsCount,g>4&&i.points.removeRange(2,g-3);else if(i.curve===9)u=!0,g=i.pointsCount,g>4&&i.points.removeRange(2,g-3),g===4&&(p=2);else{g=i.pointsCount;const N=h===Spot.None,T=a===Spot.None;g>2&&N&&T?i.points.removeRange(1,g-2):g>3&&N&&!T?i.points.removeRange(1,g-3):g>3&&!N&&T?i.points.removeRange(2,g-2):g>4&&!N&&!T&&i.points.removeRange(2,g-3)}let y,x,k=0,b=0,P=0,M=0,L=0,C=0,S=0;if(e.rev){let N=0;for(;f!==null&&c!==f;){y=null,x=null;const T=f.sourceEdges.iterator;for(;T.next();){const A=T.value;if(A.link===e.link&&(y=A.fromVertex,x=A.toVertex,y.node===null))break}if(y===null)break;if(y!==c)if(k=i.getPoint(p-1).x,b=i.getPoint(p-1).y,P=y.centerX,M=y.centerY,d)this.S===180||this.S===0?p===i.firstPickIndex+1?(i.insertPointAt(p++,k,b),i.insertPointAt(p++,k,M)):(x!==null?x.centerY:b)!==M&&(L=this.Ut[y.layer-1]+this.nr.x,i.insertPointAt(p++,L,b),i.insertPointAt(p++,L,M)):p===i.firstPickIndex+1?(i.insertPointAt(p++,k,b),i.insertPointAt(p++,P,b)):(x!==null?x.centerX:k)!==P&&(L=this.Ut[y.layer-1]+this.nr.y,i.insertPointAt(p++,k,L),i.insertPointAt(p++,P,L));else if(p===i.firstPickIndex+1)if(C=Math.max(10,this.Qs[f.layer]),S=Math.max(10,this.Ss[f.layer]),u)this.S===180?P<=f.bounds.x?(N=f.bounds.x,i.insertPointAt(p++,N-C,M),i.insertPointAt(p++,N,M),i.insertPointAt(p++,N+S,M)):(i.insertPointAt(p++,P-C,M),i.insertPointAt(p++,P,M),i.insertPointAt(p++,P+S,M)):this.S===90?M>=f.bounds.bottom?(N=f.bounds.y+f.bounds.height,i.insertPointAt(p++,P,N+S),i.insertPointAt(p++,P,N),i.insertPointAt(p++,P,N-C)):(i.insertPointAt(p++,P,M+S),i.insertPointAt(p++,P,M),i.insertPointAt(p++,P,M-C)):this.S===270?M<=f.bounds.y?(N=f.bounds.y,i.insertPointAt(p++,P,N-C),i.insertPointAt(p++,P,N),i.insertPointAt(p++,P,N+S)):(i.insertPointAt(p++,P,M-C),i.insertPointAt(p++,P,M),i.insertPointAt(p++,P,M+S)):this.S===0&&(P>=f.bounds.right?(N=f.bounds.x+f.bounds.width,i.insertPointAt(p++,N+S,M),i.insertPointAt(p++,N,M),i.insertPointAt(p++,N-C,M)):(i.insertPointAt(p++,P+S,M),i.insertPointAt(p++,P,M),i.insertPointAt(p++,P-C,M)));else{i.insertPointAt(p++,k,b);let A=0;this.S===180||this.S===0?((this.S===180?P>=f.bounds.right:P<=f.bounds.x)&&(A=(this.S===0?-C:S)/2),i.insertPointAt(p++,k+A,M)):((this.S===270?M>=f.bounds.bottom:M<=f.bounds.y)&&(A=(this.S===90?-C:S)/2),i.insertPointAt(p++,P,b+A)),i.insertPointAt(p++,P,M)}else C=Math.max(10,this.Qs[y.layer]),S=Math.max(10,this.Ss[y.layer]),u?this.S===180?(i.insertPointAt(p++,P-C-m,M),i.insertPointAt(p++,Math.min(P-C+m/2,P),M),i.insertPointAt(p++,P,M),i.insertPointAt(p++,P,M),i.insertPointAt(p++,Math.max(P+S-m/2,P),M),i.insertPointAt(p++,P+S+m,M)):this.S===90?(i.insertPointAt(p++,P,M+S+m),i.insertPointAt(p++,P,Math.max(M+S-m/2,M)),i.insertPointAt(p++,P,M),i.insertPointAt(p++,P,M),i.insertPointAt(p++,P,Math.min(M-C+m/2,M)),i.insertPointAt(p++,P,M-C-m)):this.S===270?(i.insertPointAt(p++,P,M-C-m),i.insertPointAt(p++,P,Math.min(M-C+m/2,M)),i.insertPointAt(p++,P,M),i.insertPointAt(p++,P,M),i.insertPointAt(p++,P,Math.max(M+S-m/2,M)),i.insertPointAt(p++,P,M+S+m)):(i.insertPointAt(p++,P+S+m,M),i.insertPointAt(p++,Math.max(P+S-m/2,P),M),i.insertPointAt(p++,P,M),i.insertPointAt(p++,P,M),i.insertPointAt(p++,Math.min(P-C+m/2,P),M),i.insertPointAt(p++,P-C-m,M)):(this.S===180||this.S===90||this.S,i.insertPointAt(p++,P,M));f=y}if(l===null||h!==Spot.None||d)if(k=i.getPoint(p-1).x,b=i.getPoint(p-1).y,P=i.getPoint(p).x,M=i.getPoint(p).y,d){const T=this.Ss[c.layer];let A=0;this.S===180||this.S===0?(A=b,A>=c.bounds.y&&A<=c.bounds.bottom&&(this.S===180?P>=c.bounds.x:P<=c.bounds.right)&&(N=c.centerX+(this.S===180?-T:T),A<c.bounds.y+c.bounds.height/2?A=c.bounds.y-this.Ji/2:A=c.bounds.bottom+this.Ji/2,i.insertPointAt(p++,N,b),i.insertPointAt(p++,N,A)),i.insertPointAt(p++,P,A),i.insertPointAt(p++,P,M)):(A=k,A>=c.bounds.x&&A<=c.bounds.right&&(this.S===270?M>=c.bounds.y:M<=c.bounds.bottom)&&(N=c.centerY+(this.S===270?-T:T),A<c.bounds.x+c.bounds.width/2?A=c.bounds.x-this.Ji/2:A=c.bounds.right+this.Ji/2,i.insertPointAt(p++,k,N),i.insertPointAt(p++,A,N)),i.insertPointAt(p++,A,M),i.insertPointAt(p++,P,M))}else if(u)C=Math.max(10,this.Qs[c.layer]),S=Math.max(10,this.Ss[c.layer]),this.S===180&&P>=c.bounds.x?(N=c.bounds.x+c.bounds.width,i.setPointAt(p-2,N,b),i.setPointAt(p-1,N+S,b)):this.S===90&&M<=c.bounds.bottom?(N=c.bounds.y,i.setPointAt(p-2,k,N),i.setPointAt(p-1,k,N-C)):this.S===270&&M>=c.bounds.y?(N=c.bounds.y+c.bounds.height,i.setPointAt(p-2,k,N),i.setPointAt(p-1,k,N+S)):this.S===0&&P<=c.bounds.right&&(N=c.bounds.x,i.setPointAt(p-2,N,b),i.setPointAt(p-1,N-C,b));else{C=Math.max(10,this.Qs[c.layer]),S=Math.max(10,this.Ss[c.layer]);let T=0;this.S===180||this.S===0?((this.S===180?P<=c.bounds.x:P>=c.bounds.right)&&(T=(this.S===0?S:-C)/2),i.insertPointAt(p++,P+T,b)):((this.S===270?M<=c.bounds.y:M>=c.bounds.bottom)&&(T=(this.S===90?S:-C)/2),i.insertPointAt(p++,k,M+T)),i.insertPointAt(p++,P,M)}}else{for(;c!==null&&c!==f;){y=null,x=null;const N=c.destinationEdges.iterator;for(;N.next();){const T=N.value;if(T.link===e.link&&(y=T.toVertex,x=T.fromVertex,x.node!==null&&(x=null),y.node===null))break}if(y===null)break;y!==f&&(k=i.getPoint(p-1).x,b=i.getPoint(p-1).y,P=y.centerX,M=y.centerY,d?this.S===180||this.S===0?(x!==null?x.centerY:b)!==M&&(L=this.Ut[y.layer]+this.nr.x,p===i.firstPickIndex+1&&(this.S===0?L=Math.max(L,k):L=Math.min(L,k)),i.insertPointAt(p++,L,b),i.insertPointAt(p++,L,M)):(x!==null?x.centerX:k)!==P&&(L=this.Ut[y.layer]+this.nr.y,p===i.firstPickIndex+1&&(this.S===90?L=Math.max(L,b):L=Math.min(L,b)),i.insertPointAt(p++,k,L),i.insertPointAt(p++,P,L)):(C=Math.max(10,this.Qs[y.layer]),S=Math.max(10,this.Ss[y.layer]),u?this.S===180?(i.insertPointAt(p++,P+S+m,M),i.insertPointAt(p++,Math.max(P+S-m/2,P),M),i.insertPointAt(p++,P,M),i.insertPointAt(p++,P,M),i.insertPointAt(p++,Math.min(P-C+m/2,P),M),i.insertPointAt(p++,P-C-m,M)):this.S===90?(i.insertPointAt(p++,P,M-C-m),i.insertPointAt(p++,P,Math.min(M-C+m/2,M)),i.insertPointAt(p++,P,M),i.insertPointAt(p++,P,M),i.insertPointAt(p++,P,Math.max(M+S-m/2,M)),i.insertPointAt(p++,P,M+S+m)):this.S===270?(i.insertPointAt(p++,P,M+S+m),i.insertPointAt(p++,P,Math.max(M+S-m/2,M)),i.insertPointAt(p++,P,M),i.insertPointAt(p++,P,M),i.insertPointAt(p++,P,Math.min(M-C+m/2,M)),i.insertPointAt(p++,P,M-C-m)):(i.insertPointAt(p++,P-C-m,M),i.insertPointAt(p++,Math.min(P-C+m/2,P),M),i.insertPointAt(p++,P,M),i.insertPointAt(p++,P,M),i.insertPointAt(p++,Math.max(P+S-m/2,P),M),i.insertPointAt(p++,P+S+m,M)):this.S===180?(i.insertPointAt(p++,P+S,M),i.insertPointAt(p++,P-C,M)):this.S===90?(i.insertPointAt(p++,P,M-C),i.insertPointAt(p++,P,M+S)):this.S===270?(i.insertPointAt(p++,P,M+S),i.insertPointAt(p++,P,M-C)):(i.insertPointAt(p++,P-C,M),i.insertPointAt(p++,P+S,M)))),c=y}d&&(k=i.getPoint(p-1).x,b=i.getPoint(p-1).y,P=i.getPoint(p).x,M=i.getPoint(p).y,this.S===180||this.S===0?b!==M&&(this.S===0?L=Math.min(Math.max((P+k)/2,this.Ut[f.layer]+this.nr.x),P):L=Math.max(Math.min((P+k)/2,this.Ut[f.layer]+this.nr.x),P),i.insertPointAt(p++,L,b),i.insertPointAt(p++,L,M)):k!==P&&(this.S===90?L=Math.min(Math.max((M+b)/2,this.Ut[f.layer]+this.nr.y),M):L=Math.max(Math.min((M+b)/2,this.Ut[f.layer]+this.nr.y),M),i.insertPointAt(p++,k,L),i.insertPointAt(p++,P,L)))}if(s!==null&&u&&i.pointsCount>=4){if(r!==null){const N=h===Spot.None?i.getLinkPointFromPoint(n,r,r.getDocumentPoint(Spot.Center),i.getPoint(3),!0):i.getPoint(0);if(h===Spot.None){const T=i.getPoint(2),A=i.getPoint(3);this.direction===90||this.direction===270?(i.setPointAt(1,(N.x+T.x)/2,T.y),i.setPointAt(2,A.x,(T.y+A.y)/2)):(i.setPointAt(1,T.x,(N.y+T.y)/2),i.setPointAt(2,(T.x+A.x)/2,A.y))}N.isReal()||N.set(n.actualBounds.center),i.setPointAt(0,N.x,N.y)}if(l!==null){const N=a===Spot.None?i.getLinkPointFromPoint(o,l,l.getDocumentPoint(Spot.Center),i.getPoint(i.pointsCount-4),!1):i.getPoint(i.pointsCount-1);if(a===Spot.None){const T=i.getPoint(i.pointsCount-3),A=i.getPoint(i.pointsCount-4);this.direction===90||this.direction===270?(i.setPointAt(i.pointsCount-2,(N.x+T.x)/2,T.y),i.setPointAt(i.pointsCount-2,A.x,(T.y+A.y)/2)):(i.setPointAt(i.pointsCount-2,T.x,(N.y+T.y)/2),i.setPointAt(i.pointsCount-3,(T.x+A.x)/2,A.y))}N.isReal()||N.set(o.actualBounds.center),i.setPointAt(i.pointsCount-1,N.x,N.y)}}i.commitRoute(),e.commit()}}GO(){this.Xy=-1,this.Lg=0,this.Ms=0,this.Za=null,this.Tg=null,this.Zf=null;for(let t=0;t<this.Rn.length;t++)this.Rn[t]=null}Fh(t){let i;const e=this.ui[t];if(e>=this.Rn.length){const n=[];for(let o=0;o<this.Rn.length;o++)n[o]=this.Rn[o];this.Rn=n}this.Rn[e]===void 0||this.Rn[e]===null?i=[]:(i=this.Rn[e],this.Rn[e]=null);const s=this.Zf[t];for(let n=0;n<s.length;n++){const o=s[n];i[o.index]=o}return i}Rh(t,i){this.Rn[this.ui[t]]=i}get layerSpacing(){return this.Ps}set layerSpacing(t){this.Ps!==t&&(Util.i(t,"number",LayeredDigraphLayout,"layerSpacing"),t>=0&&(this.Ps=t,this.invalidateLayout()))}get columnSpacing(){return this.Ji}set columnSpacing(t){this.Ji!==t&&(Util.i(t,"number",LayeredDigraphLayout,"columnSpacing"),t>0&&(this.Ji=t,this.invalidateLayout()))}get direction(){return this.S}set direction(t){this.S!==t&&(Util.i(t,"number",LayeredDigraphLayout,"direction"),t===0||t===90||t===180||t===270?(this.S=t,this.invalidateLayout()):Util.o("LayeredDigraphLayout.direction must be 0, 90, 180, or 270"))}get cycleRemoveOption(){return this.Hf}set cycleRemoveOption(t){this.Hf!==t&&(t===1||t===0||t===2)&&(this.Hf=t,this.invalidateLayout())}get layeringOption(){return this.qf}set layeringOption(t){this.qf!==t&&(t===10||t===11||t===12)&&(this.qf=t,this.invalidateLayout())}get initializeOption(){return this.Wf}set initializeOption(t){this.Wf!==t&&(t===20||t===21||t===22)&&(this.Wf=t,this.invalidateLayout())}get iterations(){return this.$a}set iterations(t){this.$a!==t&&t>=0&&(this.$a=t,this.invalidateLayout())}get aggressiveOption(){return this.Jf}set aggressiveOption(t){this.Jf!==t&&(t===30||t===31||t===32)&&(this.Jf=t,this.invalidateLayout())}get packOption(){return this.sr}set packOption(t){this.sr!==t&&(Util.i(t,"number",LayeredDigraphLayout,"packOption"),t>=0&&t<8&&(this.sr=t,this.invalidateLayout()))}get packIterations(){return this.$f}set packIterations(t){this.$f=t}get alignOption(){return this.vn}set alignOption(t){this.vn!==t&&(Util.i(t,"number",LayeredDigraphLayout,"align"),t>=0&&t<16&&(this.vn=t,this.invalidateLayout()))}get setsPortSpots(){return this.Fn}set setsPortSpots(t){this.Fn!==t&&(Util.i(t,"boolean",LayeredDigraphLayout,"setsPortSpots"),this.Fn=t,this.invalidateLayout())}get maxLayer(){return this.Mt}get maxIndex(){return this.Xy}get maxColumn(){return this.Yt}get minIndexLayer(){return this.Lg}get maxIndexLayer(){return this.Ms}static CycleDepthFirst=0;static CycleGreedy=1;static CycleFromLayers=2;static LayerOptimalLinkLength=10;static LayerLongestPathSink=11;static LayerLongestPathSource=12;static InitDepthFirstOut=20;static InitDepthFirstIn=21;static InitNaive=22;static AggressiveNone=30;static AggressiveLess=31;static AggressiveMore=32;static PackNone=0;static PackExpand=1;static PackStraighten=2;static PackMedian=4;static PackAll=15;static AlignNone=0;static AlignUpperLeft=1;static AlignUpperRight=2;static AlignLowerLeft=4;static AlignLowerRight=8;static AlignAll=15}class LayeredDigraphNetwork extends LayoutNetwork{constructor(t){super(t)}createVertex(){return new LayeredDigraphVertex(this)}createEdge(){return new LayeredDigraphEdge(this)}}class LayeredDigraphVertex extends LayoutVertex{qo;Bo;Dt;ek;sk;Zi;Qf;jn;Q1;J1;$1;Qa;On;fD;vh;_e;_f;he;In;jy=null;Hy=null;qy=null;Wy=null;constructor(t){super(t),this.qo=-1,this.Bo=-1,this.Dt=-1,this.ek=NaN,this.sk=null,this.Zi=!1,this.Qf=NaN,this.jn=NaN,this.Q1=0,this.J1=null,this.$1=null}static gD(t,i){return t.index-i.index}getProperSourceEdges(){if(!this.qy){const t=[];for(const i of this.po){const e=i;e.valid&&t.push(e)}this.qy=t}return this.qy}getProperDestinationEdges(){if(!this.Wy){const t=[];for(const i of this.tr){const e=i;e.valid&&t.push(e)}this.Wy=t}return this.Wy}getDestinationEdge(t){const i=this.getProperDestinationEdges();for(const e of i)if(e.toVertex===t)return e;Util.o("Unable to find destination edge to given vertex")}getProperSourceVertexes(){if(!this.jy){const t=[];for(const i of this.po){const e=i;!e.valid||e.fromVertex.layer<=e.toVertex.layer||t.push(e.fromVertex)}t.sort(LayeredDigraphVertex.gD),this.jy=t}return this.jy}getProperDestinationVertexes(){if(!this.Hy){const t=[];for(const i of this.tr){const e=i;!e.valid||e.fromVertex.layer<=e.toVertex.layer||t.push(e.toVertex)}t.sort(LayeredDigraphVertex.gD),this.Hy=t}return this.Hy}addSourceEdge(t){super.addSourceEdge(t),this.jy=null,this.qy=null}deleteSourceEdge(t){super.deleteSourceEdge(t),this.jy=null,this.qy=null}addDestinationEdge(t){super.addDestinationEdge(t),this.Hy=null,this.Wy=null}deleteDestinationEdge(t){super.deleteDestinationEdge(t),this.Hy=null,this.Wy=null}get layer(){return this.qo}set layer(t){this.qo!==t&&(Util.i(t,"number",LayeredDigraphVertex,"layer"),this.qo=t)}get column(){return this.Bo}set column(t){this.Bo!==t&&(Util.i(t,"number",LayeredDigraphVertex,"column"),this.Bo=t)}get index(){return this.Dt}set index(t){this.Dt!==t&&(Util.i(t,"number",LayeredDigraphVertex,"index"),this.Dt=t)}get component(){return this.ek}set component(t){this.ek!==t&&(Util.i(t,"number",LayeredDigraphVertex,"component"),this.ek=t)}get near(){return this.sk}set near(t){this.sk!==t&&(this.sk=t)}}class LayeredDigraphEdge extends LayoutEdge{Zi;nk;ok;rk;lk;hk;ak;constructor(t){super(t),this.Zi=!1,this.nk=!1,this.ok=!1,this.rk=NaN,this.lk=NaN,this.hk=0,this.ak=0}get fromVertex(){return this.Je}set fromVertex(t){this.Je!==t&&(this.Je=t)}get toVertex(){return this.$e}set toVertex(t){this.$e!==t&&(this.$e=t)}get valid(){return this.Zi}set valid(t){this.Zi!==t&&(Util.i(t,"boolean",LayeredDigraphEdge,"valid"),this.Zi=t)}get rev(){return this.nk}set rev(t){this.nk!==t&&(Util.i(t,"boolean",LayeredDigraphEdge,"rev"),this.nk=t)}get forest(){return this.ok}set forest(t){this.ok!==t&&(Util.i(t,"boolean",LayeredDigraphEdge,"forest"),this.ok=t)}get portFromPos(){return this.rk}set portFromPos(t){this.rk!==t&&(Util.i(t,"number",LayeredDigraphEdge,"portFromPos"),this.rk=t)}get portToPos(){return this.lk}set portToPos(t){this.lk!==t&&(Util.i(t,"number",LayeredDigraphEdge,"portToPos"),this.lk=t)}get portFromColOffset(){return this.hk}set portFromColOffset(t){this.hk!==t&&(Util.i(t,"number",LayeredDigraphEdge,"portFromColOffset"),this.hk=t)}get portToColOffset(){return this.ak}set portToColOffset(t){this.ak!==t&&(Util.i(t,"number",LayeredDigraphEdge,"portToColOffset"),this.ak=t)}}var TreePath=(w=>(w[w.Default=0]="Default",w[w.Destination=1]="Destination",w[w.Source=2]="Source",w))(TreePath||{}),TreeSorting=(w=>(w[w.Forwards=10]="Forwards",w[w.Reverse=11]="Reverse",w[w.Ascending=12]="Ascending",w[w.Descending=13]="Descending",w))(TreeSorting||{}),TreeAlignment=(w=>(w[w.CenterSubtrees=20]="CenterSubtrees",w[w.CenterChildren=21]="CenterChildren",w[w.Start=22]="Start",w[w.End=23]="End",w[w.Bus=24]="Bus",w[w.BusBranching=25]="BusBranching",w[w.TopLeftBus=26]="TopLeftBus",w[w.BottomRightBus=27]="BottomRightBus",w[w.Custom=28]="Custom",w))(TreeAlignment||{}),TreeCompaction=(w=>(w[w.None=30]="None",w[w.Block=31]="Block",w))(TreeCompaction||{}),TreeStyle=(w=>(w[w.Layered=40]="Layered",w[w.LastParents=41]="LastParents",w[w.Alternating=42]="Alternating",w[w.RootOnly=43]="RootOnly",w))(TreeStyle||{}),TreeArrangement=(w=>(w[w.Vertical=50]="Vertical",w[w.Horizontal=51]="Horizontal",w[w.FixedRoots=52]="FixedRoots",w))(TreeArrangement||{}),TreeLayerStyle=(w=>(w[w.Individual=60]="Individual",w[w.Siblings=61]="Siblings",w[w.Uniform=62]="Uniform",w))(TreeLayerStyle||{});class TreeLayout extends Layout{Ri;Ti;tu;Fg;zN;Re;Ki;ks;V;z;ck;hs;constructor(t){super(),this.Ri=new GSet,this.Ti=0,this.hs=1,this.tu=40,this.Fg=60,this.zN=[],this.Re=!0,this.Ki=50,this.ks=new Size(10,10).g();const i=new TreeNetwork(this);this.V=new TreeVertex(i),this.z=new TreeVertex(i),this.ck=[],t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Ti=this.Ti,t.tu=this.tu,t.Fg=this.Fg,t.Re=this.Re,t.Ki=this.Ki,t.ks.a(this.ks),t.V.copyInheritedPropertiesFrom(this.V),t.z.copyInheritedPropertiesFrom(this.z)}li(t){t in TreeAlignment?this.alignment=t:t in TreeArrangement?this.arrangement=t:t in TreeCompaction?this.compaction=t:t in TreePath?this.path=t:t in TreeSorting?this.sorting=t:t in TreeStyle?this.treeStyle=t:super.li(t)}createNetwork(){return new TreeNetwork(this)}makeNetwork(t){const i=this.createNetwork(),e=s=>{if(s instanceof Node)return!s.isLinkLabel&&s.category!=="Comment";if(s instanceof Link){const n=s.fromNode;if(n===null||n.isLinkLabel||n.category==="Comment")return!1;const o=s.toNode;return!(o===null||o.isLinkLabel||o.category==="Comment")}return!1};return t instanceof Diagram?(i.addParts(t.nodes,!0,e),i.addParts(t.links,!0,e)):t instanceof Group?i.addParts(t.memberParts,!1,e):i.addParts(t.iterator,!1,e),i}doLayout(t){this.network===null&&(this.network=this.makeNetwork(t)),this.arrangement!==52&&(this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin));let i=this.diagram;i===null&&t instanceof Diagram&&(i=t),this.path===0&&i!==null?this.hs=i.isTreePathToChildren?1:2:this.hs=this.path===0?1:this.path,this.network.vertexes.count>0&&(this.LI(),this.AI(),this.TI(),this.DI(),this.vN(),this.FI(),this.arrangeTrees(),this.updateParts()),this.network=null,this.Ri=new GSet,this.isValidLayout=!0}LI(){this.network.deleteSelfEdges();const t=this.network.vertexes.iterator;for(;t.next();){const n=t.value;n.initialized=!1,n.level=0,n.parent=null,n.children=[]}if(this.Ri.count>0){const n=new GSet,o=this.Ri.iterator;for(;o.next();){const r=o.value;if(r instanceof Node){const l=this.network.findVertex(r);l!==null&&n.add(l)}else r instanceof TreeVertex&&n.add(r)}this.Ri=n}this.Ri.count===0&&this.findRoots();const i=this.Ri.copy().iterator;for(;i.next();){const n=i.value;n.initialized||(n.initialized=!0,this.XN(n))}let e=this.network.vertexes,s=null;for(;s=this.RI(e),s.count>0;){const n=this.mD(s);n!==null&&this.Ri.add(n),n.initialized=!0,this.XN(n),e=s}}RI(t){const i=new GSet,e=t.iterator;for(;e.next();){const s=e.value;s.initialized||i.add(s)}return i}findRoots(){const t=this.network.vertexes,i=t.iterator;for(;i.next();){const e=i.value;switch(this.hs){case 1:e.sourceEdges.count===0&&this.Ri.add(e);break;case 2:e.destinationEdges.count===0&&this.Ri.add(e);break;default:Util.o("Unhandled path value "+this.hs.toString())}}if(this.Ri.count===0){const e=this.mD(t);e!==null&&this.Ri.add(e)}}mD(t){let i=999999,e=null;const s=t.iterator;for(;s.next();){const n=s.value;switch(this.hs){case 1:n.sourceEdges.count<i&&(i=n.sourceEdges.count,e=n);break;case 2:n.destinationEdges.count<i&&(i=n.destinationEdges.count,e=n);break;default:Util.o("Unhandled path value "+this.hs.toString())}}return e}XN(t){if(t===null)return;switch(this.hs){case 1:if(t.destinationEdges.count>0){const s=new List,n=t.destinationVertexes;for(;n.next();){const o=n.value;this.pD(t,o)&&s.add(o)}s.count>0&&(t.children=s.toArray())}break;case 2:if(t.sourceEdges.count>0){const s=new List,n=t.sourceVertexes;for(;n.next();){const o=n.value;this.pD(t,o)&&s.add(o)}s.count>0&&(t.children=s.toArray())}break;default:Util.o("Unhandled path value"+this.hs.toString())}const i=t.children,e=i.length;for(let s=0;s<e;s++){const n=i[s];n.initialized=!0,n.level=t.level+1,n.parent=t,this.Ri.delete(n)}for(let s=0;s<e;s++){const n=i[s];this.XN(n)}}pD(t,i){return i.initialized?this.vI(i,t)||i.level>t.level?!1:(this.OI(i.parent,i),!0):!0}vI(t,i){if(i===null)return!1;let e=i.parent;for(;e!==null&&e!==t;)e=e.parent;return e===t}OI(t,i){if(t===null||i===null)return;const e=t.children;let s=0;for(let n=0;n<e.length;n++)e[n]===i&&s++;if(s>0){const n=new Array(e.length-s);let o=0;for(let r=0;r<e.length;r++)e[r]!==i&&(n[o++]=e[r]);t.children=n}}AI(){const t=this.Ri.iterator;for(;t.next();){const i=t.value;i instanceof TreeVertex&&this.yD(i)}}yD(t){if(t===null)return;this.initializeTreeVertexValues(t),t.alignment===25&&this.sortTreeVertexChildren(t);let i=0,e=t.childrenCount,s=0;const n=t.children,o=n.length;for(let r=0;r<o;r++){const l=n[r];this.yD(l),i+=l.descendantCount+1,e=Math.max(e,l.maxChildrenCount),s=Math.max(s,l.maxGenerationCount)}t.descendantCount=i,t.maxChildrenCount=e,t.maxGenerationCount=e>0?s+1:0}II(t){switch(this.tu){default:case 40:return t.parent!==null?t.parent:this.V;case 43:return t.parent===null?this.V:t.parent.parent===null?this.z:t.parent;case 42:return t.parent!==null?t.parent.parent!==null?t.parent.parent:this.z:this.V;case 41:{let i=!0;if(t.childrenCount===0)i=!1;else{const e=t.children,s=e.length;for(let n=0;n<s;n++)if(e[n].childrenCount>0){i=!1;break}}return i&&t.parent!==null?this.z:t.parent!==null?t.parent:this.V}}}initializeTreeVertexValues(t){const i=this.II(t);if(t.copyInheritedPropertiesFrom(i),t.parent!==null&&t.parent.alignment===25){let e=t.angle;const s=t.parent.children;let n=0;for(;n<s.length&&t!==s[n];)n++;n%2===0?n!==s.length-1&&(e===90?e=180:e===180?e=270:e===270?e=180:e=270):e===90?e=0:e===180?e=90:e===270?e=0:e=90,t.angle=e}t.initialized=!0}TI(){const t=this.Ri.iterator;for(;t.next();){const i=t.value;i instanceof TreeVertex&&this.wD(i)}}wD(t){if(t===null)return;this.assignTreeVertexValues(t);const i=t.children,e=i.length;for(let s=0;s<e;s++){const n=i[s];this.wD(n)}}assignTreeVertexValues(t){}DI(){const t=this.Ri.iterator;for(;t.next();){const i=t.value;i instanceof TreeVertex&&this.xD(i)}}xD(t){if(t===null)return;t.alignment!==25&&this.sortTreeVertexChildren(t);const i=t.children,e=i.length;for(let s=0;s<e;s++){const n=i[s];this.xD(n)}}sortTreeVertexChildren(t){switch(t.sorting){default:case 10:break;case 11:t.children.reverse();break;case 12:t.children.sort(t.comparer);break;case 13:t.children.sort(t.comparer),t.children.reverse();break}}vN(){if(!this.comments)return;const t=this.network.vertexes.iterator;for(;t.next();){const i=t.value;this.addComments(i)}}addComments(t){const i=t.angle,e=t.parent;let s=0,n=21,o=!1;e!==null&&(s=e.angle,n=e.alignment,o=this.isBusAlignment(n));const r=i===90||i===270,l=s===90||s===270,h=t.childrenCount===0;let a=0,c=0,f=0;const u=t.commentSpacing;if(t.node!==null){const d=t.node.findNodesConnected();for(;d.next();){const m=d.value;if(m.category!=="Comment"||!m.canLayout())continue;t.comments===null&&(t.comments=[]),t.comments.push(m),m.ensureBounds();const g=m.measuredBounds;r&&!h||!o&&!l&&h||o&&l&&h?(a=Math.max(a,g.width),c+=g.height+Math.abs(f)):(a+=g.width+Math.abs(f),c=Math.max(c,g.height)),f=u}}if(t.comments!==null){r&&!h||!o&&!l&&h||o&&l&&h?(a+=Math.abs(t.commentMargin),c=Math.max(0,c-t.height)):(c+=Math.abs(t.commentMargin),a=Math.max(0,a-t.width));const d=Rect.X(0,0,t.bounds.width+a,t.bounds.height+c);t.bounds=d,Rect.s(d)}}isBusAlignment(t){return t===24||t===25||t===26||t===27}Jy(t){return t===24||t===25}KN(t){const i=t.parent;if(i!==null){const e=i.alignment;if(this.isBusAlignment(e))if(this.Jy(e)){const s=i.children;let n=0;for(;n<s.length&&t!==s[n];)n++;return n%2===0}else return e===26}return!1}layoutComments(t){if(t.comments!==null){const e=t.node.measuredBounds,s=t.parent,n=t.angle;let o=0,r=21,l=!1;s!==null&&(o=s.angle,r=s.alignment,l=this.isBusAlignment(r));const h=n===90||n===270,a=o===90||o===270,c=t.childrenCount===0,f=this.KN(t);let u=0;const d=t.comments,m=d.length,g=Point.l();for(let y=0;y<m;y++){const x=d[y],k=x.measuredBounds;if(h&&!c||!l&&!a&&c||l&&a&&c){if(o>135&&!l||a&&f)if(t.commentMargin>=0){g.e(t.bounds.x-t.commentMargin-k.width,t.bounds.y+u),x.move(g);const b=x.findLinksInto();for(;b.next();){const P=b.value;P.fromSpot=Spot.MiddleLeft,P.toSpot=Spot.MiddleRight}}else{g.e(t.bounds.x+t.focus.x*2-t.commentMargin,t.bounds.y+u),x.move(g);const b=x.findLinksInto();for(;b.next();){const P=b.value;P.fromSpot=Spot.MiddleRight,P.toSpot=Spot.MiddleLeft}}else if(t.commentMargin>=0){g.e(t.bounds.x+t.focus.x*2+t.commentMargin,t.bounds.y+u),x.move(g);const b=x.findLinksInto();for(;b.next();){const P=b.value;P.fromSpot=Spot.MiddleRight,P.toSpot=Spot.MiddleLeft}}else{g.e(t.bounds.x+t.commentMargin-k.width,t.bounds.y+u),x.move(g);const b=x.findLinksInto();for(;b.next();){const P=b.value;P.fromSpot=Spot.MiddleLeft,P.toSpot=Spot.MiddleRight}}t.commentSpacing>=0?u+=k.height+t.commentSpacing:u+=t.commentSpacing-k.height}else{if(o>135&&!l||!a&&f)if(t.commentMargin>=0){g.e(t.bounds.x+u,t.bounds.y-t.commentMargin-k.height),x.move(g);const b=x.findLinksInto();for(;b.next();){const P=b.value;P.fromSpot=Spot.MiddleTop,P.toSpot=Spot.MiddleBottom}}else{g.e(t.bounds.x+u,t.bounds.y+t.focus.y*2-t.commentMargin),x.move(g);const b=x.findLinksInto();for(;b.next();){const P=b.value;P.fromSpot=Spot.MiddleBottom,P.toSpot=Spot.MiddleTop}}else if(t.commentMargin>=0){g.e(t.bounds.x+u,t.bounds.y+t.focus.y*2+t.commentMargin),x.move(g);const b=x.findLinksInto();for(;b.next();){const P=b.value;P.fromSpot=Spot.MiddleBottom,P.toSpot=Spot.MiddleTop}}else{g.e(t.bounds.x+u,t.bounds.y+t.commentMargin-k.height),x.move(g);const b=x.findLinksInto();for(;b.next();){const P=b.value;P.fromSpot=Spot.MiddleTop,P.toSpot=Spot.MiddleBottom}}t.commentSpacing>=0?u+=k.width+t.commentSpacing:u+=t.commentSpacing-k.width}}Point.s(g);const p=u-t.commentSpacing-(h?e.height:e.width);if(this.hs===1){const y=t.destinationEdges;for(;y.next();){const k=y.value.link;k!==null&&!k.isAvoiding&&(k.fromEndSegmentLength=p>0?p:NaN)}}else{const y=t.sourceEdges;for(;y.next();){const k=y.value.link;k!==null&&!k.isAvoiding&&(k.toEndSegmentLength=p>0?p:NaN)}}}}FI(){if(this.layerStyle===62){const i=[];let e=this.network.vertexes.iterator;for(;e.next();){const s=e.value;let n=s.parent;n===null&&(n=s);const o=n.angle===0||n.angle===180;let r=i[s.level];r===void 0&&(r=0),i[s.level]=Math.max(r,o?s.width:s.height)}for(let s=0;s<i.length;s++)i[s]===void 0&&(i[s]=0);for(this.zN=i,e=this.network.vertexes.iterator;e.next();){const s=e.value;let n=s.parent;n===null&&(n=s),n.angle===0||n.angle===180?(n.angle===180&&(s.focusX+=i[s.level]-s.width),s.width=i[s.level]):(n.angle===270&&(s.focusY+=i[s.level]-s.height),s.height=i[s.level])}}else if(this.layerStyle===61){const i=this.network.vertexes.iterator;for(;i.next();){const e=i.value,s=e.angle===0||e.angle===180;let n=-1;for(let o=0;o<e.children.length;o++){const r=e.children[o];n=Math.max(n,s?r.width:r.height)}if(n>=0)for(let o=0;o<e.children.length;o++){const r=e.children[o];s?(e.angle===180&&(r.focusX+=n-r.width),r.width=n):(e.angle===270&&(r.focusY+=n-r.height),r.height=n)}}}const t=this.Ri.iterator;for(;t.next();){const i=t.value;i instanceof TreeVertex&&this.layoutTree(i)}}layoutTree(t){if(t===null)return;const i=t.children,e=i.length;for(let s=0;s<e;s++){const n=i[s];this.layoutTree(n)}switch(t.compaction){case 30:this.bD(t);break;default:case 31:t.alignment===25?this.bD(t):this.EI(t);break}}bD(t){if(t.childrenCount===0){let R=!1,v=0,O=21;t.parent!==null&&(v=t.parent.angle,O=t.parent.alignment,R=this.isBusAlignment(O));const B=this.KN(t);t.B.e(0,0),t.mt.e(t.width,t.height),t.parent!==null&&t.comments!==null&&((v===180||v===270)&&!R||B)?v===180&&!R||(v===90||v===270)&&B?t.ft.e(t.width-t.focus.x*2,0):t.ft.e(0,t.height-t.focus.y*2):t.ft.e(0,0);return}const i=this.orthoAngle(t),e=i===90||i===270;let s=0;const n=t.children,o=n.length;for(let R=0;R<o;R++){const v=n[R];s=Math.max(s,e?v.mt.width:v.mt.height)}const r=t.alignment,l=r===22,h=r===23,a=this.isBusAlignment(r),c=Math.max(0,t.breadthLimit),f=this.computeLayerSpacing(t),u=t.nodeSpacing,d=this.computeNodeIndent(t),m=l||h?0:d/2,g=t.rowSpacing;let p=0;(l||h)&&(p=Math.max(0,t.rowIndent));const y=t.width,x=t.height;let k=0,b=0,P=0,M=0,L=0,C=0,S=0,N=0,T=0,A=0;if(a&&!this.Jy(r)&&i>135&&n.reverse(),this.Jy(r))if(o>1)for(let R=0;R<o;R++){const v=n[R],O=v.mt;R%2===0&&R!==o-1?T=Math.max(T,(e?O.width:O.height)+this.computeBusNodeSpacing(v)-u):R%2!==0&&(A=Math.max(A,(e?O.width:O.height)+this.computeBusNodeSpacing(v)-u))}else o===1&&(T=e?n[0].mt.width:n[0].mt.height);if(a)switch(r){case 24:case 25:let R;i<135?R=this.kD(t,n,T,A,k,b):R=this.PD(t,n,T,A,k,b),T=R.x,k=R.width,b=R.height;break;case 26:for(let v=0;v<o;v++){const O=n[v],B=O.mt,X=S===0?0:g;e?(O.B.e(s-B.width,L+X),k=Math.max(k,B.width),b=Math.max(b,L+X+B.height),L+=X+B.height):(O.B.e(M+X,s-B.height),k=Math.max(k,M+X+B.width),b=Math.max(b,B.height),M+=X+B.width),S++}break;case 27:for(let v=0;v<o;v++){const O=n[v],B=O.mt,X=S===0?0:g;e?(O.B.e(u/2+t.focus.x,L+X),k=Math.max(k,B.width),b=Math.max(b,L+X+B.height),L+=X+B.height):(O.B.e(M+X,u/2+t.focus.y),k=Math.max(k,M+X+B.width),b=Math.max(b,B.height),M+=X+B.width),S++}break}else for(let R=0;R<o;R++){const v=n[R],O=v.mt;if(e){c>0&&S>0&&M+u+O.width>c&&(M<s&&this._a(t,r,s-M,0,N,R-1),C++,S=0,N=R,P=b,M=0,L=i>135?-b-g:b+g);const B=S===0?m:u;this.fk(v,0,L),v.B.e(M+B,L),k=Math.max(k,M+B+O.width),b=Math.max(b,P+(C===0?0:g)+O.height),M+=B+O.width}else{c>0&&S>0&&L+u+O.height>c&&(L<s&&this._a(t,r,0,s-L,N,R-1),C++,S=0,N=R,P=k,L=0,M=i>135?-k-g:k+g);const B=S===0?m:u;this.fk(v,M,0),v.B.e(M,L+B),b=Math.max(b,L+B+O.height),k=Math.max(k,P+(C===0?0:g)+O.width),L+=B+O.height}S++}C>0&&(e?(b+=Math.max(0,f),M<k&&this._a(t,r,k-M,0,N,o-1),p>0&&(h||this.iu(t,p,0,0,o-1),k+=p)):(k+=Math.max(0,f),L<b&&this._a(t,r,0,b-L,N,o-1),p>0&&(h||this.iu(t,0,p,0,o-1),b+=p)));let D=0,F=0;switch(r){case 20:e?D+=k/2-t.focus.x-d/2:F+=b/2-t.focus.y-d/2;break;default:case 21:if(C>0)e?D+=k/2-t.focus.x-d/2:F+=b/2-t.focus.y-d/2;else{const v=o;if(e){const O=n[0].B.x+n[0].ft.x,B=n[v-1].B.x+n[v-1].ft.x+n[v-1].focus.x*2;D+=O+(B-O)/2-t.focus.x-d/2}else{const O=n[0].B.y+n[0].ft.y,B=n[v-1].B.y+n[v-1].ft.y+n[v-1].focus.y*2;F+=O+(B-O)/2-t.focus.y-d/2}}break;case 22:e?(D-=d,k+=d):(F-=d,b+=d);break;case 23:e?(D+=k-t.width+d,k+=d):(F+=b-t.height+d,b+=d);break;case 24:case 25:e?o>1?D+=T+u/2-t.focus.x:D+=n[0].focus.x-t.focus.x+n[0].ft.x:o>1?F+=T+u/2-t.focus.y:F+=n[0].focus.y-t.focus.y+n[0].ft.y;break;case 26:e?D+=k+u/2-t.focus.x:F+=b+u/2-t.focus.y;break;case 27:break;case 28:const R=this.customAlignment(t,D,F,k,b);D=R[0],F=R[1],k=R[2],b=R[3];break}for(let R=0;R<o;R++){const v=n[R];e?v.B.e(v.B.x+v.ft.x-D,v.B.y+(i>135?(a?-b:-v.mt.height)+v.ft.y-f:x+f+v.ft.y)):v.B.e(v.B.x+(i>135?(a?-k:-v.mt.width)+v.ft.x-f:y+f+v.ft.x),v.B.y+v.ft.y-F)}e?(k=this.YN(t,k,D),D<0&&(D=0),i>135&&(F+=b+f),b=Math.max(Math.max(b,x),b+x+f)):(i>135&&(D+=k+f),k=Math.max(Math.max(k,y),k+y+f),b=this.GN(t,b,F),F<0&&(F=0)),t.ft.e(D,F),t.mt.e(k,b)}customAlignment(t,i,e,s,n){return[i,e,s,n]}kD(t,i,e,s,n,o){const r=i.length;if(r===0)return new Rect(e,0,n,o);if(r===1){const p=i[0];return n=p.mt.width,o=p.mt.height,new Rect(e,0,n,o)}const l=t.nodeSpacing,h=t.rowSpacing,c=this.orthoAngle(t)===90;let f=0,u=0,d=0;for(let p=0;p<r;p++){if(p%2!==0||r>1&&p===r-1)continue;const y=i[p],x=y.mt,k=f===0?0:h;if(c){const b=this.computeBusNodeSpacing(y)-l;y.B.e(e-(x.width+b),d+k),n=Math.max(n,x.width+b),o=Math.max(o,d+k+x.height),d+=k+x.height}else{const b=this.computeBusNodeSpacing(y)-l;y.B.e(u+k,e-(x.height+b)),o=Math.max(o,x.height+b),n=Math.max(n,u+k+x.width),u+=k+x.width}f++}f=0;const m=u,g=d;c?(u=e+l,d=0):(u=0,d=e+l);for(let p=0;p<r;p++){if(p%2===0)continue;const y=i[p],x=y.mt,k=f===0?0:h;if(c){const b=this.computeBusNodeSpacing(y)-l;y.B.e(u+b,d+k),n=Math.max(n,u+x.width+b),o=Math.max(o,d+k+x.height),d+=k+x.height}else{const b=this.computeBusNodeSpacing(y)-l;y.B.e(u+k,d+b),n=Math.max(n,u+k+x.width),o=Math.max(o,d+x.height+b),u+=k+x.width}f++}if(r>1&&r%2===1){const p=i[r-1],y=p.mt,x=this.computeBusLastRowSpacing(p,c?Math.max(Math.abs(g),Math.abs(d)):Math.max(Math.abs(m),Math.abs(u)));if(c){p.B.e(e+l/2-p.focus.x-p.ft.x,o+x);const k=e+l/2-p.focus.x-p.ft.x;n=Math.max(n,k+y.width),k<0&&(n-=k),o=Math.max(o,Math.max(g,d)+x+y.height),p.B.x<0&&(e=this.uk(t,p.B.x,!1,e,l))}else{p.B.e(n+x,e+l/2-p.focus.y-p.ft.y),n=Math.max(n,Math.max(m,u)+x+y.width);const k=e+l/2-p.focus.y-p.ft.y;o=Math.max(o,k+y.height),k<0&&(o-=k),p.B.y<0&&(e=this.uk(t,p.B.y,!0,e,l))}}return new Rect(e,0,n,o)}PD(t,i,e,s,n,o){const r=i.length;if(r===0)return new Rect(e,0,n,o);if(r===1){const p=i[0];return n=p.mt.width,o=p.mt.height,new Rect(e,0,n,o)}const l=t.nodeSpacing,h=t.rowSpacing,c=this.orthoAngle(t)===270;let f=0,u=0,d=0;for(let p=0;p<r;p++){if(p%2!==0||r>1&&p===r-1)continue;const y=i[p],x=y.mt,k=f===0?0:h;if(c){const b=this.computeBusNodeSpacing(y)-l;d-=k+x.height,y.B.e(e-(x.width+b),d),n=Math.max(n,x.width+b),o=Math.max(o,Math.abs(d))}else{const b=this.computeBusNodeSpacing(y)-l;u-=k+x.width,y.B.e(u,e-(x.height+b)),o=Math.max(o,x.height+b),n=Math.max(n,Math.abs(u))}f++}f=0;const m=u,g=d;c?(u=e+l,d=0):(u=0,d=e+l);for(let p=0;p<r;p++){if(p%2===0)continue;const y=i[p],x=y.mt,k=f===0?0:h;if(c){const b=this.computeBusNodeSpacing(y)-l;d-=k+x.height,y.B.e(u+b,d),n=Math.max(n,u+x.width+b),o=Math.max(o,Math.abs(d))}else{const b=this.computeBusNodeSpacing(y)-l;u-=k+x.width,y.B.e(u,d+b),o=Math.max(o,d+x.height+b),n=Math.max(n,Math.abs(u))}f++}if(r>1&&r%2===1){const p=i[r-1],y=p.mt,x=this.computeBusLastRowSpacing(p,c?Math.max(Math.abs(g),Math.abs(d)):Math.max(Math.abs(m),Math.abs(u)));if(c){p.B.e(e+l/2-p.focus.x-p.ft.x,-o-y.height-x);const k=e+l/2-p.focus.x-p.ft.x;n=Math.max(n,k+y.width),k<0&&(n-=k),o=Math.max(o,Math.abs(Math.min(g,d))+x+y.height),p.B.x<0&&(e=this.uk(t,p.B.x,!1,e,l))}else{p.B.e(-n-y.width-x,e+l/2-p.focus.y-p.ft.y),n=Math.max(n,Math.abs(Math.min(m,u))+x+y.width);const k=e+l/2-p.focus.y-p.ft.y;o=Math.max(o,k+y.height),k<0&&(o-=k),p.B.y<0&&(e=this.uk(t,p.B.y,!0,e,l))}}for(let p=0;p<r;p++){const y=i[p];c?y.B.e(y.B.x,y.B.y+o):y.B.e(y.B.x+n,y.B.y)}return new Rect(e,0,n,o)}computeBusNodeSpacing(t){return t.parent===null?0:t.parent.nodeSpacing}computeBusLastRowSpacing(t,i){return t.parent===null?0:t.parent.rowSpacing}uk(t,i,e,s,n){const o=t.children,r=o.length;for(let h=0;h<r;h++)e?o[h].B.e(o[h].B.x,o[h].B.y-i):o[h].B.e(o[h].B.x-i,o[h].B.y);const l=o[r-1];return Math.max(s,e?l.ft.y+l.focus.y-n/2:l.ft.x+l.focus.x-n/2)}YN(t,i,e){switch(t.alignment){case 21:case 20:let s=i;return e+t.width>s&&(s=e+t.width),e<0&&(s-=e),s;case 22:return t.width>i?t.width:i;case 23:return t.focus.x*2>i?t.width:i+t.width-t.focus.x*2;case 24:case 25:const n=Math.min(0,e),o=Math.max(i,e+t.width);return Math.max(t.width,o-n);case 26:return t.width-t.focus.x+t.nodeSpacing/2+i;case 27:return Math.max(t.width,t.focus.x+t.nodeSpacing/2+i);default:return i}}GN(t,i,e){switch(t.alignment){case 21:case 20:let s=i;return e+t.height>s&&(s=e+t.height),e<0&&(s-=e),s;case 22:return t.height>i?t.height:i;case 23:return t.focus.y*2>i?t.height:i+t.height-t.focus.y*2;case 24:case 25:const n=Math.min(0,e),o=Math.max(i,e+t.height);return Math.max(t.height,o-n);case 26:return t.height-t.focus.y+t.nodeSpacing/2+i;case 27:return Math.max(t.height,t.focus.y+t.nodeSpacing/2+i);default:return i}}jN(t,i,e){switch(t){case 20:i/=2,e/=2;break;case 21:i/=2,e/=2;break;case 22:i=0,e=0;break;case 23:break;default:Util.o("Unhandled alignment value "+t.toString())}return new Point(i,e)}_a(t,i,e,s,n,o){const r=this.jN(i,e,s);this.iu(t,r.x,r.y,n,o)}iu(t,i,e,s,n){if(i===0&&e===0)return;const o=t.children;for(let r=s;r<=n;r++){const h=o[r].B;h.x+=i,h.y+=e}}fk(t,i,e){const s=t.parent;switch(this.hs){case 1:{const n=t.sourceEdges;for(;n.next();){const o=n.value;o.fromVertex===s&&o.relativePoint.e(i,e)}break}case 2:{const n=t.destinationEdges;for(;n.next();){const o=n.value;o.toVertex===s&&o.relativePoint.e(i,e)}break}default:Util.o("Unhandled path value "+this.hs.toString())}}EI(t){if(t.childrenCount===0){const U=t.parent;let Y=!1,G=0,H=21;U!==null&&(G=U.angle,H=U.alignment,Y=this.isBusAlignment(H));const J=this.KN(t);t.B.e(0,0),t.mt.e(t.width,t.height),t.parent!==null&&t.comments!==null&&((G===180||G===270)&&!Y||J)?G===180&&!Y||(G===90||G===270)&&J?t.ft.e(t.width-t.focus.x*2,0):t.ft.e(0,t.height-t.focus.y*2):t.ft.e(0,0),t.Rg=null,t.vg=null;return}const i=this.orthoAngle(t),e=i===90||i===270;let s=0;const n=t.children,o=n.length;for(let U=0;U<o;U++){const Y=n[U];s=Math.max(s,e?Y.mt.width:Y.mt.height)}const r=t.alignment,l=r===22,h=r===23,a=this.isBusAlignment(r),c=Math.max(0,t.breadthLimit),f=this.computeLayerSpacing(t),u=t.nodeSpacing,d=this.computeNodeIndent(t),m=t.rowSpacing;let g=0;(l||h)&&(g=Math.max(0,t.rowIndent));const p=t.width,y=t.height;let x=0,k=0,b=0,P=null,M=null,L=0,C=0,S=0,N=0,T=0,A=0,D=0,F=0,R=0;if(a&&!this.Jy(r)&&i>135&&n.reverse(),this.Jy(r))if(o>1)for(let U=0;U<o;U++)U%2===0&&U!==o-1?F=Math.max(F,e?n[U].mt.width:n[U].mt.height):U%2!==0&&(R=Math.max(R,e?n[U].mt.width:n[U].mt.height));else o===1&&(F=e?n[0].mt.width:n[0].mt.height);if(a){switch(r){case 24:let U;i<135?U=this.kD(t,n,F,R,x,k):U=this.PD(t,n,F,R,x,k),F=U.x,x=U.width,k=U.height;break;case 26:for(let Y=0;Y<o;Y++){const G=n[Y],H=G.mt,J=A===0?0:m;e?(G.B.e(s-H.width,N+J),x=Math.max(x,H.width),k=Math.max(k,N+J+H.height),N+=J+H.height):(G.B.e(S+J,s-H.height),x=Math.max(x,S+J+H.width),k=Math.max(k,H.height),S+=J+H.width),A++}break;case 27:for(let Y=0;Y<o;Y++){const G=n[Y],H=G.mt,J=A===0?0:m;e?(G.B.e(u/2+t.focus.x,N+J),x=Math.max(x,H.width),k=Math.max(k,N+J+H.height),N+=J+H.height):(G.B.e(S+J,u/2+t.focus.y),x=Math.max(x,S+J+H.width),k=Math.max(k,H.height),S+=J+H.width),A++}break}P=this.ae(2),M=this.ae(2),e?(P[0].e(0,0),P[1].e(0,k),M[0].e(x,0),M[1].e(x,k)):(P[0].e(0,0),P[1].e(x,0),M[0].e(0,k),M[1].e(x,k))}else for(let U=0;U<o;U++){const Y=n[U],G=Y.mt;if(e){c>0&&A>0&&S+u+G.width>c&&(S<s&&this._a(t,r,s-S,0,D,U-1),T++,A=0,D=U,b=k,S=0,N=i>135?-k-m:k+m),this.fk(Y,0,N);let H=0;if(A===0)P=Y.Rg,M=Y.vg,L=G.width,C=G.height,(P===null||M===null||i!==this.orthoAngle(Y))&&(P=this.ae(2),M=this.ae(2),P[0].e(0,0),P[1].e(0,C),M[0].e(L,0),M[1].e(L,C));else{const J=Util.nt(),z=this.MD(t,Y,P,M,L,C,J);H=z.x,P=J[0],M=J[1],L=z.width,C=z.height,Util.tt(J),S<G.width&&H<0&&(this.iu(t,-H,0,D,U-1),this.dk(P,-H,0),this.dk(M,-H,0),H=0)}Y.B.e(H,N),x=Math.max(x,L),k=Math.max(k,b+(T===0?0:m)+G.height),S=L}else{c>0&&A>0&&N+u+G.height>c&&(N<s&&this._a(t,r,0,s-N,D,U-1),T++,A=0,D=U,b=x,N=0,S=i>135?-x-m:x+m),this.fk(Y,S,0);let H=0;if(A===0)P=Y.Rg,M=Y.vg,L=G.width,C=G.height,(P===null||M===null||i!==this.orthoAngle(Y))&&(P=this.ae(2),M=this.ae(2),P[0].e(0,0),P[1].e(L,0),M[0].e(0,C),M[1].e(L,C));else{const J=Util.nt(),z=this.MD(t,Y,P,M,L,C,J);H=z.x,P=J[0],M=J[1],L=z.width,C=z.height,Util.tt(J),N<G.height&&H<0&&(this.iu(t,0,-H,D,U-1),this.dk(P,0,-H),this.dk(M,0,-H),H=0)}Y.B.e(S,H),k=Math.max(k,C),x=Math.max(x,b+(T===0?0:m)+G.width),N=C}A++}T>0&&(e?(k+=Math.max(0,f),S<x&&this._a(t,r,x-S,0,D,o-1),g>0&&(h||this.iu(t,g,0,0,o-1),x+=g)):(x+=Math.max(0,f),N<k&&this._a(t,r,0,k-N,D,o-1),g>0&&(h||this.iu(t,0,g,0,o-1),k+=g)));let v=0,O=0;switch(r){case 20:e?v+=x/2-t.focus.x-d/2:O+=k/2-t.focus.y-d/2;break;default:case 21:if(T>0)e?v+=x/2-t.focus.x-d/2:O+=k/2-t.focus.y-d/2;else{const Y=o;if(e){const G=n[0].B.x+n[0].ft.x,H=n[Y-1].B.x+n[Y-1].ft.x+n[Y-1].focus.x*2;v+=G+(H-G)/2-t.focus.x-d/2}else{const G=n[0].B.y+n[0].ft.y,H=n[Y-1].B.y+n[Y-1].ft.y+n[Y-1].focus.y*2;O+=G+(H-G)/2-t.focus.y-d/2}}break;case 22:e?(v-=d,x+=d):(O-=d,k+=d);break;case 23:e?(v+=x-t.width+d,x+=d):(O+=k-t.height+d,k+=d);break;case 24:e?o>1?v+=F+u/2-t.focus.x:v+=n[0].focus.x-t.focus.x+n[0].ft.x:o>1?O+=F+u/2-t.focus.y:O+=n[0].focus.y-t.focus.y+n[0].ft.y;break;case 26:e?v+=x+u/2-t.focus.x:O+=k+u/2-t.focus.y;break;case 27:break;case 28:const U=this.customAlignment(t,v,O,x,k);v=U[0],O=U[1],x=U[2],k=U[3];break}for(let U=0;U<o;U++){const Y=n[U];e?Y.B.e(Y.B.x+Y.ft.x-v,Y.B.y+(i>135?(a?-k:-Y.mt.height)+Y.ft.y-f:y+f+Y.ft.y)):Y.B.e(Y.B.x+(i>135?(a?-x:-Y.mt.width)+Y.ft.x-f:p+f+Y.ft.x),Y.B.y+Y.ft.y-O)}let B=0,X=0;if(a)e?(x=this.YN(t,x,v),v<0&&(v=0),i>135&&(O+=k+f),k+=y+f,r===27&&(B+=u/2+t.focus.x),X+=y+f):(i>135&&(v+=x+f),x+=p+f,k=this.GN(t,k,O),O<0&&(O=0),r===27&&(X+=u/2+t.focus.y),B+=p+f);else if(e){if(t.comments===null){if(p>x){const U=this.jN(r,p-x,0);B=U.x,X=U.y,x=p,v=0}}else x=this.YN(t,x,v);v<0&&(B-=v,v=0),i>135&&(O+=k+f),k=Math.max(Math.max(k,y),k+y+f),X+=y+f}else{if(i>135&&(v+=x+f),x=Math.max(Math.max(x,p),x+p+f),t.comments===null){if(y>k){const U=this.jN(r,0,y-k);B=U.x,X=U.y,k=y,O=0}}else k=this.GN(t,k,O);O<0&&(X-=O,O=0),B+=p+f}let E,V;if(T>0)E=this.ae(4),V=this.ae(4),e?(E[2].e(0,y+f),E[3].e(E[2].x,k),V[2].e(x,E[2].y),V[3].e(V[2].x,E[3].y)):(E[2].e(p+f,0),E[3].e(x,E[2].y),V[2].e(E[2].x,k),V[3].e(E[3].x,V[2].y));else{E=this.ae(P.length+2),V=this.ae(M.length+2);for(let U=0;U<P.length;U++){const Y=P[U];E[U+2].e(Y.x+B,Y.y+X)}for(let U=0;U<M.length;U++){const Y=M[U];V[U+2].e(Y.x+B,Y.y+X)}}e?(E[0].e(v,0),E[1].e(E[0].x,y),E[2].y<E[1].y&&(E[2].x>E[0].x?E[2].a(E[1]):E[1].a(E[2])),E[3].y<E[2].y&&(E[3].x>E[0].x?E[3].a(E[2]):E[2].a(E[3])),V[0].e(v+p,0),V[1].e(V[0].x,y),V[2].y<V[1].y&&(V[2].x<V[0].x?V[2].a(V[1]):V[1].a(V[2])),V[3].y<V[2].y&&(V[3].x<V[0].x?V[3].a(V[2]):V[2].a(V[3])),E[2].y-=f/2,V[2].y-=f/2):(E[0].e(0,O),E[1].e(p,E[0].y),E[2].x<E[1].x&&(E[2].y>E[0].y?E[2].a(E[1]):E[1].a(E[2])),E[3].x<E[2].x&&(E[3].y>E[0].y?E[3].a(E[2]):E[2].a(E[3])),V[0].e(0,O+y),V[1].e(p,V[0].y),V[2].x<V[1].x&&(V[2].y<V[0].y?V[2].a(V[1]):V[1].a(V[2])),V[3].x<V[2].x&&(V[3].y<V[0].y?V[3].a(V[2]):V[2].a(V[3])),E[2].x-=f/2,V[2].x-=f/2),this.tn(P),this.tn(M),t.Rg=E,t.vg=V,t.ft.e(v,O),t.mt.e(x,k)}dk(t,i,e){for(let s=0;s<t.length;s++){const n=t[s];n.x+=i,n.y+=e}}MD(t,i,e,s,n,o,r){const l=this.orthoAngle(t),h=l===90||l===270,a=t.nodeSpacing,c=e,f=s,u=n,d=o;let m=i.Rg,g=i.vg;const p=i.mt,y=h?Math.max(d,p.height):Math.max(u,p.width);if((m===null||l!==this.orthoAngle(i))&&(m=this.ae(2),g=this.ae(2),h?(m[0].e(0,0),m[1].e(0,p.height),g[0].e(p.width,0),g[1].e(g[0].x,m[1].y)):(m[0].e(0,0),m[1].e(p.width,0),g[0].e(0,p.height),g[1].e(m[1].x,g[0].y))),h){const x=u;let k=x-this.BI(f,m,x);return k+=a,e=this.UI(c,m,k),s=this.VI(f,g,k),n=Math.max(0,k)+p.width,o=y,this.tn(c),this.tn(m),this.tn(f),this.tn(g),r[0]=e,r[1]=s,new Rect(k,0,n,o)}else{const x=d;let k=x-this.zI(f,m,x);return k+=a,e=this.XI(c,m,k),s=this.KI(f,g,k),n=y,o=Math.max(0,k)+p.height,this.tn(c),this.tn(m),this.tn(f),this.tn(g),r[0]=e,r[1]=s,new Rect(k,0,n,o)}}XI(t,i,e){if(t===null||t.length<2||i===null||i.length<2)return null;const s=this.ae(t.length+i.length);let n=0,o=0,r=0;for(;o<i.length&&i[o].x<t[0].x;){const a=i[o++];s[r++].e(a.x,a.y+e)}for(;n<t.length;){const a=t[n++];s[r++].e(a.x,a.y)}const l=t[t.length-1].x;for(;o<i.length&&i[o].x<=l;)o++;for(;o<i.length&&i[o].x>l;){const a=i[o++];s[r++].e(a.x,a.y+e)}const h=this.ae(r);for(n=0;n<r;n++)h[n].a(s[n]);return this.tn(s),h}UI(t,i,e){if(t===null||t.length<2||i===null||i.length<2)return null;const s=this.ae(t.length+i.length);let n=0,o=0,r=0;for(;o<i.length&&i[o].y<t[0].y;){const a=i[o++];s[r++].e(a.x+e,a.y)}for(;n<t.length;){const a=t[n++];s[r++].e(a.x,a.y)}const l=t[t.length-1].y;for(;o<i.length&&i[o].y<=l;)o++;for(;o<i.length&&i[o].y>l;){const a=i[o++];s[r++].e(a.x+e,a.y)}const h=this.ae(r);for(n=0;n<r;n++)h[n].a(s[n]);return this.tn(s),h}KI(t,i,e){if(t===null||t.length<2||i===null||i.length<2)return null;const s=this.ae(t.length+i.length);let n=0,o=0,r=0;for(;n<t.length&&t[n].x<i[0].x;){const a=t[n++];s[r++].e(a.x,a.y)}for(;o<i.length;){const a=i[o++];s[r++].e(a.x,a.y+e)}const l=i[i.length-1].x;for(;n<t.length&&t[n].x<=l;)n++;for(;n<t.length&&t[n].x>l;){const a=t[n++];s[r++].e(a.x,a.y)}const h=this.ae(r);for(n=0;n<r;n++)h[n].a(s[n]);return this.tn(s),h}VI(t,i,e){if(t===null||t.length<2||i===null||i.length<2)return null;const s=this.ae(t.length+i.length);let n=0,o=0,r=0;for(;n<t.length&&t[n].y<i[0].y;){const a=t[n++];s[r++].e(a.x,a.y)}for(;o<i.length;){const a=i[o++];s[r++].e(a.x+e,a.y)}const l=i[i.length-1].y;for(;n<t.length&&t[n].y<=l;)n++;for(;n<t.length&&t[n].y>l;){const a=t[n++];s[r++].e(a.x,a.y)}const h=this.ae(r);for(n=0;n<r;n++)h[n].a(s[n]);return this.tn(s),h}zI(t,i,e){let s=9999999;if(t===null||t.length<2||i===null||i.length<2)return s;let n=0,o=0;for(;n<t.length&&o<i.length;){const r=t[n],l=i[o],h=l.x;let a=l.y;a+=e;let c=r;n+1<t.length&&(c=t[n+1]);let f=l,u=f.x,d=f.y;o+1<i.length&&(f=i[o+1],u=f.x,d=f.y,d+=e);let m=s;r.x===h?m=a-r.y:r.x>h&&r.x<u?m=a+(r.x-h)/(u-h)*(d-a)-r.y:h>r.x&&h<c.x&&(m=a-(r.y+(h-r.x)/(c.x-r.x)*(c.y-r.y))),m<s&&(s=m),c.x<=r.x?n++:u<=h?o++:(c.x<=u&&n++,u<=c.x&&o++)}return s}BI(t,i,e){let s=9999999;if(t===null||t.length<2||i===null||i.length<2)return s;let n=0,o=0;for(;n<t.length&&o<i.length;){const r=t[n],l=i[o];let h=l.x;const a=l.y;h+=e;let c=r;n+1<t.length&&(c=t[n+1]);let f=l,u=f.x,d=f.y;o+1<i.length&&(f=i[o+1],u=f.x,d=f.y,u+=e);let m=s;r.y===a?m=h-r.x:r.y>a&&r.y<d?m=h+(r.y-a)/(d-a)*(u-h)-r.x:a>r.y&&a<c.y&&(m=h-(r.x+(a-r.y)/(c.y-r.y)*(c.x-r.x))),m<s&&(s=m),c.y<=r.y?n++:d<=a?o++:(c.y<=d&&n++,d<=c.y&&o++)}return s}ae(t){const i=this.ck[t];if(i!==void 0){const s=i.pop();if(s!==void 0)return s}const e=[];for(let s=0;s<t;s++)e[s]=new Point;return e}tn(t){const i=t.length;let e=this.ck[i];e===void 0&&(e=[],this.ck[i]=e),e.push(t)}arrangeTrees(){if(this.Ki===52){const t=this.Ri.iterator;for(;t.next();){const i=t.value;if(!(i instanceof TreeVertex))continue;const e=i.node;if(e===null)continue;const s=e.position;let n=s.x,o=s.y;isFinite(n)||(n=0),isFinite(o)||(o=0),this.HN(i,n,o)}}else{const t=[],i=this.Ri.iterator;for(;i.next();){const o=i.value;o instanceof TreeVertex&&t.push(o)}switch(this.sorting){default:case 10:break;case 11:t.reverse();break;case 12:t.sort(this.comparer);break;case 13:t.sort(this.comparer),t.reverse();break}const e=this.arrangementOrigin;let s=e.x,n=e.y;for(let o=0;o<t.length;o++){const r=t[o];switch(this.HN(r,s+r.ft.x,n+r.ft.y),this.Ki){case 50:n+=r.mt.height+this.ks.height;break;default:case 51:s+=r.mt.width+this.ks.width;break}}}}HN(t,i,e){if(t===null)return;t.x=i,t.y=e;const s=t.children,n=s.length;for(let o=0;o<n;o++){const r=s[o];this.HN(r,i+r.B.x,e+r.B.y)}}commitLayout(){this.zy(),this.commitNodes(),this.VN(),this.isRouting&&this.commitLinks()}commitNodes(){const t=this.network.vertexes.iterator;for(;t.next();)t.value.commit();for(t.reset();t.next();){const i=t.value;this.layoutComments(i)}}VN(){if(this.layerStyle!==62)return;const t=this.zN,i=[];let e=null;const s=this.network.vertexes.iterator;for(;s.next();){const h=s.value;e===null?e=h.bounds.copy():e.unionRect(h.bounds);let a=i[h.level];a===void 0?a=this.computeLayerSpacing(h):a=Math.max(a,this.computeLayerSpacing(h)),i[h.level]=a}for(let h=0;h<i.length;h++)i[h]===void 0&&(i[h]=0);let n;this.angle===90||this.angle===270?(e.inflate(this.nodeSpacing/2,this.layerSpacing),n=new Point(-this.nodeSpacing/2,-this.layerSpacing/2)):(e.inflate(this.layerSpacing,this.nodeSpacing/2),n=new Point(-this.layerSpacing/2,-this.nodeSpacing/2));const o=[],r=this.angle===90||this.angle===270?e.width:e.height;let l=0;if(this.angle===180||this.angle===270)for(let h=0;h<t.length;h++)l+=t[h]+i[h];for(let h=0;h<t.length;h++){const a=t[h]+i[h];this.angle===270?(l-=a,o.push(new Rect(0,l,r,a))):this.angle===90?(o.push(new Rect(0,l,r,a)),l+=a):this.angle===180?(l-=a,o.push(new Rect(l,0,a,r))):(o.push(new Rect(l,0,a,r)),l+=a)}this.commitLayers(o,n)}commitLayers(t,i){}commitLinks(){const t=this.network.edges.iterator;for(;t.next();)t.value.commit()}zy(){const t=this.Ri.iterator;for(;t.next();){const i=t.value;i instanceof TreeVertex&&this.SD(i)}}SD(t){if(t===null)return;this.setPortSpots(t);const i=t.children,e=i.length;for(let s=0;s<e;s++){const n=i[s];this.SD(n)}}setPortSpots(t){const i=t.alignment;if(this.isBusAlignment(i))this.YI(t,i);else{const e=this.orthoAngle(t);if(this.hs===1){const s=t.destinationEdges;for(;s.next();){const o=s.value.link;if(o!==null){if(t.setsPortSpot)if(t.portSpot.isDefault())switch(e){case 0:o.fromSpot=Spot.MiddleRight;break;case 90:o.fromSpot=Spot.MiddleBottom;break;case 180:o.fromSpot=Spot.MiddleLeft;break;default:o.fromSpot=Spot.MiddleTop;break}else o.fromSpot=t.portSpot;if(t.setsChildPortSpot)if(t.childPortSpot.isDefault())switch(e){case 0:o.toSpot=Spot.MiddleLeft;break;case 90:o.toSpot=Spot.MiddleTop;break;case 180:o.toSpot=Spot.MiddleRight;break;default:o.toSpot=Spot.MiddleBottom;break}else o.toSpot=t.childPortSpot}}}else{const s=t.sourceEdges;for(;s.next();){const o=s.value.link;if(o!==null){if(t.setsPortSpot)if(t.portSpot.isDefault())switch(e){case 0:o.toSpot=Spot.MiddleRight;break;case 90:o.toSpot=Spot.MiddleBottom;break;case 180:o.toSpot=Spot.MiddleLeft;break;default:o.toSpot=Spot.MiddleTop;break}else o.toSpot=t.portSpot;if(t.setsChildPortSpot)if(t.childPortSpot.isDefault())switch(e){case 0:o.fromSpot=Spot.MiddleLeft;break;case 90:o.fromSpot=Spot.MiddleTop;break;case 180:o.fromSpot=Spot.MiddleRight;break;default:o.fromSpot=Spot.MiddleBottom;break}else o.fromSpot=t.childPortSpot}}}}}YI(t,i){const e=this.hs===1,s=this.orthoAngle(t);let n;switch(s){case 0:n=Spot.MiddleRight;break;case 90:n=Spot.MiddleBottom;break;case 180:n=Spot.MiddleLeft;break;default:n=Spot.MiddleTop;break}const o=t.children,r=o.length;switch(i){case 24:case 25:{for(let l=0;l<r;l++){const h=o[l],a=(e?h.sourceEdges:h.destinationEdges).first();if(a===null)continue;const c=a.link;if(c!==null){let f=s===90||s===270?Spot.MiddleLeft:Spot.MiddleTop;if(r===1||l===r-1&&r%2===1)switch(s){case 0:f=Spot.MiddleLeft;break;case 90:f=Spot.MiddleTop;break;case 180:f=Spot.MiddleRight;break;default:f=Spot.MiddleBottom;break}else l%2===0&&(f=s===90||s===270?Spot.MiddleRight:Spot.MiddleBottom);e?(t.setsPortSpot&&(c.fromSpot=n),t.setsChildPortSpot&&(c.toSpot=f)):(t.setsPortSpot&&(c.fromSpot=f),t.setsChildPortSpot&&(c.toSpot=n))}}break}case 26:{const l=s===90||s===270?Spot.MiddleRight:Spot.MiddleBottom,h=e?t.destinationEdges:t.sourceEdges;for(;h.next();){const c=h.value.link;c!==null&&(e?(t.setsPortSpot&&(c.fromSpot=n),t.setsChildPortSpot&&(c.toSpot=l)):(t.setsPortSpot&&(c.fromSpot=l),t.setsChildPortSpot&&(c.toSpot=n)))}break}case 27:{const l=s===90||s===270?Spot.MiddleLeft:Spot.MiddleTop,h=e?t.destinationEdges:t.sourceEdges;for(;h.next();){const c=h.value.link;c!==null&&(e?(t.setsPortSpot&&(c.fromSpot=n),t.setsChildPortSpot&&(c.toSpot=l)):(t.setsPortSpot&&(c.fromSpot=l),t.setsChildPortSpot&&(c.toSpot=n)))}break}}}orthoAngle(t){const i=t.angle;return i<=45?0:i<=135?90:i<=225?180:i<=315?270:0}computeLayerSpacing(t){const i=this.orthoAngle(t),e=i===90||i===270;let s=t.layerSpacing;if(t.layerSpacingParentOverlap>0){const n=Math.min(1,t.layerSpacingParentOverlap);s-=e?t.height*n:t.width*n}return s<(e?-t.height:-t.width)&&(s=e?-t.height:-t.width),s}computeNodeIndent(t){const i=this.orthoAngle(t),e=i===90||i===270;let s=t.nodeIndent;if(t.nodeIndentPastParent>0){const n=Math.min(1,t.nodeIndentPastParent);s+=e?t.width*n:t.height*n}return s=Math.max(0,s),s}get roots(){return this.Ri}set roots(t){this.Ri!==t&&(this.Ri=t,this.invalidateLayout())}get path(){return this.Ti}set path(t){this.Ti!==t&&(this.Ti=t,this.invalidateLayout())}get treeStyle(){return this.tu}set treeStyle(t){this.tu!==t&&(t===40||t===42||t===41||t===43)&&(this.tu=t,this.invalidateLayout())}get layerStyle(){return this.Fg}set layerStyle(t){this.Fg!==t&&(t===60||t===61||t===62)&&(this.Fg=t,this.invalidateLayout())}get comments(){return this.Re}set comments(t){this.Re!==t&&(Util.i(t,"boolean",TreeLayout,"comments"),this.Re=t,this.invalidateLayout())}get arrangement(){return this.Ki}set arrangement(t){this.Ki!==t&&(t===50||t===51||t===52)&&(this.Ki=t,this.invalidateLayout())}get arrangementSpacing(){return this.ks}set arrangementSpacing(t){this.ks.equals(t)||(this.ks.a(t),this.invalidateLayout())}get rootDefaults(){return this.V}set rootDefaults(t){this.V!==t&&(this.V=t,this.invalidateLayout())}get alternateDefaults(){return this.z}set alternateDefaults(t){this.z!==t&&(this.z=t,this.invalidateLayout())}get sorting(){return this.V.sorting}set sorting(t){this.V.sorting!==t&&(this.V.sorting=t,this.invalidateLayout())}get comparer(){return this.V.comparer}set comparer(t){this.V.comparer!==t&&(Util.i(t,"function",TreeLayout,"comparer"),this.V.comparer=t,this.invalidateLayout())}get angle(){return this.V.angle}set angle(t){this.V.angle!==t&&(Util.i(t,"number",TreeLayout,"angle"),t===0||t===90||t===180||t===270?(this.V.angle=t,this.invalidateLayout()):Util.o("TreeLayout.angle must be 0, 90, 180, or 270"))}get alignment(){return this.V.alignment}set alignment(t){this.V.alignment!==t&&(this.V.alignment=t,this.invalidateLayout())}get nodeIndent(){return this.V.nodeIndent}set nodeIndent(t){this.V.nodeIndent!==t&&(Util.i(t,"number",TreeLayout,"nodeIndent"),t>=0&&(this.V.nodeIndent=t,this.invalidateLayout()))}get nodeIndentPastParent(){return this.V.nodeIndentPastParent}set nodeIndentPastParent(t){this.V.nodeIndentPastParent!==t&&(Util.i(t,"number",TreeLayout,"nodeIndentPastParent"),t>=0&&t<=1&&(this.V.nodeIndentPastParent=t,this.invalidateLayout()))}get nodeSpacing(){return this.V.nodeSpacing}set nodeSpacing(t){this.V.nodeSpacing!==t&&(Util.i(t,"number",TreeLayout,"nodeSpacing"),this.V.nodeSpacing=t,this.invalidateLayout())}get layerSpacing(){return this.V.layerSpacing}set layerSpacing(t){this.V.layerSpacing!==t&&(Util.i(t,"number",TreeLayout,"layerSpacing"),this.V.layerSpacing=t,this.invalidateLayout())}get layerSpacingParentOverlap(){return this.V.layerSpacingParentOverlap}set layerSpacingParentOverlap(t){this.V.layerSpacingParentOverlap!==t&&(Util.i(t,"number",TreeLayout,"layerSpacingParentOverlap"),t>=0&&t<=1&&(this.V.layerSpacingParentOverlap=t,this.invalidateLayout()))}get compaction(){return this.V.compaction}set compaction(t){this.V.compaction!==t&&(t===30||t===31)&&(this.V.compaction=t,this.invalidateLayout())}get breadthLimit(){return this.V.breadthLimit}set breadthLimit(t){this.V.breadthLimit!==t&&(Util.i(t,"number",TreeLayout,"breadthLimit"),t>=0&&(this.V.breadthLimit=t,this.invalidateLayout()))}get rowSpacing(){return this.V.rowSpacing}set rowSpacing(t){this.V.rowSpacing!==t&&(Util.i(t,"number",TreeLayout,"rowSpacing"),this.V.rowSpacing=t,this.invalidateLayout())}get rowIndent(){return this.V.rowIndent}set rowIndent(t){this.V.rowIndent!==t&&(Util.i(t,"number",TreeLayout,"rowIndent"),t>=0&&(this.V.rowIndent=t,this.invalidateLayout()))}get commentSpacing(){return this.V.commentSpacing}set commentSpacing(t){this.V.commentSpacing!==t&&(Util.i(t,"number",TreeLayout,"commentSpacing"),this.V.commentSpacing=t,this.invalidateLayout())}get commentMargin(){return this.V.commentMargin}set commentMargin(t){this.V.commentMargin!==t&&(Util.i(t,"number",TreeLayout,"commentMargin"),this.V.commentMargin=t,this.invalidateLayout())}get setsPortSpot(){return this.V.setsPortSpot}set setsPortSpot(t){this.V.setsPortSpot!==t&&(Util.i(t,"boolean",TreeLayout,"setsPortSpot"),this.V.setsPortSpot=t,this.invalidateLayout())}get portSpot(){return this.V.portSpot}set portSpot(t){this.V.portSpot.equals(t)||(this.V.portSpot=t,this.invalidateLayout())}get setsChildPortSpot(){return this.V.setsChildPortSpot}set setsChildPortSpot(t){this.V.setsChildPortSpot!==t&&(Util.i(t,"boolean",TreeLayout,"setsChildPortSpot"),this.V.setsChildPortSpot=t,this.invalidateLayout())}get childPortSpot(){return this.V.childPortSpot}set childPortSpot(t){this.V.childPortSpot.equals(t)||(this.V.childPortSpot=t,this.invalidateLayout())}get alternateSorting(){return this.z.sorting}set alternateSorting(t){this.z.sorting!==t&&(this.z.sorting=t,this.invalidateLayout())}get alternateComparer(){return this.z.comparer}set alternateComparer(t){this.z.comparer!==t&&(Util.i(t,"function",TreeLayout,"alternateComparer"),this.z.comparer=t,this.invalidateLayout())}get alternateAngle(){return this.z.angle}set alternateAngle(t){this.z.angle!==t&&(Util.i(t,"number",TreeLayout,"alternateAngle"),(t===0||t===90||t===180||t===270)&&(this.z.angle=t,this.invalidateLayout()))}get alternateAlignment(){return this.z.alignment}set alternateAlignment(t){this.z.alignment!==t&&(this.z.alignment=t,this.invalidateLayout())}get alternateNodeIndent(){return this.z.nodeIndent}set alternateNodeIndent(t){this.z.nodeIndent!==t&&(Util.i(t,"number",TreeLayout,"alternateNodeIndent"),t>=0&&(this.z.nodeIndent=t,this.invalidateLayout()))}get alternateNodeIndentPastParent(){return this.z.nodeIndentPastParent}set alternateNodeIndentPastParent(t){this.z.nodeIndentPastParent!==t&&(Util.i(t,"number",TreeLayout,"alternateNodeIndentPastParent"),t>=0&&t<=1&&(this.z.nodeIndentPastParent=t,this.invalidateLayout()))}get alternateNodeSpacing(){return this.z.nodeSpacing}set alternateNodeSpacing(t){this.z.nodeSpacing!==t&&(Util.i(t,"number",TreeLayout,"alternateNodeSpacing"),this.z.nodeSpacing=t,this.invalidateLayout())}get alternateLayerSpacing(){return this.z.layerSpacing}set alternateLayerSpacing(t){this.z.layerSpacing!==t&&(Util.i(t,"number",TreeLayout,"alternateLayerSpacing"),this.z.layerSpacing=t,this.invalidateLayout())}get alternateLayerSpacingParentOverlap(){return this.z.layerSpacingParentOverlap}set alternateLayerSpacingParentOverlap(t){this.z.layerSpacingParentOverlap!==t&&(Util.i(t,"number",TreeLayout,"alternateLayerSpacingParentOverlap"),t>=0&&t<=1&&(this.z.layerSpacingParentOverlap=t,this.invalidateLayout()))}get alternateCompaction(){return this.z.compaction}set alternateCompaction(t){this.z.compaction!==t&&(t===30||t===31)&&(this.z.compaction=t,this.invalidateLayout())}get alternateBreadthLimit(){return this.z.breadthLimit}set alternateBreadthLimit(t){this.z.breadthLimit!==t&&(Util.i(t,"number",TreeLayout,"alternateBreadthLimit"),t>=0&&(this.z.breadthLimit=t,this.invalidateLayout()))}get alternateRowSpacing(){return this.z.rowSpacing}set alternateRowSpacing(t){this.z.rowSpacing!==t&&(Util.i(t,"number",TreeLayout,"alternateRowSpacing"),this.z.rowSpacing=t,this.invalidateLayout())}get alternateRowIndent(){return this.z.rowIndent}set alternateRowIndent(t){this.z.rowIndent!==t&&(Util.i(t,"number",TreeLayout,"alternateRowIndent"),t>=0&&(this.z.rowIndent=t,this.invalidateLayout()))}get alternateCommentSpacing(){return this.z.commentSpacing}set alternateCommentSpacing(t){this.z.commentSpacing!==t&&(Util.i(t,"number",TreeLayout,"alternateCommentSpacing"),this.z.commentSpacing=t,this.invalidateLayout())}get alternateCommentMargin(){return this.z.commentMargin}set alternateCommentMargin(t){this.z.commentMargin!==t&&(Util.i(t,"number",TreeLayout,"alternateCommentMargin"),this.z.commentMargin=t,this.invalidateLayout())}get alternateSetsPortSpot(){return this.z.setsPortSpot}set alternateSetsPortSpot(t){this.z.setsPortSpot!==t&&(Util.i(t,"boolean",TreeLayout,"alternateSetsPortSpot"),this.z.setsPortSpot=t,this.invalidateLayout())}get alternatePortSpot(){return this.z.portSpot}set alternatePortSpot(t){this.z.portSpot.equals(t)||(this.z.portSpot=t,this.invalidateLayout())}get alternateSetsChildPortSpot(){return this.z.setsChildPortSpot}set alternateSetsChildPortSpot(t){this.z.setsChildPortSpot!==t&&(Util.i(t,"boolean",TreeLayout,"alternateSetsChildPortSpot"),this.z.setsChildPortSpot=t,this.invalidateLayout())}get alternateChildPortSpot(){return this.z.childPortSpot}set alternateChildPortSpot(t){this.z.childPortSpot.equals(t)||(this.z.childPortSpot=t,this.invalidateLayout())}static PathDefault=0;static PathDestination=1;static PathSource=2;static SortingForwards=10;static SortingReverse=11;static SortingAscending=12;static SortingDescending=13;static AlignmentCenterSubtrees=20;static AlignmentCenterChildren=21;static AlignmentStart=22;static AlignmentEnd=23;static AlignmentBus=24;static AlignmentBusBranching=25;static AlignmentTopLeftBus=26;static AlignmentBottomRightBus=27;static CompactionNone=30;static CompactionBlock=31;static StyleLayered=40;static StyleLastParents=41;static StyleAlternating=42;static StyleRootOnly=43;static ArrangementVertical=50;static ArrangementHorizontal=51;static ArrangementFixedRoots=52;static LayerIndividual=60;static LayerSiblings=61;static LayerUniform=62}class TreeNetwork extends LayoutNetwork{constructor(t){super(t)}createVertex(){return new TreeVertex(this)}createEdge(){return new TreeEdge(this)}}class TreeVertex extends LayoutVertex{B;mt;ft;gk;mk;pk;yk;wk;xk;bk;Re;Rg;vg;pe;ye;Kt;ri;$y;Zy;Qy;Ps;_y;tw;iw;ew;sw;nw;ow;rw;lw;hw;aw;constructor(t){super(t),this.gk=!1,this.mk=null,this.pk=[],this.yk=0,this.wk=0,this.xk=0,this.bk=0,this.Re=null,this.B=new Point(0,0),this.mt=new Size(0,0),this.ft=new Point(0,0),this.Rg=null,this.vg=null,this.pe=10,this.ye=LayoutVertex.standardComparer,this.Kt=0,this.ri=21,this.$y=0,this.Zy=0,this.Qy=20,this.Ps=50,this._y=0,this.tw=31,this.iw=0,this.ew=25,this.sw=10,this.nw=10,this.ow=20,this.rw=!0,this.lw=Spot.Default,this.hw=!0,this.aw=Spot.Default}copyInheritedPropertiesFrom(t){t!==null&&(this.pe=t.sorting,this.ye=t.comparer,this.Kt=t.angle,this.ri=t.alignment,this.$y=t.nodeIndent,this.Zy=t.nodeIndentPastParent,this.Qy=t.nodeSpacing,this.Ps=t.layerSpacing,this._y=t.layerSpacingParentOverlap,this.tw=t.compaction,this.iw=t.breadthLimit,this.ew=t.rowSpacing,this.sw=t.rowIndent,this.nw=t.commentSpacing,this.ow=t.commentMargin,this.rw=t.setsPortSpot,this.lw=t.portSpot,this.hw=t.setsChildPortSpot,this.aw=t.childPortSpot)}get initialized(){return this.gk}set initialized(t){this.gk!==t&&(Util.i(t,"boolean",TreeVertex,"initialized"),this.gk=t)}get parent(){return this.mk}set parent(t){this.mk!==t&&(this.mk=t)}get children(){return this.pk}set children(t){if(this.pk!==t){if(t!==null&&!Array.isArray(t)&&Util.we(t,"Array",TreeVertex,"children:value"),t!==null){const i=t.length;for(let e=0;e<i;e++){const s=t[e]}}this.pk=t}}get level(){return this.yk}set level(t){this.yk!==t&&(Util.i(t,"number",TreeVertex,"level"),this.yk=t)}get descendantCount(){return this.wk}set descendantCount(t){this.wk!==t&&(Util.i(t,"number",TreeVertex,"descendantCount"),this.wk=t)}get maxChildrenCount(){return this.xk}set maxChildrenCount(t){this.xk!==t&&(Util.i(t,"number",TreeVertex,"maxChildrenCount"),this.xk=t)}get maxGenerationCount(){return this.bk}set maxGenerationCount(t){this.bk!==t&&(Util.i(t,"number",TreeVertex,"maxGenerationCount"),this.bk=t)}get comments(){return this.Re}set comments(t){if(this.Re!==t){if(t!==null&&!Array.isArray(t)&&Util.we(t,"Array",TreeVertex,"comments:value"),t!==null){const i=t.length;for(let e=0;e<i;e++){const s=t[e]}}this.Re=t}}get sorting(){return this.pe}set sorting(t){this.pe!==t&&(this.pe=t)}get comparer(){return this.ye}set comparer(t){this.ye!==t&&(Util.i(t,"function",TreeVertex,"comparer"),this.ye=t)}get angle(){return this.Kt}set angle(t){this.Kt!==t&&(Util.i(t,"number",TreeVertex,"angle"),this.Kt=t)}get alignment(){return this.ri}set alignment(t){this.ri!==t&&(this.ri=t)}get nodeIndent(){return this.$y}set nodeIndent(t){this.$y!==t&&(Util.i(t,"number",TreeVertex,"nodeIndent"),this.$y=t)}get nodeIndentPastParent(){return this.Zy}set nodeIndentPastParent(t){this.Zy!==t&&(Util.i(t,"number",TreeVertex,"nodeIndentPastParent"),this.Zy=t)}get nodeSpacing(){return this.Qy}set nodeSpacing(t){this.Qy!==t&&(Util.i(t,"number",TreeVertex,"nodeSpacing"),this.Qy=t)}get layerSpacing(){return this.Ps}set layerSpacing(t){this.Ps!==t&&(Util.i(t,"number",TreeVertex,"layerSpacing"),this.Ps=t)}get layerSpacingParentOverlap(){return this._y}set layerSpacingParentOverlap(t){this._y!==t&&(Util.i(t,"number",TreeVertex,"layerSpacingParentOverlap"),this._y=t)}get compaction(){return this.tw}set compaction(t){this.tw!==t&&(this.tw=t)}get breadthLimit(){return this.iw}set breadthLimit(t){this.iw!==t&&(Util.i(t,"number",TreeVertex,"breadthLimit"),this.iw=t)}get rowSpacing(){return this.ew}set rowSpacing(t){this.ew!==t&&(Util.i(t,"number",TreeVertex,"rowSpacing"),this.ew=t)}get rowIndent(){return this.sw}set rowIndent(t){this.sw!==t&&(Util.i(t,"number",TreeVertex,"rowIndent"),this.sw=t)}get commentSpacing(){return this.nw}set commentSpacing(t){this.nw!==t&&(Util.i(t,"number",TreeVertex,"commentSpacing"),this.nw=t)}get commentMargin(){return this.ow}set commentMargin(t){this.ow!==t&&(Util.i(t,"number",TreeVertex,"commentMargin"),this.ow=t)}get setsPortSpot(){return this.rw}set setsPortSpot(t){this.rw!==t&&(Util.i(t,"boolean",TreeVertex,"setsPortSpot"),this.rw=t)}get portSpot(){return this.lw}set portSpot(t){this.lw.equals(t)||(this.lw=t)}get setsChildPortSpot(){return this.hw}set setsChildPortSpot(t){this.hw!==t&&(Util.i(t,"boolean",TreeVertex,"setsChildPortSpot"),this.hw=t)}get childPortSpot(){return this.aw}set childPortSpot(t){this.aw.equals(t)||(this.aw=t)}get childrenCount(){return this.children.length}get relativePosition(){return this.B}set relativePosition(t){this.B.set(t)}get subtreeSize(){return this.mt}set subtreeSize(t){this.mt.set(t)}get subtreeOffset(){return this.ft}set subtreeOffset(t){this.ft.set(t)}}class TreeEdge extends LayoutEdge{kk;constructor(t){super(t),this.kk=new Point(0,0)}commit(){const t=this.link;if(t===null||t.isAvoiding)return;const i=this.network.layout;let e=null,s=null;switch(i.hs){case 1:e=this.fromVertex,s=this.toVertex;break;case 2:e=this.toVertex,s=this.fromVertex;break;default:Util.o("Unhandled path value "+i.hs.toString())}if(e===null||s===null)return;const n=this.kk;if(n.x===0&&n.y===0){this.GI(e,s);return}const o=e.bounds,r=i.orthoAngle(e),l=i.computeLayerSpacing(e),h=e.rowSpacing;t.updateRoute();const a=t.curve===9,c=t.isOrthogonal;let f=0,u,d;if(t.startRoute(),c||a){for(f=2;t.pointsCount>4;)t.removePoint(2);u=t.getPoint(1),d=t.getPoint(2)}else{for(f=1;t.pointsCount>3;)t.removePoint(1);u=t.getPoint(0),d=t.getPoint(t.pointsCount-1)}const m=t.getPoint(t.pointsCount-1);let g=0;r===0?(e.alignment===23?(g=o.bottom+n.y,n.y===0&&u.y>m.y+e.rowIndent&&(g=Math.min(g,Math.max(u.y,g-i.computeNodeIndent(e))))):e.alignment===22?(g=o.top+n.y,n.y===0&&u.y<m.y-e.rowIndent&&(g=Math.max(g,Math.min(u.y,g+i.computeNodeIndent(e))))):g=o.y+o.height/2+n.y,a?(t.insertPointAt(f,u.x,g),f++,t.insertPointAt(f,o.right+l,g),f++,t.insertPointAt(f,o.right+l+(n.x-h)/3,g),f++,t.insertPointAt(f,o.right+l+(n.x-h)*2/3,g),f++,t.insertPointAt(f,o.right+l+(n.x-h),g),f++,t.insertPointAt(f,d.x,g),f++):(c&&(t.insertPointAt(f,o.right+l/2,u.y),f++),t.insertPointAt(f,o.right+l/2,g),f++,t.insertPointAt(f,o.right+l+n.x-(c?h/2:h),g),f++,c&&(t.insertPointAt(f,t.getPoint(f-1).x,d.y),f++))):r===90?(e.alignment===23?(g=o.right+n.x,n.x===0&&u.x>m.x+e.rowIndent&&(g=Math.min(g,Math.max(u.x,g-i.computeNodeIndent(e))))):e.alignment===22?(g=o.left+n.x,n.x===0&&u.x<m.x-e.rowIndent&&(g=Math.max(g,Math.min(u.x,g+i.computeNodeIndent(e))))):g=o.x+o.width/2+n.x,a?(t.insertPointAt(f,g,u.y),f++,t.insertPointAt(f,g,o.bottom+l),f++,t.insertPointAt(f,g,o.bottom+l+(n.y-h)/3),f++,t.insertPointAt(f,g,o.bottom+l+(n.y-h)*2/3),f++,t.insertPointAt(f,g,o.bottom+l+(n.y-h)),f++,t.insertPointAt(f,g,d.y),f++):(c&&(t.insertPointAt(f,u.x,o.bottom+l/2),f++),t.insertPointAt(f,g,o.bottom+l/2),f++,t.insertPointAt(f,g,o.bottom+l+n.y-(c?h/2:h)),f++,c&&(t.insertPointAt(f,d.x,t.getPoint(f-1).y),f++))):r===180?(e.alignment===23?(g=o.bottom+n.y,n.y===0&&u.y>m.y+e.rowIndent&&(g=Math.min(g,Math.max(u.y,g-i.computeNodeIndent(e))))):e.alignment===22?(g=o.top+n.y,n.y===0&&u.y<m.y-e.rowIndent&&(g=Math.max(g,Math.min(u.y,g+i.computeNodeIndent(e))))):g=o.y+o.height/2+n.y,a?(t.insertPointAt(f,u.x,g),f++,t.insertPointAt(f,o.left-l,g),f++,t.insertPointAt(f,o.left-l+(n.x+h)/3,g),f++,t.insertPointAt(f,o.left-l+(n.x+h)*2/3,g),f++,t.insertPointAt(f,o.left-l+(n.x+h),g),f++,t.insertPointAt(f,d.x,g),f++):(c&&(t.insertPointAt(f,o.left-l/2,u.y),f++),t.insertPointAt(f,o.left-l/2,g),f++,t.insertPointAt(f,o.left-l+n.x+(c?h/2:h),g),f++,c&&(t.insertPointAt(f,t.getPoint(f-1).x,d.y),f++))):r===270?(e.alignment===23?(g=o.right+n.x,n.x===0&&u.x>m.x+e.rowIndent&&(g=Math.min(g,Math.max(u.x,g-i.computeNodeIndent(e))))):e.alignment===22?(g=o.left+n.x,n.x===0&&u.x<m.x-e.rowIndent&&(g=Math.max(g,Math.min(u.x,g+i.computeNodeIndent(e))))):g=o.x+o.width/2+n.x,a?(t.insertPointAt(f,g,u.y),f++,t.insertPointAt(f,g,o.top-l),f++,t.insertPointAt(f,g,o.top-l+(n.y+h)/3),f++,t.insertPointAt(f,g,o.top-l+(n.y+h)*2/3),f++,t.insertPointAt(f,g,o.top-l+(n.y+h)),f++,t.insertPointAt(f,g,d.y),f++):(c&&(t.insertPointAt(f,u.x,o.top-l/2),f++),t.insertPointAt(f,g,o.top-l/2),f++,t.insertPointAt(f,g,o.top-l+n.y+(c?h/2:h)),f++,c&&(t.insertPointAt(f,d.x,t.getPoint(f-1).y),f++))):Util.o("Invalid angle "+r),t.commitRoute()}GI(t,i){const e=this.link,s=this.network.layout,n=s.orthoAngle(t),o=s.orthoAngle(i);if(n===o)return;const r=s.computeLayerSpacing(t),l=t.bounds,h=i.bounds;if(n===0&&h.left-l.right<r+1||n===90&&h.top-l.bottom<r+1||n===180&&l.left-h.right<r+1||n===270&&l.top-h.bottom<r+1)return;e.updateRoute();const a=e.curve===9,c=e.isOrthogonal,f=this.fromVertex,u=s.isBusAlignment(f.alignment);if(e.startRoute(),n===0){const d=l.right+r/2;if(a){if(e.pointsCount===4){const m=e.getPoint(3).y;e.setPointAt(1,d-20,e.getPoint(1).y),e.insertPointAt(2,d-20,m),e.insertPointAt(3,d,m),e.insertPointAt(4,d+20,m),e.setPointAt(5,e.getPoint(5).x,m)}}else c?u?e.setPointAt(3,e.getPoint(2).x,e.getPoint(4).y):e.pointsCount===6&&(e.setPointAt(2,d,e.getPoint(2).y),e.setPointAt(3,d,e.getPoint(3).y)):e.pointsCount===4?e.insertPointAt(2,d,e.getPoint(2).y):e.pointsCount===3?e.setPointAt(1,d,e.getPoint(2).y):e.pointsCount===2&&e.insertPointAt(1,d,e.getPoint(1).y)}else if(n===90){const d=l.bottom+r/2;if(a){if(e.pointsCount===4){const m=e.getPoint(3).x;e.setPointAt(1,e.getPoint(1).x,d-20),e.insertPointAt(2,m,d-20),e.insertPointAt(3,m,d),e.insertPointAt(4,m,d+20),e.setPointAt(5,m,e.getPoint(5).y)}}else c?u?e.setPointAt(3,e.getPoint(2).x,e.getPoint(4).y):e.pointsCount===6&&(e.setPointAt(2,e.getPoint(2).x,d),e.setPointAt(3,e.getPoint(3).x,d)):e.pointsCount===4?e.insertPointAt(2,e.getPoint(2).x,d):e.pointsCount===3?e.setPointAt(1,e.getPoint(2).x,d):e.pointsCount===2&&e.insertPointAt(1,e.getPoint(1).x,d)}else if(n===180){const d=l.left-r/2;if(a){if(e.pointsCount===4){const m=e.getPoint(3).y;e.setPointAt(1,d+20,e.getPoint(1).y),e.insertPointAt(2,d+20,m),e.insertPointAt(3,d,m),e.insertPointAt(4,d-20,m),e.setPointAt(5,e.getPoint(5).x,m)}}else c?u?e.setPointAt(3,e.getPoint(2).x,e.getPoint(4).y):e.pointsCount===6&&(e.setPointAt(2,d,e.getPoint(2).y),e.setPointAt(3,d,e.getPoint(3).y)):e.pointsCount===4?e.insertPointAt(2,d,e.getPoint(2).y):e.pointsCount===3?e.setPointAt(1,d,e.getPoint(2).y):e.pointsCount===2&&e.insertPointAt(1,d,e.getPoint(1).y)}else if(n===270){const d=l.top-r/2;if(a){if(e.pointsCount===4){const m=e.getPoint(3).x;e.setPointAt(1,e.getPoint(1).x,d+20),e.insertPointAt(2,m,d+20),e.insertPointAt(3,m,d),e.insertPointAt(4,m,d-20),e.setPointAt(5,m,e.getPoint(5).y)}}else c?u?e.setPointAt(3,e.getPoint(2).x,e.getPoint(4).y):e.pointsCount===6&&(e.setPointAt(2,e.getPoint(2).x,d),e.setPointAt(3,e.getPoint(3).x,d)):e.pointsCount===4?e.insertPointAt(2,e.getPoint(2).x,d):e.pointsCount===3?e.setPointAt(1,e.getPoint(2).x,d):e.pointsCount===2&&e.insertPointAt(1,e.getPoint(1).x,d)}e.commitRoute()}get fromVertex(){return this.Je}set fromVertex(t){this.Je!==t&&(this.Je=t)}get toVertex(){return this.$e}set toVertex(t){this.$e!==t&&(this.$e=t)}get relativePoint(){return this.kk}set relativePoint(t){this.kk.set(t)}}class Themes{constructor(){}static Light={colors:{text:"#0a0a0a",comment:"#ca8a04",link:"#0a0a0a",group:"#a3a3a344",outline:"#a3a3a3",selection:"#0ea5e9",div:"#fff",gridMinor:"#e5e5e5",gridMajor:"#a3a3a3",overviewBox:"#c026d3",tempLink:"#2563eb",tempPort:"#c026d3",adornmentFill:"#0ea5e9",adornmentStroke:"#1e40af",dragSelect:"#c026d3"},fonts:{normal:"10pt sans-serif",bold:"bold 12pt sans-serif"},numbers:{group:1,selection:3},margins:{group:new Margin(5)},arrowheads:{toArrow:"Standard"}};static Dark={colors:{text:"#f5f5f5",comment:"#facc15",link:"#f5f5f5",group:"#a3a3a388",outline:"#a3a3a3",selection:"#38bdf8",div:"#171717",gridMinor:"#262626",gridMajor:"#404040",overviewBox:"#e879f9",tempLink:"#60a5fa",tempPort:"#e879f9",adornmentFill:"#38bdf8",adornmentStroke:"#2563eb",dragSelect:"#e879f9"},fonts:{normal:"10pt sans-serif",bold:"bold 12pt sans-serif"},numbers:{group:1,selection:3},margins:{group:new Margin(5)},arrowheads:{toArrow:"Standard"}}}class ThemeManager{ss=new Set;eu=new GMap;Pk="light";Mk="light";Sk=!1;Og="light";ND=t=>{const i=t.matches?"dark":"light";i!==this.Og&&(this.Og=i,this.Mk==="system"&&this.cw())};constructor(t){t&&Object.assign(this,t),t?.themeMap||(this.eu.set("light",{colors:{...Themes.Light.colors},fonts:{...Themes.Light.fonts},numbers:{...Themes.Light.numbers},margins:{...Themes.Light.margins},arrowheads:{...Themes.Light.arrowheads}}),this.eu.set("dark",{colors:{...Themes.Dark.colors},fonts:{...Themes.Dark.fonts},numbers:{...Themes.Dark.numbers},margins:{...Themes.Dark.margins},arrowheads:{...Themes.Dark.arrowheads}})),root.matchMedia&&(this.Og=root.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}get themeMap(){return this.eu}set themeMap(t){this.eu!==t&&(this.eu=t,this.cw())}get defaultTheme(){return this.Pk}set defaultTheme(t){this.Pk!==t&&(Util.i(t,"string",ThemeManager,"defaultTheme"),this.Pk=t,this.cw())}get currentTheme(){return this.Mk}set currentTheme(t){this.Mk!==t&&(Util.i(t,"string",ThemeManager,"currentTheme"),this.Mk=t,this.cw())}get changesDivBackground(){return this.Sk}set changesDivBackground(t){if(this.Sk!==t&&(this.Sk=t,t))for(const e of this.ss)e.setDivBackground(this.findValue("div","","fill")),e.v("ThemeChanged",this)}get preferredColorScheme(){return this.Og}addDiagram(t){return this.ss.add(t),this.qN(t),this}removeDiagram(t){return this.ss.delete(t),this.qN(t),this}XF(){this.ss.size===0&&root.matchMedia&&root.matchMedia("(prefers-color-scheme: dark)")?.addEventListener("change",this.ND)}KF(){this.ss.size===0&&root.matchMedia&&root.matchMedia("(prefers-color-scheme: dark)")?.removeEventListener("change",this.ND)}set(t,i){t===""&&(t=this.Pk),t==="system"&&(t=this.Og);let e=this.eu.get(t);return e?e=this.CD(e,i):e=i,this.eu.set(t,e),this.cw(),this}findValue(t,i,e){return this.getValue(this.findTheme(this.currentTheme),t,i,e)||this.getValue(this.findTheme(this.defaultTheme),t,i,e)}getValue(t,i,e,s){if(!t)return;e==null&&(e="");let n=t;const o=l=>{if(n===void 0||l==="")return;if(typeof l=="number"||!(Array.isArray(l)||l.includes(".")))return n[l];const h=Array.isArray(l)?l:l.split(".");for(let a=0;a<h.length;a++){const c=h[a];if(c!==""&&(n=n[c],n===void 0))return}return n},r=()=>{if(!(e!==""&&(n=o(e),n===void 0)))return Array.isArray(n)&&typeof i=="number"?n=n[i%n.length]:n=o(i),n};if(n=r(),n===void 0&&typeof s=="string"&&s.length>0){let l=t.targetPropertyMap?.get(s);if(l?n=t[l]:(l=ThemeManager.jI.get(s),n=l?t[l]:t.colors),n=r(),n!==void 0)return n}return n}findTheme(t){return this.themeMap.get(t==="system"?this.Og:t)}qN(t){const i=t.skipsUndoManager;t.skipsUndoManager=!0,t.updateAllThemeBindings(),this.Sk&&t.setDivBackground(this.findValue("div","","fill")),t.skipsUndoManager=i,t.v("ThemeChanged",this)}cw(){for(const t of this.ss)this.qN(t)}CD(t,i){for(const e in i)if(Util.fw(i,e))try{i[e].constructor===Object?t[e]=this.CD(t[e]??{},i[e]):t[e]=i[e]}catch{delete t[e]}return t}static jI=new Map([["background","colors"],["defaultColumnSeparatorStroke","colors"],["defaultRowSeparatorStroke","colors"],["shadowColor","colors"],["fill","colors"],["stroke","colors"],["font","fonts"],["angle","numbers"],["fromEndSegmentLength","numbers"],["fromShortLength","numbers"],["height","numbers"],["opacity","numbers"],["scale","numbers"],["toEndSegmentLength","numbers"],["toShortLength","numbers"],["width","numbers"],["defaultColumnSeparatorStrokeWidth","numbers"],["defaultRowSeparatorStrokeWidth","numbers"],["shadowBlur","numbers"],["corner","numbers"],["curviness","numbers"],["smoothness","numbers"],["parameter1","numbers"],["parameter2","numbers"],["strokeWidth","numbers"],["strokeDashOffset","numbers"],["maxLines","numbers"],["spacingAbove","numbers"],["spacingBelow","numbers"],["position","points"],["shadowOffset","points"],["desiredSize","sizes"],["maxSize","sizes"],["minSize","sizes"],["margin","margins"],["defaultSeparatorPadding","margins"],["padding","margins"],["alignment","spots"],["alignmentFocus","spots"],["fromSpot","spots"],["toSpot","spots"],["defaultAlignment","spots"],["spot1","spots"],["spot2","spots"],["verticalAlignment","spots"],["imageAlignment","spots"],["fromArrow","arrowheads"],["toArrow","arrowheads"]])}class Router{St;p;Ii;fl;constructor(){this.p=Diagram.wm(),this.St="",this.Ii=!0,this.fl=!0}get name(){return this.St}set name(t){this.St=t}get isEnabled(){return this.Ii}set isEnabled(t){this.Ii=t}get isRealtime(){return this.fl}set isRealtime(t){this.fl=t}get diagram(){return this.p}set diagram(t){this.p!==t&&(this.p=t,t.xl=!0,t.requestUpdate())}invalidateRouter(){this.p!==null&&(this.p.xl=!0,this.p.requestUpdate())}canRoute(t){if(!this.isEnabled)return!1;const i=this.diagram;return!(i&&(!this.isRealtime&&i.pu||i.animationManager.isTicking))}routeLinks(t,i){}toString(){return this.name!==""?this.name+" Router":Util.sn(this.constructor)}}class AvoidsNodesRouter extends Router{constructor(t){super(),this.name="AvoidsNodes",t&&Object.assign(this,t)}canRoute(t){return(t instanceof Diagram?t.jm:t.diagram.jm)?super.canRoute(t):!1}routeLinks(t,i){const e=i instanceof Diagram?null:i,s=t.iterator,n=this.diagram.getPositions(!0,e,null);for(;s.next();){const o=s.value;if(!o.isAvoiding||o.containingGroup!==e||o.toNode===null||o.fromNode===null||o.pointsCount<4)continue;o.startRoute();const r=o.pointsCount,l=o.getPoint(1),h=o.getPoint(r-2),a=o.fromNode.actualBounds.copy();a.inflate(Link.va,Link.va),a.unionPoint(o.getPoint(0));const c=o.toNode.actualBounds.copy();c.inflate(Link.va,Link.va),c.unionPoint(o.getPoint(r-1)),this.HI(o,a,c,n)&&this.qI(o,l,o.eN,h,o.sN,a,c,n),o.commitRoute()}}HI(t,i,e,s){const n=t.diagram,o=t.pointsCount;if(n===null||t.fromNode===t.toNode||t.layer.isTemporary||i.containsPoint(t.getPoint(o-1))&&!t.toNode.isMemberOf(t.fromNode)||e.containsPoint(t.getPoint(0))&&!t.fromNode.isMemberOf(t.toNode)||!t.isOrthogonal)return!1;if(t.segmentIndex===17)return!0;const r=t.getPoint(1),l=t.getPoint(o-2),h=t.getPoint(2);if(!s.isUnoccupied(Math.min(r.x,h.x),Math.min(r.y,h.y),Math.abs(r.x-h.x),Math.abs(r.y-h.y)))return!0;for(let c=2;c<o-3;c++){const f=t.getPoint(c),u=t.getPoint(c+1);if(!s.isUnoccupied(Math.min(f.x,u.x),Math.min(f.y,u.y),Math.abs(f.x-u.x),Math.abs(f.y-u.y)))return!0}const a=t.getPoint(o-3);return!s.isUnoccupied(Math.min(a.x,l.x),Math.min(a.y,l.y),Math.abs(a.x-l.x),Math.abs(a.y-l.y))}qI(t,i,e,s,n,o,r,l){const h=t.diagram,a=i,c=s;let f=null,u=null;if(h.isVirtualized){const g=l.bounds.copy(),p=t.getPoint(2),y=t.getPoint(t.pointsCount-3);g.inflate(-l.cellWidth,-l.cellHeight);const x=Point.l();l.Vd(i.x,i.y)||(Geo.ml(g.x,g.y,g.x+g.width,g.y+g.height,i.x,i.y,p.x,p.y,x)?(f=i=x.copy(),e=x.directionPoint(p)):Geo.ml(g.x,g.y,g.x+g.width,g.y+g.height,p.x,p.y,y.x,y.y,x)?(f=i=x.copy(),e=x.directionPoint(y)):Geo.ml(g.x,g.y,g.x+g.width,g.y+g.height,y.x,y.y,s.x,s.y,x)&&(f=i=x.copy(),e=x.directionPoint(s))),l.Vd(s.x,s.y)||(Geo.ml(g.x,g.y,g.x+g.width,g.y+g.height,s.x,s.y,y.x,y.y,x)?(u=s=x.copy(),n=y.directionPoint(x)):Geo.ml(g.x,g.y,g.x+g.width,g.y+g.height,y.x,y.y,p.x,p.y,x)?(u=s=x.copy(),n=p.directionPoint(x)):Geo.ml(g.x,g.y,g.x+g.width,g.y+g.height,p.x,p.y,i.x,i.y,x)&&(u=s=x.copy(),n=i.directionPoint(x))),Point.s(x)}const d=o.copy().unionRect(r);d.inflate(l.cellWidth*l.Gc,l.cellHeight*l.Gc),l.hT(i,e,s,n,d,!0);let m=l.fo(s.x,s.y);if(!l.by&&m>=PositionArray.Ud&&(l.YL(),d.inflate(l.cellWidth*l.OS,l.cellHeight*l.IS),l.hT(i,e,s,n,d,!1),m=l.fo(s.x,s.y)),!l.by&&m<PositionArray.Ud&&!l.cO(s.x,s.y)){t.points.removeRange(2,t.pointsCount-3),this.WN(t,l,s.x,s.y,n,!0);const g=0,p=90,y=180,x=270,k=t.getPoint(2);if(t.pointsCount<4)e===g||e===y?(k.x=i.x,k.y=s.y):(k.x=s.x,k.y=i.y),t.setPointAt(2,k.x,k.y),t.insertPointAt(3,k.x,k.y);else{const b=t.getPoint(3);if(e===g||e===y)if(Geo.u(k.x,b.x)){const P=e===g?Math.max(k.x,i.x):Math.min(k.x,i.x);t.setPointAt(2,P,i.y),t.setPointAt(3,P,b.y)}else Geo.u(k.y,b.y)?(Math.abs(i.y-k.y)<=l.cellHeight/2&&(t.setPointAt(2,k.x,i.y),t.setPointAt(3,b.x,i.y)),t.insertPointAt(2,k.x,i.y)):t.setPointAt(2,i.x,k.y);else if(e===p||e===x)if(Geo.u(k.y,b.y)){const P=e===p?Math.max(k.y,i.y):Math.min(k.y,i.y);t.setPointAt(2,i.x,P),t.setPointAt(3,b.x,P)}else Geo.u(k.x,b.x)?(Math.abs(i.x-k.x)<=l.cellWidth/2&&(t.setPointAt(2,i.x,k.y),t.setPointAt(3,i.x,b.y)),t.insertPointAt(2,i.x,k.y)):t.setPointAt(2,k.x,i.y)}if(f!==null){const b=t.getPoint(1),P=t.getPoint(2);b.x!==P.x&&b.y!==P.y?e===g||e===y?t.insertPointAt(2,b.x,P.y):t.insertPointAt(2,P.x,b.y):e===g||e===y?t.insertPointAt(2,a.x,f.y):t.insertPointAt(2,f.x,a.y)}u!==null&&(n===g||n===y?t.insertPointAt(t.pointsCount-2,c.x,u.y):t.insertPointAt(t.pointsCount-2,u.x,c.y))}}WN(t,i,e,s,n,o){const c=i.cellWidth,f=i.cellHeight;let u=i.fo(e,s),d=e,m=s,g=d,p=m;for(n===0?g+=c:n===90?p+=f:n===180?g-=c:p-=f,t.rN&&u>PositionArray.Ba&&i.fo(g,p)!==u-1&&(i.fo(d-c,m)===u-1?(n=180,g=d-c,p=m):i.fo(d+c,m)===u-1?(n=0,g=d+c,p=m):i.fo(d,m-f)===u-1?(n=270,g=d,p=m-f):i.fo(d,m+f)===u-1&&(n=90,g=d,p=m+f));u>PositionArray.Ba&&i.fo(g,p)===u-1;)d=g,m=p,n===0?g+=c:n===90?p+=f:n===180?g-=c:p-=f,u-=1;if(o?u>PositionArray.Ba&&(n===180||n===0?d=Math.floor(d/c)*c+c/2:(n===90||n===270)&&(m=Math.floor(m/f)*f+f/2)):(d=Math.floor(d/c)*c+c/2,m=Math.floor(m/f)*f+f/2),u>PositionArray.Ba){let y=n,x=d,k=m;if(n===0?(y=90,k+=f):n===90?(y=180,x-=c):n===180?(y=270,k-=f):n===270&&(y=0,x+=c),i.fo(x,k)===u-1)this.WN(t,i,x,k,y,!1);else{let P=d,M=m;n===0?(y=270,M-=f):n===90?(y=0,P+=c):n===180?(y=90,M+=f):n===270&&(y=180,P-=c),i.fo(P,M)===u-1&&this.WN(t,i,P,M,y,!1)}}t.insertPointAt(t.pointsCount-2,d,m)}}ToolManager.prototype.initializeStandardTools=function(){this.$t("Action",new ActionTool,this.mouseDownTools),this.$t("Relinking",new RelinkingTool,this.mouseDownTools),this.$t("LinkReshaping",new LinkReshapingTool,this.mouseDownTools),this.$t("Rotating",new RotatingTool,this.mouseDownTools),this.$t("Resizing",new ResizingTool,this.mouseDownTools),this.$t("Linking",new LinkingTool,this.mouseMoveTools),this.$t("Dragging",new DraggingTool,this.mouseMoveTools),this.$t("DragSelecting",new DragSelectingTool,this.mouseMoveTools),this.$t("Panning",new PanningTool,this.mouseMoveTools),this.$t("ContextMenu",new ContextMenuTool,this.mouseUpTools),this.$t("TextEditing",new TextEditingTool,this.mouseUpTools),this.$t("ClickCreating",new ClickCreatingTool,this.mouseUpTools),this.$t("ClickSelecting",new ClickSelectingTool,this.mouseUpTools)};Diagram.mS("GraphLinksModel",GraphLinksPartManager);Diagram.mS("TreeModel",TreePartManager);const oldGo=root.go,go={get version(){return Diagram.version},Group,List,Set:GSet,Map:GMap,Point,Size,Rect,Margin,Spot,Geometry,PathFigure,PathSegment,InputEvent,DiagramEvent,ChangedEvent,Model,GraphLinksModel,TreeModel,Binding,ThemeBinding,Transaction,UndoManager,CommandHandler,Tool,DraggingTool,DraggingInfo,DraggingOptions,LinkingBaseTool,LinkingTool,RelinkingTool,LinkReshapingTool,ResizingTool,RotatingTool,ClickSelectingTool,ActionTool,ClickCreatingTool,HTMLInfo,ContextMenuTool,DragSelectingTool,PanningTool,TextEditingTool,ToolManager,Animation,AnimationManager,AnimationTrigger,Layer,Diagram,Palette,Overview,Brush,GraphObject,Panel,RowColumnDefinition,Shape,TextBlock,Picture,Part,Adornment,Node,Link,Placeholder,Layout,LayoutNetwork,LayoutVertex,LayoutEdge,GridLayout,PanelLayout,CircularLayout,CircularNetwork,CircularVertex,CircularEdge,ForceDirectedLayout,ForceDirectedNetwork,ForceDirectedVertex,ForceDirectedEdge,LayeredDigraphLayout,LayeredDigraphNetwork,LayeredDigraphVertex,LayeredDigraphEdge,TreeLayout,TreeNetwork,TreeVertex,TreeEdge,Themes,ThemeManager,Router,AnimationStyle,AutoScale,CycleMode,Flip,TextFormat,ImageStretch,LayoutConditions,LinkAdjusting,Curve,Routing,Orientation,TextOverflow,PortSpreading,ScrollMode,CollapsePolicy,Sizing,TriggerStart,Stretch,ViewboxStretch,Wrap,BrushType,ColorSpace,GeometryStretch,GeometryType,SegmentType,BindingMode,ChangeType,CircularArrangement,CircularDirection,CircularNodeDiameterFormula,CircularSorting,GridAlignment,GridArrangement,GridSorting,LayeredDigraphAggressive,LayeredDigraphAlign,LayeredDigraphCycleRemove,LayeredDigraphInit,LayeredDigraphLayering,LayeredDigraphPack,TreeAlignment,TreeArrangement,TreeCompaction,TreeLayerStyle,TreePath,TreeSorting,TreeStyle,GestureMode,LinkingDirection,ReshapingBehavior,TextEditingAccept,TextEditingStarting,TextEditingState,WheelMode};for(const w in go){const t=go[w];typeof t=="function"&&(t.className=w)}typeof oldGo=="object"&&oldGo.version&&Util.ei("WARNING: a `go` object on the root object is already defined.  "+("Debug"in oldGo?"debug ":"")+"version: "+oldGo.version+", replaced with version: "+go.version);Diagram.prototype.go=go;root.go=go;
})();
  "function"===typeof define&&define.amd&&define("undefined"!==typeof global?global.go:self.go);
  'undefined'!==typeof module&&'object'===typeof module.exports&&(module.exports='undefined'!==typeof global?global.go:self.go);
  